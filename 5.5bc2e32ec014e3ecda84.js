(function(){(this||window).webpackJsonp.registerAbsMids({"esri/renderers/visualVariables/support/visualVariableUtils":253})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{253:function(e,a,r){var i,n;i=[r.dj.c(e.i),a,r(70),r(77),r(37),r(40),r(110),r(347)],void 0===(n=function(e,a,r,i,n,t,s,l){function o(e,a,i){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"color"===e.type})[0]:e;if(n){if("esri.renderers.visualVariables.ColorVariable"!==n.declaredClass)return void m.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");var s="number"==typeof a,l=s?null:a,o=l&&l.attributes,u=s?a:null,c=n.field,v=n.cache,f=v.ipData,d=v.hasExpression,p=n.cache.compiledFunc;if(!c&&!d){var b=n.stops;return b&&b[0]&&b[0].color}if("number"!=typeof u)if(d){if(!t.isSome(i)||!t.isSome(i.arcade))return void m.error("Use of arcade expressions requires an arcade context");var V={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},x=i.arcade.arcadeUtils,w=x.getViewInfo(V),y=x.createExecContext(l,w);if(!p){var g=x.createSyntaxTree(n.valueExpression);p=x.createFunction(g),n.cache.compiledFunc=p}u=x.executeFunction(p,y)}else o&&(u=o[c]);var S=n.normalizationField,z=o?parseFloat(o[S]):void 0;if(null!=u&&(!S||s||!isNaN(z)&&0!==z)){isNaN(z)||s||(u/=z);var F=h(u,f);if(F){var N=F[0],M=F[1],E=N===M?n.stops[N].color:r.blendColors(n.stops[N].color,n.stops[M].color,F[2],t.isSome(i)?i.color:void 0);return new r(E)}}}}function u(e,a,r){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"opacity"===e.type})[0]:e;if(i){if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void m.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");var n="number"==typeof a,s=n?null:a,l=s&&s.attributes,o=n?a:null,u=i.field,c=i.cache,v=c.ipData,f=c.hasExpression,d=i.cache.compiledFunc;if(!u&&!f){var p=i.stops;return p&&p[0]&&p[0].opacity}if("number"!=typeof o)if(f){if(t.isNone(r)||t.isNone(r.arcade))return void m.error("Use of arcade expressions requires an arcade context");var b={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},V=r.arcade.arcadeUtils,x=V.getViewInfo(b),w=V.createExecContext(s,x);if(!d){var y=V.createSyntaxTree(i.valueExpression);d=V.createFunction(y),i.cache.compiledFunc=d}o=V.executeFunction(d,w)}else l&&(o=l[u]);var g=i.normalizationField,S=l?parseFloat(l[g]):void 0;if(null!=o&&(!g||n||!isNaN(S)&&0!==S)){isNaN(S)||n||(o/=S);var z=h(o,v);if(z){var F=z[0],N=z[1];if(F===N)return i.stops[F].opacity;var M=i.stops[F].opacity;return M+(i.stops[N].opacity-M)*z[2]}}}}function c(e,a,r){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"rotation"===e.type})[0]:e;if(i){if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void m.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");var n=i.axis||"heading",s="heading"===n&&"arithmetic"===i.rotationType?90:0,l="heading"===n&&"arithmetic"===i.rotationType?-1:1,o="number"==typeof a?null:a,u=o&&o.attributes,c=i.field,v=i.cache.hasExpression,f=i.cache.compiledFunc,d=0;if(!c&&!v)return d;if(v){if(t.isNone(r)||t.isNone(r.arcade))return void m.error("Use of arcade expressions requires an arcade context");var p={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},b=r.arcade.arcadeUtils,h=b.getViewInfo(p),V=b.createExecContext(o,h);if(!f){var x=b.createSyntaxTree(i.valueExpression);f=b.createFunction(x),i.cache.compiledFunc=f}d=b.executeFunction(f,V)}else u&&(d=u[c]||0);return"number"!=typeof d||isNaN(d)?null:s+l*d}}function v(e,a,r){var i="number"==typeof a,n=i?null:a,s=n&&n.attributes,o=i?a:null,u=e.cache.isScaleDriven,c=e.cache.compiledFunc;if(u){var v=t.isSome(r)?r.scale:void 0,f=t.isSome(r)?r.view:void 0;o=null==v||f&&"3d"===f.type?function(e){var a=null,r=null,i=e.stops;return i?(a=i[0].value,r=i[i.length-1].value):(a=e.minDataValue||0,r=e.maxDataValue||0),(a+r)/2}(e):v}else if(!i)switch(e.inputValueType){case"expression":if(t.isNone(r)||t.isNone(r.arcade))return void m.error("Use of arcade expressions requires an arcade context");var d={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},p=r.arcade.arcadeUtils,b=p.getViewInfo(d),h=p.createExecContext(n,b);if(!c){var V=p.createSyntaxTree(e.valueExpression);c=p.createFunction(V),e.cache.compiledFunc=c}o=p.executeFunction(c,h);break;case"field":s&&(o=s[e.field]);break;case"unknown":o=null}if(!l.isValidNumber(o))return null;if(i||!e.normalizationField)return o;var x=s?parseFloat(s[e.normalizationField]):null;return l.isValidNumber(x)&&0!==x?o/x:null}function f(e,a,r){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"size"===e.type})[0]:e;if(i){if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void m.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");var n=b(v(i,a,r),i,a,r,i.cache.ipData);return null==n||isNaN(n)?0:n}}function d(e,a,r){return null==e?null:l.isSizeVariable(e)?f(e,a,r):l.isValidNumber(e)?e:null}function p(e,a,r){return l.isValidNumber(r)&&e>r?r:l.isValidNumber(a)&&e<a?a:e}function b(e,a,r,i,n){switch(a.transformationType){case"additive":return function(e,a,r,i){return e+(d(a.minSize,r,i)||a.minDataValue)}(e,a,r,i);case"constant":return function(e,a,r){var i=e.stops,n=i&&i.length&&i[0].size;return null==n&&(n=e.minSize),d(n,a,r)}(a,r,i);case"clamped-linear":return function(e,a,r,i){var n=(e-a.minDataValue)/(a.maxDataValue-a.minDataValue),s=d(a.minSize,r,i),l=d(a.maxSize,r,i),o=t.isSome(i)?i.shape:void 0;if(e<=a.minDataValue)return s;if(e>=a.maxDataValue)return l;if("area"===a.scaleBy&&o){var u="circle"===o,c=u?x*Math.pow(s/2,2):s*s,v=c+n*((u?x*Math.pow(l/2,2):l*l)-c);return u?2*Math.sqrt(v/x):Math.sqrt(v)}return s+n*(l-s)}(e,a,r,i);case"proportional":return function(e,a,r,i){var n=t.isSome(i)?i.shape:void 0,s=e/a.minDataValue,l=d(a.minSize,r,i),o=d(a.maxSize,r,i);return p("circle"===n?2*Math.sqrt(s*Math.pow(l/2,2)):"square"===n||"diamond"===n||"image"===n?Math.sqrt(s*Math.pow(l,2)):s*l,l,o)}(e,a,r,i);case"stops":return function(e,a,r,i,n){var t=h(e,n),s=t[0],l=t[1],o=t[2];if(s===l)return d(a.stops[s].size,r,i);var u=d(a.stops[s].size,r,i);return u+(d(a.stops[l].size,r,i)-u)*o}(e,a,r,i,n);case"real-world-size":return function(e,a,r,i){var n=(t.isSome(i)&&i.resolution?i.resolution:1)*s.meterIn[a.valueUnit],l=d(a.minSize,r,i),o=d(a.maxSize,r,i),u=a.valueRepresentation;return p("area"===u?2*Math.sqrt(e/x)/n:"radius"===u||"distance"===u?2*e/n:e/n,l,o)}(e,a,r,i);case"identity":return function(e){return e}(e);case"unknown":return null}}function h(e,a){if(a){var r=0,i=a.length-1;return a.some(function(a,n){return e<a?(i=n,!0):(r=n,!1)}),[r,i,(e-a[r])/(a[i]-a[r])]}}Object.defineProperty(a,"__esModule",{value:!0});var m=n.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),V=new i,x=Math.PI;a.getColor=o,a.getOpacity=u,a.getRotationAngle=c,a.getSize=f,a.getSizeFromNumberOrVariable=d,a.getSizeForValue=b,a.getSizeRangeAtScale=function(e,a,r){var i=e.cache.isScaleDriven,n=r&&"3d"===r.type;if(!(i&&n||a))return null;var t={scale:a,view:r},s=d(e.minSize,V,t),l=d(e.maxSize,V,t);if(null!=s||null!=l){if(s>l){var o=l;l=s,s=o}return{minSize:s,maxSize:l}}},a.getVisualVariableValues=function(e,a,r){if(e.visualVariables){for(var i=[],n=[],t=[],s=[],l=[],v=0,d=e.visualVariables;v<d.length;v++){var p=d[v];switch(p.type){case"color":n.push(p);break;case"opacity":t.push(p);break;case"rotation":l.push(p);break;case"size":s.push(p)}}return n.forEach(function(e){var n=o(e,a,r);i.push({variable:e,value:n})}),t.forEach(function(e){var n=u(e,a,r);i.push({variable:e,value:n})}),l.forEach(function(e){var n=c(e,a,r);i.push({variable:e,value:n})}),s.forEach(function(e){var n=f(e,a,r);i.push({variable:e,value:n})}),i.filter(function(e){return null!=e.value})}}}.apply(null,i))||(e.exports=n)}}]);