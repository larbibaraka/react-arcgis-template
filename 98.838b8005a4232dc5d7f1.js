(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/support/FieldsIndex":148,"esri/layers/graphics/data/QueryEngineCapabilities":294,"esri/layers/graphics/sources/support/CSVSourceWorker":575,"dstore/Csv":576})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[98,112],{148:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(43)],void 0===(r=function(e,t,i){function n(e){return"date"===e.type||"esriFieldTypeDate"===e.type}function r(e){return e.toLowerCase().trim()}return function(){function e(e){if(this.fields=e,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],e){for(var t=[],i=0,o=e;i<o.length;i++){var s=o[i],a=s&&s.name;if(a){var l=r(a);this._fieldsMap.set(a,s),this._fieldsMap.set(l,s),t.push(l),n(s)&&(this.dateFields.push(s),this._dateFieldsSet.add(s))}}t.sort(),this.uid=t.join(",")}}return e.prototype.destroy=function(){this._fieldsMap.clear()},e.prototype.has=function(e){return null!=this.get(e)},e.prototype.get=function(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(r(e)):void 0},e.prototype.isDateField=function(e){return this._dateFieldsSet.has(this.get(e))},e.prototype.normalizeFieldName=function(e){var t=this.get(e);if(t)return t.name},e}()}.apply(null,n))||(e.exports=r)},294:function(e,t,i){var n,r;n=[i.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,n))||(e.exports=r)},575:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(31),i(32),i(444),i(576),i(42),i(44),i(36),i(49),i(38),i(34),i(39),i(289),i(63),i(90),i(246),i(162),i(267),i(163),i(229),i(581),i(148)],void 0===(r=function(e,t,i,n,r,o,s,a,l,u,d,f,p,c,h,m,y,v,g,F,_,N,I){Object.defineProperty(t,"__esModule",{value:!0});var w=N.createDrawingInfo("esriGeometryPoint"),x=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"];t.csvLatitudeFieldNames=["lat","latitude","y","ycenter","latitude83","latdecdeg","point-y"],t.csvLongitudeFieldNames=["lon","lng","long","longitude","x","xcenter","longitude83","longdecdeg","point-x"],t.csvDetectedDelimiters=[","," ",";","|","\t"];var b=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,T=[0,0],D=function(){return function(e,t){this.x=e,this.y=t}}(),E=function(){var e=r._parseInfo(),t=new RegExp("^"+e.regexp+"$"),i=new RegExp("["+e.group+"\\s\\xa0]","g"),n=e.factor;return function(r){var o=t.exec(r);if(e.factor=n,!o)return NaN;var s=o[1];if(!o[1]){if(!o[2])return NaN;s=o[2],e.factor*=-1}return+(s=s.replace(i,"").replace(e.decimal,"."))*e.factor}}(),S="isInteger"in Number?Number.isInteger:function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},C=function(){function e(){this._fieldsIndex=null,this._queryEngine=null}return e.prototype.destroy=function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=null,this._fieldsIndex=null},e.prototype.load=function(e,t){return void 0===t&&(t={}),n(this,void 0,void 0,function(){var n,r,o,s,a;return i(this,function(i){switch(i.label){case 0:return[4,f.all([this._fetch(e.url,t),this._checkProjection(t&&e.parsing&&e.parsing.spatialReference)])];case 1:return n=i.sent()[0],r=this._parse(n,e.parsing),this._queryEngine=this._createQueryEngine(n,r),r.layerDefinition.extent=this._queryEngine.fullExtent,r.layerDefinition.timeInfo&&(o=this._queryEngine.timeExtent,s=o.start,a=o.end,r.layerDefinition.timeInfo.timeExtent=[s,a]),[2,r]}})})},e.prototype.applyEdits=function(){return n(this,void 0,void 0,function(){return i(this,function(e){throw new l("csv-source:editing-not-supported","applyEdits() is not supported on CSVLayer")})})},e.prototype.queryFeatures=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),n(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQuery(e,t.signal)]})})},e.prototype.queryFeatureCount=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),n(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQueryForCount(e,t.signal)]})})},e.prototype.queryObjectIds=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),n(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQueryForIds(e,t.signal)]})})},e.prototype.queryExtent=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),n(this,void 0,void 0,function(){return i(this,function(i){return[2,this._queryEngine.executeQueryForExtent(e,t.signal)]})})},e.prototype._fetch=function(e,t){return n(this,void 0,void 0,function(){var n;return i(this,function(i){switch(i.label){case 0:if(!e)throw new l("csv-source:invalid-source","url not defined");return n=p.urlToObject(e),[4,a(n.path,{query:n.query,responseType:"text",signal:t.signal})];case 1:return[2,i.sent().data]}})})},e.prototype._parse=function(e,t){void 0===t&&(t={});for(var i={columnDelimiter:t.columnDelimiter,layerDefinition:null,locationInfo:{latitudeFieldName:t.latitudeField,longitudeFieldName:t.longitudeField}};e&&"\n"===e[0];)e=e.slice(1);"\n"!==e[e.length-1]&&(e+="\n");var n=this._readFirstLine(e);if(!n)throw new l("csv","CSV is empty",{csv:e});if(!t.columnDelimiter){var r=this._inferDelimiter(n);if(!r)throw new l("csv-source:invalid-delimiter","Unable to detect the delimiter from CSV");i.columnDelimiter=r}var o=n.split(i.columnDelimiter),s=i.layerDefinition={name:"csv",drawingInfo:w,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:t.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:t.spatialReference||{wkid:102100}}};if(!t.latitudeField||!t.longitudeField){var a=this._inferLocationInfo(o);if(!t.longitudeField&&!a.longitudeFieldName||!t.latitudeField&&!a.latitudeFieldName)throw new l("csv","Unable to identify latitudeField and/or longitudeField from CSV");i.locationInfo={longitudeFieldName:t.longitudeField||a.longitudeFieldName,latitudeFieldName:t.latitudeField||a.latitudeFieldName}}var u=this._inferFields(e,i.columnDelimiter,o,i.locationInfo);if(t.fields&&t.fields.length){for(var f=new Map,p=0,c=t.fields;p<c.length;p++){var h=c[p];f.set(h.name.toLowerCase(),h)}for(var m=0,y=u;m<y.length;m++){h=y[m];var v=f.get(h.name.toLowerCase());if(v){var g=h.name;d.mixin(h,v),h.name=g}}}if(s.fields=u,!s.fields.some(function(e){return"esriFieldTypeOID"===e.type&&(s.objectIdField=e.name,!0)})){h={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};s.objectIdField=h.name,s.fields.unshift(h)}if(this._fieldsIndex=new I(s.fields),s.timeInfo){var F=s.timeInfo;if(F.startTimeField){var _=this._fieldsIndex.get(F.startTimeField);_?(F.startTimeField=_.name,_.type="esriFieldTypeDate"):F.startTimeField=null}if(F.endTimeField){var N=this._fieldsIndex.get(F.endTimeField);N?(F.endTimeField=N.name,N.type="esriFieldTypeDate"):F.endTimeField=null}if(F.trackIdField){var x=this._fieldsIndex.get(F.trackIdField);F.trackIdField=x?x.name:null}F.startTimeField||F.endTimeField||(s.timeInfo=null)}return i},e.prototype._inferLocationInfo=function(e){var i=null,n=null;return e.forEach(function(e){var r=e.toLowerCase();-1===t.csvLatitudeFieldNames.indexOf(r)||n||(n=e),-1===t.csvLongitudeFieldNames.indexOf(r)||i||(i=e)}),{longitudeFieldName:i,latitudeFieldName:n}},e.prototype._inferFields=function(e,t,i,n){for(var r=[],o=this._sampleLines(e).map(function(e){return e.split(t).map(function(e){return e.trim()})}),s=this,a=0;a<i.length;a++)!function(e){var t=i[e];if(t===n.longitudeFieldName||t===n.latitudeFieldName)r.push({name:t,type:"esriFieldTypeDouble",alias:t});else{var a=o.map(function(t){return t[e]}),l={name:t,type:null,alias:t};switch(s._inferFieldType(a)){case"integer":l.type="esriFieldTypeInteger";break;case"double":l.type="esriFieldTypeDouble";break;case"date":l.type="esriFieldTypeDate",l.length=36;break;default:l.type="esriFieldTypeString",l.length=255}r.push(l)}}(a);return r},e.prototype._inferFieldType=function(e){var t=this;if(!e.length)return"string";var i=/[^+-.,0-9]/;return e.map(function(e){var n=!1;if(""===e||i.test(e))n=!0;else{var r=E(e);if(!isNaN(r))return/[.,]/.test(e)?"double":!S(r)||r>214783647||r<-214783648?"double":"integer";if(-1===e.indexOf("E"))n=!0;else{if(r=Number(e),!isNaN(r))return"double";if(-1===e.indexOf(","))n=!0;else{if(e=e.replace(",","."),r=Number(e),!isNaN(r))return"double";n=!0}}}if(n){if(!/^[-]?\d*[.,]?\d*$/.test(e)){var o=new Date(e);return t._isValidDate(o,e)?"date":"string"}return"string"}return"string"}).reduce(function(e,t){return e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0})},e.prototype._isValidDate=function(e,t){if(!e||"[object Date]"!==Object.prototype.toString.call(e)||isNaN(e.getTime()))return!1;var i=!0;if(u("chrome")&&/\d+\W*$/.test(t)){var n=t.match(/[a-zA-Z]{2,}/);if(n){for(var r=!1,o=0;!r&&o<=n.length;)r=!b.test(n[o]),o++;i=!r}}return i},e.prototype._readFirstLine=function(e){return e.substring(0,e.indexOf("\n")).trim()},e.prototype._sampleLines=function(e,t){void 0===t&&(t=10);for(var i=!1,n=[],r=e.indexOf("\n")+1;!i&&n.length<t;){var o=e.indexOf("\n",r);if(-1!==o){var s;(s=-1===o&&r<e.length-1?e.substring(r).trim():e.substring(r,o).trim())&&n.push(s),r=o+1}else i=!0}return n},e.prototype._inferDelimiter=function(e){var i=0,n="";return t.csvDetectedDelimiters.forEach(function(t){var r=e.split(t).length;r>i&&(i=r,n=t)}),""===n?null:n},e.prototype._createQueryEngine=function(e,t){for(var i,n=t.locationInfo,r=n.latitudeFieldName,a=n.longitudeFieldName,l=t.layerDefinition,u=l.objectIdField,d=l.fields,f=l.extent,p=l.timeInfo,F=[],N=[],I=new Set,w=new Set,b=[],S=0,C=d;S<C.length;S++){var O=C[S],j=O.name,M=O.type;"esriFieldTypeDate"===M?I.add(j):x.indexOf(M)>-1&&w.add(j),j!==u&&b.push(j)}var q=new o;q.delimiter=t.columnDelimiter,q.fieldNames=b,q.newline="\n";var R=q.parse(e),L=0;R.shift();for(var k=0,P=R;k<P.length;k++){var V=P[k],Q=this._parseCoordinateValue(V[r]),G=this._parseCoordinateValue(V[a]);if(null!=G&&null!=Q&&!isNaN(Q)&&!isNaN(G)){for(var z in V[r]=Q,V[a]=G,V)if(z!==r&&z!==a)if(I.has(z)){var B=new Date(V[z]);V[z]=this._isValidDate(B,V[z])?B.getTime():null}else if(w.has(z)){var J=E(V[z]);isNaN(J)?V[z]=null:V[z]=J}V[u]=L,L++,F.push(new D(G,Q)),N.push(V)}}if(!h.equals({wkid:4326},f.spatialReference))if(h.isWebMercator(f.spatialReference))for(var W=0,Y=F;W<Y.length;W++){var $=Y[W];i=m.lngLatToXY($.x,$.y,T),$.x=i[0],$.y=i[1]}else F=c.projectMany(F,s.SpatialReference.WGS84,f.spatialReference,null,!0);for(var A=new g.default({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1}),H=new _.default({fields:t.layerDefinition.fields,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:p,objectIdField:u,spatialReference:f.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:A}),Z=[],U=0;U<F.length;U++){var X=F[U],K=X.x,ee=X.y,te=N[U];te[u]=U+1,Z.push(new y.default(new v.default([],[K,ee]),te,null,te[u]))}return A.addMany(Z),H},e.prototype._parseCoordinateValue=function(e){if(null==e||""===e)return null;var t=E(e);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(e)),t},e.prototype._checkProjection=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,F.checkProjectionSupport(h.WGS84,e)];case 1:return t.sent(),[3,3];case 2:throw t.sent(),new l("csv-layer","Projection not supported");case 3:return[2]}})})},e}();t.default=C}.apply(null,n))||(e.exports=r)},576:function(e,t,i){var n,r;n=[i(52),i(79)],void 0===(r=function(e,t){var i=/^\s*"([\S\s]*)"\s*$/,n=/""/g,r=/"/g;function o(e,t){var i,n={},r=e.length;for(i=0;i<r;i++)n[e[i]]=t[i];return n}return t(null,{fieldNames:null,delimiter:",",newline:"\r\n",trim:!1,parse:function(t){var r,s,a,l,u,d,f,p,c=[],h=t.split(this.newline),m=this.fieldNames,y=0,v=[],g="",F="";e:for(d=0,a=h.length;d<a;d++)if(e.trim(h[d])){for(f=0,l=(r=h[d].split(this.delimiter)).length;f<l;f++){for(p=-1,g+=F+(s=r[f]),F="";(p=s.indexOf('"',p+1))>=0;)y++;if(y%2==0){if(y>0){if(!(u=i.exec(g))){console.warn("Csv: discarding row with invalid value: "+g),v=[],g="",y=0;continue e}v.push(u[1].replace(n,'"'))}else v.push(this.trim||!m?e.trim(g):g);g="",y=0}else F=this.delimiter}0===y?(m?c.push(o(m,v)):m=this.fieldNames=v,v=[]):F=this.newline}return c},toCsv:function(e){return this.stringify(this.data,e)},stringify:function(e,t){var i,n,o,s=(t=t||{}).alwaysQuote,a=this.fieldNames,l=this.delimiter,u=this.newline,d="";for(i=-1;i<e.length;i++)for(i>-1&&(d+=u),n=0;n<a.length;n++)null==(o=i<0?a[n]:e[i][a[n]])&&(o=""),"string"!=typeof o&&(o=o.toString()),d+=(n>0?l:"")+(s||o.indexOf('"')>=0||o.indexOf(l)>=0?'"'+o.replace(r,'""')+'"':o);return t.trailingNewline&&(d+=u),d}})}.apply(null,n))||(e.exports=r)}}]);