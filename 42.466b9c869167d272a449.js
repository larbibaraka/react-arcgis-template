(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/support/commonProperties":53,"esri/layers/mixins/PortalLayer":59,"esri/layers/mixins/OperationalLayer":64,"esri/layers/mixins/ScaleRangeLayer":66,"esri/symbols/support/ElevationInfo":67,"esri/symbols/support/FeatureExpressionInfo":68,"esri/symbols/support/unitConversionUtils":69,"esri/tasks/support/Query":74,"esri/tasks/support/QuantizationParameters":85,"esri/layers/mixins/RefreshableLayer":88,"esri/tasks/support/StatisticDefinition":93,"esri/geometry/support/normalizeUtils":104,"esri/tasks/operations/urlUtils":117,"esri/layers/support/labelUtils":119,"esri/layers/mixins/ArcGISService":126,"esri/tasks/Task":140,"esri/tasks/geometry/cut":142,"esri/tasks/geometry/simplify":143,"esri/layers/support/LabelExpressionInfo":166,"esri/tasks/operations/query":171,"esri/arcade/featureset/support/shared":186,"esri/layers/support/LabelClass":189,"esri/tasks/operations/queryAttachments":198,"esri/tasks/QueryTask":211,"esri/tasks/operations/queryRelatedRecords":212,"esri/arcade/featureset/support/IdSet":218,"esri/arcade/featureset/support/FeatureSet":235,"esri/arcade/featureset/support/sqlUtils":236,"esri/geometry/geometryEngineAsync":395,"esri/workers/WorkerClient":636,"esri/arcade/featureset/support/stats":637,"esri/arcade/featureset/actions/OrderBy":638,"esri/arcade/featureset/support/OrderbyClause":639,"esri/arcade/featureset/sources/Empty":640,"esri/arcade/featureset/actions/AttributeFilter":641,"esri/arcade/featureSetUtils":920,"esri/arcade/featureSetCollection":921,"esri/arcade/featureset/support/cache":922,"esri/arcade/featureset/support/sha":923,"esri/arcade/featureset/sources/FeatureLayerMemory":924,"esri/arcade/featureset/actions/Top":925,"esri/arcade/featureset/actions/SpatialFilter":926,"esri/arcade/featureset/actions/Adapted":927,"esri/arcade/featureset/sources/FeatureLayerDynamic":2349,"esri/arcade/featureset/support/FeatureSetIterator":2350,"esri/arcade/featureset/sources/FeatureLayerRelated":2351,"esri/arcade/featureset/actions/GroupBy":2352,"esri/arcade/featureset/support/StatsField":2353,"esri/arcade/functions/featuresetbase":2354,"esri/arcade/functions/featuresetgeom":2355,"esri/arcade/functions/featuresetstats":2356,"esri/arcade/functions/featuresetstring":2357})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[42,32,55,71,86,87,88,89,90,91,92,93,94,95],{104:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(31),r(32),r(7),r(36),r(37),r(40),r(34),r(114),r(115),r(50),r(63),r(90),r(142),r(143)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p,d,f,h,y){function g(e){return"polygon"===e.type}function v(e){return"polygon"===e[0].type}function m(e){return"polyline"===e[0].type}function _(e){return g(e)?e.rings:e.paths}function w(e,t){return Math.ceil((e-t)/(2*t))}function S(e,t){for(var r=0,n=_(e);r<n.length;r++)for(var i=0,a=n[r];i<a.length;i++){a[i][0]+=t}return e}function b(e){for(var t=[],r=0,n=0,i=0;i<e.length;i++){for(var a=e[i],o=null,s=0;s<a.length;s++)o=a[s],t.push(o),0===s?n=r=o[0]:(r=Math.min(r,o[0]),n=Math.max(n,o[0]));o&&t.push([(r+n)/2,0])}return t}function F(e,t){if(!(e instanceof c||e instanceof u)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw E.error(r),new a(r)}for(var n=[],i=0,o=_(e);i<o.length;i++){var s=o[i],l=[];n.push(l),l.push([s[0][0],s[0][1]]);for(var p=0;p<s.length-1;p++){var d=s[p][0],f=s[p][1],h=s[p+1][0],y=s[p+1][1],v=Math.sqrt((h-d)*(h-d)+(y-f)*(y-f)),m=(y-f)/v,w=(h-d)/v,S=v/t;if(S>1){for(var b=1;b<=S-1;b++){var F=b*t,I=w*F+d,x=m*F+f;l.push([I,x])}var T=(v+Math.floor(S-1)*t)/2,R=w*T+d,C=m*T+f;l.push([R,C])}l.push([h,y])}}return g(e)?new u({rings:n,spatialReference:e.spatialReference}):new c({paths:n,spatialReference:e.spatialReference})}function I(e,t,r){if(t){var n=F(e,1e6);e=f.webMercatorToGeographic(n,!0)}return r&&(e=S(e,r)),e}function x(e,t,r){var n;if(Array.isArray(e)){if((n=e[0])>t){var i=w(n,t);e[0]=n+i*(-2*t)}else if(n<r){i=w(n,r);e[0]=n+i*(-2*r)}}else if((n=e.x)>t){i=w(n,t);e=e.clone().offset(i*(-2*t),0)}else if(n<r){i=w(n,r);e=e.clone().offset(i*(-2*r),0)}return e}function T(e,t){for(var r=-1,n=0;n<t.cutIndexes.length;n++)!function(n){for(var i=t.cutIndexes[n],a=t.geometries[n],o=_(a),s=0;s<o.length;s++)!function(e){var t=o[e];t.some(function(r){if(r[0]<180)return!0;for(var n=0,i=0;i<t.length;i++){var o=t[i][0];n=o>n?o:n}for(var s=-360*w(n=Number(n.toFixed(9)),180),l=0;l<t.length;l++){var u=a.getPoint(e,l);a.setPoint(e,l,u.clone().offset(s,0))}return!0})}(s);if(i===r){if(v(e))for(var l=0,u=_(a);l<u.length;l++){var c=u[l];e[i]=e[i].addRing(c)}else if(m(e))for(var p=0,d=_(a);p<d.length;p++){var f=d[p];e[i]=e[i].addPath(f)}}else r=i,e[i]=a}(n);return e}Object.defineProperty(t,"__esModule",{value:!0});var E=o.getLogger("esri.geometry.support.normalizeUtils"),R={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new c({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:p.WebMercator}),minus180Line:new c({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:p.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new c({paths:[[[180,-180],[180,180]]],spatialReference:p.WGS84}),minus180Line:new c({paths:[[[-180,-180],[-180,180]]],spatialReference:p.WGS84})}};t.straightLineDensify=F,t.normalizeCentralMeridian=function e(t,a,o){return n(this,void 0,void 0,function(){var n,p,g,v,m,_,b,F,E,C,O,D,A,P,j,k,N,L,M,G,B,U,q,W,V,J,H,Q,z,Y,K,X,Z,$,ee,te,re;return r(this,function(r){switch(r.label){case 0:if(!Array.isArray(t))return[2,e([t],a)];for(n=a?a.url:i.geometryServiceUrl,C=0,O=[],D=[],A=0,P=t;A<P.length;A++)j=P[A],s.isNone(j)?D.push(j):(p||(p=j.spatialReference,g=d.getInfo(p),v=p.isWebMercator,m=R[b=v?102100:4326].maxX,_=R[b].minX,F=R[b].plus180Line,E=R[b].minus180Line),g?"mesh"===j.type?D.push(j):"point"===j.type?D.push(x(j.clone(),m,_)):"multipoint"===j.type?((k=j.clone()).points=k.points.map(function(e){return x(e,m,_)}),D.push(k)):"extent"===j.type?(L=j.clone(),N=L._normalize(!1,!1,g),D.push(N.rings?new u(N):N)):j.extent?(L=j.extent,M=w(L.xmin,_),B=0==(G=M*(2*m))?j.clone():S(j.clone(),G),L.offset(G,0),L.intersects(F)&&L.xmax!==m?(C=L.xmax>C?L.xmax:C,B=I(B,v),O.push(B),D.push("cut")):L.intersects(E)&&L.xmin!==_?(C=L.xmax*(2*m)>C?L.xmax*(2*m):C,B=I(B,v,360),O.push(B),D.push("cut")):D.push(B)):D.push(j.clone()):D.push(j));for(U=w(C,m),q=-90,W=U,V=new c;U>0;)J=360*U-180,V.addPath([[J,q],[J,-1*q]]),q*=-1,U--;return O.length>0&&W>0?[4,h.cut(n,O,V,o)]:[3,3];case 1:for(H=r.sent(),Q=T(O,H),z=[],Y=[],ee=0;ee<D.length;ee++)"cut"!==(te=D[ee])?Y.push(te):(re=Q.shift(),K=t[ee],s.isSome(K)&&"polygon"===K.type&&K.rings&&K.rings.length>1&&re.rings.length>=K.rings.length?(z.push(re),Y.push("simplify")):Y.push(v?f.geographicToWebMercator(re):re));return z.length?[4,y.simplify(n,z,o)]:[2,Y];case 2:for(X=r.sent(),Z=[],ee=0;ee<Y.length;ee++)"simplify"!==(te=Y[ee])?Z.push(te):Z.push(v?f.geographicToWebMercator(X.shift()):X.shift());return[2,Z];case 3:for($=[],ee=0;ee<D.length;ee++)"cut"!==(te=D[ee])?$.push(te):(re=O.shift(),$.push(!0===v?f.geographicToWebMercator(re):re));return[2,l.resolve($)]}})})},t.getDenormalizedExtent=function(e){var t;if(!e)return null;var r=e.extent;if(!r)return null;var n=e.spatialReference&&d.getInfo(e.spatialReference);if(!n)return r;var i,a=n.valid,o=a[0],s=a[1],l=2*s,u=r.width,c=r.xmin,p=r.xmax;if(c=(t=[p,c])[0],p=t[1],"extent"===e.type||0===u||u<=s||u>l||c<o||p>s)return r;switch(e.type){case"polygon":if(!(e.rings.length>1))return r;i=b(e.rings);break;case"polyline":if(!(e.paths.length>1))return r;i=b(e.paths);break;case"multipoint":i=e.points}for(var f=r.clone(),h=0;h<i.length;h++){var y=i[h][0];y<0?(y+=s,p=Math.max(y,p)):(y-=s,c=Math.min(y,c))}return f.xmin=c,f.xmax=p,f.width<u?(f.xmin-=s,f.xmax-=s,f):r},t.normalizeMapX=function(e,t){var r=d.getInfo(t);if(r){var n=r.valid,i=n[0],a=n[1],o=a-i;if(e<i)for(;e<i;)e+=o;if(e>a)for(;e>a;)e-=o}return e}}.apply(null,n))||(e.exports=i)},117:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var n in t)if("declaredClass"!==n){var i=t[n];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){r[n]=[];for(var a=0;a<i.length;a++)r[n][a]=e(i[a])}else"object"==typeof i?i.toJSON&&(r[n]=JSON.stringify(i)):r[n]=i}return r}}.apply(null,n))||(e.exports=i)},119:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(124)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="__begin__",i="__end__",a=new RegExp(n,"ig"),o=new RegExp(i,"ig"),s=new RegExp("^"+n,"i"),l=new RegExp(i+"$","i"),u='"',c=u+" + ",p=" + "+u;t.convertTemplatedStringToArcade=function(e){var t;return e?(t=r.replace(e,function(e){return n+'$feature["'+e+'"]'+i}),t=s.test(t)?t.replace(s,""):u+t,t=(t=l.test(t)?t.replace(l,""):t+u).replace(a,c).replace(o,p)):t='""',t}}.apply(null,n))||(e.exports=i)},126:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(37),r(30),r(116)],void 0===(i=function(e,t,r,n,i,a,o){Object.defineProperty(t,"__esModule",{value:!0});var s=i.getLogger("esri.layers.mixins.ArcGISService");t.ArcGISService=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"title",{get:function(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){var e=o.parse(this.url);if(e&&e.title)return e.title}return this._get("title")||""},set:function(e){this._set("title",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{set:function(e){this._set("url",o.sanitizeUrl(e,s))},enumerable:!0,configurable:!0}),n([a.property({dependsOn:["url"]})],t.prototype,"title",null),n([a.property({type:String})],t.prototype,"url",null),n([a.subclass("esri.layers.mixins.ArcGISService")],t)}(a.declared(e))}}.apply(null,n))||(e.exports=i)},140:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(83),r(35),r(47),r(39),r(30)],void 0===(i=function(e,t,r,n,i,a,o,s,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.requestOptions=null,r.url=null,r}return r(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"!=typeof e?e:a({url:e},t)},Object.defineProperty(t.prototype,"parsedUrl",{get:function(){return this._parseUrl(this.url)},enumerable:!0,configurable:!0}),t.prototype._parseUrl=function(e){return e?s.urlToObject(e):null},t.prototype._encode=function(e,t,r){var n={};for(var i in e)if("declaredClass"!==i){var a=e[i];if(null!=a&&"function"!=typeof a)if(Array.isArray(a)){n[i]=[];for(var o=0;o<a.length;o++)n[i][o]=this._encode(a[o])}else if("object"==typeof a)if(a.toJSON){var s=a.toJSON(r&&r[i]);n[i]=t?s:JSON.stringify(s)}else n[i]=t?a:JSON.stringify(a);else n[i]=a}return n},n([l.property({readOnly:!0,dependsOn:["url"]})],t.prototype,"parsedUrl",null),n([l.property()],t.prototype,"requestOptions",void 0),n([l.property({type:String})],t.prototype,"url",void 0),n([l.subclass("esri.tasks.Task")],t)}(l.declared(o))}.apply(null,n))||(e.exports=i)},142:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(35),r(32),r(31),r(42),r(44),r(39),r(46)],void 0===(i=function(e,t,r,n,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.cut=function(e,t,u,c){return n(this,void 0,void 0,function(){var n,p,d,f,h,y,g;return i(this,function(i){switch(i.label){case 0:return n="string"==typeof e?s.urlToObject(e):e,p=t[0].spatialReference,d=r({},c,{query:r({},n.query,{f:"json",sr:JSON.stringify(p),target:JSON.stringify({geometryType:l.getJsonType(t[0]),geometries:t}),cutter:JSON.stringify(u)})}),[4,o(n.path+"/cut",d)];case 1:return f=i.sent(),h=f.data,y=h.cutIndexes,g=h.geometries,[2,{cutIndexes:y,geometries:(void 0===g?[]:g).map(function(e){return a.fromJSON(e).set(p)})}]}})})}}.apply(null,n))||(e.exports=i)},143:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(35),r(32),r(31),r(44),r(39),r(46)],void 0===(i=function(e,t,r,n,i,a,o,s){function l(e){return{geometryType:s.getJsonType(e[0]),geometries:e.map(function(e){return e.toJSON()})}}function u(e,t,r){var n=s.getGeometryType(t);return e.map(function(e){var t=n.fromJSON(e);return t.spatialReference=r,t})}Object.defineProperty(t,"__esModule",{value:!0}),t.simplify=function(e,t,c){return n(this,void 0,void 0,function(){var n,p,d,f;return i(this,function(i){switch(i.label){case 0:return n="string"==typeof e?o.urlToObject(e):e,p=t[0].spatialReference,d=s.getJsonType(t[0]),f=r({},c,{query:r({},n.query,{f:"json",sr:p.wkid?p.wkid:JSON.stringify(p),geometries:JSON.stringify(l(t))})}),[4,a(n.path+"/simplify",f)];case 1:return[2,u(i.sent().data,d,p)]}})})}}.apply(null,n))||(e.exports=i)},166:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(33),r(30),r(119)],void 0===(i=function(e,t,r,n,i,a,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.expression=null,t}var i;return r(t,e),i=t,t.prototype.readExpression=function(e,t){return t.value?o.convertTemplatedStringToArcade(t.value):e},t.prototype.writeExpression=function(e,t,r){null!=this.value&&(e=o.convertTemplatedStringToArcade(this.value)),t[r]=e},t.prototype.clone=function(){return new i({value:this.value,expression:this.expression})},n([a.property({json:{read:!1,write:!1}})],t.prototype,"value",void 0),n([a.property({type:String,json:{write:{allowNull:!0}}})],t.prototype,"expression",void 0),n([a.reader("expression",["expression","value"])],t.prototype,"readExpression",null),n([a.writer("expression")],t.prototype,"writeExpression",null),i=n([a.subclass("esri.layers.support.LabelExpressionInfo")],t)}(a.declared(i.JSONSupport))}.apply(null,n))||(e.exports=i)},171:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(35),r(44),r(40),r(39),r(46),r(104),r(228),r(227),r(117),r(6)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c){function p(e,t){var r=e.geometry,n=e.toJSON(),i=n;if(r&&(i.geometry=JSON.stringify(r),i.geometryType=o.getJsonType(r),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(i.objectIds=n.objectIds.join(",")),n.orderByFields&&(i.orderByFields=n.orderByFields.join(",")),!n.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete i.outFields:-1!==n.outFields.indexOf("*")?i.outFields="*":i.outFields=n.outFields.join(","),n.outSR?i.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(i.outSR=i.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(i.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(i.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(i.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.source&&(i.layer=JSON.stringify({source:n.source}),delete n.source),n.timeExtent){var a=n.timeExtent,s=a.start,l=a.end;null==s&&null==l||(i.time=s===l?s:(null==s?"null":s)+","+(null==l?"null":l)),delete n.timeExtent}return i}function d(e,t,o,l,u){void 0===l&&(l={});var d="string"==typeof e?a.urlToObject(e):e,f=t.geometry?[t.geometry]:[];return l.responseType="pbf"===o?"array-buffer":"json",s.normalizeCentralMeridian(f,null,l).then(function(e){var a=e&&e[0];i.isSome(a)&&((t=t.clone()).geometry=a);var s=c.mapParameters(r({},d.query,{f:o},u,p(t,u)));return n(d.path+"/query",r({},l,{query:s}))})}Object.defineProperty(t,"__esModule",{value:!0});var f,h="Layer does not support extent calculation.";t.queryToQueryStringParameters=p,t.executeQuery=function(e,t,r){return d(e,t,"json",r)},t.executeQueryPBF=function(e,t,r,n){var i=r.useWorker?(null==f&&(f=new u.PBFWorker),f):null;return d(e,t,"pbf",n).then(function(e){var t=function(t){var r=e;return r.data=t,r};return r.useWorker?i.parseFeatureQuery(e.data,r).then(function(e){return t(e)}):t(l.parsePBFFeatureQuery(e.data,r))})},t.executeQueryForIds=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return d(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(h);if(t.hasOwnProperty("count"))throw new Error(h);return e})}}.apply(null,n))||(e.exports=i)},186:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(34),r(54),r(78)],void 0===(i=function(e,t,r,n,i){function a(e){return e instanceof Date}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"}(t.FeatureServiceDatabaseType||(t.FeatureServiceDatabaseType={})),t.cloneField=function(e){return i.fromJSON(e.toJSON())},t.esriFieldToJson=function(e){return e.toJSON()},function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(t.IdState||(t.IdState={})),t.isString=function(e){return"string"==typeof e||e instanceof String},t.isBoolean=function(e){return"boolean"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isArray=function(e){return e instanceof Array},t.isDate=a,t.equalityTest=function(e,t){return e===t||!(!a(e)||!a(t))&&e.getTime()===t.getTime()},t.cloneAttributes=function(e){var t={};for(var r in e)t[r]=e[r];return t},t.convertSquareUnitsToCode=function(e){if(void 0===e)return null;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null},t.shapeExtent=function(e){if(null===e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new n({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null},t.convertLinearUnitsToCode=function(e){if(void 0===e)return null;if("number"==typeof e)return e;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null},t.sameGeomType=function(e,t){return e===t||"point"===e&&"esriGeometryPoint"===t||"polyline"===e&&"esriGeometryPolyline"===t||"polygon"===e&&"esriGeometryPolygon"===t||"extent"===e&&"esriGeometryEnvelope"===t||"multipoint"===e&&"esriGeometryMultipoint"===t||"point"===t&&"esriGeometryPoint"===e||"polyline"===t&&"esriGeometryPolyline"===e||"polygon"===t&&"esriGeometryPolygon"===e||"extent"===t&&"esriGeometryEnvelope"===e||"multipoint"===t&&"esriGeometryMultipoint"===e},t.defaultMaxRecords=1e3,t.errback=function(e){return function(t){e.reject(t)}},t.callback=function(e,t){return function(r){try{e.apply(null,arguments)}catch(e){t.reject(e)}}},t.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},t.toEsriGeometryType=function(e){switch(e){case"point":return"esriGeometryPoint";case"polygon":return"esriGeometryPolygon";case"multipoint":return"esriGeometryMultipoint";case"polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}},t.reduceArrayWithPromises=function(e,t,n){return r.create(function(n,i){var a=r.resolve(!0);e.reduce(function(e,n,i,a){return e.then(function(e){try{return t(e,n,i,a)}catch(e){return r.reject(e)}},function(e){return r.reject(e)})},a).then(n,i)})},t.extractServiceUrl=function(e){return void 0===e?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]},t.stableStringify=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r="boolean"==typeof t.cycles&&t.cycles,n=t.cmp&&function(e){return function(t){return function(r,n){var i={key:r,value:t[r]},a={key:n,value:t[n]};return e(i,a)}}}(t.cmp),i=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var a,o;if(Array.isArray(t)){for(o="[",a=0;a<t.length;a++)a&&(o+=","),o+=e(t[a])||"null";return o+"]"}if(null===t)return"null";if(-1!==i.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=i.push(t)-1,l=Object.keys(t).sort(n&&n(t));for(o="",a=0;a<l.length;a++){var u=l[a],c=e(t[u]);c&&(o&&(o+=","),o+=JSON.stringify(u)+":"+c)}return i.splice(s,1),"{"+o+"}"}}(e)}}.apply(null,n))||(e.exports=i)},189:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(28),r(29),r(31),r(32),r(71),r(41),r(33),r(38),r(30),r(166),r(119),r(208),r(196),r(80)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p,d,f,h,y){function g(e){return!e||"service"!==e.origin&&(!e.layer||!f.isOfType(e.layer,"map-image"))}function v(e){if(!e)return null;var t=w.exec(e);return t&&(t[1]||t[3])||null}var m=new s.default({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0}),_=/^\s*\{([^}]+)\}\s*$/i,w=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]))\s*$/i;return function(e){function t(t){var r=e.call(this,t)||this;return r.name=null,r.labelExpression=null,r.labelExpressionInfo=null,r.labelPlacement=null,r.maxScale=0,r.minScale=0,r.symbol=h.defaultTextSymbol2D,r.useCodedValues=void 0,r.where=null,r}var i;return n(t,e),i=t,t.evaluateWhere=function(e,t){var r=function(e,t,r){switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;var n=e.split(" ");if(3===n.length)return r(t[n[0]],n[1],n[2]);if(7===n.length){var i=r(t[n[0]],n[1],n[2]),a=n[3],o=r(t[n[4]],n[5],n[6]);switch(a){case"AND":return i&&o;case"OR":return i||o}}return!1}catch(t){console.log("Error.: can't parse = "+e)}},t.prototype.readLabelExpression=function(e,t){var r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e},t.prototype.writeLabelExpression=function(e,t,r,n){if(this.labelExpressionInfo&&g(n))if(null!=this.labelExpressionInfo.value)e=function(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){var i=v(this.labelExpressionInfo.expression);i&&(e="["+i+"]")}null!=e&&(t[r]=e)},t.prototype.writeLabelExpressionInfo=function(e,t,r,n){if(null==e&&null!=this.labelExpression&&g(n))e=new p({expression:this.getLabelExpressionArcade()});else if(!e)return;var i=e.toJSON(n);i.expression&&(t[r]=i)},t.prototype.writeMaxScale=function(e,t){(e||this.minScale)&&(t.maxScale=e)},t.prototype.writeMinScale=function(e,t){(e||this.maxScale)&&(t.minScale=e)},t.prototype.getLabelExpression=function(){var e={expression:"",type:"none"};return this.labelExpressionInfo?this.labelExpressionInfo.value?(e.expression=this.labelExpressionInfo.value,e.type="conventional"):this.labelExpressionInfo.expression&&(e.expression=this.labelExpressionInfo.expression,e.type="arcade"):null!=this.labelExpression&&(e.expression=function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(this.labelExpression),e.type="conventional"),e},t.prototype.getLabelExpressionArcade=function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return d.convertTemplatedStringToArcade(e.expression);case"arcade":return e.expression}return null},t.prototype.getLabelExpressionSingleField=function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return function(e){var t=e.match(_);return t&&t[1].trim()||null}(e.expression);case"arcade":return v(e.expression)}return null},t.prototype.clone=function(){return new i({labelExpression:this.labelExpression,labelExpressionInfo:u.clone(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:u.clone(this.symbol),where:this.where,useCodedValues:this.useCodedValues})},r([c.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),r([c.property({type:String,json:{write:{allowNull:!0}}})],t.prototype,"labelExpression",void 0),r([c.reader("labelExpression")],t.prototype,"readLabelExpression",null),r([c.writer("labelExpression")],t.prototype,"writeLabelExpression",null),r([c.property({type:p,json:{write:{overridePolicy:function(e,t,r){return g(r)?{allowNull:!0}:{enabled:!1}}}}})],t.prototype,"labelExpressionInfo",void 0),r([c.writer("labelExpressionInfo")],t.prototype,"writeLabelExpressionInfo",null),r([c.property({type:m.apiValues,json:{type:m.jsonValues,read:m.read,write:m.write}})],t.prototype,"labelPlacement",void 0),r([c.property({type:Number})],t.prototype,"maxScale",void 0),r([c.writer("maxScale")],t.prototype,"writeMaxScale",null),r([c.property({type:Number})],t.prototype,"minScale",void 0),r([c.writer("minScale")],t.prototype,"writeMinScale",null),r([c.property({types:o.symbolTypesLabel,json:{origins:{"web-scene":{types:o.symbolTypesLabel3D,read:y.read,write:y.writeTarget,default:null}},read:y.read,write:y.writeTarget,default:null}})],t.prototype,"symbol",void 0),r([c.property({type:Boolean,json:{write:!0}})],t.prototype,"useCodedValues",void 0),r([c.property({type:String,json:{write:!0}})],t.prototype,"where",void 0),i=r([c.subclass("esri.layers.support.LabelClass")],t)}(c.declared(l.JSONSupport))}.apply(null,n))||(e.exports=i)},198:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(35),r(44),r(39),r(283),r(117)],void 0===(i=function(e,t,r,n,i,a,o){Object.defineProperty(t,"__esModule",{value:!0}),t.processAttachmentQueryResult=function(e,t){for(var r={},n=0,o=e;n<o.length;n++)for(var s=o[n],l=s.parentObjectId,u=s.parentGlobalId,c=0,p=s.attachmentInfos;c<p.length;c++){var d=p[c],f=d.id,h=i.addProxy(i.addTokenParameter(t+"/"+l+"/attachments/"+f)),y=a.fromJSON(d);y.set({url:h,parentObjectId:l,parentGlobalId:u}),r[l]?r[l].push(y):r[l]=[y]}return r},t.executeAttachmentQuery=function(e,t,i){var a={query:o.mapParameters(r({},e.query,{f:"json"},function(e){var t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}(t)))};return i&&(a=r({},i,a)),n(e.path+"/queryAttachments",a)}}.apply(null,n))||(e.exports=i)},211:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(83),r(35),r(42),r(30),r(140),r(171),r(198),r(212),r(213),r(100),r(74),r(214)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p,d,f,h,y){return function(e){function t(t){var r=e.call(this,t)||this;return r.gdbVersion=null,r.source=null,r}return r(t,e),t.prototype.execute=function(e,t){return this.executeJSON(e,t).then(function(e){return f.fromJSON(e)})},t.prototype.executeJSON=function(e,t){return u.executeQuery(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return e.data})},t.prototype.executeForCount=function(e,t){return u.executeQueryForCount(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return e.data.count})},t.prototype.executeForExtent=function(e,t){return u.executeQueryForExtent(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return{count:e.data.count,extent:o.Extent.fromJSON(e.data.extent)}})},t.prototype.executeForIds=function(e,t){return u.executeQueryForIds(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return e.data.objectIds})},t.prototype.executeRelationshipQuery=function(e,t){return e=y.from(e),(this.gdbVersion||this.source)&&(e=e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source})),p.executeRelationshipQuery(this.parsedUrl,e,a({},this.requestOptions,t)).then(function(e){var t=e.data,r={};return Object.keys(t).forEach(function(e){return r[e]=f.fromJSON(t[e])}),r})},t.prototype.executeAttachmentQuery=function(e,t){var r=this;return c.executeAttachmentQuery(this.parsedUrl,d.from(e),a({},this.requestOptions,t)).then(function(e){return c.processAttachmentQueryResult(e.data.attachmentGroups,r.parsedUrl.path)})},t.prototype._normalizeQuery=function(e){var t=h.from(e);return this.gdbVersion||this.source?(t===e?t.clone():t).set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source}):t},n([s.property()],t.prototype,"gdbVersion",void 0),n([s.property()],t.prototype,"source",void 0),n([s.subclass("esri.tasks.QueryTask")],t)}(s.declared(l))}.apply(null,n))||(e.exports=i)},212:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(35),r(44),r(117)],void 0===(i=function(e,t,r,n,i){function a(e){var t=e.toJSON();return t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.outFields&&(t.outFields=t.outFields.join(",")),t.outSpatialReference&&(t.outSR=t.outSR.wkid||JSON.stringify(t.outSR.toJSON()),delete t.outSpatialReference),t.source&&(t.layer=JSON.stringify({source:t.source}),delete t.source),t}Object.defineProperty(t,"__esModule",{value:!0}),t.toQueryStringParameters=a,t.executeRelationshipQuery=function(e,t,o){var s={query:i.mapParameters(r({},e.query,{f:"json"},a(t)))};return o&&(s=r({},o,s)),n(e.path+"/queryRelatedRecords",s).then(function(e){for(var t=e.data,r=t.geometryType,n=t.spatialReference,i={},a=0,o=t.relatedRecordGroups;a<o.length;a++){var s=o[a],l={fields:void 0,objectIdFieldName:void 0,geometryType:r,spatialReference:n,features:s.relatedRecords};if(null!=s.objectId)i[s.objectId]=l;else for(var u in s)s.hasOwnProperty(u)&&"relatedRecords"!==u&&(i[s[u]]=l)}return e.data=i,e})}}.apply(null,n))||(e.exports=i)},218:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){return function(e,t,r,n){this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=e,this._known=t,this._ordered=r,this.pagesDefinition=n}}()}.apply(null,n))||(e.exports=i)},2349:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(77),r(44),r(454),r(235),r(218),r(923),r(186),r(236),r(236),r(637),r(34),r(46),r(87),r(157),r(211),r(171),r(100),r(74),r(93)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p,d,f,h,y,g,v,m,_,w,S){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",r._removeGeometry=!1,r._overrideFields=null,r.formulaCredential=null,r._pageJustIds=!1,r._requestStandardised=!1,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return u.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(e){this._pageJustIds=e},t.prototype.convertQueryToLruCacheKey=function(e){var t=u.stableStringify(e.toJSON());return new l(t,"TEXT").getHash("SHA-1","B64")},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=f.create(function(t,r){try{if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then(function(){try{e._initialiseFeatureSet(),t(e)}catch(e){r(e)}},r),e._layer.load()}catch(e){r(e)}})),this._loadPromise},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{for(var e=[],t=0,r=this.fields;t<r.length;t++){if("oid"===(l=r[t]).type)e.push(l);else for(var n=0,i=this._layer.outFields;n<i.length;n++){if(i[n].toLowerCase()===l.name.toLowerCase()){e.push(l);break}}}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{e=[];for(var a=[],o=0,s=this.fields;o<s.length;o++){var l;if("oid"===(l=s[o]).type)e.push(l),a.push(l.name);else for(var c=0,p=this._overrideFields;c<p.length;c++){if(p[c].toLowerCase()===l.name.toLowerCase()){e.push(l),a.push(l.name);break}}}this.fields=e,this._overrideFields=a}if(this._layer.source&&this._layer.source.sourceJSON){var d=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=u.FeatureServiceDatabaseType.StandardisedNoInterval,null!=d&&d>=10.61&&(this._databaseType=u.FeatureServiceDatabaseType.Standardised)):null!=d&&(d>=10.5&&(this._databaseType=u.FeatureServiceDatabaseType.StandardisedNoInterval,this._requestStandardised=!0),d>=10.61&&(this._databaseType=u.FeatureServiceDatabaseType.Standardised))}this.objectIdField=this._layer.objectIdField,this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},t.prototype._isInFeatureSet=function(){return u.IdState.InFeatureSet},t.prototype._refineSetBlock=function(e){return f.resolve(e)},t.prototype._candidateIdTransform=function(e){return e},t.prototype._transformSetWithIdChanges=function(){},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,null,e)}).then(function(e){return t._wset=e,e}):f.resolve(this._wset)},t.prototype._runDatabaseProbe=function(e){var t=this;return f.create(function(r,n){try{t._ensureLoaded().then(function(){try{var i=new w;i.where=e.replace("OBJECTID",t._layer.objectIdField),t._layer.queryObjectIds(i).then(function(){r(!0)},function(e){try{r(!1)}catch(e){n(e)}})}catch(e){n(e)}})}catch(e){n(e)}})},t.prototype._canUsePagination=function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)},t.prototype._cacheableFeatureSetSourceKey=function(){return this._layer.url},t.prototype.pbfSupportedForQuery=function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode},t.prototype.queryPBF=function(e,t){return e.quantizationParameters={mode:"edit"},m.executeQueryPBF(this._layer.parsedUrl,e,{type:"optimized"}).then(function(e){return _.fromJSON(g.convertToFeatureSet(e.data)).unquantize()})},t.prototype.nativeCapabilities=function(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}},t.prototype.executeQuery=function(e,t){var r=this,n=new v({url:this._layer.parsedUrl.path}),i="execute"===t&&this.pbfSupportedForQuery(e),a=null;if(this.recentlyUsedQueries){var o=this.convertQueryToLruCacheKey(e);null===(a=this.recentlyUsedQueries.getFromCache(o))&&(a=!0!==i?n[t](e):this.queryPBF(e,n),this.recentlyUsedQueries.addToCache(o,a),a=a.catch(function(e){throw r.recentlyUsedQueries.removeFromCache(o),e}))}return null===a&&(a=!0!==i?n[t](e):this.queryPBF(e,n)),a},t.prototype._getFilteredSet=function(e,t,r,n,i){var a=this;return this.databaseType().then(function(o){if(a.isTable()&&t&&null!==e&&""!==e)return new s([],[],!0,null);if(a._canUsePagination())return a._getFilteredSetUsingPaging(e,t,r,n,i);var l="",u=!1;null!==n&&a._layer.capabilities&&a._layer.capabilities.query&&!0===a._layer.capabilities.query.supportsOrderBy&&(l=n.constructClause(),u=!0);var p=new w;return p.where=null===r?null===t?"1=1":"":c.toWhereClause(r,o),a._requestStandardised&&(p.sqlFormat="standard"),p.spatialRelationship=a._makeRelationshipEnum(e),p.outSpatialReference=a.spatialReference,p.orderByFields=""!==l?l.split(","):null,p.geometry=null===t?null:t,p.relationParameter=a._makeRelationshipParam(e),a.executeQuery(p,"executeForIds").then(function(e){return null===e&&(e=[]),a._checkCancelled(i),new s([],e,u,null)})})},t.prototype._expandPagedSet=function(e,t,r,n,i){return this._expandPagedSetFeatureSet(e,t,r,n,i)},t.prototype._getFilteredSetUsingPaging=function(e,t,r,n,i){var a=this;try{var o="",l=!1;return null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(o=n.constructClause(),l=!0),this.databaseType().then(function(n){var u=null===r?null===t?"1=1":"":c.toWhereClause(r,n);a._layer.definitionExpression&&(u=""!==u?"(("+a._layer.definitionExpression+") AND ("+u+"))":a._layer.definitionExpression);var p=a._maxQueryRate(),d=a._layer.capabilities.query.maxRecordCount;void 0!==d&&d<p&&(p=d);var f=null;if(!0===a._pageJustIds)f=new s([],["GETPAGES"],l,{spatialRel:a._makeRelationshipEnum(e),relationParam:a._makeRelationshipParam(e),outFields:a._layer.objectIdField,resultRecordCount:p,resultOffset:0,geometry:null===t?null:t,where:u,orderByFields:o,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}});else{var h=!0;!0===a._removeGeometry&&(h=!1);var y=null!==a._overrideFields?a._overrideFields:a._fieldsIncludingObjectId(a._layer.outFields?a._layer.outFields:["*"]);f=new s([],["GETPAGES"],l,{spatialRel:a._makeRelationshipEnum(e),relationParam:a._makeRelationshipParam(e),outFields:y.join(","),resultRecordCount:p,resultOffset:0,geometry:null===t?null:t,where:u,orderByFields:o,returnGeometry:h,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}})}return a._expandPagedSet(f,p,0,1,i).then(function(){return f})})}catch(e){return f.reject(e)}},t.prototype._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},t.prototype._getPhysicalPage=function(e,t,r){var n=this;try{var i=e.pagesDefinition.internal.lastRetrieved,a=i,o=new w;return this._requestStandardised&&(o.sqlFormat="standard"),o.spatialRelationship=e.pagesDefinition.spatialRel,o.relationParameter=e.pagesDefinition.relationParam,o.outFields=e.pagesDefinition.outFields.split(","),o.num=e.pagesDefinition.resultRecordCount,o.start=e.pagesDefinition.internal.lastRetrieved,o.geometry=e.pagesDefinition.geometry,o.where=e.pagesDefinition.where,o.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,o.returnGeometry=e.pagesDefinition.returnGeometry,o.outSpatialReference=this.spatialReference,this.executeQuery(o,"execute").then(function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastRetrieved!==i)return"done";for(var o=0;o<t.features.length;o++)e.pagesDefinition.internal.set[a+o]=t.features[o].attributes[n._layer.objectIdField];if(!1===n._pageJustIds)for(o=0;o<t.features.length;o++)n._featureCache[t.features[o].attributes[n._layer.objectIdField]]=t.features[o];return t.features.length!==e.pagesDefinition.resultRecordCount&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=i+e.pagesDefinition.resultRecordCount,"done"})}catch(e){return f.reject(e)}},t.prototype._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;for(var r=!1,n=0,i=t;n<i.length;n++)if(i[n].toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},t.prototype._getFeatures=function(e,t,r,n){var i=this,a=[];try{if(-1!==t&&void 0===this._featureCache[t]&&a.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate(),n))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,n).then(function(){return i._getFeatures(e,t,r,n)});for(var o=0,s=e._lastFetchedIndex;s<e._known.length;s++){if(e._lastFetchedIndex+=1,o++,void 0===this._featureCache[e._known[s]]){var l=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){var u=this._layer._mode;if(void 0!==u._featureMap[e._known[s]]){var c=u._featureMap[e._known[s]];null!==c&&(l=!0,this._featureCache[e._known[s]]=c)}}if(!1===l&&(e._known[s]!==t&&a.push(e._known[s]),a.length>=this._maxProcessingRate()-1))break}if(o>=r&&0===a.length)break}if(0===a.length)return f.resolve("success");try{var p=new w;return this._requestStandardised&&(p.sqlFormat="standard"),p.objectIds=a,p.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),p.returnGeometry=!0,!0===this._removeGeometry&&(p.returnGeometry=!1),p.outSpatialReference=this.spatialReference,this.executeQuery(p,"execute").then(function(e){if(i._checkCancelled(n),void 0!==e.error)return f.reject(new Error(e.error));for(var t=0;t<e.features.length;t++)i._featureCache[e.features[t].attributes[i._layer.objectIdField]]=e.features[t];return"success"})}catch(e){return f.reject(e)}}catch(e){return f.reject(e)}},t.prototype._getDistinctPages=function(e,t,r,n,i,a,o,s,l){var u=this;return this._ensureLoaded().then(function(){return u.databaseType()}).then(function(p){for(var d=r.parseTree.column,h=0;h<u._layer.fields.length;h++)if(u._layer.fields[h].name.toLowerCase()===d.toLowerCase()){d=u._layer.fields[h].name;break}var y=new w;u._requestStandardised&&(y.sqlFormat="standard");var g=null===a?null===i?"1=1":"":c.toWhereClause(a,p);return u._layer.definitionExpression&&(g=""!==g?"(("+u._layer.definitionExpression+") AND ("+g+"))":u._layer.definitionExpression),y.where=g,y.spatialRelationship=u._makeRelationshipEnum(n),y.relationParameter=u._makeRelationshipParam(n),y.geometry=null===i?null:i,y.returnDistinctValues=!0,y.returnGeometry=!1,y.outFields=[d],u.executeQuery(y,"execute").then(function(c){if(u._checkCancelled(l),!c.hasOwnProperty("features"))return f.reject(new Error("Unnexected Result querying statistics from layer"));for(var p=!1,h=0;h<u._layer.fields.length;h++)if(u._layer.fields[h].name===d){"date"===u._layer.fields[h].type&&(p=!0);break}for(h=0;h<c.features.length;h++){if(p){var y=c.features[h].attributes[d];null!==y?s.push(new Date(y)):s.push(y)}else s.push(c.features[h].attributes[d]);if(s.length>=o)break}return 0===c.features.length?s:c.features.length===u._layer.capabilities.query.maxRecordCount&&s.length<o?u._getDistinctPages(e+c.features.length,t,r,n,i,a,o,s,l).then(function(e){return{calculated:!0,result:e}}):s})})},t.prototype._distinctStat=function(e,t,r,n,i,a,o){return this._getDistinctPages(0,e,t,r,n,i,a,[],o).then(function(e){return{calculated:!0,result:e}})},t.prototype.isTable=function(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType},t.prototype._countstat=function(e,t,r,n,i){var a=this;return this.databaseType().then(function(e){var i=new w;if(a._requestStandardised&&(i.sqlFormat="standard"),a.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};var o=null===n?null===r?"1=1":"":c.toWhereClause(n,e);return a._layer.definitionExpression&&(o=""!==o?"(("+a._layer.definitionExpression+") AND ("+o+"))":a._layer.definitionExpression),i.where=o,i.where=o,i.spatialRelationship=a._makeRelationshipEnum(t),i.relationParameter=a._makeRelationshipParam(t),i.geometry=null===r?null:r,i.returnGeometry=!1,a.executeQuery(i,"executeForCount").then(function(e){return{calculated:!0,result:e}})})},t.prototype._stats=function(e,t,r,n,i,a,o){var s=this;return this._ensureLoaded().then(function(){var l=s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsSqlExpression,u=s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsStatistics,h=s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsDistinct;return"count"===e?h?s._countstat(e,r,n,i,o):{calculated:!1}:!1===u||!1===p.isSingleField(t)&&!1===l||!1===t.isStandardized?""!==r||null!==i?{calculated:!1}:s._manualStat(e,t,a,o):"distinct"===e?!1===h?""!==r||null!==i?{calculated:!1}:s._manualStat(e,t,a,o):s._distinctStat(e,t,r,n,i,a,o):s.databaseType().then(function(a){if(s.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};var o=new w;s._requestStandardised&&(o.sqlFormat="standard");var l=null===i?null===n?"1=1":"":c.toWhereClause(i,a);s._layer.definitionExpression&&(l=""!==l?"(("+s._layer.definitionExpression+") AND ("+l+"))":s._layer.definitionExpression),o.where=l,o.spatialRelationship=s._makeRelationshipEnum(r),o.relationParameter=s._makeRelationshipParam(r),o.geometry=null===n?null:n;var u=new S;u.statisticType=d.decodeStatType(e),u.onStatisticField=c.toWhereClause(t,a),u.outStatisticFieldName="ARCADE_STAT_RESULT",o.returnGeometry=!1;var p="ARCADE_STAT_RESULT";return o.outStatistics=[u],s.executeQuery(o,"execute").then(function(e){if(!e.hasOwnProperty("features")||0===e.features.length)return f.reject(new Error("Unnexected Result querying statistics from layer"));for(var t=!1,r=0;r<e.fields.length;r++)if("ARCADE_STAT_RESULT"===e.fields[r].name.toUpperCase()){p=e.fields[r].name,"date"===e.fields[r].type&&(t=!0);break}if(t){var n=e.features[0].attributes[p];return null!==n&&(n=new Date(e.features[0].attributes[p])),{calculated:!0,result:n}}return{calculated:!0,result:e.features[0].attributes[p]}})})})},t.prototype._stat=function(e,t,r,n,i,a,o){return this._stats(e,t,r,n,i,a,o)},t.prototype._canDoAggregates=function(e,t,r,n,i){var a=this;return this._ensureLoaded().then(function(){var e=!1,r=a._layer.capabilities&&a._layer.capabilities.query&&!0===a._layer.capabilities.query.supportsSqlExpression;if(void 0!==a._layer.capabilities&&null!==a._layer.capabilities.query&&!0===a._layer.capabilities.query.supportsStatistics&&!0===a._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(var n=0;n<t.length-1;n++)null!==t[n].workingexpr&&(!1===t[n].workingexpr.isStandardized?e=!1:!1===p.isSingleField(t[n].workingexpr)&&!1===r&&(e=!1));return!1!==e})},t.prototype._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},t.prototype._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,i,a,o){var l=this;return this._ensureLoaded().then(function(){return l.databaseType()}).then(function(u){var p="",d=!1,f=!1;null!==a&&l._layer.capabilities&&l._layer.capabilities.query&&!0===l._layer.capabilities.query.supportsOrderBy&&(p=a.constructClause(),f=!0),l._layer.capabilities&&l._layer.capabilities.query&&!1===l._layer.capabilities.query.supportsPagination&&(f=!1,d=!0,p=l._layer.objectIdField);for(var h=[],y=0;y<t.length;y++){var g=new S;g.onStatisticField=null!==t[y].workingexpr?c.toWhereClause(t[y].workingexpr,u):"",g.outStatisticFieldName=t[y].field,g.statisticType=t[y].toStatisticsName(),h.push(g)}""===p&&(p=e.join(","));var v=l._maxQueryRate(),m=l._layer.capabilities.query.maxRecordCount;void 0!==m&&m<v&&(v=m);var _=null===i?null===n?"1=1":"":c.toWhereClause(i,u);return l._layer.definitionExpression&&(_=""!==_?"(("+l._layer.definitionExpression+") AND ("+_+"))":l._layer.definitionExpression),new s([],["GETPAGES"],f,{groupbypage:!0,spatialRel:l._makeRelationshipEnum(r),relationParam:l._makeRelationshipParam(r),outFields:["*"],useOIDpagination:d,generatedOid:o,resultRecordCount:v,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:h,geometry:null===n?null:n,where:_,orderByFields:p,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,fullyResolved:!1}})})},t.prototype._getAgregagtePhysicalPage=function(e,t,r){var i=this;try{var a=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(a=""!==a?"("+a+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());var o=e.pagesDefinition.internal.lastRetrieved,s=o,l=new w;return this._requestStandardised&&(l.sqlFormat="standard"),l.where=a,l.spatialRelationship=e.pagesDefinition.spatialRel,l.relationParameter=e.pagesDefinition.relationParam,l.outFields=e.pagesDefinition.outFields,l.outStatistics=e.pagesDefinition.outStatistics,l.geometry=e.pagesDefinition.geometry,l.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,l.num=e.pagesDefinition.resultRecordCount,l.start=e.pagesDefinition.internal.lastRetrieved,l.returnGeometry=e.pagesDefinition.returnGeometry,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&l.geometry&&l.spatialRelationship?f.resolve([]):this.executeQuery(l,"execute").then(function(t){if(i._checkCancelled(r),!t.hasOwnProperty("features"))return f.reject(new Error("Unnexected Result querying aggregates from layer"));var a=[];if(e.pagesDefinition.internal.lastRetrieved!==o)return[];for(var l=0;l<t.features.length;l++)e.pagesDefinition.internal.set[s+l]=t.features[l].attributes[e.pagesDefinition.generatedOid];for(l=0;l<t.features.length;l++)a.push(new n({attributes:t.features[l].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===t.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=t.features[t.features.length-1].attributes[e.pagesDefinition.generatedOid]:t.features.length!==e.pagesDefinition.resultRecordCount&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=o+e.pagesDefinition.resultRecordCount,a})}catch(e){return f.reject(e)}},t.create=function(e,r,n,i){return new t({layer:new y({url:e,outFields:null===r?["*"]:r}),spatialReference:n,lrucache:i})},t.prototype.relationshipMetaData=function(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]},t.prototype.serviceUrl=function(){return u.extractServiceUrl(this._layer.parsedUrl.path)},t.prototype.queryAttachments=function(e,t,r,n){var i=this;if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){var o={objectIds:[e]};return(t&&t>0||r&&r>0)&&(o.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(o.attachmentTypes=n),this._layer.queryAttachments(o).then(function(t){var r=[];return t&&t[e]&&t[e].forEach(function(t){var n=i._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();r.push(new a(t.id,t.name,t.contentType,t.size,n))}),r})}return f.resolve([])},t.prototype.queryRelatedFeatures=function(e){var t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields.join(","),returnGeometry:e.returnGeometry.toString()};return void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=JSON.stringify(e.outSpatialReference.toJSON())),i(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t}).then(function(e){if(e.data){var t={},r=e.data;if(r&&r.relatedRecordGroups)for(var i=r.spatialReference,a=0,o=r.relatedRecordGroups;a<o.length;a++){for(var s=o[a],l=s.objectId,u=[],c=0,p=s.relatedRecords;c<p.length;c++){var d=p[c];d.geometry&&(d.geometry.spatialReference=i);var y=new n({geometry:d.geometry?h.fromJSON(d.geometry):null,attributes:d.attributes});u.push(y)}t[l]={features:u,exceededTransferLimit:!0===r.exceededTransferLimit}}return t}return f.reject("Invalid Request")})},t.prototype.getFeatureByObjectId=function(e,t){var r=new v({url:this._layer.parsedUrl.path}),n=new w;return n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=this.spatialReference,n.where=this.objectIdField+"="+e.toString(),r.execute(n).then(function(e){return 1===e.features.length?e.features[0]:null})},t}(o)}.apply(null,n))||(e.exports=i)},235:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2350),r(218),r(186),r(922),r(637),r(34),r(192),r(395),r(50),r(148)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p){return function(){function e(e){this.recentlyUsedQueries=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=i.FeatureServiceDatabaseType.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,e&&e.lrucache&&(this.recentlyUsedQueries=e.lrucache)}return e.prototype.optimisePagingFeatureQueries=function(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)},e.prototype._hasMemorySource=function(){return!0},e.prototype.prop=function(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)},e.prototype.end=function(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent},e.prototype._ensureLoaded=function(){return this.load()},e.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=s.create(function(t,r){if(!0===e._parent.loaded)return e._initialiseFeatureSet(),void t(e);e._parent.load().then(function(){try{e._initialiseFeatureSet(),t(e)}catch(e){r(e)}},r)})),this._loadPromise},e.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.spatialReference=new c({wkid:4326}),this.geometryType=i.layerGeometryEsriConstants.point)},e.prototype.getField=function(e,t){var r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some(function(t){return t&&t.name.toLowerCase()===e&&(r=t),!!r})),r},e.prototype.getFieldsIndex=function(){return null===this._fieldsIndex&&(this._fieldsIndex=new p(this.fields)),this._fieldsIndex},e.prototype._maxProcessingRate=function(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())},e.prototype._maxQueryRate=function(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery},e.prototype._checkCancelled=function(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")},e.prototype.nativeCapabilities=function(){return this._parent.nativeCapabilities()},e.prototype._canDoAggregates=function(e,t,r,n,i){return null===this._parent?s.resolve(!1):this._parent._canDoAggregates(e,t,r,n,i)},e.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,i,a,o){return null===this._parent?s.reject(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,i,a,o)},e.prototype._getAgregagtePhysicalPage=function(e,t,r){return null===this._parent?s.reject(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,r)},e.prototype.databaseType=function(){var e=this;if(this._databaseType===i.FeatureServiceDatabaseType.NotEvaluated){if(null!==a.applicationCache){var t=a.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==t)return t}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;var r=[{thetype:i.FeatureServiceDatabaseType.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:i.FeatureServiceDatabaseType.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:i.FeatureServiceDatabaseType.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}],n=s.create(function(t,n){e._getDatabaseTypeImpl(r,0).then(function(r){e._databaseType=r,t(e._databaseType)},function(e){n(e)})});return null!==a.applicationCache&&(a.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),n),n=n.catch(function(t){throw a.applicationCache.clearDatabaseType(e._cacheableFeatureSetSourceKey()),t})),this._databaseTypeProbed=n,this._databaseTypeProbed}return s.resolve(this._databaseType)},e.prototype._cacheableFeatureSetSourceKey=function(){return"MUSTBESET"},e.prototype._getDatabaseTypeImpl=function(e,t){var r=this;return t>=e.length?s.resolve(i.FeatureServiceDatabaseType.StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then(function(n){return!0===n?e[t].thetype:r._getDatabaseTypeImpl(e,t+1)})},e.prototype._runDatabaseProbe=function(e){return null!==this._parent?this._parent._runDatabaseProbe(e):s.reject(new Error("Not Implemented"))},e.prototype.isTable=function(){return this._parent.isTable()},e.prototype._featureFromCache=function(e){if(void 0!==this._featureCache[e])return this._featureCache[e]},e.prototype._isInFeatureSet=function(e){return i.IdState.Unknown},e.prototype._getSet=function(e){throw new Error("Not implemented in abstract class")},e.prototype._getFeature=function(e,t,r){var n=this;try{return this._checkCancelled(r),void 0!==this._featureFromCache(t)?s.resolve(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),r).then(function(){return n._checkCancelled(r),void 0!==n._featureFromCache(t)?n._featureFromCache(t):s.reject(new Error("Feature Not Found"))})}catch(e){return s.reject(e)}},e.prototype._getFeatureBatch=function(e,t){var r=this;try{this._checkCancelled(t);var i=new n([],e,!1,null),a=[];return this._getFeatures(i,-1,e.length,t).then(function(){r._checkCancelled(t);for(var n=0,i=e;n<i.length;n++){var o=i[n];void 0!==r._featureFromCache(o)&&a.push(r._featureFromCache(o))}return a})}catch(e){return s.reject(e)}},e.prototype._getFeatures=function(e,t,r,n){return s.resolve("success")},e.prototype._getFilteredSet=function(e,t,r,n,i){throw new Error("Not implemented in abstract class")},e.prototype._refineSetBlock=function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate(),r))return this._expandPagedSet(e,this._maxQueryRate(),0,0,r).then(function(){return n._refineSetBlock(e,t,r)});this._checkCancelled(r);var i=e._candidates.length;this._refineKnowns(e,t);var a=i-e._candidates.length;return 0===e._candidates.length?s.resolve(e):a>=t?s.resolve(e):this._refineIfParentKnown(e,t-a,r).then(function(){if(n._checkCancelled(r),n._refineKnowns(e,t-a),(a=i-e._candidates.length)<t&&e._candidates.length>0){var o=t-a,s=n._prepareFetchAndRefineSet(e._candidates,n._maxQueryRate());return n._fetchAndRefineFeatures(s,s.length>o?o:e._candidates.length,r).then(function(){return n._checkCancelled(r),n._refineKnowns(e,t-a),e})}return e})}catch(e){return s.reject(e)}},e.prototype._fetchAndRefineFeatures=function(e,t,r){return null},e.prototype._prepareFetchAndRefineSet=function(e,t){for(var r=[],n=0;n<e.length;n++)this._isPhysicalFeature(e[n])&&r.push(e[n]);return r},e.prototype._isPhysicalFeature=function(e){return null===this._parent||this._parent._isPhysicalFeature(e)},e.prototype._refineKnowns=function(e,t){var r=0,n=null,a=[];t=this._maxQueryRate();for(var o=0;o<e._candidates.length&&"GETPAGES"!==e._candidates[o];o++){var s=!1,l=this._candidateIdTransform(e._candidates[o]);l!==e._candidates[o]&&(s=!0);var u=this._isInFeatureSet(l);if(u===i.IdState.InFeatureSet)!0===s?e._known.indexOf(l)<0&&(e._known.push(l),r+=1):(e._known.push(e._candidates[o]),r+=1),null===n?n={start:o,end:o}:n.end===o-1?n.end=o:(a.push(n),n={start:o,end:o});else if(u===i.IdState.NotInFeatureSet)null===n?n={start:o,end:o}:n.end===o-1?n.end=o:(a.push(n),n={start:o,end:o}),r+=1;else if(u===i.IdState.Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==n&&a.push(n);for(var c=a.length-1;c>=0;c--)e._candidates.splice(a[c].start,a[c].end-a[c].start+1)},e.prototype._refineIfParentKnown=function(e,t,r){var i=this,a=new n([],[],e._ordered,null);return a._candidates=e._candidates.slice(0),this._parent._refineSetBlock(a,t,r).then(function(t){return i._parent._transformSetWithIdChanges(e),t})},e.prototype._candidateIdTransform=function(e){return this._parent._candidateIdTransform(e)},e.prototype._transformSetWithIdChanges=function(e){this._parent._transformSetWithIdChanges(e)},e.prototype._checkIfNeedToExpandKnownPage=function(e,t,r){if(null===e.pagesDefinition)return!1;for(var n=0,i=e._lastFetchedIndex;i<e._known.length;i++){if("GETPAGES"===e._known[i])return!0;if(void 0===this._featureCache[e._known[i]]&&(n+=1)>=t)break}return!1},e.prototype._checkIfNeedToExpandCandidatePage=function(e,t,r){if(null===e.pagesDefinition)return!1;for(var n=0,i=0;i<e._candidates.length;i++){if("GETPAGES"===e._candidates[i])return!0;if((n+=1)>=t)break}return!1},e.prototype._expandPagedSet=function(e,t,r,n,i){return null===this._parent?s.reject(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,r,n,i)},e.prototype._expandPagedSetFeatureSet=function(e,t,r,n,i){var a=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(n=1),0===n&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(n=2),0===n?s.resolve("finished"):this._getPage(e,n,i).then(function(n){return r+n<t?a._expandPagedSet(e,t,r+n,0,i):"success"})},e.prototype._getPage=function(e,t,r){var n=this,i=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){i.length=i.length-1;for(var a=0,o=0;o<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+o>=e.pagesDefinition.internal.set.length);o++)i[i.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+o],a++;e.pagesDefinition.resultOffset+=a;var l=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(l=!0),!1===l&&i.push("GETPAGES"),s.resolve(a)}return this._getPhysicalPage(e,t,r).then(function(){return n._getPage(e,t,r)})},e.prototype._getPhysicalPage=function(e,t,r){return null},e.prototype._clonePageDefinition=function(e){return null===this._parent?null:this._parent._clonePageDefinition(e)},e.prototype._first=function(e){return this.iterator(e).next()},e.prototype.first=function(e){return this._first(e)},e.prototype.calculateStatistic=function(e,t,r,n){var i=this;return this._ensureLoaded().then(function(){return i._stat(e,t,"",null,null,r,n).then(function(a){return!1===a.calculated?i._manualStat(e,t,r,n).then(function(e){return e.result}):a.result})})},e.prototype._manualStat=function(e,t,r,n){switch(e.toLowerCase()){case"count":return o.count(this,n).then(function(e){return{calculated:!0,result:e}});case"distinct":return o.distinct(this,t,r).then(function(e){return{calculated:!0,result:e}});case"avg":case"mean":return o.mean(this,t,n).then(function(e){return{calculated:!0,result:e}});case"stdev":return o.stdev(this,t,n).then(function(e){return{calculated:!0,result:e}});case"variance":return o.variance(this,t,n).then(function(e){return{calculated:!0,result:e}});case"sum":return o.sum(this,t,n).then(function(e){return{calculated:!0,result:e}});case"min":return o.min(this,t,n).then(function(e){return{calculated:!0,result:e}});case"max":return o.max(this,t,n).then(function(e){return{calculated:!0,result:e}});default:return s.resolve({calculated:!0,result:0})}},e.prototype._stat=function(e,t,r,n,i,a,o){var s=this;return this._parent._stat(e,t,r,n,i,a,o).then(function(l){return!1===l.calculated?null===i&&""===r&&null===n?s._manualStat(e,t,a,o):{calculated:!1}:l})},e.prototype._unionAllGeomSelf=function(e){var t=this,r=this.iterator(this._defaultTracker(e)),n=[];return s.create(function(e,i){t._unionShapeInBatches(n,r,e,i)})},e.prototype._unionAllGeom=function(e){var t=this;return s.create(function(r,n){var i=t.iterator(t._defaultTracker(e));t._unionShapeInBatches([],i,r,n)})},e.prototype._unionShapeInBatches=function(e,t,r,n){var i=this;t.next().then(function(a){try{null!==a&&null!==a.geometry&&e.push(a.geometry),e.length>30||null===a&&e.length>1?u.union(e).then(function(o){try{null===a?r(o):(e=[o],i._unionShapeInBatches(e,t,r,n))}catch(e){n(e)}},n):null===a?r(1===e.length?e[0]:null):i._unionShapeInBatches(e,t,r,n)}catch(e){n(e)}},n)},e.prototype.iterator=function(e){return new r(this,e)},e.prototype.intersection=function(t,r){return void 0===r&&(r=!1),e._featuresetFunctions.intersection.bind(this)(t,r)},e.prototype.difference=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!0),e._featuresetFunctions.difference.bind(this)(t,r,n)},e.prototype.symmetricDifference=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!0),e._featuresetFunctions.symmetricDifference.bind(this)(t,r,n)},e.prototype.morphShape=function(t,r,n,i){return void 0===n&&(n="unknown"),void 0===i&&(i=null),e._featuresetFunctions.morphShape.bind(this)(t,r,n,i)},e.prototype.morphShapeAndAttributes=function(t,r,n){return void 0===n&&(n="unknown"),e._featuresetFunctions.morphShapeAndAttributes.bind(this)(t,r,n)},e.prototype.union=function(t,r){return void 0===r&&(r=!1),e._featuresetFunctions.union.bind(this)(t,r)},e.prototype.intersects=function(t){return e._featuresetFunctions.intersects.bind(this)(t)},e.prototype.envelopeIntersects=function(t){return e._featuresetFunctions.envelopeIntersects.bind(this)(t)},e.prototype.contains=function(t){return e._featuresetFunctions.contains.bind(this)(t)},e.prototype.overlaps=function(t){return e._featuresetFunctions.overlaps.bind(this)(t)},e.prototype.relate=function(t,r){return e._featuresetFunctions.relate.bind(this)(t,r)},e.prototype.within=function(t){return e._featuresetFunctions.within.bind(this)(t)},e.prototype.touches=function(t){return e._featuresetFunctions.touches.bind(this)(t)},e.prototype.top=function(t){return e._featuresetFunctions.top.bind(this)(t)},e.prototype.crosses=function(t){return e._featuresetFunctions.crosses.bind(this)(t)},e.prototype.buffer=function(t,r,n,i){return void 0===i&&(i=!0),e._featuresetFunctions.buffer.bind(this)(t,r,n,i)},e.prototype.filter=function(t,r){return void 0===r&&(r=null),e._featuresetFunctions.filter.bind(this)(t,r)},e.prototype.orderBy=function(t){return e._featuresetFunctions.orderBy.bind(this)(t)},e.prototype.dissolve=function(t,r){return e._featuresetFunctions.dissolve.bind(this)(t,r)},e.prototype.groupby=function(t,r){return e._featuresetFunctions.groupby.bind(this)(t,r)},e.prototype.reduce=function(e,t,r){var n=this;return void 0===t&&(t=null),s.create(function(i,a){n._reduceImpl(n.iterator(n._defaultTracker(r)),e,t,0,i,a,0)})},e.prototype._reduceImpl=function(e,t,r,n,i,a,o){var l=this;try{if(++o>1e3)return void setTimeout(function(){o=0,l._reduceImpl(e,t,r,n,i,a,o)});e.next().then(function(u){try{if(null===u)i(r);else{var c=t(r,u,n,l);s.isPromiseLike(c)?c.then(function(r){l._reduceImpl(e,t,r,n+1,i,a,o)},a):l._reduceImpl(e,t,c,n+1,i,a,o)}}catch(e){a(e)}},a)}catch(e){a(e)}},e.prototype.removeField=function(t){return e._featuresetFunctions.removeField.bind(this)(t)},e.prototype.addField=function(t,r,n){return void 0===n&&(n=null),e._featuresetFunctions.addField.bind(this)(t,r,n)},e.prototype.sumArea=function(e,t,r){void 0===t&&(t=!1);var n=i.convertSquareUnitsToCode(e);return this.reduce(function(e,r){return null===r.geometry?0:t?u.geodesicArea(r.geometry,n).then(function(t){return e+t}):u.planarArea(r.geometry,n).then(function(t){return e+t})},0,r)},e.prototype.sumLength=function(e,t,r){void 0===t&&(t=!1);var n=i.convertLinearUnitsToCode(e);return this.reduce(function(e,r){return null===r.geometry?0:t?u.geodesicLength(r.geometry,n).then(function(t){return e+t}):u.planarLength(r.geometry,n).then(function(t){return e+t})},0,r)},e.prototype._substituteVars=function(e,t){if(null!==t){var r={};for(var n in t)r[n.toLowerCase()]=t[n];e.parameters=r}},e.prototype.distinct=function(e,t,r,n){var i=this;return void 0===t&&(t=1e3),void 0===r&&(r=null),this.load().then(function(){var a=l.WhereClause.create(e,i.getFieldsIndex());return i._substituteVars(a,r),i.calculateStatistic("distinct",a,t,i._defaultTracker(n))})},e.prototype.min=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var i=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(i,t),n.calculateStatistic("min",i,-1,n._defaultTracker(r))})},e.prototype.max=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var i=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(i,t),n.calculateStatistic("max",i,-1,n._defaultTracker(r))})},e.prototype.avg=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var i=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(i,t),n.calculateStatistic("avg",i,-1,n._defaultTracker(r))})},e.prototype.sum=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var i=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(i,t),n.calculateStatistic("sum",i,-1,n._defaultTracker(r))})},e.prototype.stdev=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var i=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(i,t),n.calculateStatistic("stdev",i,-1,n._defaultTracker(r))})},e.prototype.variance=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var i=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(i,t),n.calculateStatistic("variance",i,-1,n._defaultTracker(r))})},e.prototype.count=function(e){var t=this;return this.load().then(function(){return t.calculateStatistic("count",l.WhereClause.create("1",t.getFieldsIndex()),-1,t._defaultTracker(e))})},e.prototype._defaultTracker=function(e){return e||{aborted:!1}},e.prototype.forEach=function(e,t){var r=this;return s.create(function(n,i){r._forEachImpl(r.iterator(r._defaultTracker(t)),e,r,n,i,0)})},e.prototype._forEachImpl=function(e,t,r,n,i,a){var o=this;try{if(++a>1e3)return void setTimeout(function(){a=0,o._forEachImpl(e,t,r,n,i,a)},0);e.next().then(function(l){try{if(null===l)n(r);else{var u=t(l);null==u?o._forEachImpl(e,t,r,n,i,a):s.isPromiseLike(u)?u.then(function(){try{o._forEachImpl(e,t,r,n,i,a)}catch(e){i(e)}},i):o._forEachImpl(e,t,r,n,i,a)}}catch(e){i(e)}},i)}catch(e){i(e)}},e.prototype.convertToJSON=function(e){for(var t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}},r=0;r<this.fields.length;r++)t.layerDefinition.fields.push(i.esriFieldToJson(this.fields[r]));return this.reduce(function(e){var r={geometry:e.geometry&&e.geometry.toJSON(),attributes:{}};for(var n in e.attributes)r.attributes[n]=e.attributes[n];return t.featureSet.features.push(r),1},0,e)},e.prototype.castToText=function(){return"object, FeatureSet"},e.prototype.queryAttachments=function(e,t,r,n){return this._parent.queryAttachments(e,t,r,n)},e.prototype.serviceUrl=function(){return this._parent.serviceUrl()},e.prototype.relationshipMetaData=function(){return this._parent.relationshipMetaData()},e.prototype.schema=function(){for(var e=[],t=0,r=this.fields;t<r.length;t++){var n=r[t];e.push(i.esriFieldToJson(n))}return{objectIdField:this.objectIdField,typeIdField:this.typeIdField,geometryType:void 0===i.layerGeometryEsriConstants[this.geometryType]?"":i.layerGeometryEsriConstants[this.geometryType],hasZ:this.hasZ,hasM:this.hasM,fields:e}},e.prototype.convertToText=function(e,t){var r=this;return"schema"===e?this._ensureLoaded().then(function(){return JSON.stringify(r.schema())}):"featureset"===e?this._ensureLoaded().then(function(){var e=[];return r.reduce(function(t,r){var n={geometry:r.geometry?r.geometry.toJSON():null,attributes:r.attributes};return null!==n.geometry&&n.geometry.spatialReference&&delete n.geometry.spatialReference,e.push(n),1},0,t).then(function(){var t=r.schema();return t.features=e,t.spatialReference=r.spatialReference.toJSON(),JSON.stringify(t)})}):s.resolve(this.castToText())},e.prototype.getFeatureByObjectId=function(e,t){return this._parent.getFeatureByObjectId(e,t)},e._featuresetFunctions={},e}()}.apply(null,n))||(e.exports=i)},2350:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(34)],void 0===(i=function(e,t,r){return function(){function e(e,t){this._lastId=-1,this._progress=t,this._parent=e}return e.prototype.reset=function(){this._lastId=-1},e.prototype.nextBatch=function(e){var t=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(function(r){return t.nextBatch(e)},function(r){return t.nextBatch(e)});var n={returnpromise:null,hasset:!1},i=[];return n.returnpromise=r.create(function(r,a){t._parent._getSet(t._progress).then(function(o){var s=o._known.length-1;if("GETPAGES"===o._known[o._known.length-1]&&(s-=1),t._lastId+e<s&&o._known.length>0&&"GETPAGES"===o._known[o._known.length-1])t._parent._expandPagedSet(o,t._parent._maxQueryRate(),0,0,t._progress).then(function(r){return n.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e)},function(e){n.hasset=!0,t._parent._mainSetInUse=null,a(e)});else{if(s>=t._lastId+e||0===o._candidates.length){for(var l=0;l<e;l++){var u=l+t._lastId+1;if(u>=o._known.length)break;i[l]=o._known[u]}return t._lastId+=i.length,0===i.length&&(n.hasset=!0,t._parent._mainSetInUse=null,r([])),void t._parent._getFeatureBatch(i,t._progress).then(function(e){n.hasset=!0,t._parent._mainSetInUse=null,r(e)},function(e){n.hasset=!0,t._parent._mainSetInUse=null,a(e)})}t._parent._refineSetBlock(o,t._parent._maxProcessingRate(),t._progress).then(function(){n.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(r,a)},function(e){n.hasset=!0,t._parent._mainSetInUse=null,a(e)})}},function(e){n.hasset=!0,t._parent._mainSetInUse=null,a(e)})}),!1===n.hasset&&(this._parent._mainSetInUse=n.returnpromise,n.hasset=!0),n.returnpromise},e.prototype.next=function(){var e=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(function(t){return e.next()},function(t){return e.next()});var t={returnpromise:null,hasset:!1};return t.returnpromise=r.create(function(r,n){e._parent._getSet(e._progress).then(function(i){e._lastId<i._known.length-1?"GETPAGES"===i._known[e._lastId+1]?e._parent._expandPagedSet(i,e._parent._maxQueryRate(),0,0,e._progress).then(function(r){return t.hasset=!0,e._parent._mainSetInUse=null,e.next()}).then(r,n):(e._lastId+=1,e._parent._getFeature(i,i._known[e._lastId],e._progress).then(function(n){t.hasset=!0,e._parent._mainSetInUse=null,r(n)},function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)})):i._candidates.length>0?e._parent._refineSetBlock(i,e._parent._maxProcessingRate(),e._progress).then(function(){t.hasset=!0,e._parent._mainSetInUse=null,e.next().then(r,n)},function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}):(t.hasset=!0,e._parent._mainSetInUse=null,r(null))},function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)})}),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise},e.prototype.count=function(){var e=this;return-1!==this._parent._totalCount?r.resolve(this._parent._totalCount):this._parent._getSet(this._progress).then(function(t){return e._refineAllSets(t)}).then(function(t){return e._parent._totalCount=t._known.length,r.resolve(e._parent._totalCount)})},e.prototype._refineAllSets=function(e){var t=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then(function(r){return t._refineAllSets(e)}).then(function(e){return r.resolve(e)}):e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then(function(r){return t._refineAllSets(e)}).then(function(e){return r.resolve(e)}):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then(function(e){return e._candidates.length>0?t._refineAllSets(e):r.resolve(e)}):r.resolve(e)},e}()}.apply(null,n))||(e.exports=i)},2351:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(77),r(235),r(218),r(186),r(34),r(214)],void 0===(i=function(e,t,r,n,i,a,o,s,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",r._findObjectId=-1,r._requestStandardised=!1,r._removeGeometry=!1,r._overrideFields=null,r.featureObjectId=null,r.relatedLayer=null,r.relationship=null,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,r._findObjectId=t.objectId,r.featureObjectId=t.objectId,r.relationship=t.relationship,r.relatedLayer=t.relatedLayer,void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return o.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(e){},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=s.create(function(t,r){s.all([e._layer.load(),e.relatedLayer.load()]).then(function(){e._initialiseFeatureSet(),t(e)},r)})),this._loadPromise},t.prototype.nativeCapabilities=function(){return this.relatedLayer.nativeCapabilities()},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{for(var e=[],t=[],r=0,n=this.fields;r<n.length;r++){var i=n[r];if("oid"===i.type)e.push(i),t.push(i.name);else for(var a=0,o=this._overrideFields;a<o.length;a++){if(o[a].toLowerCase()===i.name.toLowerCase()){e.push(i),t.push(i.name);break}}}this.fields=e,this._overrideFields=t}var s=this._layer.nativeCapabilities();s&&(this._databaseType=s.databaseType,this._requestStandardised=s.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types},t.prototype.databaseType=function(){var e=this;return this.relatedLayer.databaseType().then(function(){return e._databaseType=e.relatedLayer._databaseType,e._databaseType})},t.prototype.isTable=function(){return this.relatedLayer.isTable()},t.prototype._isInFeatureSet=function(e){return o.IdState.InFeatureSet},t.prototype._transformSetWithIdChanges=function(e){},t.prototype._candidateIdTransform=function(e){return e},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,null,e)}).then(function(e){return t._wset=e,e}):s.resolve(this._wset)},t.prototype._changeFeature=function(e){for(var t={},r=0,i=this.fields;r<i.length;r++){var a=i[r];t[a.name]=e.attributes[a.name]}return new n({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},t.prototype._getFilteredSet=function(e,t,r,n,i){var o=this;return this.databaseType().then(function(s){if(o.isTable()&&t&&null!==e&&""!==e)return new a([],[],!0,null);var u=o._layer.nativeCapabilities();if(!1===u.canQueryRelated)return new a([],[],!0,null);if(u.capabilities.queryRelated&&u.capabilities.queryRelated.supportsPagination)return o._getFilteredSetUsingPaging(e,t,r,n,i);var c="",p=!1;null!==n&&u.capabilities&&u.capabilities.queryRelated&&!0===u.capabilities.queryRelated.supportsOrderBy&&(c=n.constructClause(),p=!0);var d=new l;d.objectIds=[o._findObjectId];var f=null!==o._overrideFields?o._overrideFields:o._fieldsIncludingObjectId(o.relatedLayer.fields?o.relatedLayer.fields.map(function(e){return e.name}):["*"]);d.outFields=f,d.relationshipId=o.relationship.id,d.where="1=1";var h=!0;return!0===o._removeGeometry&&(h=!1),d.returnGeometry=h,o._requestStandardised&&(d.sqlFormat="standard"),d.outSpatialReference=o.spatialReference,d.orderByFields=""!==c?c.split(","):null,u.source.queryRelatedFeatures(d).then(function(n){o._checkCancelled(i);for(var s=n[o._findObjectId]?n[o._findObjectId].features:[],l=[],u=0;u<s.length;u++)o._featureCache[s[u].attributes[o._layer.objectIdField]]=s[u],l.push(s[u].attributes[o._layer.objectIdField]);var c=t&&null!==e&&""!==e,d=null!=r;return new a(c||d?l:[],c||d?[]:l,p,null)})})},t.prototype._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;for(var r=!1,n=0,i=t;n<i.length;n++)if(i[n].toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},t.prototype._getFilteredSetUsingPaging=function(e,t,r,n,i){var o=this;try{var l="",u=!1,c=this._layer.nativeCapabilities();return null!==n&&c&&c.capabilities.queryRelated&&!0===c.capabilities.queryRelated.supportsOrderBy&&(l=n.constructClause(),u=!0),this.databaseType().then(function(n){var s=o._maxQueryRate(),p=c.capabilities.query.maxRecordCount;void 0!==p&&p<s&&(s=p);var d,f=t&&null!==e&&""!==e,h=null!=r,y=!0;!0===o._removeGeometry&&(y=!1);var g=null!==o._overrideFields?o._overrideFields:o._fieldsIncludingObjectId(o.relatedLayer.fields?o.relatedLayer.fields.map(function(e){return e.name}):["*"]);return d=new a(f||h?["GETPAGES"]:[],f||h?[]:["GETPAGES"],u,{outFields:g.join(","),resultRecordCount:s,resultOffset:0,objectIds:[o._findObjectId],where:"1=1",orderByFields:l,returnGeometry:y,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}}),o._expandPagedSet(d,s,0,0,i).then(function(){return d})})}catch(e){return s.reject(e)}},t.prototype._expandPagedSet=function(e,t,r,n,i){return this._expandPagedSetFeatureSet(e,t,r,n,i)},t.prototype._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},t.prototype._getPhysicalPage=function(e,t,r){var n=this;try{var i=e.pagesDefinition.internal.lastRetrieved,a=i,o=this._layer.nativeCapabilities(),u=new l;return!0===this._requestStandardised&&(u.sqlFormat="standard"),u.relationshipId=this.relationship.id,u.objectIds=e.pagesDefinition.objectIds,u.resultOffset=e.pagesDefinition.internal.lastRetrieved,u.resultRecordCount=e.pagesDefinition.resultRecordCount,u.outFields=e.pagesDefinition.outFields.split(","),u.where=e.pagesDefinition.where,u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,u.returnGeometry=e.pagesDefinition.returnGeometry,u.outSpatialReference=this.spatialReference,o.source.queryRelatedFeatures(u).then(function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastRetrieved!==i)return 0;for(var o=t[n._findObjectId]?t[n._findObjectId].features:[],s=0;s<o.length;s++)e.pagesDefinition.internal.set[a+s]=o[s].attributes[n._layer.objectIdField];for(s=0;s<o.length;s++)n._featureCache[o[s].attributes[n._layer.objectIdField]]=o[s];var l=!t[n._findObjectId]||!1===t[n._findObjectId].exceededTransferLimit;return o.length!==e.pagesDefinition.resultRecordCount&&l&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=i+o.length,o.length})}catch(e){return s.reject(e)}},t.prototype._getFeatures=function(e,t,r,n){var i=this,a=[];-1!==t&&void 0===this._featureCache[t]&&a.push(t);var o=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,o,n))return this._expandPagedSet(e,o,0,0,n).then(function(a){return i._getFeatures(e,t,r,n)});for(var l=0,u=e._lastFetchedIndex;u<e._known.length&&(++l<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[u]&&void 0===this._featureCache[e._known[u]]&&(e._known[u]!==t&&a.push(e._known[u]),a.length>r)))&&!(l>=r&&0===a.length);u++);return 0===a.length?s.resolve("success"):s.reject(new Error("Unaccounted for Features. Not in Feature Collection"))},t.prototype._refineSetBlock=function(e,t,r){return s.resolve(e)},t.prototype._stat=function(e,t,r,n,i,a,o){return s.resolve({calculated:!1})},t.prototype._canDoAggregates=function(e,t,r,n,i){return s.resolve(!1)},t.prototype.relationshipMetaData=function(){return this.relatedLayer.relationshipMetaData()},t.prototype.serviceUrl=function(){return this.relatedLayer.serviceUrl()},t.prototype.queryAttachments=function(e,t,r,n){return this.relatedLayer.queryAttachments(e,t,r,n)},t.prototype.getFeatureByObjectId=function(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)},t}(i)}.apply(null,n))||(e.exports=i)},2352:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(77),r(155),r(927),r(641),r(638),r(235),r(218),r(639),r(923),r(186),r(236),r(236),r(637),r(2353),r(34),r(192),r(50),r(78),r(148)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p,d,f,h,y,g,v,m,_,w,S){function b(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}var F=function(e){function t(t){var r=e.call(this,t)||this;return r._decodedStatsfield=[],r._decodedGroupbyfield=[],r._candosimplegroupby=!0,r.phsyicalgroupbyfields=[],r.objectIdField="ROW__ID",r._internalObjectIdField="ROW__ID",r._adaptedFields=[],r.declaredClass="esri.arcade.featureset.actions.Aggregate",r._uniqueIds=1,r._maxQuery=10,r._maxProcessing=10,r._parent=t.parentfeatureset,r._config=t,r}return r(t,e),t.prototype.isTable=function(){return!0},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._getFilteredSet("",null,null,null,e).then(function(e){return t._wset=e,t._wset}):v.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){return d.IdState.InFeatureSet},t.prototype.nextUniqueName=function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;var t="T"+this._uniqueIds.toString();return e[t]=1,t},t.prototype.convertToEsriFieldType=function(e){return e},t.prototype._initialiseFeatureSet=function(){var e={},t=!1,r=1,n=this._parent?this._parent.getFieldsIndex():new S([]);for(this.objectIdField="ROW__ID";!1===t;){for(var i=!1,o=0;o<this._config.groupbyfields.length;o++)if(this._config.groupbyfields[o].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}if(!1===i)for(o=0;o<this._config.statsfields.length;o++)if(this._config.statsfields[o].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}!1===i?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(var s=0,l=this._config.statsfields;s<l.length;s++){var u=l[s],c=new g;c.field=u.name,c.tofieldname=u.name,c.workingexpr=u.expression instanceof m.WhereClause?u.expression:m.WhereClause.create(u.expression,n),c.typeofstat=b(u.statistic),this._decodedStatsfield.push(c)}this._decodedGroupbyfield=[];for(var p=0,y=this._config.groupbyfields;p<y.length;p++){var v={name:(u=y[p]).name,singlefield:null,tofieldname:u.name,expression:u.expression instanceof m.WhereClause?u.expression:m.WhereClause.create(u.expression,n)};this._decodedGroupbyfield.push(v)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(var F=0,I=this._parent.fields;F<I.length;F++){e[(u=I[F]).name.toUpperCase()]=1}this.types=null}else this.geometryType=d.layerGeometryEsriConstants.point,this.typeIdField="",this.types=null,this.spatialReference=new _({wkid:4326});this.fields=[];var x=new g;x.field=this.nextUniqueName(e),x.tofieldname=this.objectIdField,x.workingexpr=m.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),x.typeofstat="MIN",this._decodedStatsfield.push(x);for(var T=0,E=this._decodedGroupbyfield;T<E.length;T++){var R=E[T],C=new w;if(R.name=this.nextUniqueName(e),C.name=R.tofieldname,C.alias=C.name,f.isSingleField(R.expression)){if(!(P=this._parent.getField(h.toWhereClause(R.expression,d.FeatureServiceDatabaseType.Standardised))))throw new Error("Field is not present for Aggregation");R.name=P.name,R.singlefield=P.name,this.phsyicalgroupbyfields.push(P.name),C.type=P.type}else{C.type=this.convertToEsriFieldType(h.predictType(R.expression,this._parent.fields));var O=new w;O.name=R.name,O.alias=O.name,this.phsyicalgroupbyfields.push(R.name),this._adaptedFields.push(new a.SqlExpressionAdapted(O,R.expression)),this._candosimplegroupby=!1}this.fields.push(C)}if(this._adaptedFields.length>0)for(var D=0,A=this._parent.fields;D<A.length;D++){u=A[D];this._adaptedFields.push(new a.OriginalField(u))}for(o=0;o<this._decodedStatsfield.length;o++){C=new w;var P=null;(R=this._decodedStatsfield[o]).field=this.nextUniqueName(e),R.tofieldname===this.objectIdField&&(this._internalObjectIdField=R.field),C.name=R.tofieldname,C.alias=C.name;var j=null!==R.workingexpr&&f.isSingleField(R.workingexpr)?h.toWhereClause(R.workingexpr,d.FeatureServiceDatabaseType.Standardised):"";switch(this._decodedStatsfield[o].typeofstat){case"SUM":if(""!==j){if(!(P=this._parent.getField(j)))throw new Error("Field is not present for Aggregation");C.type=P.type}else C.type="double";break;case"MIN":case"MAX":if(""!==j){if(!(P=this._parent.getField(j)))throw new Error("Field is not present for Aggregation");C.type=P.type}else C.type="double";break;case"COUNT":C.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==j&&!(P=this._parent.getField(j)))throw new Error("Field is not present for Aggregation");C.type="double"}this.fields.push(C)}},t.prototype._canDoAggregates=function(e,t,r,n,i){return v.resolve(!1)},t.prototype._getFeatures=function(e,t,r,n){var i=this;-1!==t&&void 0===this._featureCache[t]&&[].push(t);var a=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,a,n)?this._expandPagedSet(e,a,0,0,n).then(function(a){return i._getFeatures(e,t,r,n)}):v.resolve("success")},t.prototype._getFilteredSet=function(e,t,r,n,i){var l=this;if(""!==e)return v.resolve(new u([],[],!0,null));var p=null,d={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then(function(){if(null!==r)for(var e=0;e<l._decodedStatsfield.length;e++)if(!0===f.scanForField(r,l._decodedStatsfield[e].tofieldname)){d.nowhereclause=!0,r=null;break}if(null!==n){d.ordered=!0;for(e=0;e<l._decodedStatsfield.length;e++)if(!0===n.scanForField(l._decodedStatsfield[e].tofieldname)){n=null,d.ordered=!1;break}if(null!==n)for(var t=0,i=l._decodedGroupbyfield;t<i.length;t++){var a=i[t];if(null===a.singlefield&&!0===n.scanForField(a.tofieldname)){n=null,d.ordered=!1;break}}}return!1===l._candosimplegroupby?v.resolve(!1):l._parent._canDoAggregates(l.phsyicalgroupbyfields,l._decodedStatsfield,"",null,null)}).then(function(e){if(e){var t=null;r&&(t=l._reformulateWhereClauseWithoutGroupByFields(r));var f=null;return n&&(f=l._reformulateOrderClauseWithoutGroupByFields(n)),l._parent._getAggregatePagesDataSourceDefinition(l.phsyicalgroupbyfields,l._decodedStatsfield,"",null,t,f,l._internalObjectIdField).then(function(e){return l._checkCancelled(i),p=!0===d.nowhereclause?new u(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===d.ordered&&e._ordered,l._clonePageDefinition(e.pagesDefinition)):new u(e._candidates.slice(0),e._known.slice(0),!0===d.ordered&&e._ordered,l._clonePageDefinition(e.pagesDefinition))})}var h=l._parent;if(l._adaptedFields.length>0&&(h=new a.AdaptedFeatureSet({parentfeatureset:l._parent,adaptedFields:l._adaptedFields,extraFilter:null})),!0===d.nowhereclause)p=new u(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:l._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new s({parentfeatureset:h,orderbyclause:new c(l.phsyicalgroupbyfields.join(",")+","+l._parent.objectIdField+" ASC")})}});else{var y=h;if(null!==r){var g=null;r&&(g=l._reformulateWhereClauseWithoutGroupByFields(r)),y=new o({parentfeatureset:y,whereclause:g})}p=new u(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:l._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new s({parentfeatureset:y,orderbyclause:new c(l.phsyicalgroupbyfields.join(",")+","+l._parent.objectIdField+" ASC")})}})}return p})},t.prototype._reformulateWhereClauseWithoutStatsFields=function(e){for(var t=0,r=this._decodedStatsfield;t<r.length;t++){var n=r[t];e=h.reformulateWithoutField(e,n.tofieldname,h.toWhereClause(n.workingexpr,d.FeatureServiceDatabaseType.Standardised),this._parent.getFieldsIndex())}return e},t.prototype._reformulateWhereClauseWithoutGroupByFields=function(e){for(var t=0,r=this._decodedGroupbyfield;t<r.length;t++){var n=r[t];n.tofieldname!==n.name&&(e=h.reformulateWithoutField(e,n.tofieldname,h.toWhereClause(n.expression,d.FeatureServiceDatabaseType.Standardised),this._parent.getFieldsIndex()))}return e},t.prototype._reformulateOrderClauseWithoutGroupByFields=function(e){for(var t=[],r=0,n=this._decodedGroupbyfield;r<n.length;r++){var i=n[r];i.tofieldname!==i.name&&t.push({field:i.tofieldname,newfield:i.name})}return t.length>0?e.replaceFields(t):e},t.prototype._clonePageDefinition=function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)},t.prototype._refineSetBlock=function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery,r))return this._expandPagedSet(e,this._maxQuery,0,0,r).then(function(i){return n._refineSetBlock(e,t,r)});this._checkCancelled(r);e._candidates.length;return this._refineKnowns(e,t),e._candidates.length,e._candidates.length,v.resolve(e)}catch(e){return v.reject(e)}},t.prototype._expandPagedSet=function(e,t,r,n,i){return this._expandPagedSetFeatureSet(e,t,r,n,i)},t.prototype._getPhysicalPage=function(e,t,r){var i=this;return!0===e.pagesDefinition.aggregatefeaturesetpagedefinition?v.create(function(t,n){i._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]).then(function(e){t(e)},n)}):this._getAgregagtePhysicalPage(e,t,r).then(function(e){for(var t=0,r=e;t<r.length;t++){for(var a=r[t],o={geometry:a.geometry,attributes:{}},s=0,l=i._decodedGroupbyfield;s<l.length;s++){var u=l[s];o.attributes[u.tofieldname]=a.attributes[u.name]}for(var c=0,p=i._decodedStatsfield;c<p.length;c++){u=p[c];o.attributes[u.tofieldname]=a.attributes[u.field]}i._featureCache[o.attributes[i.objectIdField]]=new n(o)}return e.length})},t.prototype._sequentialGetPhysicalItem=function(e,t,r,n){var i=this;return v.create(function(a,o){null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved?a(n.length):0===t?a(n.length):i._nextAggregateItem(e,t,r,n,function(o){null===o?a(n.length):(t-=1,a(i._sequentialGetPhysicalItem(e,t,r,n)))},o)})},t.prototype._nextAggregateItem=function(e,t,r,n,a,o){var s=this;try{i.tick(e.pagesDefinition.internal.iterator.next()).then(function(i){if(null===i)if(null!==e.pagesDefinition.internal.workingItem){var l=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(l),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(l.attributes[s.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,a(null)}else e.pagesDefinition.internal.fullyResolved=!0,a(null);else{var u=s._generateAggregateHash(i);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[i],id:u};else{if(u!==e.pagesDefinition.internal.workingItem.id){l=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(l),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(l.attributes[s.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[i],id:u},void a(l)}e.pagesDefinition.internal.workingItem.features.push(i)}s._nextAggregateItem(e,t,r,n,a,o)}},o)}catch(e){o(e)}},t.prototype._calculateFieldStat=function(e,t,r){for(var n=[],i=0;i<e.features.length;i++)if(null!==t.workingexpr){var a=t.workingexpr.calculateValue(e.features[i]);null!==a&&n.push(a)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=y.calculateStat("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=y.calculateStat("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=y.calculateStat("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=y.calculateStat("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=y.calculateStat("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=y.calculateStat("avg",n,-1)}return!0},t.prototype._calculateAndAppendAggregateItem=function(e){for(var t={attributes:{},geometry:null},r=0,i=this._decodedGroupbyfield;r<i.length;r++){var a=i[r],o=a.singlefield?e.features[0].attributes[a.singlefield]:a.expression.calculateValue(e.features[0]);t.attributes[a.tofieldname]=o}for(var s=0,l=this._decodedStatsfield;s<l.length;s++){var u=l[s];this._calculateFieldStat(e,u,t)}for(var c=[],p=0;p<this._decodedStatsfield.length;p++)c.push(this._calculateFieldStat(e,this._decodedStatsfield[p],t));return this._featureCache[t.attributes[this.objectIdField]]=new n({attributes:t.attributes,geometry:t.geometry}),t},t.prototype._generateAggregateHash=function(e){for(var t="",r=0,n=this._decodedGroupbyfield;r<n.length;r++){var i=n[r],a=i.singlefield?e.attributes[i.singlefield]:i.expression.calculateValue(e);t+=null==a?":":":"+a.toString()}return new p(t,"TEXT").getHash("SHA-1","B64")},t.prototype._stat=function(e,t,r,n,i,a,o){return v.resolve({calculated:!1})},t.prototype.getFeatureByObjectId=function(e,t){return v.resolve(null)},t}(l);return l._featuresetFunctions.groupby=function(e,t){return new F({parentfeatureset:this,groupbyfields:e,statsfields:t})},F}.apply(null,n))||(e.exports=i)},2353:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(186),r(236),r(192)],void 0===(i=function(e,t,r,n,i){function a(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");var t=i.WhereClause.create(n.toWhereClauseFromTree(e.parseTree.args.value[0],r.FeatureServiceDatabaseType.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}return function(){function e(){}return e.prototype.clone=function(){var t=new e;return t.field=this.field,t.tofieldname=this.tofieldname,t.typeofstat=this.typeofstat,t.workingexpr=this.workingexpr,t},e.parseStatField=function(t,r,n){var o=new e;o.field=t;var s=i.WhereClause.create(r,n),l=a(s);if(null===l)throw new Error("Invalid Statistic Function");var u=l.name.toUpperCase().trim();if("MIN"===u){if(o.typeofstat="MIN",o.workingexpr=l.expr,null===s)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===u){if(o.typeofstat="MAX",o.workingexpr=l.expr,null===s)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===u)o.typeofstat="COUNT",o.workingexpr=l.expr;else if("STDEV"===u){if(o.typeofstat="STDDEV",o.workingexpr=l.expr,null===s)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===u){if(o.typeofstat="SUM",o.workingexpr=l.expr,null===s)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===u){if(o.typeofstat="AVG",o.workingexpr=l.expr,null===s)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===u){if(o.typeofstat="AVG",o.workingexpr=l.expr,null===s)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==u)throw new Error("Invalid Statistic Function");if(o.typeofstat="VAR",o.workingexpr=l.expr,null===s)throw new Error("Invalid Statistic Function Parameters")}return o},e.prototype.toStatisticsName=function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg";default:return"count"}},e}()}.apply(null,n))||(e.exports=i)},2354:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(382),r(217),r(217),r(272),r(921),r(920),r(155),r(927),r(641),r(638),r(925),r(640),r(924),r(639),r(186),r(236),r(599),r(34),r(192),r(87),r(78)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p,d,f,h,y,g,v,m,_,w,S,b){function F(e,t,r){var n=e.getVariables();if(n.length>0){for(var i=[],a=0;a<n.length;a++){var o={name:n[a]};i.push(t.evaluateIdentifier(r,o))}return _.all(i).then(function(t){for(var r={},i=0;i<n.length;i++)r[n[i]]=t[i];return e.parameters=r,e})}return _.resolve(e)}function I(e,t,r){for(var n in void 0===r&&(r=null),e)if(n.toLowerCase()===t.toLowerCase())return e[n];return r}function x(e){if(null===e)return null;var t={type:I(e,"type",""),name:I(e,"name","")};if("range"===t.type)t.range=I(e,"range",[]);else{t.codedValues=[];for(var r=0,n=I(e,"codedValues",[]);r<n.length;r++){var i=n[r];t.codedValues.push({name:I(i,"name",""),code:I(i,"code",null)})}}return t}function T(e){if(null===e)return null;var t={},r=I(e,"wkt",null);null!==r&&(t.wkt=r);var n=I(e,"wkid",null);return null!==n&&(t.wkid=n),t}function E(e){if(null===e)return null;var t={hasZ:I(e,"hasz",!1),hasM:I(e,"hasm",!1)},r=I(e,"spatialreference",null);r&&(t.spatialReference=T(r));var n=I(e,"x",null);if(null!==n)return t.x=n,t.y=I(e,"y",null),t;var i=I(e,"rings",null);if(null!==i)return t.rings=i,t;var a=I(e,"paths",null);if(null!==a)return t.paths=a,t;var o=I(e,"points",null);if(null!==o)return t.points=o,t;for(var s=0,l=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];s<l.length;s++){var u=l[s],c=I(e,u,null);null!==c&&(t[u]=c)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.featuresetbyid=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(l.pcCheck(r,2,4),r[0]instanceof o){var n=l.toString(r[1]),i=l.defaultUndefined(r[2],null),a=l.toBoolean(l.defaultUndefined(r[3],!0));if(null===i&&(i=["*"]),!1===l.isArray(i))throw new Error("Invalid Parameter");return r[0].featureSetById(n,a,i)}throw new Error("Invalid Parameter")})},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.featuresetbyportalitem=function(t,n){return e.standardFunctionAsync(t,n,function(e,n,i){if(l.pcCheck(i,2,5),null===i[0])throw new Error("Portal is required");if(i[0]instanceof r){var a=l.toString(i[1]),o=l.toString(i[2]),u=l.defaultUndefined(i[3],null),c=l.toBoolean(l.defaultUndefined(i[4],!0));if(null===u&&(u=["*"]),!1===l.isArray(u))throw new Error("Invalid Parameter");var p=null;return t.services&&t.services.portal&&(p=t.services.portal),p=s.getPortal(i[0],p),s.constructFeatureSetFromPortalItem(a,o,t.spatialReference,u,c,p,t.lrucache)}if(!1===l.isString(i[0]))throw new Error("Portal is required");var d=l.toString(i[0]),f=l.toString(i[1]),h=l.defaultUndefined(i[2],null),y=l.toBoolean(l.defaultUndefined(i[3],!0));if(null===h&&(h=["*"]),!1===l.isArray(h))throw new Error("Invalid Parameter");if(t.services&&t.services.portal)return s.constructFeatureSetFromPortalItem(d,f,t.spatialReference,h,y,t.services.portal,t.lrucache);throw new Error("Portal is required")})},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(l.pcCheck(r,2,4),r[0]instanceof o){var n=l.toString(r[1]),i=l.defaultUndefined(r[2],null),a=l.toBoolean(l.defaultUndefined(r[3],!0));if(null===i&&(i=["*"]),!1===l.isArray(i))throw new Error("Invalid Parameter");return r[0].featureSetByName(n,a,i)}throw new Error("Invalid Parameter")})},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(t,r){return e.standardFunction(t,r,function(e,r,i){l.pcCheck(i,1,1);var a=i[0],o={layerDefinition:{geometryType:"",objectIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(l.isString(a))void 0!==(a=JSON.parse(a)).layerDefinition?(o.layerDefinition=a.layerDefinition,o.featureSet=a.featureSet,a.layerDefinition.spatialReference&&(o.layerDefinition.spatialReference=a.layerDefinition.spatialReference)):(o.featureSet.features=a.features,o.featureSet.geometryType=a.geometryType,o.layerDefinition.geometryType=o.featureSet.geometryType,o.layerDefinition.objectIdField=a.objectIdFieldName,o.layerDefinition.typeIdField=a.typeIdFieldName,o.layerDefinition.fields=a.fields,a.spatialReference&&(o.layerDefinition.spatialReference=a.spatialReference));else{if(!(i[0]instanceof n))throw new Error("Invalid Parameter");var s=I(a=JSON.parse(i[0].castToText()),"layerdefinition");if(null!==s){o.layerDefinition.geometryType=I(s,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.objectIdField=I(s,"objectidfield",""),o.layerDefinition.typeIdField=I(s,"typeidfield",""),(b=I(s,"spatialreference",null))&&(o.layerDefinition.spatialReference=T(b));for(var u=0,c=I(s,"fields",[]);u<c.length;u++){var p={name:I(C=c[u],"name",""),alias:I(C,"alias",""),type:I(C,"type",""),nullable:I(C,"nullable",!0),editable:I(C,"editable",!0),length:I(C,"length",null),domain:x(I(C,"domain"))};o.layerDefinition.fields.push(p)}var d=I(a,"featureset",null);if(d){for(var f={},y=0,g=o.layerDefinition.fields;y<g.length;y++)f[(S=g[y]).name.toLowerCase()]=S.name;for(var v=0,m=I(d,"features",[]);v<m.length;v++){var _={},w=I(j=m[v],"attributes",{});for(var S in w)_[f[S.toLowerCase()]]=w[S];o.featureSet.features.push({attributes:_,geometry:E(I(j,"geometry",null))})}}}else{var b;o.layerDefinition.geometryType=I(a,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.objectIdField=I(a,"objectidfieldname",""),o.layerDefinition.typeIdField=I(a,"typeidfieldname",""),(b=I(a,"spatialreference",null))&&(o.layerDefinition.spatialReference=T(b));for(var F=0,R=I(a,"fields",[]);F<R.length;F++){var C;p={name:I(C=R[F],"name",""),alias:I(C,"alias",""),type:I(C,"type",""),nullable:I(C,"nullable",!0),editable:I(C,"editable",!0),length:I(C,"length",null),domain:x(I(C,"domain"))},o.layerDefinition.fields.push(p)}f={};for(var O=0,D=o.layerDefinition.fields;O<D.length;O++)f[(S=D[O]).name.toLowerCase()]=S.name;for(var A=0,P=I(a,"features",[]);A<P.length;A++){var j;for(var S in _={},w=I(j=P[A],"attributes",{}))_[f[S.toLowerCase()]]=w[S];o.featureSet.features.push({attributes:_,geometry:E(I(j,"geometry",null))})}}}if(!1===function(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){for(var r=0,n=t;r<n.length;r++)if(n[r]===e)return!0;return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==l.isArray(e.layerDefinition.fields)&&!1!==l.isArray(e.featureSet.features)}(o))throw new Error("Invalid Parameter");return h.create(o,t.spatialReference)})},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,i){return l.pcCheck(i,2,2),l.isFeatureSet(i[0])?i[0].load().then(function(r){var n=w.WhereClause.create(i[1],r.getFieldsIndex()),a=n.getVariables();if(a.length>0){for(var o=[],s=0;s<a.length;s++){var l={name:a[s]};o.push(e.evaluateIdentifier(t,l))}return _.all(o).then(function(e){for(var t={},r=0;r<a.length;r++)t[a[r]]=e[r];return n.parameters=t,new c({parentfeatureset:i[0],whereclause:n})})}return _.resolve(new c({parentfeatureset:i[0],whereclause:n}))}):e.failDefferred("Filter cannot accept this parameter type")})},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(t,r){return e.standardFunctionAsync(t,r,function(t,r,n){if(l.pcCheck(n,2,2),l.isFeatureSet(n[0])){var i=new y(n[1]);return _.resolve(new p({parentfeatureset:n[0],orderbyclause:i}))}return e.failDefferred("Order cannot accept this parameter type")})},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(t,r){return e.standardFunctionAsync(t,r,function(t,r,n){return l.pcCheck(n,2,2),l.isFeatureSet(n[0])?_.resolve(new d({parentfeatureset:n[0],topnum:n[1]})):l.isArray(n[0])?l.toNumber(n[1])>=n[0].length?n[0].slice(0):n[0].slice(0,l.toNumber(n[1])):l.isImmutableArray(n[0])?l.toNumber(n[1])>=n[0].length()?n[0].slice(0):n[0].slice(0,l.toNumber(n[1])):e.failDefferred("Top cannot accept this parameter type")})},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){return l.pcCheck(r,1,1),l.isFeatureSet(r[0])?r[0].first(e.abortSignal).then(function(e){if(null!==e){var t=a.createFromGraphicLikeObject(e.geometry,e.attributes,r[0]);t._underlyingGraphic=e,e=t}return e}):l.isArray(r[0])?0===r[0].length?_.resolve(null):_.resolve(r[0][0]):l.isImmutableArray(r[0])?0===r[0].length()?_.resolve(null):_.resolve(r[0].get(0)):null})},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(t,r){return e.standardFunctionAsync(t,r,function(e,r,i){l.pcCheck(i,1,2);var o={minsize:-1,maxsize:-1,types:null};if(i.length>1)if(i[1]instanceof n){if(i[1].hasField("minsize")&&(o.minsize=l.toNumber(i[1].field("minsize"))),i[1].hasField("maxsize")&&(o.maxsize=l.toNumber(i[1].field("maxsize"))),i[1].hasField("types")){var u=l.toStringArray(i[1].field("types"),!1);u.length>0&&(o.types=u)}}else if(null!==i[1])throw new Error("Invalid Parameter");if(i[0]instanceof a){var c=i[0]._layer;return c instanceof S&&(c=s.constructFeatureSet(c,t.spatialReference,["*"],!0,t.lrucache)),null===c?[]:!1===l.isFeatureSet(c)?[]:c.load().then(function(){return c.queryAttachments(i[0].field(c.objectIdField),o.minsize,o.maxsize,o.types)})}if(null===i[0])return[];throw new Error("Invalid Parameter")})},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(t,r){return e.standardFunctionAsync(t,r,function(e,r,n){l.pcCheck(n,2,4);var i=n[0],o=l.toString(n[1]),u=l.defaultUndefined(n[2],null),c=l.toBoolean(l.defaultUndefined(n[3],!0));if(null===u&&(u=["*"]),!1===l.isArray(u))throw new Error("Invalid Parameter");if(null===n[0])return null;if(!(n[0]instanceof a))throw new Error("Invalid Parameter");var p=i._layer;return p instanceof S&&(p=s.constructFeatureSet(p,t.spatialReference,["*"],!0,t.lrucache)),null===p?null:!1===l.isFeatureSet(p)?null:p.load().then(function(e){var r=e.relationshipMetaData().filter(function(e){return e.name===o});if(0===r.length)return null;if(void 0!==r[0].relationshipTableId&&null!==r[0].relationshipTableId&&r[0].relationshipTableId>-1)return s.constructFeatureSetFromRelationship(e,r[0],i.field(e.objectIdField),e.spatialReference,u,c,t.lrucache);var n=e.serviceUrl();return n?(n="/"===n.charAt(n.length-1)?n+r[0].relatedTableId.toString():n+"/"+r[0].relatedTableId.toString(),s.constructFeatureSetFromUrl(n,e.spatialReference,u,c,t.lrucache).then(function(t){return t.load().then(function(){return t.relationshipMetaData()}).then(function(n){if(n=n.filter(function(e){return e.id===r[0].id}),!1===i.hasField(r[0].keyField)||null===i.field(r[0].keyField))return e.getFeatureByObjectId(i.field(e.objectIdField),[r[0].keyField]).then(function(e){if(e){var i=w.WhereClause.create(n[0].keyField+"= @id",t.getFieldsIndex());return i.parameters={id:e.attributes[r[0].keyField]},t.filter(i)}return new f({parentfeatureset:t})});var a=w.WhereClause.create(n[0].keyField+"= @id",t.getFieldsIndex());return a.parameters={id:i.field(r[0].keyField)},t.filter(a)})})):null})})},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(t,r){return e.standardFunctionAsync(t,r,function(e,r,n){l.pcCheck(n,2,3);var i=n[0],o=l.toString(l.defaultUndefined(n[1],"")).toLowerCase(),c=l.isString(n[2])?l.toString(n[2]):null;if(null===n[0])return null;if(!(n[0]instanceof a))throw new Error("Invalid Parameter");var p=i._layer;return p instanceof S&&(p=s.constructFeatureSet(p,t.spatialReference,["*"],!0,t.lrucache)),null===p?null:!1===l.isFeatureSet(p)?null:p.load().then(function(){var e=p.serviceUrl();return s.constructAssociationMetaDataFeatureSetFromUrl(e,t.spatialReference)}).then(function(e){var t=null,r=null,n=!1;if(null!==c&&""!==c&&void 0!==c){for(var a=0,s=e.terminals;a<s.length;a++){var d=s[a];d.terminalName===c&&(r=d.terminalId)}null===r&&(n=!0)}for(var f=e.associations.getFieldsIndex(),h=f.get("TOGLOBALID").name,y=f.get("FROMGLOBALID").name,v=f.get("TOTERMINALID").name,m=f.get("FROMTERMINALID").name,_=f.get("FROMNETWORKSOURCEID").name,S=f.get("TONETWORKSOURCEID").name,F=f.get("ASSOCIATIONTYPE").name,I=f.get("ISCONTENTVISIBLE").name,x=f.get("OBJECTID").name,T=0,E=p.fields;T<E.length;T++){var R=E[T];if("global-id"===R.type){t=i.field(R.name);break}}var C=null,O={};for(var D in e.lkp)O[D]=e.lkp[D].sourceId;var A=new u.StringToCodeAdapted(new b({name:"classname",alias:"classname",type:"string"}),null,O),P="";switch(o){case"connected":var j=h+"='@T'",k=y+"='@T'";null!==r&&(j+=" AND "+v+"=@A",k+=" AND "+m+"=@A"),P="(("+j+") OR ("+k+"))",P=l.multiReplace(P,"@T",t),j=l.multiReplace(j,"@T",t),null!==r&&(j=l.multiReplace(j,"@A",r.toString()),P=l.multiReplace(P,"@A",r.toString())),A.codefield=w.WhereClause.create("CASE WHEN "+j+" THEN "+_+" ELSE "+S+" END",e.associations.getFieldsIndex());var N=g.cloneField(u.AdaptedFeatureSet.findField(e.associations.fields,y));N.name="globalid",N.alias="globalid",C=new u.SqlExpressionAdapted(N,w.WhereClause.create("CASE WHEN "+j+" THEN "+y+" ELSE "+h+" END",e.associations.getFieldsIndex()));break;case"container":P=h+"='"+t+"' AND "+F+" = 2",null!==r&&(P+=" AND "+v+" = "+r.toString()),A.codefield=_,P="( "+P+" )",C=new u.FieldRename(u.AdaptedFeatureSet.findField(e.associations.fields,y),"globalid","globalid");case"content":P="("+y+"='"+t+"' AND "+F+" = 2)",null!==r&&(P+=" AND "+m+" = "+r.toString()),A.codefield=S,P="( "+P+" )",C=new u.FieldRename(u.AdaptedFeatureSet.findField(e.associations.fields,h),"globalid","globalid");break;case"structure":P="("+h+"='"+t+"' AND "+F+" = 3)",null!==r&&(P+=" AND "+v+" = "+r.toString()),A.codefield=_,P="( "+P+" )",C=new u.FieldRename(u.AdaptedFeatureSet.findField(e.associations.fields,y),"globalid","globalId");break;case"attached":P="("+y+"='"+t+"' AND "+F+" = 3)",null!==r&&(P+=" AND "+m+" = "+r.toString()),A.codefield=S,P="( "+P+" )",C=new u.FieldRename(u.AdaptedFeatureSet.findField(e.associations.fields,h),"globalid","globalId");break;default:throw new Error("Invalid Parameter")}return n&&(P="1 <> 1"),new u.AdaptedFeatureSet({parentfeatureset:e.associations,adaptedFields:[new u.OriginalField(u.AdaptedFeatureSet.findField(e.associations.fields,x)),new u.OriginalField(u.AdaptedFeatureSet.findField(e.associations.fields,I)),C,A],extraFilter:P?w.WhereClause.create(P,e.associations.getFieldsIndex()):null})})})},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return l.pcCheck(a,3,3),l.isFeatureSet(a[0])?a[0].load().then(function(r){var n=[],o=[],s=!1,u=[];if(l.isString(a[1]))u.push(a[1]);else if(a[1]instanceof i)u.push(a[1]);else if(l.isArray(a[1]))u=a[1];else{if(!l.isImmutableArray(a[1]))return e.failDefferred("Illegal Value: GroupBy");u=a[1].toArray()}for(var c=0,p=u;c<p.length;c++){var d=p[c];if(l.isString(d)){var f=w.WhereClause.create(l.toString(d),r.getFieldsIndex()),h=!0===v.isSingleField(f)?l.toString(d):"%%%%FIELDNAME";n.push({name:h,expression:f}),"%%%%FIELDNAME"===h&&(s=!0)}else{if(!(d instanceof i))return e.failDefferred("Illegal Value: GroupBy");var y=d.hasField("name")?d.field("name"):"%%%%FIELDNAME";if(f=d.hasField("expression")?d.field("expression"):"","%%%%FIELDNAME"===y&&(s=!0),!y)return e.failDefferred("Illegal Value: GroupBy");n.push({name:y,expression:w.WhereClause.create(f||y,r.getFieldsIndex())})}}if(u=[],l.isString(a[2]))u.push(a[2]);else if(l.isArray(a[2]))u=a[2];else if(l.isImmutableArray(a[2]))u=a[2].toArray();else{if(!(a[2]instanceof i))return e.failDefferred("Illegal Value: GroupBy");u.push(a[2])}for(var g=0,m=u;g<m.length;g++){if(!((d=m[g])instanceof i))return e.failDefferred("Illegal Value: GroupBy");var S=d.hasField("name")?d.field("name"):"",b=d.hasField("statistic")?d.field("statistic"):"";if(f=d.hasField("expression")?d.field("expression"):"",!S||!b||!f)return e.failDefferred("Illegal Value: GroupBy");o.push({name:S,statistic:b.toLowerCase(),expression:w.WhereClause.create(f,r.getFieldsIndex())})}if(s){for(var I={},x=0,T=r.fields;x<T.length;x++)I[(j=T[x]).name.toLowerCase()]=1;for(var E=0,R=n;E<R.length;E++)"%%%%FIELDNAME"!==(j=R[E]).name&&(I[j.name.toLowerCase()]=1);for(var C=0,O=o;C<O.length;C++)"%%%%FIELDNAME"!==(j=O[C]).name&&(I[j.name.toLowerCase()]=1);for(var D=0,A=0,P=n;A<P.length;A++){var j;if("%%%%FIELDNAME"===(j=P[A]).name){for(;1===I["field_"+D.toString()];)D++;I["field_"+D.toString()]=1,j.name="FIELD_"+D.toString()}}}for(var k=[],N=0,L=n;N<L.length;N++){var M=L[N];k.push(F(M.expression,e,t))}for(var G=0,B=o;G<B.length;G++)M=B[G],k.push(F(M.expression,e,t));return k.length>0?_.all(k).then(function(){return _.resolve(a[0].groupby(n,o))}):_.resolve(a[0].groupby(n,o))}):e.failDefferred("Illegal Value: GroupBy")})},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return l.isFeatureSet(a[0])?(l.pcCheck(a,2,2),a[0].load().then(function(r){var n=[],o=[];if(l.isString(a[1]))o.push(a[1]);else if(a[1]instanceof i)o.push(a[1]);else if(l.isArray(a[1]))o=a[1];else{if(!l.isImmutableArray(a[1]))return e.failDefferred("Illegal Value: GroupBy");o=a[1].toArray()}for(var s=!1,u=0,c=o;u<c.length;u++){var p=c[u];if(l.isString(p)){var d=w.WhereClause.create(l.toString(p),r.getFieldsIndex()),f=!0===v.isSingleField(d)?l.toString(p):"%%%%FIELDNAME";n.push({name:f,expression:d}),"%%%%FIELDNAME"===f&&(s=!0)}else{if(!(p instanceof i))return e.failDefferred("Illegal Value: GroupBy");var h=p.hasField("name")?p.field("name"):"%%%%FIELDNAME";if(d=p.hasField("expression")?p.field("expression"):"","%%%%FIELDNAME"===h&&(s=!0),!h)return e.failDefferred("Illegal Value: GroupBy");n.push({name:h,expression:w.WhereClause.create(d||h,r.getFieldsIndex())})}}if(s){for(var y={},g=0,m=r.fields;g<m.length;g++)y[(E=m[g]).name.toLowerCase()]=1;for(var S=0,b=n;S<b.length;S++)"%%%%FIELDNAME"!==(E=b[S]).name&&(y[E.name.toLowerCase()]=1);for(var I=0,x=0,T=n;x<T.length;x++){var E;if("%%%%FIELDNAME"===(E=T[x]).name){for(;1===y["field_"+I.toString()];)I++;y["field_"+I.toString()]=1,E.name="FIELD_"+I.toString()}}}for(var R=[],C=0,O=n;C<O.length;C++){var D=O[C];R.push(F(D.expression,e,t))}return R.length>0?_.all(R).then(function(){return _.resolve(a[0].groupby(n,[]))}):_.resolve(a[0].groupby(n,[]))})):function(e,t,r,n){if(1===n.length){if(l.isArray(n[0]))return m.calculateStat(e,n[0],-1);if(l.isImmutableArray(n[0]))return m.calculateStat(e,n[0].toArray(),-1)}return m.calculateStat(e,n,-1)}("distinct",0,0,a)})})}}.apply(null,n))||(e.exports=i)},2355:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(455),r(155),r(926),r(640),r(34),r(96),r(395)],void 0===(i=function(e,t,r,n,i,a,o,s,l){function u(e,t,u,c,p){return p(e,t,function(e,t,p){if(p.length<2)return c(new Error("Missing Parameters"));if(null===(p=n.autoCastFeatureToGeometry(p))[0]&&null===p[1])return o.resolve(!1);if(n.isFeatureSet(p[0]))return p[1]instanceof s?o.resolve(new i({parentfeatureset:p[0],relation:u,relationGeom:p[1]})):null===p[1]?o.resolve(new a({parentfeatureset:p[0]})):c("Spatial Relation cannot accept this parameter type");if(p[0]instanceof s){if(p[1]instanceof s){var d=null;switch(u){case"esriSpatialRelEnvelopeIntersects":d=l.intersects(r.shapeExtent(p[0]),r.shapeExtent(p[1]));break;case"esriSpatialRelIntersects":d=l.intersects(p[0],p[1]);break;case"esriSpatialRelContains":d=l.contains(p[0],p[1]);break;case"esriSpatialRelOverlaps":d=l.overlaps(p[0],p[1]);break;case"esriSpatialRelWithin":d=l.within(p[0],p[1]);break;case"esriSpatialRelTouches":d=l.touches(p[0],p[1]);break;case"esriSpatialRelCrosses":d=l.crosses(p[0],p[1])}return null!==d?d:o.reject(new Error("Unrecognised Relationship"))}return n.isFeatureSet(p[1])?o.resolve(new i({parentfeatureset:p[1],relation:u,relationGeom:p[0]})):null===p[1]?o.resolve(!1):c("Spatial Relation cannot accept this parameter type")}return null!==p[0]?c("Spatial Relation cannot accept this parameter type"):n.isFeatureSet(p[1])?o.resolve(new a({parentfeatureset:p[1]})):p[1]instanceof s||null===p[1]?o.resolve(!1):void 0})}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.intersects=function(t,r){return u(t,r,"esriSpatialRelIntersects",e.failDefferred,e.standardFunctionAsync)},e.functions.envelopeintersects=function(t,r){return u(t,r,"esriSpatialRelEnvelopeIntersects",e.failDefferred,e.standardFunctionAsync)},e.signatures.push({name:"envelopeintersects",min:"2",max:"2"}),e.functions.contains=function(t,r){return u(t,r,"esriSpatialRelContains",e.failDefferred,e.standardFunctionAsync)},e.functions.overlaps=function(t,r){return u(t,r,"esriSpatialRelOverlaps",e.failDefferred,e.standardFunctionAsync)},e.functions.within=function(t,r){return u(t,r,"esriSpatialRelWithin",e.failDefferred,e.standardFunctionAsync)},e.functions.touches=function(t,r){return u(t,r,"esriSpatialRelTouches",e.failDefferred,e.standardFunctionAsync)},e.functions.crosses=function(t,r){return u(t,r,"esriSpatialRelCrosses",e.failDefferred,e.standardFunctionAsync)},e.functions.relate=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(r=n.autoCastFeatureToGeometry(r),n.pcCheck(r,3,3),r[0]instanceof s&&r[1]instanceof s)return l.relate(r[0],r[1],n.toString(r[2]));if(r[0]instanceof s&&null===r[1])return!1;if(r[1]instanceof s&&null===r[0])return!1;if(n.isFeatureSet(r[0])&&null===r[1])return new a({parentfeatureset:r[0]});if(n.isFeatureSet(r[1])&&null===r[0])return new a({parentfeatureset:r[1]});if(n.isFeatureSet(r[0])&&r[1]instanceof s)return r[0].relate(r[1],n.toString(r[2]));if(n.isFeatureSet(r[1])&&r[0]instanceof s)return r[1].relate(r[0],n.toString(r[2]));if(null===r[0]&&null===r[1])return!1;throw new Error("Illegal Argument")})})}}.apply(null,n))||(e.exports=i)},2356:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(155),r(599),r(34),r(192)],void 0===(i=function(e,t,r,n,i,a){function o(e,t,o,l,u,c){if(1===l.length){if(r.isArray(l[0]))return i.resolve(n.calculateStat(e,l[0],r.defaultUndefined(l[1],-1)));if(r.isImmutableArray(l[0]))return i.resolve(n.calculateStat(e,l[0].toArray(),r.defaultUndefined(l[1],-1)))}else if(2===l.length){if(r.isArray(l[0]))return i.resolve(n.calculateStat(e,l[0],r.defaultUndefined(l[1],-1)));if(r.isImmutableArray(l[0]))return i.resolve(n.calculateStat(e,l[0].toArray(),r.defaultUndefined(l[1],-1)));if(r.isFeatureSet(l[0]))return l[0].load().then(function(n){return s(a.WhereClause.create(l[1],n.getFieldsIndex()),c,u).then(function(n){return l[0].calculateStatistic(e,n,r.defaultUndefined(l[2],1e3),t.abortSignal)})})}else if(3===l.length&&r.isFeatureSet(l[0]))return l[0].load().then(function(n){return s(a.WhereClause.create(l[1],n.getFieldsIndex()),c,u).then(function(n){return l[0].calculateStatistic(e,n,r.defaultUndefined(l[2],1e3),t.abortSignal)})});return i.resolve(n.calculateStat(e,l,-1))}function s(e,t,r){try{var n=e.getVariables();if(n.length>0){for(var a=[],o=0;o<n.length;o++){var s={name:n[o]};a.push(t.evaluateIdentifier(r,s))}return i.all(a).then(function(t){for(var r={},i=0;i<n.length;i++)r[n[i]]=t[i];return e.parameters=r,e})}return i.resolve(e)}catch(e){return i.reject(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.stdev=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,i){return o("stdev",r,0,i,t,e)})},e.functions.variance=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,i){return o("variance",r,0,i,t,e)})},e.functions.average=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,i){return o("mean",r,0,i,t,e)})},e.functions.mean=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,i){return o("mean",r,0,i,t,e)})},e.functions.sum=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,i){return o("sum",r,0,i,t,e)})},e.functions.min=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,i){return o("min",r,0,i,t,e)})},e.functions.max=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,i){return o("max",r,0,i,t,e)})},e.functions.count=function(t,n){return e.standardFunctionAsync(t,n,function(e,t,n){if(r.pcCheck(n,1,1),r.isFeatureSet(n[0]))return n[0].count(e.abortSignal);if(r.isArray(n[0])||r.isString(n[0]))return n[0].length;if(r.isImmutableArray(n[0]))return n[0].length();throw new Error("Invalid Parameters for Count")})})}}.apply(null,n))||(e.exports=i)},2357:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(272),r(155)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.domainname=function(t,i){return e.standardFunctionAsync(t,i,function(e,t,i){if(n.pcCheck(i,2,4),i[0]instanceof r)return i[0].domainValueLookup(n.toString(i[1]),i[2],void 0===i[3]?void 0:n.toNumber(i[3]));if(n.isFeatureSet(i[0]))return i[0]._ensureLoaded().then(function(){var e=n.getDomain(n.toString(i[1]),i[0],null,void 0===i[3]?void 0:n.toNumber(i[3]));return n.getDomainValue(e,i[2])});throw new Error("Invalid Parameter")})},e.signatures.push({name:"domainname",min:"2",max:"4"}),e.functions.domaincode=function(t,i){return e.standardFunctionAsync(t,i,function(e,t,i){if(n.pcCheck(i,2,4),i[0]instanceof r)return i[0].domainCodeLookup(n.toString(i[1]),i[2],void 0===i[3]?void 0:n.toNumber(i[3]));if(n.isFeatureSet(i[0]))return i[0]._ensureLoaded().then(function(){var e=n.getDomain(n.toString(i[1]),i[0],null,void 0===i[3]?void 0:n.toNumber(i[3]));return n.getDomainCode(e,i[2])});throw new Error("Invalid Parameter")})},e.signatures.push({name:"domaincode",min:"2",max:"4"})),e.functions.text=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(n.pcCheck(r,1,2),!n.isFeatureSet(r[0]))return n.toStringExplicit(r[0],r[1]);var i=n.defaultUndefined(r[1],"");return""===i?r[0].castToText():"schema"===i.toLowerCase()?r[0].convertToText("schema",e.abortSignal):"featureset"===i.toLowerCase()?r[0].convertToText("featureset",e.abortSignal):void 0})}}}.apply(null,n))||(e.exports=i)},236:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(155),r(186),r(192)],void 0===(i=function(e,t,r,n,i){function a(e,t){return o(e.parseTree,t,e.parameters)}function o(e,t,r,n,i){var a,c,p,f;switch(void 0===n&&(n=null),void 0===i&&(i=null),e.type){case"interval":return d(o(e.value,t,r,n,i),e.qualifier,e.op,t);case"case_expression":var h=" CASE ";"simple"===e.format&&(h+=o(e.operand,t,r,n,i));for(var y=0;y<e.clauses.length;y++)h+=" WHEN "+o(e.clauses[y].operand,t,r,n,i)+" THEN "+o(e.clauses[y].value,t,r,n,i);return null!==e.else&&(h+=" ELSE "+o(e.else,t,r,n,i)),h+" END ";case"param":var g=r[e.value.toLowerCase()];if("string"==typeof g)return"'"+r[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(g instanceof Date)return l(g,t);if(g instanceof Array){var v=[];for(y=0;y<g.length;y++)"string"==typeof g[y]?v.push("'"+g[y].toString().replace(/'/g,"''")+"'"):g[y]instanceof Date?v.push(l(g[y],t)):v.push(g[y].toString());return v}return g.toString();case"expr_list":c=[];for(var m=0,_=e.value;m<_.length;m++){var w=_[m];c.push(o(w,t,r,n,i))}return c;case"unary_expr":return" ( NOT "+o(e.expr,t,r,n,i)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+o(e.left,t,r,n,i)+" AND "+o(e.right,t,r,n,i)+") ";case"OR":return" ("+o(e.left,t,r,n,i)+" OR "+o(e.right,t,r,n,i)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+o(e.left,t,r,n,i)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+o(e.left,t,r,n,i)+" IS NOT NULL )";case"IN":return a=[],"expr_list"===e.right.type?(a=o(e.right,t,r,n,i)," ("+o(e.left,t,r,n,i)+" IN ("+a.join(",")+")) "):(f=o(e.right,t,r,n,i))instanceof Array?" ("+o(e.left,t,r,n,i)+" IN ("+f.join(",")+")) ":" ("+o(e.left,t,r,n,i)+" IN ("+f+")) ";case"NOT IN":return a=[],"expr_list"===e.right.type?(a=o(e.right,t,r,n,i)," ("+o(e.left,t,r,n,i)+" NOT IN ("+a.join(",")+")) "):(f=o(e.right,t,r,n,i))instanceof Array?" ("+o(e.left,t,r,n,i)+" NOT IN ("+f.join(",")+")) ":" ("+o(e.left,t,r,n,i)+" NOT IN ("+f+")) ";case"BETWEEN":return p=o(e.right,t,r,n,i)," ("+o(e.left,t,r,n,i)+" BETWEEN "+p[0]+" AND "+p[1]+" ) ";case"NOTBETWEEN":return p=o(e.right,t,r,n,i)," ("+o(e.left,t,r,n,i)+" NOT BETWEEN "+p[0]+" AND "+p[1]+" ) ";case"LIKE":return""!==e.escape?" ("+o(e.left,t,r,n,i)+" LIKE "+o(e.right,t,r,n,i)+" ESCAPE '"+e.escape+"') ":" ("+o(e.left,t,r,n,i)+" LIKE "+o(e.right,t,r,n,i)+") ";case"NOT LIKE":return""!==e.escape?" ("+o(e.left,t,r,n,i)+" NOT LIKE "+o(e.right,t,r,n,i)+" ESCAPE '"+e.escape+"') ":" ("+o(e.left,t,r,n,i)+" NOT LIKE "+o(e.right,t,r,n,i)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+o(e.left,t,r,n,i)+" "+e.operator+" "+o(e.right,t,r,n,i)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return l(e.value,t);case"number":return e.value.toString();case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?u(!0,t):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?u(!1,t):n&&n.toLowerCase()===e.column.toLowerCase()?"("+i+")":e.column;case"function":var S=o(e.args,t,r,n,i);return s(e.name,S,t)}throw new Error("Unsupported sql syntax "+e.type)}function s(e,t,r){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(r){case n.FeatureServiceDatabaseType.Standardised:case n.FeatureServiceDatabaseType.StandardisedNoInterval:default:return"CEILING("+t[0]+")"}case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");switch(r){case n.FeatureServiceDatabaseType.SqlServer:return"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)";default:return"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")")}case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(r){case n.FeatureServiceDatabaseType.SqlServer:return"LEN("+t[0]+")";case n.FeatureServiceDatabaseType.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");for(var i="CONCAT(",a=0;a<t.length;a++)0!==a&&(i+=","),i+=t[a];return i+")";case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":var o="";switch(r){case n.FeatureServiceDatabaseType.Oracle:return o="SUBSTR("+t[0]+","+t[1],3===t.length&&(o+=","+t[2]),o+")";case n.FeatureServiceDatabaseType.SqlServer:return 3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")";default:return o="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(o+=" FOR "+t[2]),o+")"}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function l(e,t){var i=r.MomentLibrary.Moment(e),a=0===i.minute()&&0===i.hour()&&0===i.second()&&0===i.millisecond();switch(t){case n.FeatureServiceDatabaseType.FILEGDB:case n.FeatureServiceDatabaseType.Standardised:case n.FeatureServiceDatabaseType.StandardisedNoInterval:return a?"date '"+i.format("YYYY-MM-DD")+"'":"date '"+i.format("YYYY-MM-DD HH:mm:ss")+"'";case n.FeatureServiceDatabaseType.Oracle:return a?"TO_DATE('"+i.format("YYYY-MM-DD")+"','YYYY-MM-DD')":"TO_DATE('"+i.format("YYYY-MM-DD HH:mm:ss")+"','YYYY-MM-DD HH24:MI:SS')";case n.FeatureServiceDatabaseType.SqlServer:return"'"+i.format(a?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";case n.FeatureServiceDatabaseType.PGDB:return"#"+i.format(a?"MM-DD-YYYY":"MM-DD-YYYY HH:mm:ss")+"#";case n.FeatureServiceDatabaseType.Postgres:return"TIMESTAMP '"+i.format(a?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";default:return"date '"+i.format("YYYY-MM-DD HH:mm:ss")+"'"}}function u(e,t){switch(t){case n.FeatureServiceDatabaseType.FILEGDB:case n.FeatureServiceDatabaseType.Standardised:case n.FeatureServiceDatabaseType.StandardisedNoInterval:case n.FeatureServiceDatabaseType.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case n.FeatureServiceDatabaseType.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case n.FeatureServiceDatabaseType.PGDB:case n.FeatureServiceDatabaseType.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function c(e){if(e){for(var t="",r=0,n=e;r<n.length;r++){var i=n[r];""!==i&&(t=""===t?i:f[t]<f[i]?i:t)}return t}return""}function p(e,t){return""+e.period.toUpperCase()}function d(e,t,r,n){return"INTERVAL "+r+" "+e+" "+("interval-period"===t.type?p(t):p(t.start)+" TO "+p(t.end))}Object.defineProperty(t,"__esModule",{value:!0}),t.toWhereClause=a,t.toWhereClauseFromTree=function(e,t,r){return o(e,t,r)},t.reformulateWithoutField=function(e,t,r,a){return i.WhereClause.create(o(e.parseTree,n.FeatureServiceDatabaseType.Standardised,e.parameters,t,r),a)},t.combine=function(e,t,r){return void 0===r&&(r="AND"),i.WhereClause.create("(("+a(e,n.FeatureServiceDatabaseType.Standardised)+")"+r+"("+a(t,n.FeatureServiceDatabaseType.Standardised)+"))",e.fieldsIndex)},t.translateFunctionToDatabaseSpecific=s,t.makeDateString=l,t.makeToday=u,t.predictType=function(e,t,r){void 0===r&&(r={});for(var n={},i={},a={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"},o=0,s=t;o<s.length;o++){var l=a[(u=s[o]).type];n[u.name.toLowerCase()]=void 0===l?"":l}for(var u in r)l=a[r[u]],i[u.toLowerCase()]=void 0===l?"":l;switch(function e(t,r,n,i){var a;switch(r.type){case"interval":return"integer";case"case_expression":var o=[];if("simple"===r.format){for(var s=0;s<r.clauses.length;s++)o.push(e(t,r.clauses[s].value,n,i));null!==r.else&&o.push(e(t,r.else,n,i))}else{for(var s=0;s<r.clauses.length;s++)o.push(e(t,r.else,n,i));null!==r.else&&o.push(e(t,r.else,n,i))}return c(o);case"param":var l=i[r.value.toLowerCase()];if(void 0===l&&n){var u=n[r.value.toLowerCase()];if(void 0===u)return"";if(null===u)return"";if("string"==typeof u||u instanceof String)return"string";if("boolean"==typeof u)return"boolean";if(u instanceof Date)return"date";if("number"==typeof u)return u%1==0?"integer":"double"}return void 0===l?"":l;case"expr_list":for(var p=[],d=0,f=r.value;d<f.length;d++){var h=f[d];p.push(e(t,h,n,i))}return p;case"unary_expr":return"boolean";case"binary_expr":switch(r.operator){case"AND":case"OR":return"boolean";case"IS":case"ISNOT":if("null"!==r.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":return"boolean";case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"*":case"-":case"+":case"/":return c([e(t,r.left,n,i),e(t,r.right,n,i)])}throw new Error("Not Supported Operator "+r.operator);case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===r.value?"":r.value%1==0?"integer":"double";case"date":case"timestamp":return"date";case"column_ref":if("CURRENT_DATE"===r.column.toUpperCase())return"date";if("CURRENT_TIMESTAMP"===r.column.toUpperCase())return"date";var y=t[r.column.toLowerCase()];return void 0===y?"":y;case"function":switch(r.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return(a=e(t,r.args,n,i))instanceof Array?a.length>0?a[0]:"":a;case"sign":return(a=e(t,r.args,n,i))instanceof Array&&(a=c(a)),"integer"===a||"double"===a?a:"double";case"ceiling":case"floor":case"abs":var g=e(t,r.args,n,i);return g instanceof Array?c(g):g;case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"round":return(a=e(t,r.args,n,i))instanceof Array?a.length>0?a[0]:"":a}return""}throw new Error("Unsupported sql syntax "+r.type)}(n,e.parseTree,e.parameters,i)){case"double":return"double";case"integer":return"integer";case"double":return"double";case"date":return"date";case"string":return"string"}return""};var f={boolean:1,string:2,integer:3,double:4,date:5};t.scanForField=function(e,t){return function e(t,r){if(null==t)return!1;switch(t.type){case"when_clause":return e(t.operand,r)||e(t.value,r);case"case_expression":for(var n=0,i=t.clauses;n<i.length;n++){var a=i[n];if(e(a,r))return!0}return!("simple"!==t.format||!e(t.operand,r))||!(null===t.else||!e(t.else,r));case"param":return!1;case"expr_list":for(var o=0,s=t.value;o<s.length;o++){var a=s[o];if(e(a,r))return!0}return!1;case"unary_expr":return e(t.expr,r);case"binary_expr":return e(t.left,r)||e(t.right,r);case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"column_ref":return r.toLowerCase()===t.column.toLowerCase();case"function":return e(t.args,r)}return!1}(e.parseTree,t)},t.isSingleField=function(e){return"column_ref"===e.parseTree.type},t.convertIntervalToSql=d}.apply(null,n))||(e.exports=i)},395:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(181),r.dj.m(e),r(96),r(114),r(115),r(102),r(54),r(182),r(636),r(237)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p){function d(e,t){var r;if(null==e||void 0===e)return e;if("number"==typeof e)return e;var n=e.toString();if(""===n)return null;if(2==t){if(void 0!==(r=F[n]))return r}else if(0==t){if(void 0!==(r=b[n]))return r;if(void 0!==(r=I[e]))return r}else if(3==t&&void 0!==(r=b[n]))return r;if(1==t&&void 0!==(r=I[e]))return r;if(!0===/^\d+$/.test(n))return parseInt(n);throw Error("Unrecognised Unit Type")}function f(e){if(null!=e)switch(e){case"loxodrome":return 1;case"great-elliptic":return 2;case"normal-section":return 3;case"shape-preserving":return 4}return 0}function h(e){if(null==e)return null;if(S)switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m};case"multipoint":return{points:e.points,hasZ:e.hasZ,hasM:e.hasM};case"polyline":return{paths:e.paths,hasZ:e.hasZ,hasM:e.hasM};case"polygon":return{rings:e.rings,hasZ:e.hasZ,hasM:e.hasM};case"extent":return{xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax}}else switch(e.type){case"point":return{x:e.x,y:e.y};case"multipoint":return{points:e.points};case"polyline":return{paths:e.paths};case"polygon":return{rings:e.rings};case"extent":return{xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax}}return null}function y(e,t){if(null===e)return null;var r=function(e){if(void 0===s.fromJson){if(void 0!==e.x&&void 0!==e.y)return new s(e);if(void 0!==e.paths)return new o(e);if(void 0!==e.rings)return new a(e);if(void 0!==e.points)return new u(e);if(void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax)return new l(e)}else{if(void 0!==e.x&&void 0!==e.y)return s.fromJson(e);if(void 0!==e.paths)return o.fromJson(e);if(void 0!==e.rings)return a.fromJson(e);if(void 0!==e.points)return u.fromJson(e);if(void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax)return l.fromJson(e)}}(e);return S?r.set("spatialReference",t):r.setSpatialReference(t),r}function g(e){return null==e||void 0===e?null:-1!=e.wkid&&null!==e.wkid&&void 0!==e.wkid?{wkid:e.wkid}:""!==e.wkt&&void 0!==e.wkt&&null!==e.wkt?{wkt:e.wkt}:null}function v(e,t,r){var n=new p,i=t.spatialReference;return T.a({action:e,geoma:h(t),geomb:h(r),spatialReference:g(t.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(y(e.result,i))},function(e){n.reject(e)}),n.promise}function m(e,t,r){var n=new p;return T.a({action:e,geoma:h(t),geomb:h(r),spatialReference:g(t.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise}var _,w,S=0==r.version.indexOf("4.");(w=_||(_={}))[w.Linear=0]="Linear",w[w.Angular=1]="Angular",w[w.Area=2]="Area",w[w.LinearOrAngular=3]="LinearOrAngular";var b={feet:9002,kilometers:9036,meters:9001,miles:9035,"nautical-miles":9030,yards:9096},F={acres:109402,ares:109463,hectares:109401,"square-feet":109405,"square-kilometers":109414,"square-meters":109404,"square-miles":109413,"square-yards":109442},I={degrees:9102,radians:9101},x=function(){function t(){this.c=!0,this.i=null}return t.prototype.A=function(e){var t=this;this.i=new c,this.i.setWorker(this.l(),function(){t.c=!1,e()})},t.prototype.l=function(){return e.B?e.B("./geometryenginewebworker"):n.id.replace(/\/[^\/]*$/gi,"/")+"./geometryenginewebworker"},t}(),T=function(){function e(){}return e.a=function(t){var r=new p;return e.h.push({task:t,d:r}),e.f(),r.promise},e.f=function(){if(0<e.h.length){for(var t=null,r=0;r<e.b.length;r++)if(!1===e.b[r].c){t=e.b[r];break}if(null===t&&e.b.length<e.g&&(r=new x,e.b.push(r),r.A(function(){e.f()})),null!==t){var n=this.h.shift();t.c=!0,t.i.postMessage(n.task).then(function(r){t.c=!1;try{n.d.resolve(r)}catch(e){}e.f()},function(r){t.c=!1;try{n.d.reject(r)}catch(e){}e.f()})}}},e.b=[],e.h=[],e.g=4,e}();return function(){function e(){}return e._removeAllWorkers=function(){T.b=[]},e._setMaxWorkers=function(t){e._removeAllWorkers(),T.g=t},e._getMaxWorkers=function(){return T.g},e._getNumWorkers=function(){return T.b.length},e.extendedSpatialReferenceInfo=function(e){var t=new p;return T.a({action:"extendedspatialreferenceinfo",spatialReference:g(e)}).then(function(e){0===e.status?t.reject(Error(e.error.message)):t.resolve(e.result)},function(e){t.reject(e)}),t.promise},e.equals=function(e,t){return!(null===e&&null!==t||null===t&&null!==e)&&m("equals",e,t)},e.intersects=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("intersects",e,t)},e.touches=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("touches",e,t)},e.within=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("within",e,t)},e.disjoint=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("disjoint",e,t)},e.overlaps=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("overlaps",e,t)},e.crosses=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("crosses",e,t)},e.contains=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return m("contains",e,t)},e.isSimple=function(e){return m("issimple",e,null)},e.clip=function(e,t){return v("clip",e,t)},e.simplify=function(e){var t=new p,r=e.spatialReference;return T.a({action:"simplify",geoma:h(e),spatialReference:g(e.spatialReference)}).then(function(e){0===e.status?t.reject(Error(e.error.message)):t.resolve(y(e.result,r))},function(e){t.reject(e)}),t.promise},e.rotate=function(e,t,r){var n=new p,i=e.spatialReference;if(null==r)switch(e.type){case"point":r=e;break;case"extent":r=S?e.get("center"):e.getCenter();break;default:r=S?e.get("extent").get("center"):e.getExtent().getCenter()}return T.a({action:"rotate",geoma:h(e),spatialReference:g(e.spatialReference),angle:t,rotpt:h(r)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(y(e.result,i))},function(e){n.reject(e)}),n.promise},e.flipHorizontal=function(e,t){var r=new p,n=e.spatialReference;if(null==t)switch(e.type){case"point":t=e;break;case"extent":t=S?e.get("center"):e.getCenter();break;default:t=S?e.get("extent").get("center"):e.getExtent().getCenter()}return T.a({action:"fliph",geoma:h(e),spatialReference:g(e.spatialReference),flippt:h(t)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(y(e.result,n))},function(e){r.reject(e)}),r.promise},e.flipVertical=function(e,t){var r=new p,n=e.spatialReference;if(null==t)switch(e.type){case"point":t=e;break;case"extent":t=S?e.get("center"):e.getCenter();break;default:t=S?e.get("extent").get("center"):e.getExtent().getCenter()}return T.a({action:"flipv",geoma:h(e),spatialReference:g(e.spatialReference),flippt:h(t)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(y(e.result,n))},function(e){r.reject(e)}),r.promise},e.distance=function(e,t,r){var n=new p;return T.a({action:"distance",geoma:h(e),geomb:h(t),spatialReference:g(e.spatialReference),distanceunits:d(r,3)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},e.relate=function(e,t,r){var n=new p;return T.a({action:"relate",geoma:h(e),geomb:h(t),relation:r,spatialReference:g(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},e.nearestCoordinate=function(e,t,r){var n=new p,i=e.spatialReference;return T.a({action:"nearestcoord",geoma:h(e),geomb:h(t),spatialReference:g(e.spatialReference),testinterior:void 0===r||r}).then(function(e){0===e.status?n.reject(Error(e.error.message)):(e.result.coordinate=y(e.result.coordinate,i),n.resolve(e.result))},function(e){n.reject(e)}),n.promise},e.nearestVertex=function(e,t){var r=new p,n=e.spatialReference;return T.a({action:"nearestvertex",geoma:h(e),geomb:h(t),spatialReference:g(e.spatialReference)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):(e.result.coordinate=y(e.result.coordinate,n),r.resolve(e.result))},function(e){r.reject(e)}),r.promise},e.nearestVertices=function(e,t,r,n){var i=new p,a=e.spatialReference;return T.a({action:"nearestvertices",geoma:h(e),geomb:h(t),spatialReference:g(e.spatialReference),searchradius:r,maxreturn:n}).then(function(e){if(0===e.status)i.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t].coordinate=y(e.result[t].coordinate,a);i.resolve(e.result)}},function(e){i.reject(e)}),i.promise},e.cut=function(e,t){var r=new p,n=e.spatialReference;return T.a({action:"cut",geoma:h(e),geomb:h(t),spatialReference:g(e.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],n);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},e.generalize=function(e,t,r,n){var i=new p,a=e.spatialReference;return T.a({action:"generalize",geoma:h(e),maxdeviation:t,removedegenerateparts:r,maxdeviationunit:d(n,3),spatialReference:g(e.spatialReference)}).then(function(e){0===e.status?i.reject(Error(e.error.message)):i.resolve(y(e.result,a))},function(e){i.reject(e)}),i.promise},e.densify=function(e,t,r){var n=new p,i=e.spatialReference;return T.a({action:"densify",geoma:h(e),maxsegmentlength:t,maxsegmentlengthunit:d(r,3),spatialReference:g(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(y(e.result,i))},function(e){n.reject(e)}),n.promise},e.geodesicDensify=function(e,t,r,n){void 0===n&&(n=0);var i=new p,a=e.spatialReference;return T.a({action:"geodensify",geoma:h(e),maxsegmentlength:t,maxsegmentlengthunit:d(r,3),spatialReference:g(e.spatialReference),curveType:n}).then(function(e){0===e.status?i.reject(Error(e.error.message)):i.resolve(y(e.result,a))},function(e){i.reject(e)}),i.promise},e.intersect=function(t,r){return t instanceof i?v("intersect",t,r):e.u(t,r)},e.u=function(e,t){for(var r=new p,n=[],i=0;i<e.length;i++)n.push(h(e[i]));var a=t.spatialReference;return T.a({action:"intersectmany",geom:h(t),geometries:n,spatialReference:g(t.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],a);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},e.difference=function(t,r){return t instanceof i?v("difference",t,r):e.s(t,r)},e.s=function(e,t){for(var r=new p,n=[],i=0;i<e.length;i++)n.push(h(e[i]));var a=t.spatialReference;return T.a({action:"differencemany",geom:h(t),geometries:n,spatialReference:g(t.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],a);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},e.symmetricDifference=function(t,r){return t instanceof i?v("symdifference",t,r):e.w(t,r)},e.w=function(e,t){for(var r=new p,n=[],i=0;i<e.length;i++)n.push(h(e[i]));var a=t.spatialReference;return T.a({action:"symdifferencemany",geom:h(t),geometries:n,spatialReference:g(t.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],a);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},e.union=function(e,t){void 0===t&&(t=null);var r=new p,n=[];if(null===e)return r.resolve(null),r.promise;if(e instanceof i&&(e=[e],null!==t&&e.push(t)),0===e.length)return r.resolve(null),r.promise;for(var a=0;a<e.length;a++)n.push(h(e[a]));var o=e[0].spatialReference;return T.a({action:"unionmany",geometries:n,spatialReference:g(o)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(y(e.result,o))},function(e){r.reject(e)}),r.promise},e.buffer=function(t,r,n,a){if(void 0===a&&(a=!1),t instanceof i){var o=new p,s=t.spatialReference;return T.a({action:"buffer",geoma:h(t),spatialReference:g(t.spatialReference),distance:r,unit:d(n,3),geodesic:!1,geodesicmaxdeviation:NaN,geodesiccurvetype:0}).then(function(e){0===e.status?o.reject(Error(e.error.message)):o.resolve(y(e.result,s))},function(e){o.reject(e)}),o.promise}if("[object Array]"!==Object.prototype.toString.call(r)){for(var l=[],u=0;u<t.length;u++)l.push(r);r=l}if(r.length!=t.length){if(0==r.length)throw Error("Illegal Argument Exception");l=[];var c=0;for(u=0;u<t.length;u++)void 0===r[u]?l.push(c):(l.push(r[u]),c=r[u]);r=l}return e.j(t,r,n,!1,a,"geodesic",NaN)},e.geodesicBuffer=function(t,r,n,a,o,s){if(t instanceof i){var l=new p;void 0===o&&(o=NaN);var u=t.spatialReference;return T.a({action:"buffer",geoma:h(t),spatialReference:g(t.spatialReference),distance:r,unit:d(n,0),geodesic:!0,geodesicmaxdeviation:o,geodesiccurvetype:f(a)}).then(function(e){0===e.status?l.reject(Error(e.error.message)):l.resolve(y(e.result,u))},function(e){l.reject(e)}),l.promise}if("[object Array]"!==Object.prototype.toString.call(r)){for(var c=[],v=0;v<t.length;v++)c.push(r);r=c}if(r.length!=t.length){if(0==r.length)throw Error("Illegal Argument Exception");c=[];var m=0;for(v=0;v<t.length;v++)void 0===r[v]?c.push(m):(c.push(r[v]),m=r[v]);r=c}return e.j(t,r,n,!0,a,o,s)},e.j=function(e,t,r,n,i,a,o){var s=new p,l=[];if(void 0===o&&(o=NaN),null===e||0===e.length)return s.resolve(null),s.promise;for(var u=0;u<e.length;u++)l.push(h(e[u]));r=d(r,n?0:3);var c=e[0].spatialReference;return T.a({action:"buffermany",geometries:l,spatialReference:g(c),distances:t,tounionresults:i,unit:r,geodesic:n,geodesicmaxdeviation:o,geodesiccurvetype:f(a)}).then(function(e){if(0===e.status)s.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],c);s.resolve(e.result)}},function(e){s.reject(e)}),s.promise},e.convexHull=function(t,r){if(void 0===r&&(r=!1),t instanceof i){var n=new p,a=t.spatialReference;return T.a({action:"convexhull",geoma:h(t),spatialReference:g(t.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(y(e.result,a))},function(e){n.reject(e)}),n.promise}return e.o(t,r)},e.o=function(e,t){for(var r=new p,n=[],i=0;i<e.length;i++)n.push(h(e[i]));var a=0<e.length?e[0].spatialReference:null;return T.a({action:"convexhullmany",geometries:n,merge:t}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],a);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},e.offset=function(t,r,n,a,o,s){var l=0;if(null!=a&&null!=a)switch(a){case"round":l=0;break;case"bevel":l=1;break;case"miter":l=2;break;case"square":l=3}if(t instanceof i){var u=new p,c=t.spatialReference;return T.a({action:"offset",geoma:h(t),spatialReference:g(t.spatialReference),distance:r,joins:l,bevelratio:o,flattenerror:s,offsetunit:d(n,3)}).then(function(e){0===e.status?u.reject(Error(e.error.message)):u.resolve(y(e.result,c))},function(e){u.reject(e)}),u.promise}return e.v(t,r,n,l,o,s)},e.v=function(e,t,r,n,i,a){for(var o=new p,s=[],l=0;l<e.length;l++)s.push(h(e[l]));var u=0<e.length?e[0].spatialReference:null;return T.a({action:"offsetmany",geometries:s,spatialReference:g(u),distance:t,joins:n,bevelratio:i,offsetunit:d(r,3),flattenerror:a}).then(function(e){if(0===e.status)o.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=y(e.result[t],u);o.resolve(e.result)}},function(e){o.reject(e)}),o.promise},e.planarArea=function(e,t){var r=new p;return T.a({action:"area",geoma:h(e),unit:d(t,2),spatialReference:g(e.spatialReference)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(e.result)},function(e){r.reject(e)}),r.promise},e.planarLength=function(e,t){var r=new p;return T.a({action:"length",geoma:h(e),unit:d(t,3),spatialReference:g(e.spatialReference)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(e.result)},function(e){r.reject(e)}),r.promise},e.geodesicArea=function(e,t,r){var n=new p;return T.a({action:"geodesicarea",geoma:h(e),unit:d(t,2),geodesiccurvetype:f(r),spatialReference:g(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},e.geodesicLength=function(e,t,r){var n=new p;return T.a({action:"geodesiclength",geoma:h(e),unit:d(t,0),geodesiccurvetype:f(r),spatialReference:g(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},e}()}.apply(null,n))||(e.exports=i)},53:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(35),r(39),r(75),r(61),r(67),r(139)],void 0===(i=function(e,t,r,n,i,a,o,s){Object.defineProperty(t,"__esModule",{value:!0}),t.screenSizePerspectiveEnabled={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader:function(e,t){return null==t.screenSizePerspective&&"defaults"===this.originOf("screenSizePerspectiveEnabled")?void i.getProperties(this).store.set("screenSizePerspectiveEnabled",!1,0):t.screenSizePerspective}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer:function(e,t,r,n){"defaults"===this.originOf("screenSizePerspectiveEnabled")&&e?t[r]=e:a.willPropertyWrite(this,"screenSizePerspectiveEnabled",{},n)&&(t[r]=e)}}}}}},t.popupEnabled={type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",writer:function(e,t,r){t[r]=!e}}}},t.labelsVisible={type:Boolean,json:{read:{source:"showLabels"},write:{target:"showLabels"}}},t.url={type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writer:n.write}}},t.legendEnabled={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}},t.elevationInfo={value:null,type:o,json:{origins:{service:{read:{source:"elevationInfo"},write:{target:"elevationInfo",enabled:!1}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}},t.readOnlyService=function(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}},t.opacity={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0}}}},t.opacityDrawingInfo=r({},t.opacity,{json:r({},t.opacity.json,{origins:{"web-document":r({},t.opacity.json.origins["web-document"],{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:function(e,t,r){return r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?s.transparencyToOpacity(t.layerDefinition.drawingInfo.transparency):void 0:s.transparencyToOpacity(t.drawingInfo.transparency)}}})})}.apply(null,n))||(e.exports=i)},59:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(31),r(32),r(36),r(37),r(34),r(39),r(30),r(72),r(76)],void 0===(i=function(e,t,n,i,a,o,s,l,u,c,p,d,f){Object.defineProperty(t,"__esModule",{value:!0});var h=l.getLogger("esri.layers.mixins.PortalLayer");t.PortalLayer=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"portalItem",{set:function(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))},enumerable:!0,configurable:!0}),t.prototype.readPortalItem=function(e,t,r){if(t.itemId)return new f({id:t.itemId,portal:r&&r.portal})},t.prototype.writePortalItem=function(e,t){e&&e.id&&(t.itemId=e.id)},t.prototype.loadFromPortal=function(e,t){return o(this,void 0,void 0,function(){var n,i;return a(this,function(a){switch(a.label){case 0:if(!this.portalItem||!this.portalItem.id)return[2];a.label=1;case 1:return a.trys.push([1,4,,5]),[4,u.create(function(e){return r.e(99).then(function(){var t=[r(123)];e.apply(null,t)}.bind(this)).catch(r.oe)})];case 2:return n=a.sent(),u.throwIfAborted(t),[4,n.load({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData},t)];case 3:return[2,a.sent()];case 4:throw i=a.sent(),h.warn("Failed to load layer ("+this.title+", "+this.id+") portal item ("+this.portalItem.id+")\n  "+i),i;case 5:return[2]}})})},t.prototype.read=function(e,t){var r=arguments;t&&(t.layer=this),this.inherited(r)},t.prototype.write=function(e,t){var r=t&&t.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||d.getDefault());return r&&n&&!c.hasSamePortal(n.restUrl,r.restUrl)?(t.messages&&t.messages.push(new s("layer:cross-portal","The layer '"+this.title+" ("+this.id+")' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer",{layer:this})),null):this.inherited(arguments)},i([p.property({type:f})],t.prototype,"portalItem",null),i([p.reader("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),i([p.writer("portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),i([p.subclass("esri.layers.mixins.PortalLayer")],t)}(p.declared(e))}}.apply(null,n))||(e.exports=i)},636:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(34),r(39)],void 0===(i=function(e,t,r,n){return function(){function t(){var e=this;this.worker=null,this._queue=new Map,this._useProxy=!1,this._acceptMessage=function(t){var r=t.data,n=r.msgId;if(e._queue.has(n)){var i=e._queue.get(n);"error"===r.status?(i.reject(t.data),e._queue.delete(n)):(i.resolve(t.data),e._queue.delete(n))}},this._errorMessage=function(e){console.log("Worker Error: "+e.message+"\nIn "+e.filename+" on "+e.lineno)}}return t.prototype.setWorker=function(e,t){var r=this._getUrl(e);r=n.normalize(r);var i,a=!n.hasSameOrigin(r,location.href);if(this.worker&&((i=this.worker).removeEventListener("message",this._acceptMessage,!1),i.removeEventListener("error",this._errorMessage,!1),i.terminate(),i=null),a){var o=URL.createObjectURL(new Blob(['\nfunction actionHandler(evt) {\n  var msg = evt.data;\n  var error, success;\n\n  if (msg.action) {\n    switch (msg.action) {\n      case "import-script":\n        try {\n          if (!Array.isArray(msg.url)) {\n            msg.url = [msg.url];\n          }\n\n          importScripts(msg.url);\n          success = true;\n        }\n        catch (err) {\n          error = err;\n        }\n\n        break;\n    }\n\n    if (success) {\n      postMessage({\n        msgId: msg.msgId,\n        success: true\n      });\n    }\n    else if (error) {\n      postMessage({\n        status: "error",\n        msgId: msg.msgId,\n        message: error.message\n      });\n    }\n  }\n}\n\nself.addEventListener("message", actionHandler, false);\n'],{type:"text/javascript"}));t(this._createWorker(o,r))}else t(this._createWorker(r))},t.prototype.postMessage=function(e,t){if(!this.worker)return r.reject({message:"No worker was set."});(Array.isArray(e)||"object"!=typeof e)&&(e={data:e});var n=r.createDeferred(),i=Math.floor(64e9*Math.random()).toString(36);return e.msgId=i,this._queue.set(i,n),t?this.worker.postMessage(e,t):this.worker.postMessage(e),n.promise},t.prototype.terminate=function(){this.worker&&this.worker.terminate(),this._queue.forEach(function(e){e.reject(r.createAbortError("terminated"))}),this._queue.clear()},t.prototype.importScripts=function(e){var t=this;Array.isArray(e)||(e=[e]);var r=e.map(function(e){var r=t._getUrl(e,!0);return t._useProxy&&!n.hasSameOrigin(r,location.href)&&(r=n.getProxyUrl(r).path+"?"+encodeURI(r)),r});return this.postMessage({action:"import-script",url:r}).then(function(e){e.target=t})},t.prototype._createWorker=function(e,t){var r=new Worker(e);return r.addEventListener("message",this._acceptMessage,!1),r.addEventListener("error",this._errorMessage,!1),this.worker=r,t&&this.importScripts(t),r},t.prototype._getUrl=function(t,r){void 0===r&&(r=!1),t.match(/\.js$/)||(t+=".js");var i=e.toUrl(t);return r?n.makeAbsolute(i):i},t}()}.apply(null,n))||(e.exports=i)},637:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(155),r(186),r(236),r(34)],void 0===(i=function(e,t,r,n,i,a){function o(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function s(e){for(var t=o(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/e.length}function l(e){for(var t=o(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/(e.length-1)}function u(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function c(e,t,r,n){void 0===n&&(n=!1);try{var i=e.iterator(r);return a.create(function(e,r){p(i,[],t,n,e,r)})}catch(e){return a.reject(e)}}function p(e,t,n,i,a,o){r.tick(e.next().then(function(r){try{if(null!==r){var s=n.calculateValue(r);return null===s?!1===i&&(t[t.length]=s):t[t.length]=s,p(e,t,n,i,a,o)}a(t)}catch(e){o(e)}},o))}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeStatType=function(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""},t.calculateStat=function(e,t,r){switch(void 0===r&&(r=1e3),e.toLowerCase()){case"distinct":return function(e,t){for(var r=[],i={},a=[],o=0;o<e.length;o++){if(void 0!==e[o]&&null!==e[o]){var s=e[o];if(n.isNumber(s)||n.isString(s))void 0===i[s]&&(r.push(s),i[s]=1);else{for(var l=!1,u=0;u<a.length;u++)!0===n.equalityTest(a[u],s)&&(l=!0);!1===l&&(a.push(s),r.push(s))}}if(r.length>=t&&-1!==t)return r}return r}(t,r);case"avg":case"mean":return o(t);case"min":return Math.min.apply(Math,t);case"sum":return u(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(s(t));case"var":case"variance":return s(t);case"count":return t.length}return 0},t.min=function(e,t,r){return c(e,t,r,!0).then(function(e){return 0===e.length?null:Math.min.apply(Math,e)})},t.max=function(e,t,r){return c(e,t,r,!0).then(function(e){return 0===e.length?null:Math.max.apply(Math,e)})},t.mean=function(e,t,r){var n="";return!1===i.isSingleField(t)&&(n=i.predictType(t,e.fields,null)),c(e,t,r,!0).then(function(e){if(0===e.length)return null;var t=o(e);return null===t?t:"integer"===n?function(e){return e=+e,isFinite(e)?e-e%1||(e<0?-0:0===e?e:0):e}(t):t})},t.variance=function(e,t,r){return c(e,t,r,!0).then(function(e){return 0===e.length?null:l(e)})},t.stdev=function(e,t,r){return c(e,t,r,!0).then(function(e){return 0===e.length?null:Math.sqrt(l(e))})},t.sum=function(e,t,r){return c(e,t,r,!0).then(function(e){return 0===e.length?null:u(e)})},t.count=function(e,t){try{return e.iterator(t).count()}catch(e){return a.reject(e)}},t.distinct=function(e,t,r,n){return void 0===r&&(r=1e3),void 0===n&&(n=null),function(e,t,r,n){try{return function e(t,r,n,i,a){return t.next().then(function(o){if(null!==o){var s=i.calculateValue(o);return null!=s&&void 0===r[s]&&(n.push(s),r[s]=1),n.length>=a&&-1!==a?n:e(t,r,n,i,a)}return n})}(e.iterator(n),{},[],t,r)}catch(e){return a.reject(e)}}(e,t,r,n)}}.apply(null,n))||(e.exports=i)},638:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(155),r(235),r(218),r(639),r(34)],void 0===(i=function(e,t,r,n,i,a,o,s){var l=function(e){function t(t){var r=e.call(this,t)||this;return r._orderbyclause=null,r.declaredClass="esri.arcade.featureset.actions.OrderBy",r._maxProcessing=100,r._orderbyclause=t.orderbyclause,r._parent=t.parentfeatureset,r}return r(t,e),t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,t._orderbyclause,e)}).then(function(r){return t._checkCancelled(e),t._wset=r,t._wset}):s.resolve(this._wset)},t.prototype.manualOrderSet=function(e,t){var r=this;return this.getIdColumnDictionary(e,[],-1,t).then(function(e){r._orderbyclause.order(e);for(var t=new a([],[],!0,null),n=0;n<e.length;n++)t._known.push(e[n].id);return t})},t.prototype.getIdColumnDictionary=function(e,t,r,i){var a=this;if(r<e._known.length-1){var o=this._maxQueryRate();if("GETPAGES"===e._known[r+1])return n.tick(this._parent._expandPagedSet(e,o,0,0,i)).then(function(n){return a.getIdColumnDictionary(e,t,r,i)});for(var l=r+1,u=[];l<e._known.length&&"GETPAGES"!==e._known[l];)u.push(e._known[l]),l++;return r+=u.length,n.tick(this._parent._getFeatureBatch(u,i)).then(function(n){a._checkCancelled(i);for(var o=0,s=n;o<s.length;o++){var l=s[o];t.push({id:l.attributes[a.objectIdField],feature:l})}return a.getIdColumnDictionary(e,t,r,i)})}return e._candidates.length>0?n.tick(this._refineSetBlock(e,this._maxProcessingRate(),i)).then(function(){return a._checkCancelled(i),a.getIdColumnDictionary(e,t,r,i)}):s.resolve(t)},t.prototype._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){if(void 0===this._featureCache[e]){var t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]},t.prototype._fetchAndRefineFeatures=function(e,t,r){return s.reject(new Error("Fetch and Refine should not be called in this featureset"))},t.prototype._getFilteredSet=function(e,t,r,n,i){var o=this;return this._ensureLoaded().then(function(){return o._parent._getFilteredSet(e,t,r,null===n?o._orderbyclause:n,i)}).then(function(e){var n;o._checkCancelled(i),n=new a(e._candidates.slice(0),e._known.slice(0),e._ordered,o._clonePageDefinition(e.pagesDefinition));var s=!0;return e._candidates.length>0&&(s=!1),!1===n._ordered?o.manualOrderSet(n,i).then(function(e){return!1===s&&(null===t&&null===r||(e=new a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,o._clonePageDefinition(e.pagesDefinition)))),e}):n})},t}(i);return i._featuresetFunctions.orderBy=function(e){return""===e?this:new l({parentfeatureset:this,orderbyclause:new o(e)})},l}.apply(null,n))||(e.exports=i)},639:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}return function(){function e(e){var t=e.split(",");this._fields=[],this._directions=[];for(var r=0;r<t.length;r++){var n=t[r].match(/\S+/g);this._fields.push(n[0]),2===n.length?"asc"===n[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}return e.prototype.constructClause=function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e},e.prototype.order=function(e){var t=this;e.sort(function(e,n){for(var i=0;i<t._fields.length;i++){var a,o=t.featureValue(e.feature,t._fields[i],i),s=t.featureValue(n.feature,t._fields[i],i);if(0!==(a=1===t._directions[i]?r(o,s):-1*r(o,s)))return a}return 0})},e.prototype.scanForField=function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1},e.prototype.replaceFields=function(t){for(var r="",n=0;n<this._fields.length;n++){0!==n&&(r+=",");for(var i=this._fields[n],a=0,o=t;a<o.length;a++){var s=o[a];if(i.toLowerCase()===s.field.toLowerCase()){i=s.newfield;break}}r+=i,1===this._directions[n]?r+=" ASC":r+=" DESC"}return new e(r)},e.prototype.featureValue=function(e,t,r){var n=e.attributes[t];if(void 0!==n)return n;for(var i in e.attributes)if(t.toLowerCase()===i.toLowerCase())return this._fields[r]=i,e.attributes[i];return null},e}()}.apply(null,n))||(e.exports=i)},64:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(36),r(34),r(30),r(137),r(61),r(53)],void 0===(i=function(e,t,n,i,a,o,s,l,u,c){Object.defineProperty(t,"__esModule",{value:!0}),t.OperationalLayer=function(e){return function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.title="Layer",t}return n(r,e),r.prototype.writeListMode=function(e,t,r,n){n&&"ground"===n.layerContainerType?t[r]=e:e&&u.willPropertyWrite(this,r,{},n)&&(t[r]=e)},r.prototype.writeTitle=function(e,t){t.title=e||"Layer"},r.prototype.writeOperationalLayerType=function(e,t){e&&(t.layerType=e)},r.prototype.read=function(e,t){var r=this,n=arguments;t&&(t.layer=this),l.readLoadable(this,e,function(t){return r.inherited(n,[e,t])},t)},r.prototype.write=function(e,r){if(r&&r.origin){var n=r.origin+"/"+(r.layerContainerType||"operational-layers"),i=t.supportedTypes[n],o=i&&i[this.operationalLayerType];if("write"!==o&&"readwrite"!==o)return r.messages&&r.messages.push(new a("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' are not supported in the context of '"+n+"'",{layer:this})),null}var s=this.inherited(arguments,[e,r]),l=!!r&&!!r.messages&&!!r.messages.filter(function(e){return e instanceof a&&"web-document-write:property-required"===e.name}).length;return!this.url&&l?null:s},i([s.property({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}}}}})],r.prototype,"id",void 0),i([s.property({json:{write:{ignoreOrigin:!0}}})],r.prototype,"listMode",void 0),i([s.writer("listMode")],r.prototype,"writeListMode",null),i([s.property({type:String,json:{write:{ignoreOrigin:!0,allowNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}}}}})],r.prototype,"title",void 0),i([s.writer("title")],r.prototype,"writeTitle",null),i([s.property({type:String,readOnly:!0,json:{write:{target:"layerType",ignoreOrigin:!0}}})],r.prototype,"operationalLayerType",void 0),i([s.writer("operationalLayerType")],r.prototype,"writeOperationalLayerType",null),i([s.property(c.opacity)],r.prototype,"opacity",void 0),i([s.property({type:Boolean,json:{read:{source:"visibility"},write:{target:"visibility"},origins:{"web-document":{read:{source:"visibility"},write:{target:"visibility"},default:!0}}}})],r.prototype,"visible",void 0),i([s.subclass("esri.layers.mixins.OperationalLayer")],r)}(s.declared(e))},t.typeModuleMap={ArcGISFeatureLayer:function(){return o.create(function(e){return Promise.all([r.e(0),r.e(71)]).then(function(){var t=[r(87)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISImageServiceLayer:function(){return o.create(function(e){return Promise.all([r.e(1),r.e(13),r.e(17)]).then(function(){var t=[r(128)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISImageServiceVectorLayer:function(){return o.resolve(null)},ArcGISMapServiceLayer:function(){return o.create(function(e){return Promise.all([r.e(4),r.e(78)]).then(function(){var t=[r(109)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISSceneServiceLayer:function(){return o.create(function(e){return Promise.all([r.e(0),r.e(24)]).then(function(){var t=[r(131)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISStreamLayer:function(){return o.create(function(e){return Promise.all([r.e(0),r.e(26)]).then(function(){var t=[r(133)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISTiledElevationServiceLayer:function(){return o.create(function(e){return r.e(11).then(function(){var t=[r(118)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISTiledImageServiceLayer:function(){return o.create(function(e){return Promise.all([r.e(4),r.e(12)]).then(function(){var t=[r(62)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISTiledMapServiceLayer:function(){return o.create(function(e){return Promise.all([r.e(4),r.e(12)]).then(function(){var t=[r(62)];e.apply(null,t)}.bind(this)).catch(r.oe)})},BingMapsAerial:function(){return o.create(function(e){return r.e(15).then(function(){var t=[r(51)];e.apply(null,t)}.bind(this)).catch(r.oe)})},BingMapsRoad:function(){return o.create(function(e){return r.e(15).then(function(){var t=[r(51)];e.apply(null,t)}.bind(this)).catch(r.oe)})},BingMapsHybrid:function(){return o.create(function(e){return r.e(15).then(function(){var t=[r(51)];e.apply(null,t)}.bind(this)).catch(r.oe)})},BuildingSceneLayer:function(){return o.create(function(e){return r.e(21).then(function(){var t=[r(132)];e.apply(null,t)}.bind(this)).catch(r.oe)})},CSV:function(){return o.create(function(e){return Promise.all([r.e(0),r.e(25)]).then(function(){var t=[r(127)];e.apply(null,t)}.bind(this)).catch(r.oe)})},GeoRSS:function(){return o.create(function(e){return r.e(97).then(function(){var t=[r(120)];e.apply(null,t)}.bind(this)).catch(r.oe)})},GroupLayer:function(){return o.create(function(e){return r.e(109).then(function(){var t=[r(111)];e.apply(null,t)}.bind(this)).catch(r.oe)})},IntegratedMeshLayer:function(){return o.create(function(e){return r.e(83).then(function(){var t=[r(122)];e.apply(null,t)}.bind(this)).catch(r.oe)})},KML:function(){return o.create(function(e){return r.e(29).then(function(){var t=[r(129)];e.apply(null,t)}.bind(this)).catch(r.oe)})},OpenStreetMap:function(){return o.create(function(e){return r.e(84).then(function(){var t=[r(121)];e.apply(null,t)}.bind(this)).catch(r.oe)})},PointCloudLayer:function(){return o.create(function(e){return r.e(19).then(function(){var t=[r(130)];e.apply(null,t)}.bind(this)).catch(r.oe)})},VectorTileLayer:function(){return o.create(function(e){return r.e(22).then(function(){var t=[r(134)];e.apply(null,t)}.bind(this)).catch(r.oe)})},WebTiledLayer:function(){return o.create(function(e){return r.e(85).then(function(){var t=[r(95)];e.apply(null,t)}.bind(this)).catch(r.oe)})},WFS:function(){return o.resolve(null)},WMS:function(){return o.create(function(e){return r.e(30).then(function(){var t=[r(135)];e.apply(null,t)}.bind(this)).catch(r.oe)})},RasterDataLayer:function(){return o.resolve(null)}},t.supportedTypes={"web-scene/operational-layers":{ArcGISFeatureLayer:"readwrite",ArcGISImageServiceLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISSceneServiceLayer:"readwrite",ArcGISTiledElevationServiceLayer:"read",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",BuildingSceneLayer:"readwrite",GroupLayer:"readwrite",IntegratedMeshLayer:"readwrite",PointCloudLayer:"readwrite",WebTiledLayer:"readwrite",CSV:"readwrite",VectorTileLayer:"readwrite",WMS:"readwrite",KML:"readwrite",RasterDataLayer:"readwrite"},"web-scene/basemap":{ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",WebTiledLayer:"readwrite",OpenStreetMap:"readwrite",VectorTileLayer:"readwrite",ArcGISImageServiceLayer:"readwrite",WMS:"readwrite",ArcGISMapServiceLayer:"readwrite"},"web-scene/ground":{ArcGISTiledElevationServiceLayer:"readwrite"},"web-map/operational-layers":{ArcGISImageServiceLayer:"readwrite",ArcGISImageServiceVectorLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISStreamLayer:"readwrite",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",ArcGISFeatureLayer:"readwrite",BingMapsAerial:"readwrite",BingMapsRoad:"readwrite",BingMapsHybrid:"readwrite",CSV:"readwrite",GeoRSS:"readwrite",KML:"readwrite",VectorTileLayer:"readwrite",WFS:"readwrite",WMS:"readwrite",WebTiledLayer:"readwrite"},"web-map/basemap":{ArcGISImageServiceLayer:"readwrite",ArcGISImageServiceVectorLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",OpenStreetMap:"readwrite",VectorTileLayer:"readwrite",WMS:"readwrite",WebTiledLayer:"readwrite",BingMapsAerial:"readwrite",BingMapsRoad:"readwrite",BingMapsHybrid:"readwrite"}}}.apply(null,n))||(e.exports=i)},640:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(235),r(218),r(186),r(34)],void 0===(i=function(e,t,r,n,i,a,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.layers.featureset.sources.Empty",r._maxProcessing=1e3,r._wset=new i([],[],!1,null),r._parent=t.parentfeatureset,r._databaseType=a.FeatureServiceDatabaseType.Standardised,r}return r(t,e),t.prototype._getSet=function(e){return o.resolve(this._wset)},t.prototype.optimisePagingFeatureQueries=function(e){},t.prototype._isInFeatureSet=function(e){return a.IdState.NotInFeatureSet},t.prototype._getFeature=function(e,t){return o.reject(new Error("No Feature Found in EmptySet"))},t.prototype.queryAttachments=function(e,t,r,n){return o.resolve([])},t.prototype._getFeatures=function(e,t,r,n){return o.resolve("success")},t.prototype._featureFromCache=function(e){return null},t.prototype._fetchAndRefineFeatures=function(e,t,r){return o.reject(new Error("Fetch and Refine should not be called in this featureset"))},t.prototype._getFilteredSet=function(e,t,r,n,a){return o.resolve(new i([],[],!1,null))},t.prototype._stat=function(e,t,r,n,i,a,o){return this._manualStat(e,t,a,o)},t.prototype._canDoAggregates=function(e,t,r,n,i){return o.resolve(!1)},t}(n)}.apply(null,n))||(e.exports=i)},641:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(235),r(218),r(186),r(236),r(34),r(192),r(50)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u){var c=function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.actions.AttributeFilter",r._maxProcessing=1e3,r._parent=t.parentfeatureset,t.whereclause instanceof l.WhereClause?(r._whereclause=t.whereclause,r._whereClauseFunction=null):(r._whereClauseFunction=t.whereclause,r._whereclause=null),r}return r(t,e),t.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.spatialReference=new u({wkid:4326}),this.geometryType=a.layerGeometryEsriConstants.point)},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._parent._getFilteredSet("",null,t._whereclause,null,e)}).then(function(r){return t._checkCancelled(e),null!==t._whereClauseFunction?t._wset=new i(r._candidates.slice(0).concat(r._known.slice(0)),[],r._ordered,t._clonePageDefinition(r.pagesDefinition)):t._wset=new i(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset}):s.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);return t===a.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?a.IdState.Unknown:t},t.prototype._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){return this._parent._featureFromCache(e)},t.prototype.executeWhereClause=function(e){return this._whereclause.testFeature(e)},t.prototype.executeWhereClauseDeferred=function(e){if(null!==this._whereClauseFunction)try{var t=this._whereClauseFunction(e);return s.isPromiseLike(t)?t:s.resolve(t)}catch(e){return s.reject(e)}return s.resolve(this.executeWhereClause(e))},t.prototype._fetchAndRefineFeatures=function(e,t,r){var n=this,o=new i([],e,!1,null),l=Math.min(t,e.length);return this._parent._getFeatures(o,-1,l,r).then(function(){if(n._checkCancelled(r),null==n._whereClauseFunction){for(var i=0;i<l;i++){var o=n._parent._featureFromCache(e[i]);!0===n.executeWhereClause(o)?n._idstates[e[i]]=a.IdState.InFeatureSet:n._idstates[e[i]]=a.IdState.NotInFeatureSet}return"success"}var u=[];for(i=0;i<l;i++){o=n._parent._featureFromCache(e[i]);u.push(n.executeWhereClauseDeferred(o))}return s.all(u).then(function(r){for(var i=0;i<t;i++)!0===r[i]?n._idstates[e[i]]=a.IdState.InFeatureSet:n._idstates[e[i]]=a.IdState.NotInFeatureSet;return"success"})})},t.prototype._getFilteredSet=function(e,t,r,n,a){var s=this;return null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=o.combine(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then(function(){return s._parent._getFilteredSet(e,t,r,n,a)}).then(function(e){return s._checkCancelled(a),null!==s._whereClauseFunction?new i(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,s._clonePageDefinition(e.pagesDefinition)):new i(e._candidates.slice(0),e._known.slice(0),e._ordered,s._clonePageDefinition(e.pagesDefinition))})},t.prototype._stat=function(e,t,r,n,i,a,l){var u=this;if(null!==this._whereClauseFunction)return null===i&&""===r&&null===n?this._manualStat(e,t,a,l):s.resolve({calculated:!1});var c=this._whereclause;return null!==i&&null!==this._whereclause&&(c=o.combine(this._whereclause,i)),this._parent._stat(e,t,r,n,c,a,l).then(function(o){return!1===o.calculated?null===i&&""===r&&null===n?u._manualStat(e,t,a,l):{calculated:!1}:o})},t.prototype._canDoAggregates=function(e,t,r,n,i){return null!==this._whereClauseFunction?s.resolve(!1):(null!==i?null!==this._whereclause&&(i=o.combine(this._whereclause,i)):i=this._whereclause,null===this._parent?s.resolve(!1):this._parent._canDoAggregates(e,t,r,n,i))},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,i,a,l){return null===this._parent?s.reject(new Error("Should never be called")):(null!==i?null!==this._whereclause&&(i=o.combine(this._whereclause,i)):i=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,i,a,l))},t}(n);return n._featuresetFunctions.filter=function(e){if("function"==typeof e)return new c({parentfeatureset:this,whereclause:e});var t=null;return e instanceof l.WhereClause&&(t=e),new c({parentfeatureset:this,whereclause:t})},c}.apply(null,n))||(e.exports=i)},66:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(30)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ScaleRangeLayer=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minScale=0,t.maxScale=0,t}return r(t,e),Object.defineProperty(t.prototype,"scaleRangeId",{get:function(){return this.minScale+","+this.maxScale},enumerable:!0,configurable:!0}),n([i.property({type:Number,json:{write:!0}})],t.prototype,"minScale",void 0),n([i.property({type:Number,json:{write:!0}})],t.prototype,"maxScale",void 0),n([i.property({readOnly:!0,dependsOn:["minScale","maxScale"]})],t.prototype,"scaleRangeId",null),n([i.subclass("esri.layers.mixins.ScaleRangeLayer")],t)}(i.declared(e))}}.apply(null,n))||(e.exports=i)},67:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(31),r(32),r(41),r(33),r(30),r(68),r(69)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c){var p=o.strict()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),d=new o.JSONMap({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var i;return r(t,e),i=t,t.prototype.readFeatureExpressionInfo=function(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0},t.prototype.writeFeatureExpressionInfo=function(e,t,r,n){t[r]=e.write(null,n),"0"===e.expression&&(t.featureExpression={value:0})},Object.defineProperty(t.prototype,"mode",{get:function(){return this._isOverridden("mode")?this._get("mode"):null!=this.offset||this.featureExpressionInfo?"relative-to-ground":"on-the-ground"},set:function(e){this._override("mode",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unit",{set:function(e){this._set("unit",e)},enumerable:!0,configurable:!0}),t.prototype.write=function(){return this.offset||this.mode||this.featureExpressionInfo||this.unit?this.inherited(arguments):null},t.prototype.clone=function(){return new i({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})},n([l.property({type:u,json:{write:!0}})],t.prototype,"featureExpressionInfo",void 0),n([l.reader("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],t.prototype,"readFeatureExpressionInfo",null),n([l.writer("featureExpressionInfo",{featureExpressionInfo:{type:u},"featureExpression.value":{type:[0]}})],t.prototype,"writeFeatureExpressionInfo",null),n([l.property({type:p.apiValues,dependsOn:["offset","featureExpressionInfo"],nonNullable:!0,json:{type:p.jsonValues,read:p.read,write:{writer:p.write,isRequired:!0}}})],t.prototype,"mode",null),n([l.property({type:Number,json:{write:!0}})],t.prototype,"offset",void 0),n([l.property({type:c.supportedUnits,json:{type:String,read:d.read,write:d.write}})],t.prototype,"unit",null),i=n([l.subclass("esri.layers.support.ElevationInfo")],t)}(l.declared(s.JSONSupport))}.apply(null,n))||(e.exports=i)},68:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(31),r(32),r(33),r(30),r(65)],void 0===(i=function(e,t,r,n,i,a,o,s,l){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var o;return r(t,e),o=t,t.prototype.collectRequiredFields=function(e,t){return a(this,void 0,void 0,function(){return i(this,function(r){return[2,l.collectArcadeFieldNames(e,t,this.expression)]})})},t.prototype.clone=function(){return new o({expression:this.expression,title:this.title})},n([s.property({type:String,json:{write:!0}})],t.prototype,"expression",void 0),n([s.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),o=n([s.subclass("esri.layers.support.FeatureExpressionInfo")],t)}(s.declared(o.JSONSupport))}.apply(null,n))||(e.exports=i)},69:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(110)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.supportsUnit=function(e){return null!=r.meterIn[e]},t.getMetersPerUnit=function(e){return 1/(r.meterIn[e]||1)},t.supportedUnits=function(){var e=Object.keys(r.meterIn);return e.sort(),e}()}.apply(null,n))||(e.exports=i)},74:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(42),r(42),r(71),r(97),r(41),r(33),r(38),r(30),r(48),r(46),r(80),r(85),r(93)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p,d,f,h,y,g){var v=new l.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),m=new l.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(e){function t(t){var r=e.call(this,t)||this;return r.cacheHint=!1,r.datumTransformation=null,r.distance=void 0,r.gdbVersion=null,r.geometry=null,r.geometryPrecision=void 0,r.groupByFieldsForStatistics=null,r.having=null,r.historicMoment=null,r.maxAllowableOffset=void 0,r.maxRecordCountFactor=1,r.multipatchOption=null,r.num=void 0,r.objectIds=null,r.orderByFields=null,r.outFields=null,r.outSpatialReference=null,r.outStatistics=null,r.parameterValues=null,r.pixelSize=null,r.quantizationParameters=null,r.rangeValues=null,r.relationParameter=null,r.resultType=null,r.returnCentroid=!1,r.returnDistinctValues=!1,r.returnExceededLimitFeatures=!0,r.returnGeometry=!1,r.returnQueryGeometry=!1,r.returnM=void 0,r.returnZ=void 0,r.source=null,r.spatialRelationship="intersects",r.start=void 0,r.sqlFormat=null,r.text=null,r.timeExtent=null,r.units=null,r.where=null,r}var l;return r(t,e),l=t,t.from=function(e){return d.ensureClass(l,e)},t.prototype.castDatumTransformation=function(e){return"number"==typeof e||"object"==typeof e?e:null},t.prototype.writeHistoricMoment=function(e,t){t.historicMoment=e&&e.getTime()},t.prototype.writeParameterValues=function(e,t){if(e){var r={};for(var n in e){var i=e[n];Array.isArray(i)?r[n]=i.map(function(e){return e instanceof Date?e.getTime():e}):i instanceof Date?r[n]=i.getTime():r[n]=i}t.parameterValues=r}},t.prototype.writeStart=function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"},t.prototype.writeWhere=function(e,t){t.where=e||"1=1"},t.prototype.clone=function(){return new l(c.clone({cacheHint:this.cacheHint,datumTransformation:this.datumTransformation,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,source:this.source,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,units:this.units,where:this.where}))},t.MAX_MAX_RECORD_COUNT_FACTOR=5,n([p.property({type:Boolean,json:{write:!0,default:!1}})],t.prototype,"cacheHint",void 0),n([p.property({json:{write:!0}})],t.prototype,"datumTransformation",void 0),n([p.cast("datumTransformation")],t.prototype,"castDatumTransformation",null),n([p.property({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],t.prototype,"distance",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"gdbVersion",void 0),n([p.property({types:a.geometryTypes,json:{read:f.fromJSON,write:!0}})],t.prototype,"geometry",void 0),n([p.property({type:Number,json:{write:!0}})],t.prototype,"geometryPrecision",void 0),n([p.property({type:[String],json:{write:!0}})],t.prototype,"groupByFieldsForStatistics",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"having",void 0),n([p.property({type:Date})],t.prototype,"historicMoment",void 0),n([p.writer("historicMoment")],t.prototype,"writeHistoricMoment",null),n([p.property({type:Number,json:{write:!0}})],t.prototype,"maxAllowableOffset",void 0),n([p.property({type:Number,cast:function(e){return e<1?1:e>l.MAX_MAX_RECORD_COUNT_FACTOR?l.MAX_MAX_RECORD_COUNT_FACTOR:e},json:{write:{overridePolicy:function(e){return{enabled:e>1}}}}})],t.prototype,"maxRecordCountFactor",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"multipatchOption",void 0),n([p.property({type:Number,json:{read:{source:"resultRecordCount"}}})],t.prototype,"num",void 0),n([p.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([p.property({type:[String],json:{write:!0}})],t.prototype,"orderByFields",void 0),n([p.property({type:[String],json:{write:!0}})],t.prototype,"outFields",void 0),n([p.property({type:i.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t.prototype,"outSpatialReference",void 0),n([p.property({type:[g],json:{write:!0}})],t.prototype,"outStatistics",void 0),n([p.property({json:{write:!0}})],t.prototype,"parameterValues",void 0),n([p.writer("parameterValues")],t.prototype,"writeParameterValues",null),n([p.property({types:o.symbolTypes,json:{read:h.read,write:!0}})],t.prototype,"pixelSize",void 0),n([p.property({type:y.default,json:{write:!0}})],t.prototype,"quantizationParameters",void 0),n([p.property({type:[Object],json:{write:!0}})],t.prototype,"rangeValues",void 0),n([p.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy:function(){return{enabled:"relation"===this.spatialRelationship}}}}})],t.prototype,"relationParameter",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"resultType",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnCentroid",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnDistinctValues",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:!e}}}}})],t.prototype,"returnExceededLimitFeatures",void 0),n([p.property({type:Boolean,json:{write:!0}})],t.prototype,"returnGeometry",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnQueryGeometry",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnM",void 0),n([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnZ",void 0),n([p.property({json:{write:!0}})],t.prototype,"source",void 0),n([p.property({type:String,json:{read:{source:"spatialRel",reader:v.read},write:{target:"spatialRel",writer:v.write}}})],t.prototype,"spatialRelationship",void 0),n([p.property({type:Number,json:{read:{source:"resultOffset"}}})],t.prototype,"start",void 0),n([p.writer("start"),p.writer("num")],t.prototype,"writeStart",null),n([p.property({type:String,json:{write:!0}})],t.prototype,"sqlFormat",void 0),n([p.property({type:String,json:{write:!0}})],t.prototype,"text",void 0),n([p.property({type:s,json:{write:!0}})],t.prototype,"timeExtent",void 0),n([p.property({type:String,json:{read:m.read,write:{writer:m.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],t.prototype,"units",void 0),n([p.property({type:String,json:{write:{overridePolicy:function(e){return{enabled:null!=e||this.start>0}}}}})],t.prototype,"where",void 0),n([p.writer("where")],t.prototype,"writeWhere",null),l=n([p.subclass("esri.tasks.support.Query")],t)}(p.declared(u.JSONSupport))}.apply(null,n))||(e.exports=i)},85:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(42),r(41),r(33),r(38),r(30)],void 0===(i=function(e,t,r,n,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var u=new a.default({upperLeft:"upper-left",lowerLeft:"lower-left"}),c=function(e){function t(t){var r=e.call(this,t)||this;return r.extent=null,r.mode="view",r.originPosition="upper-left",r.tolerance=1,r}var a;return r(t,e),a=t,t.prototype.clone=function(){return new a(s.clone({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))},n([l.property({type:i.Extent,json:{write:!0}})],t.prototype,"extent",void 0),n([l.property({type:["view","edit"],json:{write:!0}})],t.prototype,"mode",void 0),n([l.property({type:String,json:{read:u.read,write:u.write}})],t.prototype,"originPosition",void 0),n([l.property({type:Number,json:{write:!0}})],t.prototype,"tolerance",void 0),a=n([l.subclass("esri.tasks.support.QuantizationParameters")],t)}(l.declared(o.JSONSupport));t.default=c}.apply(null,n))||(e.exports=i)},88:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(30)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshableLayer=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshInterval=0,t}return r(t,e),t.prototype.refresh=function(){this.emit("refresh")},n([i.property({type:Number,cast:function(e){return e>=.1?e:e<=0?0:.1},json:{write:!0,origins:{"web-document":{write:!0}}}})],t.prototype,"refreshInterval",void 0),n([i.subclass("esri.layers.mixins.RefreshableLayer")],t)}(i.declared(e))}}.apply(null,n))||(e.exports=i)},920:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(35),r(44),r(921),r(2349),r(924),r(2351),r(922),r(186),r(34),r(87),r(72),r(76),r(638),r(925),r(926),r(641),r(2352)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p,d,f,h){function y(e,t){if(u.applicationCache){var r=u.applicationCache.getLayerInfo(e);if(r)return r.then(function(r){return p.resolve(new d({url:e,outFields:t,sourceJSON:r}))});var n=new d({url:e,outFields:t}),i=p.create(function(e,t){n.load().then(function(){e(n.sourceJSON)},function(e){t(e)})});return u.applicationCache&&(u.applicationCache.setLayerInfo(e,i),i=i.catch(function(t){throw u.applicationCache.clearLayerInfo(e),t})),i.then(function(e){return p.resolve(n)})}return p.resolve(new d({url:e,outFields:t}))}function g(e,t,r,n,i){return y(e,["*"]).then(function(e){return p.resolve(v(e,t,r,n,i))})}function v(e,t,r,n,i){return void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=!0),void 0===i&&(i=null),!0===e._hasMemorySource()?new s({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:i}):new o({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:i})}function m(e){if(null!==u.applicationCache){var t=u.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=i(e,{responseType:"json",query:{f:"json"}}).then(function(e){if(e.data){var t=e.data;return p.resolve(t)}return p.resolve(null)});return null!==u.applicationCache&&(u.applicationCache.setLayerInfo(e,r),r=r.catch(function(t){throw u.applicationCache.clearLayerInfo(e),t})),r}function _(e,t){var r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==u.applicationCache){var n=u.applicationCache.getLayerInfo(r);if(null!==n)return n}var a=i(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then(function(e){if(e.data){var t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")});return null!==u.applicationCache&&(u.applicationCache.setLayerInfo(r,a),a=a.catch(function(e){throw u.applicationCache.clearLayerInfo(r),e})),a}function w(e){if(null!==u.applicationCache){var t=u.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=i(e,{responseType:"json",query:{f:"json"}}).then(function(e){if(e.data){var t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),p.resolve(t)}return p.resolve({layers:[],tables:[]})});return null!==u.applicationCache&&(u.applicationCache.setLayerInfo(e,r),r=r.catch(function(t){throw u.applicationCache.clearLayerInfo(e),t})),r}Object.defineProperty(t,"__esModule",{value:!0}),t.initialiseMetaDataCache=function(){null===u.applicationCache&&(u.applicationCache=new u)},t.constructFeatureSetFromUrl=g,t.constructFeatureSet=v,t.constructAssociationMetaDataFeatureSetFromUrl=function(e,t){var r={metadata:null,networkId:-1,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return w(e).then(function(n){if(r.metadata=n,n.controllerDatasetLayers&&void 0!==n.controllerDatasetLayers.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers)for(var i=0,a=n.layers;i<a.length;i++){var o=a[i];r.layerNameLkp[o.id]=o.name}if(n.tables)for(var s=0,l=n.tables;s<l.length;s++)o=l[s],r.layerNameLkp[o.id]=o.name;var u=n.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=u,_(e,u).then(function(n){if(n){r.queryelem=n,r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);for(var i=0,a=r.queryelem.dataElement.domainNetworks;i<a.length;i++){for(var o=a[i],s=0,l=o.edgeSources?o.edgeSources:[];s<l.length;s++)(f={layerId:(d=l[s]).layerId,sourceId:d.sourceId,className:r.layerNameLkp[d.layerId]?r.layerNameLkp[d.layerId]:null}).className&&(r.lkp[f.className]=f);for(var c=0,p=o.junctionSources?o.junctionSources:[];c<p.length;c++){var d,f;(f={layerId:(d=p[c]).layerId,sourceId:d.sourceId,className:r.layerNameLkp[d.layerId]?r.layerNameLkp[d.layerId]:null}).className&&(r.lkp[f.className]=f)}}if(r.queryelem.dataElement.terminalConfigurations)for(var h=0,y=r.queryelem.dataElement.terminalConfigurations;h<y.length;h++)for(var v=0,_=y[h].terminals;v<_.length;v++){var w=_[v];r.terminals.push({terminalId:w.terminalId,terminalName:w.terminalName})}return m(e+"/"+u).then(function(n){return n.systemLayers&&void 0!==n.systemLayers.associationsTableId&&null!==n.systemLayers.associationsTableId?g(e+"/"+n.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"],!1,null).then(function(e){return e.load()}).then(function(e){return{lkp:r.lkp,associations:e,terminals:r.terminals}}):{associations:null,lkp:null,terminals:[]}})}return{associations:null,lkp:null,terminals:[]}})}return{associations:null,lkp:null,terminals:[]}})},t.constructFeatureSetFromRelationship=function(e,t,r,n,i,a,o){void 0===n&&(n=null),void 0===i&&(i=null),void 0===a&&(a=!0),void 0===o&&(o=null);var s=e.serviceUrl();return s?g(s="/"===s.charAt(s.length-1)?s+t.relatedTableId.toString():s+"/"+t.relatedTableId.toString(),n,i,a,o).then(function(s){return new l({layer:e,relatedLayer:s,relationship:t,objectId:r,spatialReference:n,outFields:i,includeGeometry:a,lrucache:o})}):null};var S=function(e){function t(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var i=e.call(this)||this;return i._map=t,i._overridespref=r,i.lrucache=n,i._instantLayers=[],i}return r(t,e),t.prototype.makeAndAddFeatureSet=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=v(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n},t.prototype.featureSetByName=function(e,t,r){var i=this;if(void 0===t&&(t=!0),void 0===r&&(r=null),void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then(function(){try{return i.featureSetByName(e,t,r)}catch(e){return p.reject(e)}});null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var a=JSON.stringify(r),o=0;o<this._instantLayers.length;o++){var s=this._instantLayers[o];if(s.opitem.title===e&&s.includeGeometry===t&&s.outFields===a)return this.resolvePromise(this._instantLayers[o].featureset)}var l=this._map.layers.find(function(t){return t instanceof d&&t.title===e});if(l)return this.resolvePromise(this.makeAndAddFeatureSet(l,t,r));if(this._map.tables){var u=this._map.tables.find(function(t){return!!(t.title&&t.title===e||t.title&&t.title===e)});if(u){if(u._materializedTable);else{var c=u.outFields?u:n({},u,{outFields:["*"]});u._materializedTable=new d(c)}return u._materializedTable.load().then(function(){return i.resolvePromise(i.makeAndAddFeatureSet(u._materializedTable,t,r))})}}return this.resolvePromise(null)},t.prototype.featureSetById=function(e,t,r){var i=this;if(void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then(function(){try{return i.featureSetById(e,t,r)}catch(e){return p.reject(e)}});null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var a=JSON.stringify(r),o=0;o<this._instantLayers.length;o++){var s=this._instantLayers[o];if(s.opitem.id===e&&s.includeGeometry===t&&s.outFields===a)return this.resolvePromise(this._instantLayers[o].featureset)}var l=this._map.layers.find(function(t){return t instanceof d&&t.id===e});if(l)return this.resolvePromise(this.makeAndAddFeatureSet(l,t,r));if(this._map.tables){var u=this._map.tables.find(function(t){return t.id===e});if(u){if(u._materializedTable);else{var c=n({},u,{outFields:["*"]});u._materializedTable=new d(c)}return u._materializedTable.load().then(function(){return i.resolvePromise(i.makeAndAddFeatureSet(u._materializedTable,t,r))})}}return this.resolvePromise(null)},t}(a),b=function(e){function t(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var i=e.call(this)||this;return i._url=t,i._overridespref=r,i.lrucache=n,i.metadata=null,i._instantLayers=[],i}return r(t,e),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),t.prototype.makeAndAddFeatureSet=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=v(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n},t.prototype._loadMetaData=function(){var e=this;return w(this._url).then(function(t){return e.metadata=t,t})},t.prototype.load=function(){return this._loadMetaData()},t.prototype.clone=function(){return new t(this._url,this._overridespref,this.lrucache)},t.prototype.featureSetByName=function(e,t,r){var n=this;void 0===t&&(t=!0),void 0===r&&(r=null),null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var i=JSON.stringify(r),a=0;a<this._instantLayers.length;a++){var o=this._instantLayers[a];if(o.opitem.title===e&&o.includeGeometry===t&&o.outFields===i)return this.resolvePromise(this._instantLayers[a].featureset)}return this._loadMetaData().then(function(i){for(var a=null,o=0,s=i.layers?i.layers:[];o<s.length;o++){(c=s[o]).name===e&&(a=c)}if(!a)for(var l=0,u=i.tables?i.tables:[];l<u.length;l++){var c;(c=u[l]).name===e&&(a=c)}return a?y(n._url+"/"+a.id,["*"]).then(function(e){return n.makeAndAddFeatureSet(e,t,r)}):n.resolvePromise(null)})},t.prototype.featureSetById=function(e,t,r){var n=this;void 0===t&&(t=!0),void 0===r&&(r=["*"]),null===r&&(r=["*"]),r=(r=r.slice(0)).sort();var i=JSON.stringify(r);e=null!=e?e.toString():"";for(var a=0;a<this._instantLayers.length;a++){var o=this._instantLayers[a];if(o.opitem.id===e&&o.includeGeometry===t&&o.outFields===i)return this.resolvePromise(this._instantLayers[a].featureset)}return this._loadMetaData().then(function(i){for(var a=null,o=0,s=i.layers?i.layers:[];o<s.length;o++){null!==(c=s[o]).id&&void 0!==c.id&&c.id.toString()===e&&(a=c)}if(!a)for(var l=0,u=i.tables?i.tables:[];l<u.length;l++){var c;null!==(c=u[l]).id&&void 0!==c.id&&c.id.toString()===e&&(a=c)}return a?y(n._url+"/"+a.id,["*"]).then(function(e){return n.makeAndAddFeatureSet(e,t,r)}):n.resolvePromise(null)})},t}(a);t.createFeatureSetCollectionFromMap=function(e,t,r){return void 0===r&&(r=null),new S(e,t,r)},t.createFeatureSetCollectionFromService=function(e,t,r){return void 0===r&&(r=null),new b(e,t,r)},t.getPortal=function(e,t){return null===e?t:new f({url:e.field("url")})},t.constructFeatureSetFromPortalItem=function(e,t,r,n,i,a,o){if(u.applicationCache){var s=u.applicationCache.getLayerInfo(e+":"+a.url);if(s)return s.then(function(e){try{var a=new d({url:c.extractServiceUrl(e.url)+"/"+t,outFields:["*"]});return p.resolve(v(a,r,n,i,o))}catch(e){return p.reject(e)}},function(e){return p.reject(e)})}return p.create(function(s,l){var p=new h({id:e,portal:a}).load();u.applicationCache&&u.applicationCache.setLayerInfo(e+":"+a.url,p),p.then(function(e){try{var a=new d({url:c.extractServiceUrl(e.url)+"/"+t,outFields:["*"]});s(v(a,r,n,i,o))}catch(e){l(e)}},function(t){u.applicationCache&&u.applicationCache.clearLayerInfo(e+":"+a.url),l(t)})})}}.apply(null,n))||(e.exports=i)},921:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(34)],void 0===(i=function(e,t,r){return function(){function e(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}return e.prototype.add=function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r},e.prototype.featureSetByName=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])},e.prototype.featureSetById=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])},e.prototype.castToText=function(){return"object, FeatureSetCollection"},e.prototype.resolvePromise=function(e){return r.resolve(e)},e}()}.apply(null,n))||(e.exports=i)},922:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this._databaseTypeMetaData={},this._layerInfo={}}return e.prototype.clearDatabaseType=function(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]},e.prototype.getDatabaseType=function(e){return"MUSTBESET"===e?null:void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]},e.prototype.setDatabaseType=function(e,t){this._databaseTypeMetaData[e]=t},e.prototype.getLayerInfo=function(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]},e.prototype.setLayerInfo=function(e,t){this._layerInfo[e]=t},e.prototype.clearLayerInfo=function(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]},e.applicationCache=null,e}()}.apply(null,n))||(e.exports=i)},923:function(e,t,r){var n,i;
/**
 * @preserve A JavaScript implementation of the SHA family of hashes, as
 * defined in FIPS PUB 180-2 as well as the corresponding HMAC implementation
 * as defined in FIPS PUB 198a
 *
 * Copyright Brian Turek 2008-2015
 * Distributed under the BSD License
 * See http://caligatio.github.com/jsSHA/ for more information
 *
 * Several functions taken from Paul Johnston
 */n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){var r,n,i,a,o=[],s=[],l=0;if("UTF8"===t)for(n=0;n<e.length;n+=1)for(s=[],128>(r=e.charCodeAt(n))?s.push(r):2048>r?(s.push(192|r>>>6),s.push(128|63&r)):55296>r||57344<=r?s.push(224|r>>>12,128|r>>>6&63,128|63&r):(n+=1,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),s.push(240|r>>>18,128|r>>>12&63,128|r>>>6&63,128|63&r)),i=0;i<s.length;i+=1){for(a=l>>>2;o.length<=a;)o.push(0);o[a]|=s[i]<<24-l%4*8,l+=1}else if("UTF16BE"===t||"UTF16LE"===t)for(n=0;n<e.length;n+=1){for(r=e.charCodeAt(n),"UTF16LE"===t&&(r=(i=255&r)<<8|r>>8),a=l>>>2;o.length<=a;)o.push(0);o[a]|=r<<16-l%4*8,l+=2}return{value:o,binLen:8*l}}function n(e){var t,r,n,i=[],a=e.length;if(0!=a%2)throw"String of HEX type must be in byte increments";for(t=0;t<a;t+=2){if(r=parseInt(e.substr(t,2),16),isNaN(r))throw"String of HEX type contains invalid characters";for(n=t>>>3;i.length<=n;)i.push(0);i[t>>>3]|=r<<24-t%8*4}return{value:i,binLen:4*a}}function i(e){var t,r,n,i=[];for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),n=r>>>2,i.length<=n&&i.push(0),i[n]|=t<<24-r%4*8;return{value:i,binLen:8*e.length}}function a(e){var t,r,n,i,a,o,s=[],l=0;if(-1===e.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(a=e.indexOf("="),e=e.replace(/\=/g,""),-1!==a&&a<e.length)throw"Invalid '=' found in base-64 string";for(t=0;t<e.length;t+=4){for(i=e.substr(t,4),n=0,r=0;r<i.length;r+=1)n|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(i[r])<<18-6*r;for(r=0;r<i.length-1;r+=1){for(o=l>>>2;s.length<=o;)s.push(0);s[o]|=(n>>>16-8*r&255)<<24-l%4*8,l+=1}}return{value:s,binLen:8*l}}function o(e,t){var r,n,i="0123456789abcdef",a="",o=4*e.length;for(r=0;r<o;r+=1)n=e[r>>>2]>>>8*(3-r%4),a+=i.charAt(n>>>4&15)+i.charAt(15&n);return t.outputUpper?a.toUpperCase():a}function s(e,t){var r,n,i,a,o,s,l="",u=4*e.length;for(r=0;r<u;r+=3)for(a=r+1>>>2,o=e.length<=a?0:e[a],a=r+2>>>2,s=e.length<=a?0:e[a],i=(e[r>>>2]>>>8*(3-r%4)&255)<<16|(o>>>8*(3-(r+1)%4)&255)<<8|s>>>8*(3-(r+2)%4)&255,n=0;n<4;n+=1)8*r+6*n<=32*e.length?l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-n)&63):l+=t.b64Pad;return l}function l(e,t){var r,n,i="",a=4*e.length;for(r=0;r<a;r+=1)n=e[r>>>2]>>>8*(3-r%4)&255,i+=String.fromCharCode(n);return i}function u(e){var t={outputUpper:!1,b64Pad:"="};try{e.hasOwnProperty("outputUpper")&&(t.outputUpper=e.outputUpper),e.hasOwnProperty("b64Pad")&&(t.b64Pad=e.b64Pad)}catch(e){}if("boolean"!=typeof t.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof t.b64Pad)throw"Invalid b64Pad formatting option";return t}function c(e,t){return e<<t|e>>>32-t}function p(e,t){return e>>>t|e<<32-t}function d(e,t){var r=new L(e.highOrder,e.lowOrder);return 32>=t?new L(r.highOrder>>>t|r.lowOrder<<32-t&4294967295,r.lowOrder>>>t|r.highOrder<<32-t&4294967295):new L(r.lowOrder>>>t-32|r.highOrder<<64-t&4294967295,r.highOrder>>>t-32|r.lowOrder<<64-t&4294967295)}function f(e,t){return e>>>t}function h(e,t){return 32>=t?new L(e.highOrder>>>t,e.lowOrder>>>t|e.highOrder<<32-t&4294967295):new L(0,e.highOrder>>>t-32)}function y(e,t,r){return e^t^r}function g(e,t,r){return e&t^~e&r}function v(e,t,r){return new L(e.highOrder&t.highOrder^~e.highOrder&r.highOrder,e.lowOrder&t.lowOrder^~e.lowOrder&r.lowOrder)}function m(e,t,r){return e&t^e&r^t&r}function _(e,t,r){return new L(e.highOrder&t.highOrder^e.highOrder&r.highOrder^t.highOrder&r.highOrder,e.lowOrder&t.lowOrder^e.lowOrder&r.lowOrder^t.lowOrder&r.lowOrder)}function w(e){return p(e,2)^p(e,13)^p(e,22)}function S(e){var t=d(e,28),r=d(e,34),n=d(e,39);return new L(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function b(e){return p(e,6)^p(e,11)^p(e,25)}function F(e){var t=d(e,14),r=d(e,18),n=d(e,41);return new L(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function I(e){return p(e,7)^p(e,18)^f(e,3)}function x(e){var t=d(e,1),r=d(e,8),n=h(e,7);return new L(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function T(e){return p(e,17)^p(e,19)^f(e,10)}function E(e){var t=d(e,19),r=d(e,61),n=h(e,6);return new L(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function R(e,t){var r=(65535&e)+(65535&t);return(65535&(e>>>16)+(t>>>16)+(r>>>16))<<16|65535&r}function C(e,t,r,n){var i=(65535&e)+(65535&t)+(65535&r)+(65535&n);return(65535&(e>>>16)+(t>>>16)+(r>>>16)+(n>>>16)+(i>>>16))<<16|65535&i}function O(e,t,r,n,i){var a=(65535&e)+(65535&t)+(65535&r)+(65535&n)+(65535&i);return(65535&(e>>>16)+(t>>>16)+(r>>>16)+(n>>>16)+(i>>>16)+(a>>>16))<<16|65535&a}function D(e,t){var r,n,i;return r=(65535&e.lowOrder)+(65535&t.lowOrder),i=(65535&(n=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r>>>16)))<<16|65535&r,r=(65535&e.highOrder)+(65535&t.highOrder)+(n>>>16),n=(e.highOrder>>>16)+(t.highOrder>>>16)+(r>>>16),new L((65535&n)<<16|65535&r,i)}function A(e,t,r,n){var i,a,o;return i=(65535&e.lowOrder)+(65535&t.lowOrder)+(65535&r.lowOrder)+(65535&n.lowOrder),o=(65535&(a=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r.lowOrder>>>16)+(n.lowOrder>>>16)+(i>>>16)))<<16|65535&i,i=(65535&e.highOrder)+(65535&t.highOrder)+(65535&r.highOrder)+(65535&n.highOrder)+(a>>>16),a=(e.highOrder>>>16)+(t.highOrder>>>16)+(r.highOrder>>>16)+(n.highOrder>>>16)+(i>>>16),new L((65535&a)<<16|65535&i,o)}function P(e,t,r,n,i){var a,o,s;return a=(65535&e.lowOrder)+(65535&t.lowOrder)+(65535&r.lowOrder)+(65535&n.lowOrder)+(65535&i.lowOrder),s=(65535&(o=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r.lowOrder>>>16)+(n.lowOrder>>>16)+(i.lowOrder>>>16)+(a>>>16)))<<16|65535&a,a=(65535&e.highOrder)+(65535&t.highOrder)+(65535&r.highOrder)+(65535&n.highOrder)+(65535&i.highOrder)+(o>>>16),o=(e.highOrder>>>16)+(t.highOrder>>>16)+(r.highOrder>>>16)+(n.highOrder>>>16)+(i.highOrder>>>16)+(a>>>16),new L((65535&o)<<16|65535&a,s)}function j(e,t){var r,n,i,a,o,s,l,u,p,d,f=[],h=g,v=y,_=m,w=c,S=R,b=O,F=[1732584193,4023233417,2562383102,271733878,3285377520];for(d=15+(t+65>>>9<<4);e.length<=d;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[d]=t,p=e.length,l=0;l<p;l+=16){for(r=F[0],n=F[1],i=F[2],a=F[3],o=F[4],u=0;u<80;u+=1)f[u]=u<16?e[u+l]:w(f[u-3]^f[u-8]^f[u-14]^f[u-16],1),s=u<20?b(w(r,5),h(n,i,a),o,1518500249,f[u]):u<40?b(w(r,5),v(n,i,a),o,1859775393,f[u]):u<60?b(w(r,5),_(n,i,a),o,2400959708,f[u]):b(w(r,5),v(n,i,a),o,3395469782,f[u]),o=a,a=i,i=w(n,30),n=r,r=s;F[0]=S(r,F[0]),F[1]=S(n,F[1]),F[2]=S(i,F[2]),F[3]=S(a,F[3]),F[4]=S(o,F[4])}return F}function k(e,t,r){var n,i,a,o,s,l,u,c,p,d,f,h,y,j,k,M,G,B,U,q,W,V,J,H,Q,z,Y,K,X,Z,$,ee,te=[],re=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],ne=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],ie=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];if(("SHA-224"===r||"SHA-256"===r)&&2&N)h=64,y=15+(t+65>>>9<<4),M=16,G=1,Y=Number,B=R,U=C,q=O,W=I,V=T,J=w,H=b,z=m,Q=g,f="SHA-224"===r?ne:ie;else{if("SHA-384"!==r&&"SHA-512"!==r||!(4&N))throw"Unexpected error in SHA-2 implementation";h=80,y=31+(t+128>>>10<<5),M=32,G=2,B=D,U=A,q=P,W=x,V=E,J=S,H=F,z=_,Q=v,re=[new(Y=L)(re[0],3609767458),new Y(re[1],602891725),new Y(re[2],3964484399),new Y(re[3],2173295548),new Y(re[4],4081628472),new Y(re[5],3053834265),new Y(re[6],2937671579),new Y(re[7],3664609560),new Y(re[8],2734883394),new Y(re[9],1164996542),new Y(re[10],1323610764),new Y(re[11],3590304994),new Y(re[12],4068182383),new Y(re[13],991336113),new Y(re[14],633803317),new Y(re[15],3479774868),new Y(re[16],2666613458),new Y(re[17],944711139),new Y(re[18],2341262773),new Y(re[19],2007800933),new Y(re[20],1495990901),new Y(re[21],1856431235),new Y(re[22],3175218132),new Y(re[23],2198950837),new Y(re[24],3999719339),new Y(re[25],766784016),new Y(re[26],2566594879),new Y(re[27],3203337956),new Y(re[28],1034457026),new Y(re[29],2466948901),new Y(re[30],3758326383),new Y(re[31],168717936),new Y(re[32],1188179964),new Y(re[33],1546045734),new Y(re[34],1522805485),new Y(re[35],2643833823),new Y(re[36],2343527390),new Y(re[37],1014477480),new Y(re[38],1206759142),new Y(re[39],344077627),new Y(re[40],1290863460),new Y(re[41],3158454273),new Y(re[42],3505952657),new Y(re[43],106217008),new Y(re[44],3606008344),new Y(re[45],1432725776),new Y(re[46],1467031594),new Y(re[47],851169720),new Y(re[48],3100823752),new Y(re[49],1363258195),new Y(re[50],3750685593),new Y(re[51],3785050280),new Y(re[52],3318307427),new Y(re[53],3812723403),new Y(re[54],2003034995),new Y(re[55],3602036899),new Y(re[56],1575990012),new Y(re[57],1125592928),new Y(re[58],2716904306),new Y(re[59],442776044),new Y(re[60],593698344),new Y(re[61],3733110249),new Y(re[62],2999351573),new Y(re[63],3815920427),new Y(3391569614,3928383900),new Y(3515267271,566280711),new Y(3940187606,3454069534),new Y(4118630271,4000239992),new Y(116418474,1914138554),new Y(174292421,2731055270),new Y(289380356,3203993006),new Y(460393269,320620315),new Y(685471733,587496836),new Y(852142971,1086792851),new Y(1017036298,365543100),new Y(1126000580,2618297676),new Y(1288033470,3409855158),new Y(1501505948,4234509866),new Y(1607167915,987167468),new Y(1816402316,1246189591)],f="SHA-384"===r?[new Y(3418070365,ne[0]),new Y(1654270250,ne[1]),new Y(2438529370,ne[2]),new Y(355462360,ne[3]),new Y(1731405415,ne[4]),new Y(41048885895,ne[5]),new Y(3675008525,ne[6]),new Y(1203062813,ne[7])]:[new Y(ie[0],4089235720),new Y(ie[1],2227873595),new Y(ie[2],4271175723),new Y(ie[3],1595750129),new Y(ie[4],2917565137),new Y(ie[5],725511199),new Y(ie[6],4215389547),new Y(ie[7],327033209)]}for(;e.length<=y;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[y]=t,$=e.length,j=0;j<$;j+=M){for(n=f[0],i=f[1],a=f[2],o=f[3],s=f[4],l=f[5],u=f[6],c=f[7],k=0;k<h;k+=1)k<16?(Z=k*G+j,K=e.length<=Z?0:e[Z],X=e.length<=Z+1?0:e[Z+1],te[k]=new Y(K,X)):te[k]=U(V(te[k-2]),te[k-7],W(te[k-15]),te[k-16]),p=q(c,H(s),Q(s,l,u),re[k],te[k]),d=B(J(n),z(n,i,a)),c=u,u=l,l=s,s=B(o,p),o=a,a=i,i=n,n=B(p,d);f[0]=B(n,f[0]),f[1]=B(i,f[1]),f[2]=B(a,f[2]),f[3]=B(o,f[3]),f[4]=B(s,f[4]),f[5]=B(l,f[5]),f[6]=B(u,f[6]),f[7]=B(c,f[7])}if("SHA-224"===r&&2&N)ee=[f[0],f[1],f[2],f[3],f[4],f[5],f[6]];else if("SHA-256"===r&&2&N)ee=f;else if("SHA-384"===r&&4&N)ee=[f[0].highOrder,f[0].lowOrder,f[1].highOrder,f[1].lowOrder,f[2].highOrder,f[2].lowOrder,f[3].highOrder,f[3].lowOrder,f[4].highOrder,f[4].lowOrder,f[5].highOrder,f[5].lowOrder];else{if(!("SHA-512"===r&&4&N))throw"Unexpected error in SHA-2 implementation";ee=[f[0].highOrder,f[0].lowOrder,f[1].highOrder,f[1].lowOrder,f[2].highOrder,f[2].lowOrder,f[3].highOrder,f[3].lowOrder,f[4].highOrder,f[4].lowOrder,f[5].highOrder,f[5].lowOrder,f[6].highOrder,f[6].lowOrder,f[7].highOrder,f[7].lowOrder]}return ee}var N=7,L=function(){return function(e,t){this.highOrder=e,this.lowOrder=t}}();return function(){function e(e,t,o){this.strBinLen=0,this.strToHash=null,this.utfType="";var s=null;if(this.strToHash=[0],this.strBinLen=0,this.utfType=o||"UTF8","UTF8"!==this.utfType&&"UTF16BE"!==this.utfType&&"UTF16LE"!==this.utfType)throw"encoding must be UTF8, UTF16BE, or UTF16LE";if("HEX"===t){if(0!=e.length%2)throw"srcString of HEX type must be in byte increments";s=n(e),this.strBinLen=s.binLen,this.strToHash=s.value}else if("TEXT"===t)s=r(e,this.utfType),this.strBinLen=s.binLen,this.strToHash=s.value;else if("B64"===t)s=a(e),this.strBinLen=s.binLen,this.strToHash=s.value;else{if("BYTES"!==t)throw"inputFormat must be HEX, TEXT, B64, or BYTES";s=i(e),this.strBinLen=s.binLen,this.strToHash=s.value}}return e.prototype.getHash=function(e,t,r,n){var i,a=null,c=this.strToHash.slice(),p=this.strBinLen;if(3===arguments.length?"number"!=typeof r&&(n=r,r=1):2===arguments.length&&(r=1),r!==parseInt(r,10)||1>r)throw"numRounds must a integer >= 1";switch(t){case"HEX":a=o;break;case"B64":a=s;break;case"BYTES":a=l;break;default:throw"format must be HEX, B64, or BYTES"}if("SHA-1"===e&&1&N)for(i=0;i<r;i+=1)c=j(c,p),p=160;else if("SHA-224"===e&&2&N)for(i=0;i<r;i+=1)c=k(c,p,e),p=224;else if("SHA-256"===e&&2&N)for(i=0;i<r;i+=1)c=k(c,p,e),p=256;else if("SHA-384"===e&&4&N)for(i=0;i<r;i+=1)c=k(c,p,e),p=384;else{if(!("SHA-512"===e&&4&N))throw"Chosen SHA variant is not supported";for(i=0;i<r;i+=1)c=k(c,p,e),p=512}return a(c,u(n))},e.prototype.getHMAC=function(e,t,c,p,d){var f,h,y,g,v,m,_,w,S,b=[],F=[],I=null;switch(p){case"HEX":f=o;break;case"B64":f=s;break;case"BYTES":f=l;break;default:throw"outputFormat must be HEX, B64, or BYTES"}if("SHA-1"===c&&1&N)y=64,S=160;else if("SHA-224"===c&&2&N)y=64,S=224;else if("SHA-256"===c&&2&N)y=64,S=256;else if("SHA-384"===c&&4&N)y=128,S=384;else{if(!("SHA-512"===c&&4&N))throw"Chosen SHA variant is not supported";y=128,S=512}if("HEX"===t)w=(I=n(e)).binLen,h=I.value;else if("TEXT"===t)w=(I=r(e,this.utfType)).binLen,h=I.value;else if("B64"===t)w=(I=a(e)).binLen,h=I.value;else{if("BYTES"!==t)throw"inputFormat must be HEX, TEXT, B64, or BYTES";w=(I=i(e)).binLen,h=I.value}if(g=8*y,_=y/4-1,y<w/8){if("SHA-1"===c&&1&N)h=j(h,w);else{if(!(6&N))throw"Unexpected error in HMAC implementation";h=k(h,w,c)}for(;h.length<=_;)h.push(0);h[_]&=4294967040}else if(y>w/8){for(;h.length<=_;)h.push(0);h[_]&=4294967040}for(v=0;v<=_;v+=1)b[v]=909522486^h[v],F[v]=1549556828^h[v];if("SHA-1"===c&&1&N)m=j(F.concat(j(b.concat(this.strToHash),g+this.strBinLen)),g+S);else{if(!(6&N))throw"Unexpected error in HMAC implementation";m=k(F.concat(k(b.concat(this.strToHash),g+this.strBinLen,c)),g+S,c)}return f(m,u(d))},e}()}.apply(null,n))||(e.exports=i)},924:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(77),r(235),r(218),r(186),r(236),r(34),r(96),r(87),r(78),r(74)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p,d){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",r._removeGeometry=!1,r._overrideFields=null,r._forceIsTable=!1,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,!0===t.isTable&&(r._forceIsTable=!0),void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return o.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(e){},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=l.create(function(t,r){if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then(function(){try{e._initialiseFeatureSet(),t(e)}catch(e){r(e)}},r),e._layer.load()})),this._loadPromise},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{for(var e=[],t=0,r=this.fields;t<r.length;t++){if("oid"===(u=r[t]).type)e.push(u);else for(var n=0,i=this._layer.outFields;n<i.length;n++){if(i[n].toLowerCase()===u.name.toLowerCase()){e.push(u);break}}}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{e=[];for(var a=[],s=0,l=this.fields;s<l.length;s++){var u;if("oid"===(u=l[s]).type)e.push(u),a.push(u.name);else for(var c=0,p=this._overrideFields;c<p.length;c++){if(p[c].toLowerCase()===u.name.toLowerCase()){e.push(u),a.push(u.name);break}}}this.fields=e,this._overrideFields=a}this.objectIdField=this._layer.objectIdField,this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=o.FeatureServiceDatabaseType.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},t.prototype.isTable=function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType},t.prototype._isInFeatureSet=function(e){return o.IdState.InFeatureSet},t.prototype._transformSetWithIdChanges=function(e){},t.prototype._candidateIdTransform=function(e){return e},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,null,e)}).then(function(e){return t._wset=e,e}):l.resolve(this._wset)},t.prototype._changeFeature=function(e){for(var t={},r=0,i=this.fields;r<i.length;r++){var a=i[r];t[a.name]=e.attributes[a.name]}return new n({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},t.prototype._getFilteredSet=function(e,t,r,n,i){var u=this,c="",p=!1;if(null!==n&&(c=n.constructClause(),p=!0),this.isTable()&&t&&null!==e&&""!==e){var f=new a([],[],!0,null);return l.resolve(f)}var h=new d;return h.where=null===r?null===t?"1=1":"":s.toWhereClause(r,o.FeatureServiceDatabaseType.Standardised),h.spatialRelationship=this._makeRelationshipEnum(e),h.outSpatialReference=this.spatialReference,h.orderByFields=""!==c?c.split(","):null,h.geometry=null===t?null:t,h.returnGeometry=!0,h.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(h).then(function(e){if(null===e)return new a([],[],p,null);u._checkCancelled(i);var t=[];return e.features.forEach(function(e){var r=e.attributes[u._layer.objectIdField];t.push(r),u._featureCache[r]=u._changeFeature(e)}),new a([],t,p,null)})},t.prototype._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},t.prototype._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},t.prototype._queryAllFeatures=function(){var e=this;if(this._wset)return l.resolve(this._wset);var t=new d;return t.where="1=1",this._ensureLoaded().then(function(){if(e._layer.source&&e._layer.source.items){var r=[];return e._layer.source.items.forEach(function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)}),e._wset=new a([],r,!1,null),e._wset}return e._layer.queryFeatures(t).then(function(t){var r=[];return t.features.forEach(function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)}),e._wset=new a([],r,!1,null),e._wset})})},t.prototype._getFeatures=function(e,t,r,n){var i=[];-1!==t&&void 0===this._featureCache[t]&&i.push(t);for(var a=e._lastFetchedIndex;a<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[a]]&&(e._known[a]!==t&&i.push(e._known[a]),i.length>r)));a++);return 0===i.length?l.resolve("success"):l.reject(new Error("Unaccounted for Features. Not in Feature Collection"))},t.prototype._refineSetBlock=function(e,t,r){return l.resolve(e)},t.prototype._stat=function(e,t,r,n,i,a,o){return l.resolve({calculated:!1})},t.prototype._canDoAggregates=function(e,t,r,n,i){return l.resolve(!1)},t.prototype.relationshipMetaData=function(){return[]},t._cloneAttr=function(e){var t={};for(var r in e)t[r]=e[r];return t},t.prototype.nativeCapabilities=function(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}},t.create=function(e,r){var n=e.layerDefinition.objectIdField,i=e.layerDefinition.geometryType;void 0===i&&(i=e.featureSet.geometryType||"");var a=e.featureSet.features,o=r.toJSON();if(""===n||void 0===n){for(var s=!1,l=0,d=e.layerDefinition.fields;l<d.length;l++){if("oid"===(E=d[l]).type||"esriFieldTypeOID"===E.type){n=E.name,s=!0;break}}if(!1===s){for(var f="FID",h=!0,y=0;h;){for(var g=!0,v=0,m=e.layerDefinition.fields;v<m.length;v++){if((E=m[v]).name===f){g=!1;break}}!0===g?h=!1:f="FID"+(++y).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:f,alias:f});for(var _=[],w=0;w<a.length;w++)_.push({geometry:e.featureSet.features[w].geometry,attributes:e.featureSet.features[w].attributes?this._cloneAttr(e.featureSet.features[w].attributes):{}}),_[w].attributes[f]=w;a=_,n=f}}for(var S=[],b=0,F=e.layerDefinition.fields;b<F.length;b++){(E=F[b])instanceof p?S.push(E):S.push(p.fromJSON(E))}var I=i;switch(I){case"esriGeometryPoint":I="point";break;case"esriGeometryPolyline":I="polyline";break;case"esriGeometryPolygon":I="polygon";break;case"esriGeometryExtent":I="extent";break;case"esriGeometryMultipoint":I="multipoint"}for(var x=0,T=a;x<T.length;x++){var E;(E=T[x]).geometry&&E.geometry instanceof u==0&&(E.geometry.type=I,void 0===E.geometry.spatialReference&&(E.geometry.spatialReference=o))}var R={outFields:["*"],source:a,fields:S,objectIdField:n,spatialReference:r};return R.geometryType=I||"point",new t({layer:new c(R),spatialReference:r,isTable:null===I||""===I})},t.prototype.queryAttachments=function(e,t,r,n){return l.resolve([])},t.prototype.getFeatureByObjectId=function(e,t){var r=new d;return r.where=this.objectIdField+"="+e.toString(),this._layer.queryFeatures(r).then(function(e){return 1===e.features.length?e.features[0]:null})},t}(i)}.apply(null,n))||(e.exports=i)},925:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(235),r(218),r(186),r(34)],void 0===(i=function(e,t,r,n,i,a,o){var s=function(e){function t(t){var r=e.call(this,t)||this;return r._topnum=0,r.declaredClass="esri.arcade.featureset.actions.Top",r._countedin=0,r._maxProcessing=100,r._topnum=t.topnum,r._parent=t.parentfeatureset,r}return r(t,e),t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._parent._getSet(e)}).then(function(e){return t._wset=new i(e._candidates.slice(0),e._known.slice(0),!1,t._clonePageDefinition(e.pagesDefinition)),t._setKnownLength(t._wset)>t._topnum&&(t._wset._known=t._wset._known.slice(0,t._topnum)),t._setKnownLength(t._wset)>=t._topnum&&(t._wset._candidates=[]),t._wset}):o.resolve(this._wset)},t.prototype._setKnownLength=function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);if(t===a.IdState.NotInFeatureSet)return t;var r=this._idstates[e];return r===a.IdState.InFeatureSet||r===a.IdState.NotInFeatureSet?r:t===a.IdState.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=a.IdState.InFeatureSet,this._countedin++,a.IdState.InFeatureSet):(this._idstates[e]=a.IdState.NotInFeatureSet,a.IdState.NotInFeatureSet):a.IdState.Unknown},t.prototype._expandPagedSet=function(e,t,r,n,i){var a=this;if(null===this._parent)return o.reject(new Error("Parent Paging not implemented"));if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){var s=e._known.length;return s>0&&"GETPAGES"===e._known[s-1]&&(e._known.length=s-1),(s=e._candidates.length)>0&&"GETPAGES"===e._candidates[s-1]&&(e._candidates.length=s-1),o.resolve("success")}return this._parent._expandPagedSet(e,t,r,n,i).then(function(t){return a._setKnownLength(e)>a._topnum&&(e._known.length=a._topnum),a._setKnownLength(e)>=a._topnum&&(e._candidates.length=0),t})},t.prototype._getFeatures=function(e,t,r,n){var a=this,s=[],l=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,l,n))return this._expandPagedSet(e,l,0,0,n).then(function(i){return a._getFeatures(e,t,r,n)});-1!==t&&void 0===this._featureCache[t]&&s.push(t);for(var u=0,c=e._lastFetchedIndex;c<e._known.length&&(++u<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[c]]&&(e._known[c]!==t&&s.push(e._known[c]),s.length>l-1)));c++);if(0===s.length)return o.resolve("success");var p=new i([],s,!1,null),d=Math.min(s.length,r);return this._parent._getFeatures(p,-1,d,n).then(function(e){for(var t=0;t<d;t++){var r=a._parent._featureFromCache(s[t]);void 0!==r&&(a._featureCache[s[t]]=r)}return"success"})},t.prototype._getFilteredSet=function(e,t,r,n,a){var o=this;return this._ensureLoaded().then(function(){return o._getSet(a)}).then(function(e){return new i(e._candidates.slice(0).concat(e._known.slice(0)),[],!1,o._clonePageDefinition(e.pagesDefinition))})},t.prototype._refineKnowns=function(e,t){for(var r=0,n=null,i=[],o=0;o<e._candidates.length;o++){var s=this._isInFeatureSet(e._candidates[o]);if(s===a.IdState.InFeatureSet){if(e._known.push(e._candidates[o]),r+=1,null===n?n={start:o,end:o}:n.end===o-1?n.end=o:(i.push(n),n={start:o,end:o}),e._known.length>=this._topnum)break}else if(s===a.IdState.NotInFeatureSet)null===n?n={start:o,end:o}:n.end===o-1?n.end=o:(i.push(n),n={start:o,end:o}),r+=1;else if(s===a.IdState.Unknown)break;if(r>=t)break}null!==n&&i.push(n);for(var l=i.length-1;l>=0;l--)e._candidates.splice(i[l].start,i[l].end-i[l].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])},t.prototype._stat=function(e,t,r,n,i,a,s){return o.resolve({calculated:!1})},t.prototype._canDoAggregates=function(e,t,r,n,i){return o.resolve(!1)},t}(n);return n._featuresetFunctions.top=function(e){return new s({parentfeatureset:this,topnum:e})},s}.apply(null,n))||(e.exports=i)},926:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(640),r(235),r(218),r(186),r(34),r(395)],void 0===(i=function(e,t,r,n,i,a,o,s,l){var u=function(e){function t(t){var r=e.call(this,t)||this;return r._relation="",r._relationGeom=null,r._relationString="",r.declaredClass="esri.arcade.featureset.actions.SpatialFilter",r._relationString=t.relationString,r._parent=t.parentfeatureset,r._maxProcessing=40,r._relation=t.relation,r._relationGeom=t.relationGeom,r}return r(t,e),t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._parent._getFilteredSet("esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,null,null,e)}).then(function(r){return t._checkCancelled(e),t._wset=new a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset}):s.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);return t===o.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?o.IdState.Unknown:t},t.prototype._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){return this._parent._featureFromCache(e)},t.prototype.executeSpatialRelationTest=function(e){if(null===e.geometry)return s.resolve(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var t=o.shapeExtent(this._relationGeom),r=o.shapeExtent(e.geometry);return l.intersects(t,r);case"esriSpatialRelIntersects":return l.intersects(this._relationGeom,e.geometry);case"esriSpatialRelContains":return l.contains(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return l.overlaps(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return l.within(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return l.touches(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return l.crosses(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return l.relate(this._relationGeom,e.geometry,this._relationString)}},t.prototype._fetchAndRefineFeatures=function(e,t,r){var n=this,i=new a([],e,!1,null),l=Math.min(t,e.length);return this._parent._getFeatures(i,-1,l,r).then(function(){n._checkCancelled(r);for(var t=[],i=0;i<l;i++){var a=n._parent._featureFromCache(e[i]);t.push(n.executeSpatialRelationTest(a))}return s.all(t)}).then(function(r){for(var i=0;i<t;i++)!0===r[i]?n._idstates[e[i]]=o.IdState.InFeatureSet:n._idstates[e[i]]=o.IdState.NotInFeatureSet;return"success"})},t.prototype._getFilteredSet=function(e,t,r,n,i){var o=this;return this._ensureLoaded().then(function(){return o._parent._getFilteredSet("esriSpatialRelRelation"!==o._relation?o._relation:o._relation+":"+o._relationString,o._relationGeom,r,n,i)}).then(function(e){return o._checkCancelled(i),null!==t?new a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,o._clonePageDefinition(e.pagesDefinition)):new a(e._candidates.slice(0),e._known.slice(0),e._ordered,o._clonePageDefinition(e.pagesDefinition))})},t.prototype._stat=function(e,t,r,n,i,a,o){var l=this;return""!==r?s.resolve({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,i,a,o).then(function(s){return!1===s.calculated?null===i&&""===r&&null===n?l._manualStat(e,t,a,o):{calculated:!1}:s})},t.prototype._canDoAggregates=function(e,t,r,n,i){return""!==r||null!==n?s.resolve(!1):null===this._parent?s.resolve(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,i)},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,i,a,o){return null===this._parent?s.reject(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,i,a,o)},t}(i);return i._featuresetFunctions.intersects=function(e){return null==e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},i._featuresetFunctions.envelopeIntersects=function(e){return null==e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},i._featuresetFunctions.contains=function(e){return null==e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},i._featuresetFunctions.overlaps=function(e){return null==e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},i._featuresetFunctions.within=function(e){return null==e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},i._featuresetFunctions.touches=function(e){return null==e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},i._featuresetFunctions.crosses=function(e){return null==e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},i._featuresetFunctions.relate=function(e,t){return null==e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})},u}.apply(null,n))||(e.exports=i)},927:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(77),r(455),r(235),r(218),r(186),r(236),r(34),r(192),r(50)],void 0===(i=function(e,t,r,n,i,a,o,s,l,u,c,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(){this.sqlRewritable=!1}return e.prototype.extractValue=function(e){return null},e.prototype.postInitialization=function(e,t){},e.prototype.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:e}},e}();t.AdaptedField=d;var f=function(e){function t(t){var r=e.call(this)||this;return r.field=t,r.sqlRewritable=!0,r}return r(t,e),t.prototype.extractValue=function(e){return e.attributes[this.field.name]},t.prototype.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:e}},t}(d);t.OriginalField=f;var h=function(e){function t(t,r,n){var i=e.call(this)||this;return i.originalField=t,i.sqlRewritable=!0,i.field=s.cloneField(t),i.field.name=r,i.field.alias=n,i}return r(t,e),t.prototype.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:l.reformulateWithoutField(e,this.field.name,this.originalField.name,t.getFieldsIndex())}},t.prototype.extractValue=function(e){return e.attributes[this.originalField.name]},t}(d);t.FieldRename=h;var y=function(e){function t(t,r,n){var i=e.call(this)||this;for(var a in i.field=t,i.codefield=r,i.lkp=n,i.reverseLkp={},n)i.reverseLkp[n[a]]=a;return i.sqlRewritable=!0,i}return r(t,e),t.prototype.rewriteSql=function(e,r){var n=this.evaluateNodeToWhereClause(e.parseTree,s.FeatureServiceDatabaseType.Standardised,this.field.name,this.codefield instanceof c.WhereClause?l.toWhereClause(this.codefield,s.FeatureServiceDatabaseType.Standardised):this.codefield,e.parameters);return n.indexOf(t.BADNESS)>=0?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:c.WhereClause.create(n,r._parent.getFieldsIndex())}},t.prototype.evaluateNodeToWhereClause=function(e,r,n,i,a){var o,u,c,p;switch(void 0===n&&(n=null),void 0===i&&(i=null),e.type){case"interval":return l.convertIntervalToSql(this.evaluateNodeToWhereClause(e.value,r,n,i,a),e.qualifier,e.op,s.FeatureServiceDatabaseType.Standardised);case"case_expression":var d=" CASE ";"simple"===e.format&&(d+=this.evaluateNodeToWhereClause(e.operand,r,n,t.BADNESS,a));for(var f=0;f<e.clauses.length;f++)d+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[f].operand,r,n,t.BADNESS,a)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[f].value,r,n,t.BADNESS,a);return null!==e.else&&(d+=" ELSE "+this.evaluateNodeToWhereClause(e.else,r,n,t.BADNESS,a)),d+" END ";case"param":var h=a[e.value.toLowerCase()];if("string"==typeof h)return"'"+a[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(h instanceof Date)return l.makeDateString(h,r);if(h instanceof Array){var y=[];for(f=0;f<h.length;f++)"string"==typeof h[f]?y.push("'"+h[f].toString().replace(/'/g,"''")+"'"):h[f]instanceof Date?y.push(l.makeDateString(h[f],r)):y.push(h[f].toString());return y}return h.toString();case"expr_list":u=[];for(var g=0,v=e.value;g<v.length;g++){var m=v[g];u.push(this.evaluateNodeToWhereClause(m,r,n,i,a))}return u;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,r,n,t.BADNESS,a)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" AND "+this.evaluateNodeToWhereClause(e.right,r,n,i,a)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" OR "+this.evaluateNodeToWhereClause(e.right,r,n,i,a)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" IS NOT NULL )";case"IN":if(o=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){for(var _=[],w=!0,S=0,b=e.right.value;S<b.length;S++){if("string"!==(x=b[S]).type){w=!1;break}if(void 0===this.lkp[x.value]){w=!1;break}_.push(this.lkp[x.value].toString())}if(w)return" ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" IN ("+_.join(",")+")) "}return o=this.evaluateNodeToWhereClause(e.right,r,n,i,a)," ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" IN ("+o.join(",")+")) "}return(p=this.evaluateNodeToWhereClause(e.right,r,n,i,a))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" IN ("+p.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" IN ("+p+")) ";case"NOT IN":if(o=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){_=[],w=!0;for(var F=0,I=e.right.value;F<I.length;F++){var x;if("string"!==(x=I[F]).type){w=!1;break}if(void 0===this.lkp[x.value]){w=!1;break}_.push(this.lkp[x.value].toString())}if(w)return" ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" NOT IN ("+_.join(",")+")) "}return o=this.evaluateNodeToWhereClause(e.right,r,n,i,a)," ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" NOT IN ("+o.join(",")+")) "}return(p=this.evaluateNodeToWhereClause(e.right,r,n,i,a))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" NOT IN ("+p.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,i,a)+" NOT IN ("+p+")) ";case"BETWEEN":return c=this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,a)," ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,a)+" BETWEEN "+c[0]+" AND "+c[1]+" ) ";case"NOTBETWEEN":return c=this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,a)," ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,a)+" NOT BETWEEN "+c[0]+" AND "+c[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,a)+" LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,a)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,a)+" LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,a)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,a)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,a)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,a)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,a)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+i+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+i+") ";return" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,a)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,a)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,a)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,a)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return l.makeDateString(e.value,r);case"number":return e.value.toString();case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?l.makeToday(!0,r):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?l.makeToday(!1,r):n&&n.toLowerCase()===e.column.toLowerCase()?"("+i+")":e.column;case"function":var T=this.evaluateNodeToWhereClause(e.args,r,n,t.BADNESS,a);return l.translateFunctionToDatabaseSpecific(e.name,T,r)}throw new Error("Unsupported sql syntax "+e.type)},t.prototype.extractValue=function(e){return this.codefield instanceof c.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]},t.BADNESS="_!!!_BAD_LKP_!!!!",t}(d);t.StringToCodeAdapted=y;var g=function(e){function t(t,r){var n=e.call(this)||this;return n.field=t,n.sql=r,n}return r(t,e),t.prototype.rewriteSql=function(e,t){return{rewritten:!0,where:l.reformulateWithoutField(e,this.field.name,l.toWhereClause(this.sql,s.FeatureServiceDatabaseType.Standardised),t.getFieldsIndex())}},t.prototype.postInitialization=function(e,t){},t.prototype.extractValue=function(e){return this.sql.calculateValueCompiled(e)},t}(d);t.SqlExpressionAdapted=g;var v=function(e){function t(t){var r=e.call(this,t)||this;return r._calcFunc=null,r.declaredClass="esri.arcade.featureset.actions.Adapted",r.adaptedFields=null,r._extraFilter=null,r._extraFilter=t.extraFilter,r._parent=t.parentfeatureset,r._maxProcessing=30,r.adaptedFields=t.adaptedFields,r}return r(t,e),t.findField=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name.toLowerCase()===t.toString().toLowerCase())return i}return null},t.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new p({wkid:4326}),this.objectIdField="",this.geometryType=s.layerGeometryEsriConstants.point,this.typeIdField="",this.types=null),this.fields=[];for(var e=0,t=this.adaptedFields;e<t.length;e++){var r=t[e];r.postInitialization(this,this._parent),this.fields.push(r.field)}},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._extraFilter?t._getFilteredSet("",null,null,null,e):t._parent._getSet(e)}).then(function(r){return t._checkCancelled(e),t._wset=new o(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset}):u.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},t.prototype._getFeatures=function(e,t,r,a){var s=this,l=[];-1!==t&&void 0===this._featureCache[t]&&l.push(t);var c=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,c,a))return this._expandPagedSet(e,c,0,0,a).then(function(n){return s._getFeatures(e,t,r,a)});for(var p=0,d=e._lastFetchedIndex;d<e._known.length&&(++p<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[d]]&&(e._known[d]!==t&&l.push(e._known[d]),l.length>=c-1)));d++);if(0===l.length)return u.resolve("success");e=new o([],l,e._ordered,null);var f=Math.min(l.length,r);return this._parent._getFeatures(e,-1,f,a).then(function(e){s._checkCancelled(a);for(var t=[],r=0;r<f;r++){var o=s._parent._featureFromCache(l[r]);void 0!==o&&t.push({geometry:o.geometry,attributes:o.attributes,id:l[r]})}for(var u=0,c=t;u<c.length;u++){for(var p=c[u],d=[],h=0,y=s.adaptedFields;h<y.length;h++){var g=y[h];d[g.field.name]=g.extractValue(p)}s._featureCache[p.id]=new n({attributes:d,geometry:i.cloneGeometry(p.geometry)})}return"success"})},t.prototype._fetchAndRefineFeatures=function(e,t,r){return u.reject(new Error("Fetch and Refine should not be called in this featureset"))},t.prototype._getFilteredSet=function(e,t,r,n,i){var a,s=this,u=this.reformulateWithoutAdaptions(r);a=u.cannot,r=u.where;var c=!1;if(null!==n){c=!0;for(var p=[],d=0,y=this.adaptedFields;d<y.length;d++){var g=y[d];if(!(g instanceof f)&&!0===n.scanForField(g.field.name)){if(!(g instanceof h)){n=null,c=!1;break}p.push({field:g.field.name,newfield:g.originalField.name})}}n&&p.length>0&&(n=n.replaceFields(p))}return null!==r?null!==this._extraFilter&&(r=l.combine(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then(function(){return s._parent._getFilteredSet(e,t,r,n,i)}).then(function(e){return s._checkCancelled(i),!0===a?new o(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===c&&e._ordered,s._clonePageDefinition(e.pagesDefinition)):new o(e._candidates.slice(0),e._known.slice(0),!0===c&&e._ordered,s._clonePageDefinition(e.pagesDefinition))})},t.prototype.reformulateWithoutAdaptions=function(e){var t={cannot:!1,where:e};if(null!==e)for(var r=0,n=this.adaptedFields;r<n.length;r++){var i=n[r];if(!0===l.scanForField(e,i.field.name)){var a=i.rewriteSql(e,this);if(!0!==a.rewritten){t.cannot=!0,t.where=null;break}t.where=a.where}}return t},t.prototype._stat=function(e,t,r,n,i,a,o){var s=this,c=!1,p=this.reformulateWithoutAdaptions(t);return c=p.cannot,t=p.where,p=this.reformulateWithoutAdaptions(i),c=c||p.cannot,null!==(i=p.where)?null!==this._extraFilter&&(i=l.combine(this._extraFilter,i)):i=this._extraFilter,!0===c?null===i&&""===r&&null===n?this._manualStat(e,t,a,o):u.resolve({calculated:!1}):this._parent._stat(e,t,r,n,i,a,o).then(function(l){return!1===l.calculated?null===i&&""===r&&null===n?s._manualStat(e,t,a,o):{calculated:!1}:l})},t.prototype._canDoAggregates=function(e,t,r,n,i){if(null===this._parent)return u.resolve(!1);for(var a=0;a<e.length;a++)for(var o=0,s=this.adaptedFields;o<s.length;o++){var c=s[o];if(e[a].toLowerCase()===c.field.name.toLowerCase()&&!(c instanceof f))return u.resolve(!1)}var p=[];for(a=0;a<t.length;a++){var d=t[a];if(null!==d.workingexpr){var h=this.reformulateWithoutAdaptions(d.workingexpr);if(h.cannot)return u.resolve(!1);var y=d.clone();y.workingexpr=h.where,p.push(y)}else p.push(d)}var g=this.reformulateWithoutAdaptions(i);return g.cannot?u.resolve(!1):(null!==(i=g.where)?null!==this._extraFilter&&(i=l.combine(this._extraFilter,i)):i=this._extraFilter,this._parent._canDoAggregates(e,p,r,n,i))},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,i,a,o){if(null===this._parent)return u.reject(new Error("Should never be called"));for(var s=[],c=0;c<t.length;c++){var p=t[c];if(null!==p.workingexpr){var d=this.reformulateWithoutAdaptions(p.workingexpr);if(d.cannot)return u.reject(new Error("Should never be called"));var f=p.clone();f.workingexpr=d.where,s.push(f)}else s.push(p)}var h=this.reformulateWithoutAdaptions(i);return h.cannot?u.reject(new Error("Should never be called")):(null!==(i=h.where)?null!==this._extraFilter&&(i=l.combine(this._extraFilter,i)):i=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,s,r,n,i,a,o))},t}(a);t.AdaptedFeatureSet=v}.apply(null,n))||(e.exports=i)},93:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(28),r(33),r(30)],void 0===(i=function(e,t,r,n,i,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.maxPointCount=void 0,r.maxRecordCount=void 0,r.maxVertexCount=void 0,r.onStatisticField=null,r.outStatisticFieldName=null,r.statisticType=null,r}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType})},n([a.property({type:Number,json:{write:!0}})],t.prototype,"maxPointCount",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"maxRecordCount",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"maxVertexCount",void 0),n([a.property({type:String,json:{write:!0}})],t.prototype,"onStatisticField",void 0),n([a.property({type:String,json:{write:!0}})],t.prototype,"outStatisticFieldName",void 0),n([a.property({type:String,json:{write:!0}})],t.prototype,"statisticType",void 0),i=n([a.subclass("esri.tasks.support.StatisticDefinition")],t)}(a.declared(i.JSONSupport))}.apply(null,n))||(e.exports=i)}}]);