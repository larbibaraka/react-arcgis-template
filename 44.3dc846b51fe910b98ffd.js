(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/support/commonProperties":53,"esri/layers/mixins/PortalLayer":59,"esri/layers/mixins/OperationalLayer":64,"esri/layers/mixins/ScaleRangeLayer":66,"esri/symbols/support/ElevationInfo":67,"esri/symbols/support/FeatureExpressionInfo":68,"esri/symbols/support/unitConversionUtils":69,"esri/tasks/support/Query":74,"esri/layers/mixins/RefreshableLayer":88,"esri/tasks/support/StatisticDefinition":93,"esri/tasks/operations/urlUtils":117,"esri/layers/support/labelUtils":119,"esri/layers/mixins/ArcGISService":126,"esri/layers/support/LabelExpressionInfo":166,"esri/tasks/operations/query":171,"esri/layers/graphics/data/utils":188,"esri/layers/support/LabelClass":189,"esri/layers/graphics/data/attributeSupport":215,"esri/layers/graphics/data/QueryEngine":229,"esri/layers/graphics/data/FeatureStore":267,"esri/layers/graphics/centroid":268,"esri/layers/graphics/data/spatialQuerySupport":269,"esri/layers/graphics/data/QueryEngineCapabilities":294,"esri/layers/graphics/data/timeSupport":295,"esri/core/sql/WhereClauseCache":376,"esri/layers/graphics/contains":377,"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":378,"esri/geohash/geohashUtils":394,"esri/layers/graphics/data/executeTileQuery":446,"esri/layers/graphics/data/BoundsStore":577,"esri/layers/graphics/data/QueryEngineResult":578,"esri/layers/graphics/data/AttributesBuilder":579,"esri/layers/support/PromiseQueue":580,"esri/views/2d/layers/features/controllers/BaseController":624,"esri/views/2d/layers/features/support/ClusterStore":625,"esri/geohash/GeohashTree":626,"esri/views/2d/layers/features/support/pixelBuffering":627,"esri/views/2d/layers/features/controllers/StreamController":2288,"esri/layers/graphics/data/StreamStore":2289,"esri/layers/graphics/sources/connections/GeoEventConnection":2290,"esri/layers/graphics/sources/connections/StreamConnection":2296,"esri/views/2d/layers/features/controllers/support/DispatchQueue":2297})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[44,9,32,86,87,88,89,90,91,92,93,94,95],{117:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var n=t[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[i]=[];for(var o=0;o<n.length;o++)r[i][o]=e(n[o])}else"object"==typeof n?n.toJSON&&(r[i]=JSON.stringify(n)):r[i]=n}return r}}.apply(null,i))||(e.exports=n)},119:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(124)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i="__begin__",n="__end__",o=new RegExp(i,"ig"),s=new RegExp(n,"ig"),a=new RegExp("^"+i,"i"),u=new RegExp(n+"$","i"),l='"',c=l+" + ",p=" + "+l;t.convertTemplatedStringToArcade=function(e){var t;return e?(t=r.replace(e,function(e){return i+'$feature["'+e+'"]'+n}),t=a.test(t)?t.replace(a,""):l+t,t=(t=u.test(t)?t.replace(u,""):t+l).replace(o,c).replace(s,p)):t='""',t}}.apply(null,i))||(e.exports=n)},126:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(37),r(30),r(116)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.layers.mixins.ArcGISService");t.ArcGISService=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"title",{get:function(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){var e=s.parse(this.url);if(e&&e.title)return e.title}return this._get("title")||""},set:function(e){this._set("title",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{set:function(e){this._set("url",s.sanitizeUrl(e,a))},enumerable:!0,configurable:!0}),i([o.property({dependsOn:["url"]})],t.prototype,"title",null),i([o.property({type:String})],t.prototype,"url",null),i([o.subclass("esri.layers.mixins.ArcGISService")],t)}(o.declared(e))}}.apply(null,i))||(e.exports=n)},166:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(33),r(30),r(119)],void 0===(n=function(e,t,r,i,n,o,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.expression=null,t}var n;return r(t,e),n=t,t.prototype.readExpression=function(e,t){return t.value?s.convertTemplatedStringToArcade(t.value):e},t.prototype.writeExpression=function(e,t,r){null!=this.value&&(e=s.convertTemplatedStringToArcade(this.value)),t[r]=e},t.prototype.clone=function(){return new n({value:this.value,expression:this.expression})},i([o.property({json:{read:!1,write:!1}})],t.prototype,"value",void 0),i([o.property({type:String,json:{write:{allowNull:!0}}})],t.prototype,"expression",void 0),i([o.reader("expression",["expression","value"])],t.prototype,"readExpression",null),i([o.writer("expression")],t.prototype,"writeExpression",null),n=i([o.subclass("esri.layers.support.LabelExpressionInfo")],t)}(o.declared(n.JSONSupport))}.apply(null,i))||(e.exports=n)},171:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(35),r(44),r(40),r(39),r(46),r(104),r(228),r(227),r(117),r(6)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c){function p(e,t){var r=e.geometry,i=e.toJSON(),n=i;if(r&&(n.geometry=JSON.stringify(r),n.geometryType=s.getJsonType(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete n.outFields:-1!==i.outFields.indexOf("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(n.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var o=i.timeExtent,a=o.start,u=o.end;null==a&&null==u||(n.time=a===u?a:(null==a?"null":a)+","+(null==u?"null":u)),delete i.timeExtent}return n}function d(e,t,s,u,l){void 0===u&&(u={});var d="string"==typeof e?o.urlToObject(e):e,h=t.geometry?[t.geometry]:[];return u.responseType="pbf"===s?"array-buffer":"json",a.normalizeCentralMeridian(h,null,u).then(function(e){var o=e&&e[0];n.isSome(o)&&((t=t.clone()).geometry=o);var a=c.mapParameters(r({},d.query,{f:s},l,p(t,l)));return i(d.path+"/query",r({},u,{query:a}))})}Object.defineProperty(t,"__esModule",{value:!0});var h,f="Layer does not support extent calculation.";t.queryToQueryStringParameters=p,t.executeQuery=function(e,t,r){return d(e,t,"json",r)},t.executeQueryPBF=function(e,t,r,i){var n=r.useWorker?(null==h&&(h=new l.PBFWorker),h):null;return d(e,t,"pbf",i).then(function(e){var t=function(t){var r=e;return r.data=t,r};return r.useWorker?n.parseFeatureQuery(e.data,r).then(function(e){return t(e)}):t(u.parsePBFFeatureQuery(e.data,r))})},t.executeQueryForIds=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return d(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(f);if(t.hasOwnProperty("count"))throw new Error(f);return e})}}.apply(null,i))||(e.exports=n)},188:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(31),r(32),r(41),r(40),r(34),r(174),r(309),r(46),r(104),r(63),r(268),r(157),r(162),r(163),r(269)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,v){function g(e,t,r,i,n){void 0===i&&(i=e.hasZ),void 0===n&&(n=e.hasM);var o=e.hasZ&&i,s=e.hasM&&n;if(r){var a=h.quantizeOptimizedGeometry(x,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,n);return h.convertToPoint(a,o,s)}return h.convertToPoint(t,o,s)}function m(e,n,s){return i(this,void 0,void 0,function(){var i,a,p,d,h,f;return r(this,function(r){switch(r.label){case 0:return e?(i=e.where,e.where=i=i&&i.trim(),(!i||/^1 *= *1$/.test(i)||n&&n===i)&&(e.where=null),e.geometry?[4,b(e)]:[2,e]):[2,null];case 1:return a=r.sent(),e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel&&(p=e.geometry.spatialReference,(a=u.getGeometryExtent(a)).spatialReference=p),e.geometry=a,[4,y.checkProjectionSupport(a.spatialReference,s)];case 2:return r.sent(),[4,c.normalizeCentralMeridian(l.fromJSON(a))];case 3:if(d=r.sent()[0],o.isNone(d))throw t.QUERY_ENGINE_EMPTY_RESULT;return h=d.toJSON(),[4,y.project(h,h.spatialReference,s)];case 4:if(!(f=r.sent()))throw t.QUERY_ENGINE_EMPTY_RESULT;return f.spatialReference=s,e.geometry=f,[2,e]}})})}function b(e){return i(this,void 0,void 0,function(){var t,i,n,o,u,l,c,d,h;return r(this,function(r){switch(r.label){case 0:return t=e.geometry,i=e.distance,n=e.units,null==i?[2,s.resolve(t)]:(o=t.spatialReference,u=n&&_.fromJSON(n)||a.getUnitString(o),o&&(p.isGeographic(o)||p.isWebMercator(o))?(c=t,[3,3]):[3,1]);case 1:return[4,y.checkProjectionSupport(o,p.WGS84).then(function(){return y.project(t,p.WGS84)})];case 2:c=r.sent(),r.label=3;case 3:return l=c,[4,v.getGeodesicBufferOperator()];case 4:return d=r.sent(),[2,(h=d(l,i,u))?h.toJSON():null]}})})}Object.defineProperty(t,"__esModule",{value:!0});var _=new n.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});t.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var S=new f.default,I=new f.default,x=new f.default,w={esriGeometryPoint:h.convertToPoint,esriGeometryPolyline:h.convertToPolyline,esriGeometryPolygon:h.convertToPolygon,esriGeometryMultipoint:h.convertToMultipoint};t.transformCentroid=g,t.getCentroid=function(e,t,r){return"esriGeometryPolygon"===e.geometryType&&t&&(t.centroid||t.geometry)?(t.centroid||(t.centroid=d.getCentroidOptimizedGeometry(new f.default,t.geometry,e.hasZ,e.hasM)),g(e,t.centroid,r)):null},t.getGeometry=function(e,t,r,i,n,o){void 0===n&&(n=e.hasZ),void 0===o&&(o=e.hasM);var s=e.hasZ&&n,a=e.hasM&&o,u=t?"coords"in t?t:t.geometry:null;if(!u)return null;if(r){var l=h.generalizeOptimizedGeometry(I,u,e.hasZ,e.hasM,e.geometryType,r,n,o);return i&&(l=h.quantizeOptimizedGeometry(x,l,s,a,e.geometryType,i)),w[e.geometryType](l,s,a)}if(i)return l=h.quantizeOptimizedGeometry(x,u,e.hasZ,e.hasM,e.geometryType,i,n,o),w[e.geometryType](l,s,a);return h.removeZMValues(S,u,e.hasZ,e.hasM,n,o),w[e.geometryType](S,s,a)},t.normalizeQuery=function(e,t,n){return i(this,void 0,void 0,function(){var i,o,s,a,u;return r(this,function(r){if(i=e.outFields,o=e.orderByFields,s=e.groupByFieldsForStatistics,a=e.outStatistics,i)for(u=0;u<i.length;u++)i[u]=i[u].trim();if(o)for(u=0;u<o.length;u++)o[u]=o[u].trim();if(s)for(u=0;u<s.length;u++)s[u]=s[u].trim();if(a)for(u=0;u<a.length;u++)a[u].onStatisticField&&(a[u].onStatisticField=a[u].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),[2,m(e,t,n)]})})},t.normalizeFilter=function(e,t,n){return i(this,void 0,void 0,function(){return r(this,function(r){return[2,m(e,t,n)]})})},t.normalizeQueryLike=m,t.cleanFromGeometryEngine=function(e){return e&&F in e?JSON.parse(JSON.stringify(e,T)):e};var F="_geVersion",T=function(e,t){return e!==F?t:void 0}}.apply(null,i))||(e.exports=n)},189:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(28),r(29),r(31),r(32),r(71),r(41),r(33),r(38),r(30),r(166),r(119),r(208),r(196),r(80)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y){function v(e){return!e||"service"!==e.origin&&(!e.layer||!h.isOfType(e.layer,"map-image"))}function g(e){if(!e)return null;var t=_.exec(e);return t&&(t[1]||t[3])||null}var m=new a.default({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0}),b=/^\s*\{([^}]+)\}\s*$/i,_=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]))\s*$/i;return function(e){function t(t){var r=e.call(this,t)||this;return r.name=null,r.labelExpression=null,r.labelExpressionInfo=null,r.labelPlacement=null,r.maxScale=0,r.minScale=0,r.symbol=f.defaultTextSymbol2D,r.useCodedValues=void 0,r.where=null,r}var n;return i(t,e),n=t,t.evaluateWhere=function(e,t){var r=function(e,t,r){switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;var i=e.split(" ");if(3===i.length)return r(t[i[0]],i[1],i[2]);if(7===i.length){var n=r(t[i[0]],i[1],i[2]),o=i[3],s=r(t[i[4]],i[5],i[6]);switch(o){case"AND":return n&&s;case"OR":return n||s}}return!1}catch(t){console.log("Error.: can't parse = "+e)}},t.prototype.readLabelExpression=function(e,t){var r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e},t.prototype.writeLabelExpression=function(e,t,r,i){if(this.labelExpressionInfo&&v(i))if(null!=this.labelExpressionInfo.value)e=function(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){var n=g(this.labelExpressionInfo.expression);n&&(e="["+n+"]")}null!=e&&(t[r]=e)},t.prototype.writeLabelExpressionInfo=function(e,t,r,i){if(null==e&&null!=this.labelExpression&&v(i))e=new p({expression:this.getLabelExpressionArcade()});else if(!e)return;var n=e.toJSON(i);n.expression&&(t[r]=n)},t.prototype.writeMaxScale=function(e,t){(e||this.minScale)&&(t.maxScale=e)},t.prototype.writeMinScale=function(e,t){(e||this.maxScale)&&(t.minScale=e)},t.prototype.getLabelExpression=function(){var e={expression:"",type:"none"};return this.labelExpressionInfo?this.labelExpressionInfo.value?(e.expression=this.labelExpressionInfo.value,e.type="conventional"):this.labelExpressionInfo.expression&&(e.expression=this.labelExpressionInfo.expression,e.type="arcade"):null!=this.labelExpression&&(e.expression=function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(this.labelExpression),e.type="conventional"),e},t.prototype.getLabelExpressionArcade=function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return d.convertTemplatedStringToArcade(e.expression);case"arcade":return e.expression}return null},t.prototype.getLabelExpressionSingleField=function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return function(e){var t=e.match(b);return t&&t[1].trim()||null}(e.expression);case"arcade":return g(e.expression)}return null},t.prototype.clone=function(){return new n({labelExpression:this.labelExpression,labelExpressionInfo:l.clone(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:l.clone(this.symbol),where:this.where,useCodedValues:this.useCodedValues})},r([c.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),r([c.property({type:String,json:{write:{allowNull:!0}}})],t.prototype,"labelExpression",void 0),r([c.reader("labelExpression")],t.prototype,"readLabelExpression",null),r([c.writer("labelExpression")],t.prototype,"writeLabelExpression",null),r([c.property({type:p,json:{write:{overridePolicy:function(e,t,r){return v(r)?{allowNull:!0}:{enabled:!1}}}}})],t.prototype,"labelExpressionInfo",void 0),r([c.writer("labelExpressionInfo")],t.prototype,"writeLabelExpressionInfo",null),r([c.property({type:m.apiValues,json:{type:m.jsonValues,read:m.read,write:m.write}})],t.prototype,"labelPlacement",void 0),r([c.property({type:Number})],t.prototype,"maxScale",void 0),r([c.writer("maxScale")],t.prototype,"writeMaxScale",null),r([c.property({type:Number})],t.prototype,"minScale",void 0),r([c.writer("minScale")],t.prototype,"writeMinScale",null),r([c.property({types:s.symbolTypesLabel,json:{origins:{"web-scene":{types:s.symbolTypesLabel3D,read:y.read,write:y.writeTarget,default:null}},read:y.read,write:y.writeTarget,default:null}})],t.prototype,"symbol",void 0),r([c.property({type:Boolean,json:{write:!0}})],t.prototype,"useCodedValues",void 0),r([c.property({type:String,json:{write:!0}})],t.prototype,"where",void 0),n=r([c.subclass("esri.layers.support.LabelClass")],t)}(c.declared(u.JSONSupport))}.apply(null,i))||(e.exports=n)},215:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(35),r(36),r(107),r(376)],void 0===(n=function(e,t,r,i,n,o){function s(e,t){return e?l.get(e,t):null}function a(e,t,r,n){void 0===n&&(n=!0);for(var o=[],l=0,p=t;l<p.length;l++){var d=p[l];if("*"!==d&&!e.has(d))if(n){var h=u(d);try{var f=s(h,e);if(!f)throw new i(c,"invalid SQL expression",{where:h});if(!f.isStandardized)throw new i(c,"expression is not standard",{clause:f});a(e,f.fieldNames,"expression contains missing fields")}catch(e){var y=e&&e.details;if(y&&(y.clause||y.where))throw e;y&&y.missingFields?o.push.apply(o,y.missingFields):o.push(d)}}else o.push(d)}if(o.length)throw new i(c,r,{missingFields:o})}function u(e){return e.split(p)[0]}Object.defineProperty(t,"__esModule",{value:!0});var l=new o.WhereClauseCache(50,500),c="feature-store:unsupported-query",p=" as ",d=n.createSetFromValues(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);t.validateWhere=function(e,t){if(!t)return!0;var r=l.get(t,e);if(!r)throw new i(c,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new i(c,"where clause is not standard",{where:t});return a(e,r.fieldNames,"where clause contains missing fields"),!0},t.validateHaving=function(e,t,r){if(!t)return!0;var n=l.get(t,e);if(!n)throw new i(c,"invalid SQL expression",{having:t});if(!n.isAggregate)throw new i(c,"having does not contain a valid aggregate function",{having:t});var o=n.fieldNames;if(a(e,o,"having contains missing fields"),!n.getExpressions().every(function(t){var i=t.aggregateType,n=t.field,o=e.has(n)&&e.get(n).name;return r.some(function(t){var r=t.onStatisticField,n=t.statisticType;return(e.has(r)&&e.get(r).name)===o&&n.toLowerCase().trim()===i})}))throw new i(c,"expressions in having should also exist in outStatistics",{having:t});return!0},t.getWhereClause=s,t.validateFields=a,t.getExpressionFromFieldName=u,t.getAliasFromFieldName=function(e){return e.split(p)[1]},t.hasInvalidFieldType=function(e,t){var r=t.get(e);return!!r&&!d.has(r.type)}}.apply(null,i))||(e.exports=n)},2288:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(35),r(31),r(32),r(36),r(49),r(107),r(40),r(34),r(30),r(157),r(446),r(2289),r(2290),r(624),r(2297)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,v,g,m){Object.defineProperty(t,"__esModule",{value:!0});var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="stream",t._tileDispatchMap=new Map,t._updateIntervalId=0,t}return r(t,e),t.prototype.initialize=function(){var e=this,t=this.service,r=t.source,i=t.objectIdField,n=t.timeInfo,o=t.maximumTrackPoints,s=t.purgeOptions,a=t.serviceFilter;this.connection=new v.default(r,this.spatialReference,a),this._set("store",new y.default(i,n,this.geometryInfo,o,s)),this.connection.on("feature",function(t){return e._onFeature(t)}),this.store.events.on("update",function(t){var r=t.addOrUpdated,i=t.removed;return e._onUpdate(r,i)}),["connectionStatus","errorString"].forEach(function(t){e.watch("connection."+t,function(r){return e.remoteClient.invoke("setProperty",{propertyName:t,value:r})})}),this._updateIntervalId=setInterval(function(){return e.store.checkForUpdates()},64),this._shouldPushDataReceived=this.service.enableDataRecieved},t.prototype.destroy=function(){clearInterval(this._updateIntervalId),this.connection.destroy(),this.queryEngine.destroy(),this._tileDispatchMap.forEach(function(e){return e.destroy()})},Object.defineProperty(t.prototype,"queryEngine",{get:function(){return this._createQueryEngine(this.store)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._tempQueryEngine&&!!this._tempQueryEngine.featureStore.numFeatures||this._anyUpdatesQueued()},enumerable:!0,configurable:!0}),t.prototype.update=function(e){return s(this,void 0,void 0,function(){var t,r,i=this;return o(this,function(n){switch(n.label){case 0:return this.validateConfig(e),t=this.renderer.getAttributeHash(),this._set("config",e),[4,this.updatePixelBuffer()];case 1:return n.sent(),"heatmap"===this.renderer.type?[2]:t===this.renderer.getAttributeHash()?[3,3]:(r=this.queryEngine.featureStore,[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]);case 2:n.sent(),r.forEach(function(e){return i.attributeStore.setAttributeData(e.localId,e,i.geometryInfo,i.viewParams)}),n.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return n.sent(),[4,this.attributeStore.sendUpdates()];case 5:return n.sent(),[2]}})})},t.prototype.invalidate=function(){this._repushActiveTiles()},t.prototype.onEdits=function(){},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},t.prototype.queryLatestObservations=function(e){return s(this,void 0,void 0,function(){return o(this,function(t){if(!this.service.timeInfo.trackIdField)throw new a("mapview-no-trackIdField","queryLatestObservation can only be used with services that define a TrackIdField");return[2,this.queryEngine.executeQueryForLatestObservations(e)]})})},t.prototype.queryStatistics=function(){throw new a("Method not implemented.")},t.prototype.refresh=function(){},t.prototype.setViewState=function(){var e=this,t=this.viewState&&this.viewState.scale;this.inherited(arguments),t!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.queryEngine.featureStore.forEach(function(t){return e.attributeStore.setAttributeData(t.localId,t,e.geometryInfo,e.viewParams)}),this.attributeStore.sendUpdates())},t.prototype.onTileUpdate=function(e){var t=this,r=e.added;e.removed.forEach(function(e){return t._handleTileRemove(e)}),r.forEach(function(e){return t._handleTileAdd(e)})},t.prototype.enableEvent=function(e){"data-received"===e.name&&(this._shouldPushDataReceived=e.value)},t.prototype._onFeature=function(e){this._shouldPushDataReceived&&this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}});try{var t=this.geometryInfo,r=t.geometryType,i=t.hasM,n=t.hasZ,o=h.convertFromFeature(e,r,n,i,this.store.objectIdField);this.store.add(o)}catch(e){u("esri-2d-debug")&&console.debug(e)}},t.prototype._createStoreWithFeatures=function(e){if(c.isNone(e))return null;var t=this._createFeatureStore();return t.addMany(e),t},t.prototype._onUpdate=function(e,t){return s(this,void 0,void 0,function(){var r,i,n=this;return o(this,function(o){switch(o.label){case 0:return c.isSome(e)&&e.forEach(function(e){return n.onFeatureAdd(e)}),r=this._createStoreWithFeatures(e),i=this._createStoreWithFeatures(t),this.attributeStore.sendUpdates(),this.processor.supportsTileUpdates?[4,this._updateActiveTiles(r,i)]:[3,2];case 1:return o.sent(),[3,3];case 2:this._repushActiveTiles(),o.label=3;case 3:return c.isSome(t)&&t.forEach(function(e){return n.onFeatureRemove(e)}),[2]}})})},t.prototype._handleTileAdd=function(e){if(this._tileDispatchMap.has(e.id)){(t=this._tileDispatchMap.get(e.id)).up()}else{var t=new m.default;this._tileDispatchMap.set(e.id,t)}this._queryTileFeatures(e,!0,this.queryEngine)},t.prototype._handleTileRemove=function(e){this._tileDispatchMap.get(e.id).destroy(),this._tileDispatchMap.delete(e.id)},t.prototype._anyUpdatesQueued=function(){return l.valuesOfMap(this._tileDispatchMap).some(function(e){return e.hasAction()})},t.prototype._updateActiveTiles=function(e,t){return s(this,void 0,void 0,function(){var r,i,n=this;return o(this,function(o){switch(o.label){case 0:return r=c.applySome(e,function(e){return n._createQueryEngine(e)}),i=c.applySome(t,function(e){return n._createQueryEngine(e)}),[4,p.all(this.tileStore.tiles.map(function(e){return n._queryTileFeatures(e,!1,r,i)}))];case 1:return o.sent(),[2]}})})},t.prototype._repushActiveTiles=function(){for(var e=0,t=this.tileStore.tiles;e<t.length;e++){var r=t[e];this._queryTileFeatures(r,!0,this.queryEngine)}},t.prototype._queryTileFeatures=function(e,t,r,i){return s(this,void 0,void 0,function(){var n,a,u,l,d,h,y,v,g,m,b,_,S=this;return o(this,function(I){switch(I.label){case 0:return n={hasZ:!1,hasM:!1,transform:{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}},a=this.queryInfo,u=a.returnCentroid,l=a.returnGeometry,d=this._pixelBuffer,h={returnCentroid:u,returnGeometry:l,pixelBuffer:d,returnOutline:this.returnOutline},y=this._tileDispatchMap.get(e.id),[4,c.applySome(r,function(t){return t.featureStore.executeTileQuery(e,S.spatialReference,h)})];case 1:return v=I.sent(),g=c.mapOr(v,[],function(e){return e.features}),m=c.mapOr(i,[],function(t){return f.executeTileQueryForIds(t,e,h)}).map(function(e){return S.attributeStore.getLocalId(e)}),b=p.createResolver(),_=function(r){return s(S,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,this.processor.onTileData(e,{addOrUpdate:g,remove:m,clear:t,transformParams:n},{signal:r})];case 1:return i.sent(),b.resolve(),[2]}})})},y.enqueue(_),[2,b.promise]}})})},i([d.property()],t.prototype,"connection",void 0),i([d.property()],t.prototype,"service",void 0),i([d.property({readOnly:!0})],t.prototype,"store",void 0),i([d.property({readOnly:!0,dependsOn:["store","service","config"]})],t.prototype,"queryEngine",null),i([d.property()],t.prototype,"updating",null),i([d.subclass("esri.views.2d.layers.features.controllers.StreamController")],t)}(d.declared(g.default));t.default=b}.apply(null,i))||(e.exports=n)},2289:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(28),r(43),r(430),r(40),r(267)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_STREAM_ID_FIELD="__esri_stream_id__";var a=function(e){function r(r,i,n,s,a,u){void 0===u&&(u=128);var l=e.call(this,n)||this;return l._trackIdToObservations=new Map,l._idCounter=0,l._lastPurge=Date.now(),l._addOrUpdated=new Map,l._removed=[],l._maxAge=0,l._timeInfo=i,l._maximumTrackCount=s,l._purgeOptions=a,l.purgeInterval=u,l.objectIdField=o.unwrapOr(r,t.DEFAULT_STREAM_ID_FIELD),l._useGeneratedIds=l.objectIdField===t.DEFAULT_STREAM_ID_FIELD,l}return i(r,e),r.prototype.add=function(t){if(this._useGeneratedIds&&(t.attributes[this.objectIdField]=this._nextId(),t.objectId=t.attributes[this.objectIdField]),e.prototype.add.call(this,t),this._addOrUpdated.set(t.objectId,t),this._maxAge=Math.max(this._maxAge,t.attributes[this._timeInfo.startTimeField]),this._timeInfo.trackIdField){var r=t.attributes[this._timeInfo.trackIdField];this._trackIdToObservations.has(r)||this._trackIdToObservations.set(r,new n.default(this._maximumTrackCount));var i=this._trackIdToObservations.get(r),s=t.attributes[this.objectIdField],a=i.enqueue(s);if(o.isSome(a)){var u=this.removeById(a);o.isSome(u)&&(this._addOrUpdated.has(a)?this._addOrUpdated.delete(a):this._removed.push(u))}}},r.prototype.checkForUpdates=function(){var e=this._getToAdd(),t=this._getToRemove(),r=Date.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(),this._lastPurge=r),(e||t)&&this.events.emit("update",{addOrUpdated:e,removed:t})},r.prototype._getToAdd=function(){if(!this._addOrUpdated.size)return null;var e=new Array(this._addOrUpdated.size),t=0;return this._addOrUpdated.forEach(function(r){return e[t++]=r}),this._addOrUpdated.clear(),e},r.prototype._getToRemove=function(){var e=this._removed;return this._removed.length?(this._removed=[],e):null},r.prototype._nextId=function(){var e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e},r.prototype._purge=function(){var e=this._purgeOptions;o.isSome(e)&&(this._purgeSomeByDisplayCount(e),this._purgeByAge(e))},r.prototype._purgeSomeByDisplayCount=function(e){var t=this;if(e.displayCount){var r=this.numFeatures;r>e.displayCount&&this._trackIdToObservations.forEach(function(i){if(r>e.displayCount&&i.size){var n=t.removeById(o.unwrap(i.dequeue()));o.isSome(n)&&t._removed.push(n),r--}})}},r.prototype._purgeByAge=function(e){var t=this;if(e.age){var r=60*e.age*1e3,i=this._maxAge-r,n=this._timeInfo.startTimeField;this.forEach(function(e){e.attributes[n]<i&&(t.removeById(e.objectId),t._removed.push(e))})}},r}(s.default);t.default=a}.apply(null,i))||(e.exports=n)},229:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(35),r(31),r(32),r(36),r(107),r(38),r(37),r(355),r(34),r(174),r(185),r(92),r(281),r(46),r(63),r(215),r(163),r(294),r(578),r(269),r(295),r(188),r(148),r(580)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,v,g,m,b,_,S,I,x,w,F){Object.defineProperty(t,"__esModule",{value:!0});var T=u.getLogger("esri.layers.graphics.data.QueryEngine"),E=function(){return function(e,t,r,i,n){void 0===t&&(t=null),this.attributes=e,this.geometry=r,this.centroid=i,this.filterFlags=n,this.groupId=-1,this.localId=t}}();t.Feature=E;var R=new Set,M=new l.MemCacheStorage(2e6),j=0,P=function(){function e(e){var t=this;this.capabilities={query:b.queryCapabilities},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.cacheSpatialQueries=e.cacheSpatialQueries||!1,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",function(){return t.clearCache()}),this.timeInfo=e.timeInfo,this.cacheSpatialQueries&&(this._geometryQueryCache=new l.MemCache(j+++"$$",M)),this.fieldsIndex=new w(e.fields),e.scheduler&&e.task&&(this._frameQueue=new F.PromiseQueue,this._frameTask=e.scheduler.registerTask(e.task,function(e){return t._update(e)},function(){return t._frameQueue.length>0}))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()},Object.defineProperty(e.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:(this._timeExtent=I.getTimeExtent(this.timeInfo,this.featureStore),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e,t){return void 0===e&&(e={}),n(this,void 0,void 0,function(){var t,r,n;return i(this,function(i){switch(i.label){case 0:t=a.clone(e),i.label=1;case 1:return i.trys.push([1,14,,15]),[4,this._schedule()];case 2:return i.sent(),[4,x.normalizeQuery(t,this.definitionExpression,this.spatialReference)];case 3:return t=i.sent(),[4,this._reschedule()];case 4:return i.sent(),[4,this._checkQuerySupport(t)];case 5:return t=i.sent(),[4,this._reschedule()];case 6:return i.sent(),[4,this._executeGeometryQuery(t)];case 7:return r=i.sent(),[4,this._reschedule()];case 8:return i.sent(),[4,r.executeObjectIdsQuery(t)];case 9:return r=i.sent(),[4,this._reschedule()];case 10:return i.sent(),[4,r.executeTimeQuery(t)];case 11:return r=i.sent(),[4,this._reschedule()];case 12:return i.sent(),[4,r.executeAttributesQuery(t)];case 13:return r=i.sent(),[3,15];case 14:if((n=i.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw n;return r=new _.default([],null,this),[3,15];case 15:return[2,r.createQueryResponse(t)]}})})},e.prototype.executeQueryForCount=function(e,t){return void 0===e&&(e={}),n(this,void 0,void 0,function(){var t,r,n;return i(this,function(i){switch(i.label){case 0:(t=a.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,i.label=1;case 1:return i.trys.push([1,14,,15]),[4,this._schedule()];case 2:return i.sent(),[4,x.normalizeQuery(t,this.definitionExpression,this.spatialReference)];case 3:return t=i.sent(),[4,this._reschedule()];case 4:return i.sent(),[4,this._checkQuerySupport(t)];case 5:return t=i.sent(),[4,this._reschedule()];case 6:return i.sent(),[4,this._executeGeometryQuery(t)];case 7:return r=i.sent(),[4,this._reschedule()];case 8:return i.sent(),[4,r.executeObjectIdsQuery(t)];case 9:return r=i.sent(),[4,this._reschedule()];case 10:return i.sent(),[4,r.executeTimeQuery(t)];case 11:return r=i.sent(),[4,this._reschedule()];case 12:return i.sent(),[4,r.executeAttributesQuery(t)];case 13:return[2,(r=i.sent()).size];case 14:if((n=i.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw n;return[2,0];case 15:return[2]}})})},e.prototype.executeQueryForExtent=function(e,t){return void 0===e&&(e={}),n(this,void 0,void 0,function(){var t,r,n,o,s,u,l,c;return i(this,function(i){switch(i.label){case 0:t=a.clone(e),n=t.outSR,i.label=1;case 1:return i.trys.push([1,14,,15]),[4,this._schedule()];case 2:return i.sent(),[4,x.normalizeQuery(t,this.definitionExpression,this.spatialReference)];case 3:return t=i.sent(),[4,this._reschedule()];case 4:return i.sent(),[4,this._checkQuerySupport(t)];case 5:return(t=i.sent()).returnGeometry=!0,t.returnCentroid=!1,t.outSR=null,[4,this._reschedule()];case 6:return i.sent(),[4,this._executeGeometryQuery(t)];case 7:return r=i.sent(),[4,this._reschedule()];case 8:return i.sent(),[4,r.executeObjectIdsQuery(t)];case 9:return r=i.sent(),[4,this._reschedule()];case 10:return i.sent(),[4,r.executeTimeQuery(t)];case 11:return r=i.sent(),[4,this._reschedule()];case 12:return i.sent(),[4,r.executeAttributesQuery(t)];case 13:return r=i.sent(),(o=r.size)?(d.set(C,d.NEGATIVE_INFINITY),this.featureStore.forEachBounds(r.items,function(e){return d.expand(C,e)},O),s={xmin:C[0],ymin:C[1],xmax:C[3],ymax:C[4],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)},this.hasZ&&isFinite(C[2])&&isFinite(C[5])&&(s.zmin=C[2],s.zmax=C[5]),(u=m.project(s,r.spatialReference,n)).spatialReference=x.cleanFromGeometryEngine(n||this.spatialReference),u.xmax-u.xmin==0&&(l=p.getMetersPerUnitForSR(u.spatialReference),u.xmin-=l,u.xmax+=l),u.ymax-u.ymin==0&&(l=p.getMetersPerUnitForSR(u.spatialReference),u.ymin-=l,u.ymax+=l),this.hasZ&&null!=u.zmin&&null!=u.zmax&&u.zmax-u.zmin==0&&(l=p.getMetersPerUnitForSR(u.spatialReference),u.zmin-=l,u.zmax+=l),[2,{count:o,extent:u}]):[2,{count:o,extent:null}];case 14:if((c=i.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw c;case 15:return[2]}})})},e.prototype.executeQueryForIds=function(e,t){return void 0===e&&(e={}),n(this,void 0,void 0,function(){return i(this,function(r){return[2,this.executeQueryForIdSet(e,t).then(function(e){return s.valuesOfSet(e)})]})})},e.prototype.executeQueryForIdSet=function(e,t){return void 0===e&&(e={}),n(this,void 0,void 0,function(){var t,r,n,o,s,u,l,c;return i(this,function(i){switch(i.label){case 0:(t=a.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,i.label=1;case 1:return i.trys.push([1,13,,14]),[4,this._schedule()];case 2:return i.sent(),[4,x.normalizeQuery(t,this.definitionExpression,this.spatialReference)];case 3:return t=i.sent(),[4,this._reschedule()];case 4:return i.sent(),[4,this._executeGeometryQuery(t)];case 5:return r=i.sent(),[4,this._reschedule()];case 6:return i.sent(),[4,r.executeObjectIdsQuery(t)];case 7:return r=i.sent(),[4,this._reschedule()];case 8:return i.sent(),[4,r.executeTimeQuery(t)];case 9:return r=i.sent(),[4,this._reschedule()];case 10:return i.sent(),[4,r.executeAttributesQuery(t)];case 11:return r=i.sent(),[4,this._reschedule()];case 12:for(i.sent(),n=r.items,o=new Set,s=0,u=n;s<u.length;s++)l=u[s],o.add(r.featureAdapter.getObjectId(l));return[2,o];case 13:if((c=i.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw c;case 14:return[2]}})})},e.prototype.executeQueryForLatestObservations=function(e,t){var r=this;return this.timeInfo?this.executeQuery(e,t).then(function(e){return r._filterLatest(e,r.timeInfo)}):void T.error(new o("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))},e.prototype._schedule=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){return this._frameQueue?[2,this._frameQueue.push(e).then(function(e){return e})]:[2,e]})})},e.prototype._reschedule=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){return this._frameQueue?[2,this._frameQueue.unshift(e).then(function(e){return e})]:[2,e]})})},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._filterLatest=function(e,t){for(var i=t.trackIdField,n=t.startTimeField,o=t.endTimeField||n,s=new Map,a=[],u=0,l=e.features;u<l.length;u++){var c=l[u],p=c.attributes[i],d=c.attributes[o];(!s.has(p)||s.get(p).attributes[o]<d)&&s.set(p,c)}return s.forEach(function(e){return a.push(e)}),r({},e,{features:a})},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach(function(t){return e.push(t)}),this._allItems=new _.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){return n(this,void 0,void 0,function(){var t,r,o,s,a,u,l,c,p,d,h,f,y,g,m,b,I,x,w,F,T,E,R,M=this;return i(this,function(j){switch(j.label){case 0:if(t=e.geometry,r=e.outSR,o=e.spatialRel,s=v.isValid(r)&&!v.equals(this.spatialReference,r),(a=this.cacheSpatialQueries?s?JSON.stringify({geometry:t,spatialRelationship:o,outSpatialReference:r}):JSON.stringify({geometry:t,spatialRelationship:o}):null)&&void 0!==(u=this._geometryQueryCache.get(a)))return[2,u];if(l=function(t){return n(M,void 0,void 0,function(){var n;return i(this,function(i){switch(i.label){case 0:return s&&(e.returnGeometry||e.returnCentroid)?[4,t.project(r)]:[3,2];case 1:return n=i.sent(),a&&this._geometryQueryCache.put(a,n,n.size||1),[2,n];case 2:return a&&this._geometryQueryCache.put(a,t,t.size||1),[2,t]}})})},!t)return[2,l(this._getAll())];if(c=this.featureAdapter,"esriSpatialRelDisjoint"!==o)return[3,5];if(!(p=this._searchFeatures(this._getQueryBBoxes(t))).length)return[2,l(this._getAll())];for(f=new Set,y=0,g=p;y<g.length;y++)m=g[y],f.add(c.getObjectId(m));return[4,this._reschedule(f)];case 1:return f=j.sent(),b=0,d=new Array(f.size),this.featureStore.forEach(function(e){return d[b++]=e}),h=f,[4,this._reschedule()];case 2:return j.sent(),[4,S.getSpatialQueryOperator(o,t,this)];case 3:return I=j.sent(),x=function(e){return!h.has(c.getObjectId(e))||I(c.getGeometry(e))},w=_.default.bind,[4,this._runSpatialFilter(d,x)];case 4:return T=new(w.apply(_.default,[void 0,j.sent(),t,this])),[2,l(T)];case 5:return(F=this._searchFeatures(this._getQueryBBoxes(t))).length?this._canExecuteSoloPass(t,e)?[2,l(new _.default(F,t,this))]:[4,S.getSpatialQueryOperator(o,t,this)]:(T=new _.default([],t,this),a&&this._geometryQueryCache.put(a,T,T.size||1),[2,T]);case 6:return E=j.sent(),[4,this._runSpatialFilter(F,function(e){return E(c.getGeometry(e))})];case 7:return R=j.sent(),[2,l(new _.default(R,t,this))]}})})},e.prototype._runSpatialFilter=function(e,t){return n(this,void 0,void 0,function(){var r,o,s,a=this;return i(this,function(u){return t?this._budget?(r=0,o=new Array,s=function(){return n(a,void 0,void 0,function(){var n;return i(this,function(i){switch(i.label){case 0:return r<e.length?(n=e[r],t(n)&&o.push(n),this._budget.done?[4,this._reschedule()]:[3,2]):[3,3];case 1:return i.sent(),[2,s()];case 2:return++r,[3,0];case 3:return[2]}})})},[2,this._reschedule().then(function(){return s()}).then(function(){return o})]):[2,e.filter(function(e){return t(e)})]:[2,e]})})},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,i=t.spatialRel;return S.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))},e.prototype._getQueryBBoxes=function(e){if(S.canQueryWithRBush(e)){if(y.isExtent(e))return[h.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(y.isPolygon(e))return e.rings.map(function(e){return h.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))})}return[f.getBoundsXY(h.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.featureStore.forEachInBounds(i,function(e){R.add(e)})}var n=new Array(R.size),o=0;return R.forEach(function(e){return n[o++]=e}),R.clear(),n},e.prototype._checkQuerySupport=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new o("feature-store:unsupported-query","Unsupported query options",{query:e});return[2,c.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),S.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),m.checkProjectionSupport(this.spatialReference,e.outSR)]).then(function(){return e})]})})},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,i=e.returnDistinctValues;if(r&&r.length>0){var n=r.map(function(e){return e.indexOf(" ASC")>-1?e.split(" ASC")[0]:e.indexOf(" DESC")>-1?e.split(" DESC")[0]:e});g.validateFields(this.fieldsIndex,n,"orderByFields contains missing fields")}if(t&&t.length>0)g.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(i)throw new o("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});g.validateWhere(this.fieldsIndex,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){return n(this,void 0,void 0,function(){var t,r,n,s,a,u,l,c,p,d,h;return i(this,function(i){if(t=e.outStatistics,r=e.groupByFieldsForStatistics,n=e.having,s=r&&r.length,a=t&&t.length,n){if(!s||!a)throw new o("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});g.validateHaving(this.fieldsIndex,n,t)}if(a){if(t.some(function(e){return"exceedslimit"===e.statisticType}))return[2];for(u=t.map(function(e){return e.onStatisticField}),g.validateFields(this.fieldsIndex,u,"onStatisticFields contains missing fields"),s&&g.validateFields(this.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields"),l=0,c=t;l<c.length;l++)if(p=c[l],d=p.onStatisticField,h=p.statisticType,(!s||"count"!==h)&&d&&g.hasInvalidFieldType(d,this.fieldsIndex))throw new o("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:p,query:e})}return[2]})})},e}();t.default=P;var O=d.create(),C=d.create()}.apply(null,i))||(e.exports=n)},2290:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(31),r(28),r(32),r(29),r(42),r(44),r(36),r(37),r(40),r(34),r(30),r(87),r(2296),r(171),r(74)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,v){Object.defineProperty(t,"__esModule",{value:!0});var g,m=l.getLogger("esri.layers.graphics.sources.connections.GeoEventConnection");!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(g=t.ReadyState||(t.ReadyState={}));var b=function(e){function t(t,r,i,n,o,s){void 0===n&&(n=5),void 0===o&&(o=3);var a=e.call(this)||this;return a.errorString=null,a._source=t,a._spatialReference=r,a._filter=i,a._outFields=s,a._maxQueryDepth=n,a._maxRecordCountFactor=o,a._open(),a}return o(t,e),t.prototype._open=function(){return n(this,void 0,void 0,function(){var e,t,i,n;return r(this,function(r){switch(r.label){case 0:return[4,this._fetchServiceDefinition(this._source)];case 1:return(e=r.sent()).timeInfo.trackIdField||m.warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The maximumTrackPoints property will have no effect."),[4,this._fetchWebSocketUrl(e.streamUrls,this._spatialReference)];case 2:return t=r.sent(),this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),[4,this._buddyServicesQuery];case 3:return r.sent(),[4,this._tryCreateWebSocket(t)];case 4:return r.sent(),i=this._filter,n=this._outFields,this._setFilter(i,n),[2]}})})},t.prototype.destroy=function(){c.isSome(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null},Object.defineProperty(t.prototype,"connectionStatus",{get:function(){if(c.isNone(this._websocket))return"disconnected";switch(this._websocket.readyState){case g.CONNECTING:case g.OPEN:return"connected";case g.CLOSING:case g.CLOSED:return"disconnected"}},enumerable:!0,configurable:!0}),t.prototype._tryCreateWebSocket=function(e,t){return void 0===t&&(t=1e3),n(this,void 0,void 0,function(){var i,n,o;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),i=this,[4,this._createWebSocket(e)];case 1:return i._websocket=r.sent(),this.notifyChange("connectionStatus"),[3,4];case 2:return n=r.sent(),o=t/1e3,m.error(new u("geoevent-connection","Failed to connect. Attempting to reconnect in "+o+"s",n)),[4,p.after(t)];case 3:return r.sent(),[2,this._tryCreateWebSocket(e,1.5*t)];case 4:return[2]}})})},t.prototype._createWebSocket=function(e){var t=this,r=new WebSocket(e),i=p.create(function(e,t){r.onopen=function(){return e(r)},r.onclose=function(e){return t(e)}});return i.then(function(){r.onclose=function(e){return t._onClose(e)},r.onerror=function(e){return t._onError(e)},r.onmessage=function(e){return t._onMessage(e)}}),i},t.prototype._onMessage=function(e){var t;try{t=this._enrich(JSON.parse(e.data))}catch(e){return void m.error(new u("geoevent-connection","Failed to parse message",e))}this.onFeature(t)},t.prototype._onError=function(e){var t="Encountered an error over WebSocket connection";this._set("errorString",t),m.error("geoevent-connection",t)},t.prototype._onClose=function(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&m.error("geoevent-connection","WebSocket closed unexpectedly with error code "+e.code),this._open()},t.prototype._fetchServiceDefinition=function(e){return n(this,void 0,void 0,function(){var t,i;return r(this,function(r){switch(r.label){case 0:return[4,a(e,{query:{f:"json"},responseType:"json"})];case 1:return t=r.sent(),i=t.data,this._serviceDefinition=i,[2,i]}})})},t.prototype._fetchWebSocketUrl=function(e,t){return n(this,void 0,void 0,function(){var i,n,o;return r(this,function(r){return i=e[0],n=i.urls,o=i.token,[2,this._inferWebSocketBaseUrl(n)+"/subscribe?outSR="+t.wkid+(o?"&token="+o:"")]})})},t.prototype._inferWebSocketBaseUrl=function(e){if(1===e.length)return e[0];for(var t=0,r=e;t<r.length;t++){var i=r[t];if(-1!==i.indexOf("wss"))return i}return m.error(new u("geoevent-connection","Unable to infer WebSocket url",e)),null},t.prototype._setFilter=function(e,t){return n(this,void 0,void 0,function(){var i,n,o,s,a,l,d=this;return r(this,function(r){return i=this._websocket,this._filter=e,this._outFields=t,c.isNone(i)||c.isNone(e)&&c.isNone(t)?[2]:(n=JSON.stringify({filter:this._serializeFilter(e,t)}),o=!1,s=p.createResolver(),a=function(){o||(d._websocket===i&&m.error(new u("geoevent-connection","Server timed out when setting filter")),s.reject())},l=function(e){var t=JSON.parse(e.data);t.filter&&(t.error&&(m.error(new u("geoevent-connection","Failed to set service filter",t.error)),d._set("errorString","Could not set service filter - "+t.error),s.reject(t.error)),i.onmessage=d._onMessage.bind(d),o=!0,s.resolve())},i.onmessage=l,i.send(n),setTimeout(a,1e4),[2,s.promise])})})},t.prototype._serializeFilter=function(e,t){var r={};if(c.isNone(e)&&c.isNone(t))return r;if(c.isSome(e)&&e.geometry)try{var i=s.fromJSON(e.geometry);if("extent"!==i.type)throw new u("Expected extent but found type "+i.type);r.geometry=JSON.stringify(i.shiftCentralMeridian())}catch(e){m.error(new u("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return c.isSome(e)&&e.where&&(r.where=e.where),c.isSome(t)&&(r.outFields=t.join(",")),r},t.prototype._enrich=function(e){if(!this._relatedFeatures)return e;var t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t];if(!this._relatedFeatures.has(r))return m.warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;var i=this._relatedFeatures.get(r),n=i.attributes,o=i.geometry;for(var s in n)e.attributes[s]=n[s];return o&&(e.geometry=o),e.geometry||e.centroid||m.error(new u("geoevent-connection","Found malformed feature - no geometry found",e)),e},t.prototype._queryBuddyServices=function(){return n(this,void 0,void 0,function(){var e,t,i,n,o,s,a,l,c,p;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=this._serviceDefinition,t=e.relatedFeatures,i=e.keepLatestArchive,n=this._queryRelatedFeatures(t),o=this._queryArchive(i),[4,n];case 1:return r.sent(),[4,o];case 2:if(!(s=r.sent()))return[2];for(a=0,l=s.features;a<l.length;a++)c=l[a],this.onFeature(this._enrich(c));return[3,4];case 3:return p=r.sent(),m.error(new u("geoevent-connection","Encountered an error when querying buddy services",{error:p})),[3,4];case 4:return[2]}})})},t.prototype._queryRelatedFeatures=function(e){return n(this,void 0,void 0,function(){var t;return r(this,function(r){switch(r.label){case 0:return e?[4,this._queryBuddy(e.featuresUrl)]:[2];case 1:return t=r.sent(),this._addRelatedFeatures(t),[2]}})})},t.prototype._queryArchive=function(e){return n(this,void 0,void 0,function(){return r(this,function(t){return e?[2,this._queryBuddy(e.featuresUrl)]:[2,void 0]})})},t.prototype._queryBuddy=function(e){return n(this,void 0,void 0,function(){var t,i,n,o,s,a,u,l,p,d;return r(this,function(r){switch(r.label){case 0:return[4,(t=new h({url:e})).load()];case 1:return i=r.sent().capabilities,n=i.query.supportsMaxRecordCountFactor,o=i.query.supportsPagination,s=i.query.supportsCentroid,a=this._maxRecordCountFactor,u=t.capabilities.query.maxRecordCount,l=n?u*a:u,(p=new v).outFields=c.unwrapOr(this._outFields,["*"]),p.where=c.unwrapOr(c.get(this._filter,"where"),"1=1"),p.returnGeometry=!0,p.returnExceededLimitFeatures=!0,p.outSpatialReference=this._spatialReference,s&&(p.returnCentroid=!0),n&&(p.maxRecordCountFactor=a),o?(p.num=l,t.destroy(),[2,this._queryPages(e,p)]):[4,y.executeQuery(e,p)];case 2:return d=r.sent(),t.destroy(),[2,d.data]}})})},t.prototype._queryPages=function(e,t,i,o){return void 0===i&&(i=[]),void 0===o&&(o=0),n(this,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return t.start=o*t.num,[4,y.executeQuery(e,t)];case 1:return(n=r.sent().data).exceededTransferLimit&&o<this._maxQueryDepth?(n.features.forEach(function(e){return i.push(e)}),[2,this._queryPages(e,t,i,o+1)]):(i.forEach(function(e){return n.features.push(e)}),[2,n])}})})},t.prototype._addRelatedFeatures=function(e){for(var t=new Map,r=e.features,i=this._serviceDefinition.relatedFeatures.joinField,n=0,o=r;n<o.length;n++){var s=o[n],a=s.attributes[i];t.set(a,s)}this._relatedFeatures=t},i([d.property()],t.prototype,"connectionStatus",null),i([d.property()],t.prototype,"errorString",void 0),i([d.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],t)}(d.declared(f.default));t.default=b}.apply(null,i))||(e.exports=n)},2296:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(28),r(29),r(106),r(141),r(30)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.onFeature=function(e){this.emit("feature",e)},r([s.subclass("esri.layers.graphics.sources.connections.StreamConnection")],t)}(s.declared(n.EventedMixin(o.HandleOwner)));t.default=a}.apply(null,i))||(e.exports=n)},2297:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(31),r(32),r(34)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this._action=null,this._queue=[],this._abortController=n.createAbortController(),this._refs=1}return e.prototype.up=function(){this._refs++},e.prototype.down=function(){return 0==--this._refs},e.prototype.clear=function(){this._abortController.abort(),this._abortController=n.createAbortController()},e.prototype.destroy=function(){this._queue.length=0,this._action&&(this._action=null)},e.prototype.enqueue=function(e){this._action?this._queue.push(e):this._setAction(e)},e.prototype.flush=function(){return i(this,void 0,void 0,function(){var e,t,i;return r(this,function(r){return(e=this._action)?(t=this._abortController.signal,i=this._queue.reduce(function(e,r){return e.then(function(){return r(t)})},e),this._action=i.then(this._handleNext.bind(this)),this._queue.length=0,[2,i]):[2]})})},e.prototype.hasAction=function(){return!!this._action},e.prototype._setAction=function(e){var t=this._abortController.signal;this._action=e(t).then(this._handleNext.bind(this))},e.prototype._handleNext=function(){this._queue.length?this._setAction(this._queue.shift()):this._action=null},e}();t.default=o}.apply(null,i))||(e.exports=n)},267:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(31),r(32),r(29),r(28),r(36),r(106),r(37),r(40),r(185),r(92),r(63),r(157),r(577),r(446),r(378)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,v){Object.defineProperty(t,"__esModule",{value:!0});var g=u.getLogger("esri.layers.graphics.data.FeatureStore"),m=function(){function e(e){this.geometryInfo=e,this._boundsStore=new f.BoundsStore,this._featuresById=new Map,this._markedIds=new Set,this.events=new a,this.featureAdapter=v.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){var e=this;if(!this.numFeatures)return null;var t=p.create(p.NEGATIVE_INFINITY);return this._featuresById.forEach(function(r){var i=e._boundsStore.get(r.objectId);i&&(t[0]=Math.min(i[0],t[0]),t[1]=Math.min(i[1],t[1]),t[2]=Math.max(i[2],t[2]),t[3]=Math.max(i[3],t[3]))}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeStatistics",{get:function(){var e=0;return this._featuresById.forEach(function(t){t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e),this._emitChanged()},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._add(i)}this._emitChanged()},e.prototype.clear=function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null},e.prototype.removeManyById=function(e){this._boundsStore.invalidateIndex();for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this._featuresById.get(i);n&&this._remove(n)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var o=n[i],s=this._boundsStore.get(o.objectId);s&&t(c.fromRect(r,s))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach(function(t){return e(t)})},e.prototype.forEachInBounds=function(e,t){var r=this;this._boundsStore.forEachInBounds(e,function(e){t(r._featuresById.get(e))})},e.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()},e.prototype.sweep=function(){var e=this,t=!1;this._featuresById.forEach(function(r,i){e._markedIds.has(i)||(t=!0,e._remove(r))}),this._markedIds.clear(),t&&this._emitChanged()},e.prototype.executeTileQuery=function(e,t,n){return i(this,void 0,void 0,function(){var i,o,s,a,u,l,c,h,f,v,g,m,b,_;return r(this,function(r){return i=n.returnGeometry,o=n.returnCentroid,s=n.returnOutline,a=n.pixelBuffer,u=new Set,l=[],c=a*e.resolution,h=p.pad(e.bounds,c,p.create()),y.createTileFeatures(l,u,this.geometryInfo,this,h,i,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),("esriGeometryPoint"===this.geometryType||o)&&(f=d.getInfo(t))&&(v=f.valid,g=v[0],m=v[1],h[0]<g&&(b=p.fromValues(m-c,h[1],m,h[3]),y.createTileFeatures(l,u,this.geometryInfo,this,b,i,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[m,e.bounds[3]]})),h[2]>m&&(_=p.fromValues(g,h[1],g+c,h[3]),y.createTileFeatures(l,u,this.geometryInfo,this,_,i,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[g-m+e.bounds[0],e.bounds[3]]}))),l.sort(function(e,t){return e.localId-t.localId}),[2,{features:l,objectIds:u}]})})},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e){if(e){var t=e.objectId;if(null==t)return void g.error(new s("featurestore:invalid-feature","feature id is missing",{feature:e}));var r,i=this._featuresById.get(t);if(this._markedIds.add(t),i?(e.localId=i.localId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):l.isSome(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=h.getBoundsOptimizedGeometry(r||p.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,r),this._featuresById.set(t,e)}},e.prototype._remove=function(e){return l.isSome(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e},e}();t.default=m}.apply(null,i))||(e.exports=n)},268:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){return e?t?4:3:t?3:2}function i(e,t,i,n,o,s){for(var a=r(o,s),u=i,l=i+a,c=0,p=0,d=0,h=0,f=0,y=0,v=n-1;y<v;y++,u+=a,l+=a){var g=t[u],m=t[u+1],b=t[u+2],_=t[l],S=t[l+1],I=t[l+2],x=g*S-_*m;h+=x,c+=(g+_)*x,p+=(m+S)*x,o&&(d+=(b+I)*(x=g*I-_*b),f+=x),g<e[0]&&(e[0]=g),g>e[1]&&(e[1]=g),m<e[2]&&(e[2]=m),m>e[3]&&(e[3]=m),o&&(b<e[4]&&(e[4]=b),b>e[5]&&(e[5]=b))}if(h>0&&(h*=-1),f>0&&(f*=-1),!h)return null;var w=[c,p,.5*h];return o&&(w[3]=d,w[4]=.5*f),w}function n(e,t,i,n,l){for(var c=r(n,l),p=t,d=t+c,h=0,f=0,y=0,v=0,g=0,m=i-1;g<m;g++,p+=c,d+=c){var b=e[p],_=e[p+1],S=e[p+2],I=e[d],x=e[d+1],w=e[d+2],F=n?s(b,_,S,I,x,w):o(b,_,I,x);if(F)if(h+=F,n){f+=F*(T=u(b,_,S,I,x,w))[0],y+=F*T[1],v+=F*T[2]}else{var T;f+=F*(T=a(b,_,I,x))[0],y+=F*T[1]}}return h>0?n?[f/h,y/h,v/h]:[f/h,y/h]:i>0?n?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function o(e,t,r,i){var n=r-e,o=i-t;return Math.sqrt(n*n+o*o)}function s(e,t,r,i,n,o){var s=i-e,a=n-t,u=o-r;return Math.sqrt(s*s+a*a+u*u)}function a(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function u(e,t,r,i,n,o){return[e+.5*(i-e),t+.5*(n-t),r+.5*(o-r)]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCentroidOptimizedGeometry=function(e,t,o,s){if(!t||!t.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);for(var a=e.coords,u=[],l=o?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],c=t.lengths,p=t.coords,d=r(o,s),h=0,f=0,y=c;f<y.length;f++){var v=y[f],g=i(l,p,h,v,o,s);g&&u.push(g),h+=v*d}if(u.sort(function(e,t){var r=e[2]-t[2];return 0===r&&o&&(r=e[4]-t[4]),r}),u.length){var m=6*u[0][2];a[0]=u[0][0]/m,a[1]=u[0][1]/m,o&&(m=6*u[0][4],a[2]=0!==m?u[0][3]/m:0),(a[0]<l[0]||a[0]>l[1]||a[1]<l[2]||a[1]>l[3]||o&&(a[2]<l[4]||a[2]>l[5]))&&(a.length=0)}if(!a.length){var b=t.lengths[0]?n(p,0,c[0],o,s):null;if(!b)return null;a[0]=b[0],a[1]=b[1],o&&b.length>2&&(a[2]=b[2])}return e},t.lineCentroid=n}.apply(null,i))||(e.exports=n)},269:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(31),r(32),r(36),r(34),r(238),r(280),r(46),r(63),r(377),r(157),r(162),r(163),r(188)],void 0===(n=function(e,t,i,n,o,s,a,u,l,c,p,d,h,f,y){function v(){return s.create(function(e){return r.e(7).then(function(){var t=[r(255)];e.apply(null,t)}.bind(this)).catch(r.oe)})}Object.defineProperty(t,"__esModule",{value:!0});var g="feature-store:unsupported-query",m={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},b={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};t.importGeometryEngine=v,t.getGeodesicBufferOperator=function(){return v().then(function(e){return e.geodesicBuffer})},t.getSpatialQueryOperator=function(e,t,r){if(l.isPolygon(t)&&"esriGeometryPoint"===r.geometryType&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var i=d.convertFromPolygon(new h.default,t,!1,!1);return s.resolve(function(e){return p.polygonContainsPoint(i,!1,!1,e)})}if(l.isPolygon(t)&&"esriGeometryMultipoint"===r.geometryType){var n=d.convertFromPolygon(new h.default,t,!1,!1);if("esriSpatialRelContains"===e)return s.resolve(function(e){return p.polygonContainsMultipoint(n,!1,!1,e,r.hasZ,r.hasM)})}if(l.isExtent(t)&&"esriGeometryPoint"===r.geometryType&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return s.resolve(function(e){return a.extentContainsPoint(t,y.getGeometry(r,e))});if(l.isExtent(t)&&"esriGeometryMultipoint"===r.geometryType&&"esriSpatialRelContains"===e)return s.resolve(function(e){return a.extentContainsMultipoint(t,y.getGeometry(r,e))});if(l.isExtent(t)&&"esriSpatialRelIntersects"===e){var o=u.getExtentIntersector(r.geometryType);return s.resolve(function(e){return o(t,y.getGeometry(r,e))})}return v().then(function(i){var n=i[m[e]].bind(null,t);return function(e){return n(y.getGeometry(r,e))}})},t.checkSpatialQuerySupport=function(e,t,r){return n(this,void 0,void 0,function(){var n,s;return i(this,function(i){if(n=e.spatialRel,!(s=e.geometry))return[2];if(!function(e){return!0===b.spatialRelationship[e]}(n))throw new o(g,"Unsupported query spatial relationship",{query:e});if(!c.isValid(s.spatialReference)||!c.isValid(r))return[2];if(!function(e){return!0===b.queryGeometry[l.getJsonType(e)]}(s))throw new o(g,"Unsupported query geometry type",{query:e});if(!function(e){return!0===b.layerGeometry[e]}(t))throw new o(g,"Unsupported layer geometry type",{query:e});return e.outSR?[2,f.checkProjectionSupport(e.geometry&&e.geometry.spatialReference,e.outSR)]:[2]})})},t.canQueryWithRBush=function(e){if(l.isExtent(e))return!0;if(l.isPolygon(e)){for(var t=0,r=e.rings;t<r.length;t++){var i=r[t];if(5!==i.length)return!1;if(i[0][0]!==i[1][0]||i[0][0]!==i[4][0]||i[2][0]!==i[3][0]||i[0][1]!==i[3][1]||i[0][1]!==i[4][1]||i[1][1]!==i[2][1])return!1}return!0}return!1}}.apply(null,i))||(e.exports=n)},294:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,i))||(e.exports=n)},295:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeExtent=function(e,t){if(!e)return null;var r=t.featureAdapter,i=e.startTimeField,n=e.endTimeField,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(i&&n)t.forEach(function(e){var t=r.getAttribute(e,i),a=r.getAttribute(e,n);null==t||isNaN(t)||(o=Math.min(o,t)),null==a||isNaN(a)||(s=Math.max(s,a))});else{var a=i||n;t.forEach(function(e){var t=r.getAttribute(e,a);null==t||isNaN(t)||(o=Math.min(o,t),s=Math.max(s,t))})}return{start:o,end:s}},t.getTimeOperator=function(e,t,r){if(!t||!e)return null;var i=e.startTimeField,n=e.endTimeField;if(!i&&!n)return null;var o=t.start,s=t.end;return null==o&&null==s?null:i&&n?function(e,t,r,i,n){if(null!=i&&null!=n&&i===n){var o=i;return function(i){return o>=e.getAttribute(i,t)&&o<=e.getAttribute(i,r)}}return null!=i&&null!=n?function(o){return function(e,t,r,i){return!(r>t||i<e)}(i,n,e.getAttribute(o,t),e.getAttribute(o,r))}:null!=i?function(t){return!(e.getAttribute(t,r)<i)}:null!=n?function(r){return!(e.getAttribute(r,t)>n)}:void 0}(r,i,n,o,s):function(e,t,r,i){return null!=r&&null!=i&&r===i?function(i){return e.getAttribute(i,t)===r}:null!=r&&null!=i?function(n){return e.getAttribute(n,t)>=r&&e.getAttribute(n,t)<=i}:null!=r?function(i){return e.getAttribute(i,t)>=r}:null!=i?function(r){return e.getAttribute(r,t)<=i}:void 0}(r,i||n,o,s)}}.apply(null,i))||(e.exports=n)},376:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(360),r(192)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this._cache=new r(e),this._invalidCache=new r(t)}return e.prototype.get=function(e,t){var r=t.uid+":"+e,n=this._cache.get(r);if(n)return n;if(void 0!==this._invalidCache.get(r))return null;try{var o=i.WhereClause.create(e,t);return this._cache.put(r,o),o}catch(e){return this._invalidCache.put(r,null),null}},e}();t.WhereClauseCache=n}.apply(null,i))||(e.exports=n)},377:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){return e?t?4:3:t?3:2}function i(e,t,i,o,s){if(!e)return!1;for(var a=r(t,i),u=e.coords,l=!1,c=0,p=0,d=e.lengths;p<d.length;p++){var h=d[p];l=n(l,u,a,c,h,o,s),c+=h*a}return l}function n(e,t,r,i,n,o,s){for(var a=e,u=i,l=i,c=i+n*r;l<c;l+=r){(u=l+r)===c&&(u=i);var p=t[l],d=t[l+1],h=t[u],f=t[u+1];(d<s&&f>=s||f<s&&d>=s)&&p+(s-d)/(f-d)*(h-p)<o&&(a=!a)}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.polygonContainsPoint=function(e,t,r,n){return i(e,t,r,n.coords[0],n.coords[1])},t.polygonContainsMultipoint=function(e,t,n,o,s,a){var u=r(s,a),l=o.coords,c=o.lengths;if(!c)return!1;for(var p=0,d=0;p<c.length;p++,d+=u)if(!i(e,t,n,l[d],l[d+1]))return!1;return!0},t.polygonContainsCoords=i}.apply(null,i))||(e.exports=n)},378:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(268),r(246),r(162)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new i.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=r.getCentroidOptimizedGeometry(new n.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,i))||(e.exports=n)},394:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function i(e){return T[e]}function n(e){return(e[0]+e[1])/2}function o(e,t,r){return e[0]=t,e[1]=r,e}function s(e,t){var r=n(e),i=t,o=!t;e[0]=o*e[0]+i*r,e[1]=o*r+i*e[1]}function a(e,t){var r=t>n(e);return s(e,r),r}function u(e,t){for(var i=o(_,I,x),a=o(S,w,F),u=0;u<t.length;u++){var l=r(t.charCodeAt(u));u%2==0?(s(a,!!(y&l)),s(a,!!(g&l)),s(a,!!(b&l)),s(i,!!(v&l)),s(i,!!(m&l))):(s(i,!!(y&l)),s(i,!!(g&l)),s(i,!!(b&l)),s(a,!!(v&l)),s(a,!!(m&l)))}return e[0]=n(i),e[1]=n(a),e}function l(e,t,r){for(var n="",s=o(_,-90,90),u=o(S,-180,180),l=0;l<r;l++){var c=0;l%2?(c|=a(s,e)<<4,c|=a(u,t)<<3,c|=a(s,e)<<2,c|=a(u,t)<<1,c|=a(s,e)<<0):(c|=a(u,t)<<4,c|=a(s,e)<<3,c|=a(u,t)<<2,c|=a(s,e)<<1,c|=a(u,t)<<0),n+=i(c)}return n}function c(e){var t=Math.floor(5*e/2);return(x-I)/Math.pow(2,t)}function p(e){var t=Math.ceil(5*e/2);return(F-w)/Math.pow(2,t)}function d(e,t){return t?b&e|(g&e)>>1|(y&e)>>2:(m&e)>>1|(v&e)>>2}function h(e,t){return t?(m&e)>>1|(v&e)>>2:b&e|(g&e)>>1|(y&e)>>2}function f(e,t,n){var o=!((e.length-1)%2),s=e.substring(0,e.length-1),a=r(e.charCodeAt(e.length-1)),u=0,l=0,c=0,p=0;o?(u=8,l=4,c=b&a|(g&a)>>1|(y&a)>>2,p=(m&a)>>1|(v&a)>>2):(u=4,l=8,p=b&a|(g&a)>>1|(y&a)>>2,c=(m&a)>>1|(v&a)>>2);var d=c+t,h=p+n,_=Math.floor(d/u),S=Math.floor(h/l),I=i(function(e,t,r){return r?e&b|(t&b)<<1|(e&m)<<1|(t&m)<<2|(e&g)<<2:t&b|(e&b)<<1|(t&m)<<1|(e&m)<<2|(t&g)<<2}(d-_*u,h-S*l,o));return e.length>1&&(_||S)?f(s,_,S)+I:s+I}Object.defineProperty(t,"__esModule",{value:!0});var y=16,v=8,g=4,m=2,b=1,_=new Float64Array(2),S=new Float64Array(2),I=-90,x=90,w=-180,F=180,T="0123456789bcdefghjkmnpqrstuvwxyz";t.decodeBase32Char=r,t.encodeBase32Char=i,t.decodeGeohash=u,t.convertGeohash32ToXY=function(e,t){for(var i=0,n=0,o=30,s=30,a=0;a<t.length;a++){var u=r(t.charCodeAt(a)),l=a%2==0;i|=d(u,l)<<(o-=l?3:2),n|=h(u,l)<<(s-=l?2:3)}return{geohashX:i,geohashY:n}},t.decodeGeohashXY=function(e,t){for(var r=-90,i=90,n=-180,o=180,s=0;s<t;s++){for(var a=Math.ceil((s+1)/2),u=Math.floor((s+1)/2),l=1-s%2,c=30-(3*a+2*u),p=30-(2*a+3*u),d=3*l+2*(1-l),h=2*l+3*(1-l),f=3*l+7*(1-l)<<p,y=(7*l+3*(1-l)<<c&e.geohashX)>>c,v=(f&e.geohashY)>>p,g=d-1;g>=0;g--){var m=(n+o)/2,b=y&1<<g?1:0;n=(1-b)*n+b*m,o=(1-b)*m+b*o}for(g=h-1;g>=0;g--){var _=(r+i)/2,S=v&1<<g?1:0;r=(1-S)*r+S*_,i=(1-S)*_+S*i}}return[n,r,o,i]},t.setGeohashXY=function(e,t,r,i){i%2&&(i+=1);for(var n=0,o=0,s=-90,a=90,u=-180,l=180,c=0;c<i/2;c++){for(var p=0;p<5;p++){var d=(u+l)/2,h=r>d?1:0;n|=h<<29-(p+5*c),u=(1-h)*u+h*d,l=(1-h)*d+h*l}for(p=0;p<5;p++){var f=(s+a)/2,y=t>f?1:0;o|=y<<29-(p+5*c),s=(1-y)*s+y*f,a=(1-y)*f+y*a}}e.geohashX=n,e.geohashY=o},t.encodeGeohash=l,t.latDistPerGeohash=c,t.lonDistPerGeohash=p,t.unpackXBits=d,t.unpackYBits=h,t.getRelativeGeohash=f,t.getIntersectingGeohashes=function(e,t,r,i,n){for(var o=Math.abs(r-e),s=Math.abs(i-t),a=c(n),u=p(n),d=Math.ceil(s/u),h=Math.ceil(o/a),y=l(e,t,n),v=new Array,g=0;g<d;g++)for(var m=0;m<h;m++)v.push(f(y,g,m));return v},t.forEachIntersectingGeohash=function(e,t,r,i,n,o){for(var s=Math.abs(r-e),a=Math.abs(i-t),d=c(n),h=p(n),y=Math.ceil(a/h),v=Math.ceil(s/d),g=l(e,t,n),m=0;m<y;m++)for(var b=0;b<v;b++){var _=f(g,m,b),S=u([0,0],_),I=S[0],x=S[1],w=I-d/2,F=x-h/2,T=I+d/2,E=x+h/2,R=d*h,M=Math.max(e,w),j=Math.max(t,F),P=Math.min(r,T)-M,O=Math.min(i,E)-j;o(_,Math.abs(P*O)/R)}}}.apply(null,i))||(e.exports=n)},446:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(35),r(31),r(32),r(92),r(157),r(162),r(229),r(188)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l){function c(e,t,r,i,n){if(!t.has(r.objectId)){var o=l.getCentroid(i,r,n),s=r.attributes;o&&(t.add(r.objectId),e.push(new u.Feature(s,r.localId,null,o)))}}function p(e,t,r,i,n,o,s,a){if(!t.has(r.objectId)){var l=r.attributes,c=i(h(f,r.geometry,n,o,a,s),!1,!1);c&&(t.add(r.objectId),e.push(new u.Feature(l,r.localId,c,null)))}}function d(e,t,r,i,n,o,s,a,c){if(!t.has(r.objectId)){var p=l.getCentroid(i,r,n),d=r.attributes,y=o(h(f,r.geometry,s,a,c,n),!1,!1);y&&p&&(t.add(r.objectId),e.push(new u.Feature(d,r.localId,y,p)))}}function h(e,t,r,i,n,o){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var a=t.coords,u=t.lengths;if(!u.length)return e.coords[0]=s.quantizeX(o,a[0]),e.coords[1]=s.quantizeY(o,a[1]),e.coords.length=r,e;for(var l,c,p,d,h=0,f=0,y=f,v=0,g=u;v<g.length;v++){var m=g[v];if(!(m<i)){f=y,p=l=s.quantizeX(o,a[h]),d=c=s.quantizeY(o,a[h+1]),e.coords[f]=p,e.coords[f+1]=d,h+=r;var b=(p=s.quantizeX(o,a[h]))-l,_=(d=s.quantizeY(o,a[h+1]))-c,S=_/b;f+=2,e.coords[f]=b,e.coords[f+1]=_,l=p,c=d,h+=r;for(var I=2;I<m;I++){if(p=s.quantizeX(o,a[h]),d=s.quantizeY(o,a[h+1]),p!==l||d!==c){var x=p-l,w=d-c,F=w/x;(S===F||!isFinite(S)&&!isFinite(F))&&(n||(_>=0&&w>=0||_<=0&&w<=0)&&(b>=0&&x>=0||b<=0&&x<=0))?(b+=x,_+=w):(b=x,_=w,f+=2),e.coords[f]=b,e.coords[f+1]=_,S=F,l=p,c=d}h+=r}var T=(f+2-y)/2;T>=i&&(e.lengths.push(T),y=f+2)}}return e.coords.length>y&&(e.coords.length=y),e.coords.length?e:null}Object.defineProperty(t,"__esModule",{value:!0});var f=new a.default,y={esriGeometryPoint:s.convertToPoint,esriGeometryPolyline:s.convertToPolyline,esriGeometryPolygon:s.convertToPolygon,esriGeometryMultipoint:s.convertToMultipoint};t.executeTileQueryForIds=function(e,t,r){var i=r.pixelBuffer*t.resolution,n=o.pad(t.bounds,i,o.create()),s=[];return e.featureStore.forEachInBounds(n,function(t){return s.push(e.featureAdapter.getObjectId(t))}),s},t.createTileFeatures=function(e,t,r,i,n,o,s,a,u){var l=y[r.geometryType],h=v[r.geometryType],f="esriGeometryPolygon"===r.geometryType&&!a,g=r.hasZ?r.hasM?4:3:r.hasM?3:2;s&&!o?i.forEachInBounds(n,function(i){return c(e,t,i,r,u)}):o&&!s?i.forEachInBounds(n,function(r){return p(e,t,r,l,g,h,u,f)}):i.forEachInBounds(n,function(i){return d(e,t,i,r,u,l,g,h,f)})};var v={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};t.quantizeOptimizedGeometryForDisplay=h}.apply(null,i))||(e.exports=n)},53:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(35),r(39),r(75),r(61),r(67),r(139)],void 0===(n=function(e,t,r,i,n,o,s,a){Object.defineProperty(t,"__esModule",{value:!0}),t.screenSizePerspectiveEnabled={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader:function(e,t){return null==t.screenSizePerspective&&"defaults"===this.originOf("screenSizePerspectiveEnabled")?void n.getProperties(this).store.set("screenSizePerspectiveEnabled",!1,0):t.screenSizePerspective}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer:function(e,t,r,i){"defaults"===this.originOf("screenSizePerspectiveEnabled")&&e?t[r]=e:o.willPropertyWrite(this,"screenSizePerspectiveEnabled",{},i)&&(t[r]=e)}}}}}},t.popupEnabled={type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",writer:function(e,t,r){t[r]=!e}}}},t.labelsVisible={type:Boolean,json:{read:{source:"showLabels"},write:{target:"showLabels"}}},t.url={type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writer:i.write}}},t.legendEnabled={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}},t.elevationInfo={value:null,type:s,json:{origins:{service:{read:{source:"elevationInfo"},write:{target:"elevationInfo",enabled:!1}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}},t.readOnlyService=function(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}},t.opacity={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0}}}},t.opacityDrawingInfo=r({},t.opacity,{json:r({},t.opacity.json,{origins:{"web-document":r({},t.opacity.json.origins["web-document"],{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:function(e,t,r){return r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?a.transparencyToOpacity(t.layerDefinition.drawingInfo.transparency):void 0:a.transparencyToOpacity(t.drawingInfo.transparency)}}})})}.apply(null,i))||(e.exports=n)},577:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(49),r(290),r(6)],void 0===(n=function(e,t,r,i){function n(e,t){return o.minX=t[0],o.minY=t[1],o.maxX=t[2],o.maxY=t[3],e.search(o)}Object.defineProperty(t,"__esModule",{value:!0});var o={minX:0,minY:0,maxX:0,maxY:0},s=function(){function e(){var e=this;this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=i(9,r("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(e._indexInvalid){var t=new Array(e._idByBounds.size),r=0;e._idByBounds.forEach(function(e,i){t[r++]=i}),e._indexInvalid=!1,e._index.clear(),e._index.load(t)}else e._boundsToLoad.length&&(e._index.load(e._boundsToLoad.filter(function(t){return e._idByBounds.has(t)})),e._boundsToLoad.length=0)}}return e.prototype.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},e.prototype.delete=function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))},e.prototype.forEachInBounds=function(e,t){this._loadIndex();for(var r=0,i=n(this._index,e);r<i.length;r++){var o=i[r];t(this._idByBounds.get(o))}},e.prototype.get=function(e){return this._boundsById.get(e)},e.prototype.has=function(e){return this._boundsById.has(e)},e.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},e.prototype.set=function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||this._boundsToLoad.push(t))},e}();t.BoundsStore=s}.apply(null,i))||(e.exports=n)},578:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(35),r(31),r(32),r(107),r(40),r(34),r(320),r(63),r(157),r(579),r(215),r(163),r(295),r(188)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y){Object.defineProperty(t,"__esModule",{value:!0});var v=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some(function(e){return"exceedslimit"===e.statisticType})?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(l.isValid(e.outSR)&&!l.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=y.cleanFromGeometryEngine(r({spatialReference:e.outSR},h.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=y.cleanFromGeometryEngine(r({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=d.getWhereClause(t.where,this.fieldsIndex);if(!r)return a.resolve(this);if(r.isStandardized){for(var i=0,n=[],o=0,s=this.items;o<s.length;o++){var u=s[o];r.testFeature(u,this.featureAdapter)&&(n[i++]=u)}var l=new e(n,this.queryGeometry,this);return l.definitionExpression=t.where,a.resolve(l)}return a.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return a.resolve(this);var r=o.createSetFromValues(t.objectIds),i=this.featureAdapter.getObjectId;return a.resolve(new e(this.items.filter(function(e){return r.has(i(e))}),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=f.getTimeOperator(this.timeInfo,t.timeExtent,this.featureAdapter);if(!s.isSome(r))return a.resolve(this);var i=this.items.filter(r);return a.resolve(new e(i,this.queryGeometry,this))},e.prototype.project=function(t){return n(this,void 0,void 0,function(){var r,n,o=this;return i(this,function(i){switch(i.label){case 0:return!t||l.equals(this.spatialReference,t)?[2,this]:(r=this.featureAdapter,[4,h.projectMany(this.items.map(function(e){return y.getGeometry(o,r.getGeometry(e))}),this.spatialReference,t)]);case 1:return n=i.sent(),[2,new e(n.map(function(e,t){return r.cloneWithGeometry(o.items[t],c.convertFromGeometry(e,o.hasZ,o.hasM))}),this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}})})},e.prototype._createFeatureQueryResponse=function(e){var t=this,r=this.items,i=this,n=i.geometryType,o=i.hasM,s=i.hasZ,a=i.objectIdField,l=i.spatialReference,c=e.outFields,p=e.outSR,d=e.quantizationParameters,h=e.resultRecordCount,f=e.resultOffset,v=e.returnZ,g=e.returnM,m=!1;if(null!=h&&null!=f){var b=f+h;m=r.length>b,r=r.slice(f,Math.min(r.length,b))}return{exceededTransferLimit:m,features:this._createFeatures(e,r),fields:c&&c.map(function(e){return t.fieldsIndex.get(e)}),geometryType:n,hasM:o&&g,hasZ:s&&v,objectIdFieldName:a,spatialReference:y.cleanFromGeometryEngine(p||l),transform:d&&u.toQuantizationTransform(d)||null}},e.prototype._createFeatures=function(e,t){var r=new p.default(e,this.featureAdapter,this.fieldsIndex),i=this.hasM,n=this.hasZ,o=e.orderByFields,s=e.quantizationParameters,a=e.returnGeometry,l=e.returnCentroid,c=e.maxAllowableOffset,d=e.returnZ,h=void 0!==d&&d,f=e.returnM,v=n&&h,g=i&&(void 0!==f&&f),m=[],b=0;if(t.length&&o&&o.length){var _=o[0].split(" "),S=_[0],I=this.fieldsIndex.get(S),x="DESC"===_[1];t.sort(function(e,t){var i=r.getFieldValue(e,S,I),n=r.getFieldValue(t,S,I);if("number"==typeof i&&"number"==typeof n)return x?n-i:i-n;if("string"==typeof i&&"string"==typeof n){var o=i.toUpperCase(),s=n.toUpperCase();return(x?o>s:o<s)?-1:(x?o<s:o>s)?1:0}})}if(a||l){var w=u.toQuantizationTransform(s);if(a&&!l)for(var F=0,T=t;F<T.length;F++){var E=T[F];m[b++]={attributes:r.getAttributes(E),geometry:y.getGeometry(this,this.featureAdapter.getGeometry(E),c,w,v,g)}}else if(!a&&l)for(var R=0,M=t;R<M.length;R++){E=M[R];m[b++]={attributes:r.getAttributes(E),centroid:y.transformCentroid(this,this.featureAdapter.getCentroid(E,this),w)}}else for(var j=0,P=t;j<P.length;j++){E=P[j];m[b++]={attributes:r.getAttributes(E),centroid:y.transformCentroid(this,this.featureAdapter.getCentroid(E,this),w),geometry:y.getGeometry(this,this.featureAdapter.getGeometry(E),c,w,v,g)}}}else for(var O=0,C=t;O<C.length;O++){E=C[O];var G=r.getAttributes(E);G&&(m[b++]={attributes:G})}return m},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=0,s=e.outStatistics;o<s.length;o++){var a=s[o];if("exceedslimit"===a.statisticType){r=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,i=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{var u=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;t=this.items.reduce(function(e,t){var r=l.getGeometry(t);return e+(r&&r.coords.length||0)},0)/u>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=new p.default(e,this.featureAdapter,this.fieldsIndex),r=e.outStatistics,i=[],n=[],o=e.groupByFieldsForStatistics,s=e.having,a=o&&o.length,u=a&&o[0],l=this.fieldsIndex.get(u),c=!l,d={},h={},f={},y={attributes:{}},v=0,g=r;v<g.length;v++){var m=g[v],b=m.outStatisticFieldName,_=m.statisticType,S="exceedslimit"!==_?m.onStatisticField:void 0,I=this.fieldsIndex.get(S),x=a&&(S===u||c)&&"count"===_;if(a){d[S]||(d[S]=this._calculateUniqueValues(t,u,l));var w=d[S];for(var F in w){var T=w[F],E=T.count,R=T.data,M=T.items;if(!s||t.validateItems(M,s)){var j=h[R]||{attributes:{}},P=null;if(x)P=E;else P=(O=this._calculateStatistics(M,t,S,I))[C="var"===_?"variance":_];j.attributes[b]=P,j.attributes[c?"EXPR_1":u]=R,h[R]=j}}}else{f[S]||(f[S]=this._calculateStatistics(this.items,t,S,I));var O=f[S],C="var"===_?"variance":_;y.attributes[b]=O[C]}n.push({name:b,alias:b,type:"esriFieldTypeDouble"})}if(a)for(var G in h)i.push(h[G]);else i.push(y);return{fields:n,features:i}},e.prototype._calculateStatistics=function(e,t,r,i){for(var n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,s=null,a=null,u=null,l=null,c=[],p=0,d=0;d<e.length;d++){var h=e[d];"string"==typeof(g=t.getFieldValue(h,r,i))?p++:null==g||isNaN(g)||(s+=g,n=Math.min(n,g),o=Math.max(o,g),c.push(g),p++)}if(p){a=s/p;for(var f=0,y=0,v=c;y<v.length;y++){var g=v[y];f+=Math.pow(g-a,2)}l=p>1?f/(p-1):0,u=Math.sqrt(l)}else n=null,o=null;return{avg:a,count:p,max:o,min:n,stddev:u,sum:s,variance:l}},e.prototype._calculateUniqueValues=function(e,t,r){for(var i={},n=0,o=this.items;n<o.length;n++){var s=o[n],a=e.getFieldValue(s,t,r);(null==a||"string"==typeof a&&""===a.trim())&&(a=null),null==i[a]?i[a]={count:1,data:a,items:[s]}:(i[a].count++,i[a].items.push(s))}return i},e}();t.default=v}.apply(null,i))||(e.exports=n)},579:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(40),r(215)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var n=e.outFields;if(n&&-1===n.indexOf("*")){this.outFields=n;for(var o=0,s=0,a=n;s<a.length;s++){var u=a[s],l=i.getExpressionFromFieldName(u),c=this.fieldsIndex.get(l),p=c?null:i.getWhereClause(l,r),d=c?c.name:i.getAliasFromFieldName(u)||"FIELD_EXP_"+o++;this._fieldDataCache.set(u,{alias:d,clause:p})}}}return e.prototype.getAttributes=function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t,r){var n=r?r.name:t,o=null;return this._fieldDataCache.has(n)?o=this._fieldDataCache.get(n).clause:r||(o=i.getWhereClause(t,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:o})),r?this.featureAdapter.getAttribute(e,n):o.calculateValue(e,this.featureAdapter)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)},e.prototype.validateItems=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);for(var r={},i=0,n=t;i<n.length;i++){var o=n[i],s=this._fieldDataCache.get(o),a=s.alias,u=s.clause;r[a]=u?u.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,a)}return r},e.prototype._processAttributesForDistinctValues=function(e){if(r.isNone(e)||!this.returnDistinctValues)return e;var t=this.outFields,i=[];if(t)for(var n=0,o=t;n<o.length;n++){var s=o[n],a=this._fieldDataCache.get(s).alias;i.push(e[a])}else for(var a in e)i.push(e[a]);var u=(t||["*"]).join(",")+"="+i.join(","),l=this._returnDistinctMap.get(u)||0;return this._returnDistinctMap.set(u,++l),l>1?null:e},e}();t.default=n}.apply(null,i))||(e.exports=n)},580:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(34)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=this;return r.create(function(r,i){t._deferreds.push({resolve:r,reject:i}),t._values.push(e)})},e.prototype.unshift=function(e){var t=this;return r.create(function(r,i){t._deferreds.unshift({resolve:r,reject:i}),t._values.unshift(e)})},Object.defineProperty(e.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,configurable:!0}),e.prototype.process=function(){return 0!==this.length&&(this._deferreds.shift().resolve(this._values.shift()),!0)},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,i=this._deferreds;t<i.length;t++)i[t].reject(e);this._deferreds.length=0,this._values.length=0},e}();t.PromiseQueue=i}.apply(null,i))||(e.exports=n)},59:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(31),r(32),r(36),r(37),r(34),r(39),r(30),r(72),r(76)],void 0===(n=function(e,t,i,n,o,s,a,u,l,c,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var f=u.getLogger("esri.layers.mixins.PortalLayer");t.PortalLayer=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"portalItem",{set:function(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))},enumerable:!0,configurable:!0}),t.prototype.readPortalItem=function(e,t,r){if(t.itemId)return new h({id:t.itemId,portal:r&&r.portal})},t.prototype.writePortalItem=function(e,t){e&&e.id&&(t.itemId=e.id)},t.prototype.loadFromPortal=function(e,t){return s(this,void 0,void 0,function(){var i,n;return o(this,function(o){switch(o.label){case 0:if(!this.portalItem||!this.portalItem.id)return[2];o.label=1;case 1:return o.trys.push([1,4,,5]),[4,l.create(function(e){return r.e(99).then(function(){var t=[r(123)];e.apply(null,t)}.bind(this)).catch(r.oe)})];case 2:return i=o.sent(),l.throwIfAborted(t),[4,i.load({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData},t)];case 3:return[2,o.sent()];case 4:throw n=o.sent(),f.warn("Failed to load layer ("+this.title+", "+this.id+") portal item ("+this.portalItem.id+")\n  "+n),n;case 5:return[2]}})})},t.prototype.read=function(e,t){var r=arguments;t&&(t.layer=this),this.inherited(r)},t.prototype.write=function(e,t){var r=t&&t.portal,i=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||d.getDefault());return r&&i&&!c.hasSamePortal(i.restUrl,r.restUrl)?(t.messages&&t.messages.push(new a("layer:cross-portal","The layer '"+this.title+" ("+this.id+")' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer",{layer:this})),null):this.inherited(arguments)},n([p.property({type:h})],t.prototype,"portalItem",null),n([p.reader("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),n([p.writer("portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),n([p.subclass("esri.layers.mixins.PortalLayer")],t)}(p.declared(e))}}.apply(null,i))||(e.exports=n)},624:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(28),r(31),r(32),r(29),r(35),r(36),r(141),r(49),r(37),r(40),r(34),r(30),r(215),r(229),r(148),r(195),r(85),r(74),r(98),r(549),r(625),r(627)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,v,g,m,b,_,S,I,x){Object.defineProperty(t,"__esModule",{value:!0});var w=c.getLogger("esri.views.2d.layers.features.controllers.BaseController"),F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._availableFields=[],t._pixelBuffer=0,t.config=null,t.filters=new Array(_.definitions.MAX_FILTERS),t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t}return o(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._initAttributeStore()},t.prototype.startup=function(){return n(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,d.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}})})},t.prototype.destroy=function(){this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureReduction",{get:function(){return this.config.featureReduction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new v(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){function i(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t||"cim"===t}if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;switch(r.type){case"simple":return i(r.symbol);case"unique-value":return i(r.defaultSymbol)||r.uniqueValueInfos.some(function(e){return i(e.symbol)});case"class-breaks":return i(r.defaultSymbol)||r.classBreakInfos.some(function(e){return i(e.symbol)});case"dot-density":return!1;default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnOutline",{get:function(){return function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol&&"outline"in e.backgroundFillSymbol&&null!=e.backgroundFillSymbol.outline||t.some(function(e){return"outline"in e&&null!=e.outline})}(t)}}(this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?g.fromJSON(this.config.renderer):(w.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter(function(t){return-1===e._availableFields.indexOf(t)});return this._availableFields=this._availableFields.concat(t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getAggregate=function(e){return null},t.prototype.getAggregateValueRanges=function(){return{}},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map(function(e){return t.attributeStore.getLocalId(e)}).filter(function(e){return null!=e})},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return n(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,x.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}})})},t.prototype.setHighlight=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){return[2,this.attributeStore.setHighlight(e)]})})},t.prototype.validateConfig=function(e){for(var t=0,r=e.filters;t<r.length;t++){var i=r[t];if(p.isSome(i)&&i.where)try{f.validateWhere(this.fieldsIndex,i.where)}catch(e){throw new a("mapview-bad-filter",e.message,{filter:i,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&l("esri-2d-debug")&&console.debug("Feature must have localId"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new S.default({type:"remote",initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}})},t.prototype._createQueryEngine=function(e){return new y.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore()),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(){var e={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};return new I.ClusterStore(e,this.spatialReference,this.attributeStore,this.featureReduction)},t.prototype._createDefaultQuery=function(e){var t=new b,r=e.outFields,i=this.config,n=i.gdbVersion,o=i.historicMoment,s=i.definitionExpression;return r=r.length/this.service.fields.length>=.75?["*"]:r,t.gdbVersion=n,t.historicMoment=null!=o?new Date(o):null,t.num=e.num,t.outFields=r,t.outSpatialReference=this.spatialReference,t.returnGeometry=e.returnGeometry,t.returnCentroid=e.returnCentroid,t.start=e.resultOffset,t.where=s||"1=1",t},t.prototype._createQuery=function(e,t,r,i,n,o){var s=this.service.geometryType,a=this._createDefaultQuery(i);return a.maxRecordCountFactor=n,a.returnExceededLimitFeatures=o,a.resultType="tile",a.geometry=e,this.service.capabilities.query.supportsQuantization?(a.quantizationParameters=new m.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:t}),"esriGeometryPolyline"===s&&(a.maxAllowableOffset=r)):"esriGeometryPolyline"!==s&&"esriGeometryPolygon"!==s||(a.maxAllowableOffset=r),a},t.prototype.hasGeometryFilter=function(){return this.filters.some(function(e){return p.isSome(e)&&!!e.geometry})},r([h.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r([h.property()],t.prototype,"config",void 0),r([h.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"featureReduction",null),r([h.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r([h.property()],t.prototype,"filters",void 0),r([h.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r([h.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r([h.property({readOnly:!0,dependsOn:["service","config"]})],t.prototype,"returnOutline",null),r([h.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r([h.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r([h.property()],t.prototype,"processor",void 0),r([h.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r([h.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([h.property({constructOnly:!0})],t.prototype,"service",void 0),r([h.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([h.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([h.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([h.property({readOnly:!0})],t.prototype,"viewState",void 0),r([h.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r([h.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(h.declared(u.HandleOwner));t.default=F}.apply(null,i))||(e.exports=n)},625:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(43),r(35),r(31),r(32),r(42),r(49),r(40),r(58),r(626),r(394),r(63),r(90),r(246),r(162),r(267),r(163),r(229),r(188),r(84)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,v,g,m,b,_){Object.defineProperty(t,"__esModule",{value:!0});var S=function(e){return u.andThen(e,function(e){return"cluster"!==e.type?null:i({},e,{clusterRadius:l.pt2px(e.clusterRadius/2)})})},I=function(e){function t(t,r,i,n,o){var s=this,a=new y.default([],[r,i]);return(s=e.call(this,a,n,null,t)||this).invalid=!1,s.canDelete=!1,s.geohashBoundsInfo=o,s}return r(t,e),Object.defineProperty(t.prototype,"count",{get:function(){return this.attributes.cluster_count},enumerable:!0,configurable:!0}),t.create=function(e,r,i,n,o,s,a){var u=new t(r,i,n,s,a);return u.localId=e.createLocalId(u.objectId,!0),u.tileLevel=o,u},t.prototype.update=function(e,t,r,i,n){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=i,this.geohashBoundsInfo=n,this.referenceId=null,this.invalid=!1,this},t.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:this.referenceId,attributes:i({},this.attributes,{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},t}(f.default),x=function(e){function t(t,r,i,n){var o=e.call(this,t)||this;return o._deferredDeletionQueue=[],o._invalidated=!1,o._aggregateFieldsHash=null,o._geohashLevel=0,o._aggregateValueRanges={},o._aggregateValueRangesChanged=!1,o._clusters=new Map,o._tiles=new Map,o._spatialReference=r,o._attributeStore=i,o._featureReduction=S(n),o._projectionSupportCheck=g.checkProjectionSupport(r,s.SpatialReference.WGS84),o}return r(t,e),t.prototype.update=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,s,a,l,p=this;return n(this,function(n){switch(n.label){case 0:return r=this._featureReduction,i=u.andThen(t.featureReduction,S),o=t.aggregateFields.reduce(function(e,t){return e+JSON.stringify(t)},""),s=null===r&&t.featureReduction,a=o!==this._aggregateFieldsHash,l=s||a,[4,this._projectionSupportCheck];case 1:return n.sent(),this._featureReduction=i,this._aggregateFieldsHash=o,this._aggregateValueRanges={},this._invalidated=!0,u.isNone(i)?(this._tree=null,[2]):(u.isSome(r)&&r.clusterRadius!==i.clusterRadius&&this._clusters.forEach(function(e){return e.canDelete=!0}),l&&(this._tree=new c.GeohashTree(t.aggregateFields),this._unindexFeatures()),(l||e)&&this._reindexFeatures(),this._handleClusterUpdates(),this._tiles.forEach(function(e){return p._getClustersForTile(e,0,i.clusterRadius,null,!1)}),[2])}})})},t.prototype._unindexFeatures=function(){this._featuresById.forEach(function(e){e.geohashIndexed=!1})},t.prototype._reindexFeatures=function(){var e=this;this._featuresById.forEach(function(t){t.geohashX||t.geohashY||e._setGeohash(t),e._attributeStore.isVisible(t)?e._insertIntoIndex(t):e._removeFromIndex(t)})},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,i=e.removed;if(r.length){var n=Math.max.apply(Math,r.map(function(e){return e.level}));this._setGeohashLevel(n),r.forEach(function(e){return t._tiles.set(e.key.id,e)})}if(!u.isNone(this._featureReduction)){var o=this._featureReduction.clusterRadius;i.forEach(function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,o)})}},t.prototype.sweepClusters=function(){var e=this;this._clusters.forEach(function(t,r){t.canDelete&&(e._attributeStore.freeLocalId(t.objectId),e._clusters.delete(r))});for(var t=0,r=this._deferredDeletionQueue;t<r.length;t++){var i=r[t];this._attributeStore.addLocalId(i)}this._deferredDeletionQueue=[]},t.prototype.executeTileQuery=function(t,r,i){return o(this,void 0,void 0,function(){var o,s,a;return n(this,function(n){switch(n.label){case 0:return u.isNone(this._featureReduction)?[2,e.prototype.executeTileQuery.call(this,t,r,i)]:[4,this._projectionSupportCheck];case 1:return n.sent(),this._handleClusterUpdates(),o=this._featureReduction.clusterRadius,s=this._getTransforms(t,r),a=this._getClustersForTile(t,i.pixelBuffer,o,s),this._aggregateValueRangesChanged&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),[2,a]}})})},t.prototype.getAggregate=function(e){var t=null;return this._clusters.forEach(function(r){r.localId===e&&(t=r.toJSON())}),t},t.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},t.prototype._getClustersForTile=function(e,t,r,n,o){var l=this;void 0===o&&(o=!0),t=Math.max(t,50);for(var c=2*r,p=new Set,d=this._getGeohashLevel(e.key.level),f=Math.pow(2,e.key.level)*Math.ceil(_.TILE_SIZE/c),y=Math.ceil(t/c)+2,v=Math.ceil(_.TILE_SIZE/c)+2*y,S=e.key,I=S.row,x=S.col*_.TILE_SIZE,w=I*_.TILE_SIZE,F=Math.floor(x/c)-y,T=Math.floor(w/c)-y,E=F+v,R=T+v,M=new Array,j=e.tileInfoView.getLODInfoAt(e.key.level),P=F;P<=E;P++)for(var O=this,C=T;C<=R;C++)!function(t){var r,c,y=P;j.wrap&&(y=P<0?P+f:P%f);var v=j.wrap&&P<0,_=j.wrap&&P%f!==P,S=O._lookupCluster(j,e.key.level,y,t,d);if(u.isSome(S)){var I=u.andThen(n,function(e){return v?e.left:_?e.right:e.tile});if(o&&u.isNone(I))return"continue";if(!S.count)return"continue";if(o&&1===S.count){var x=S.geohashBoundsInfo,w=x.xLL,F=x.yLL,T=x.xTR,E=x.yTR,R=x.level,C=u.expect(O._tree).findSingleOccupancyNode(w,F,T,E,R),G=u.unwrap(C).getLngLatBounds(),L={x:G[0],y:G[1]},A={x:G[2],y:G[3]},N=0,B=0,Q=0,k=0;if(O._spatialReference.isWebMercator)N=(r=h.lngLatToXY(L.x,L.y))[0],B=r[1],Q=(c=h.lngLatToXY(A.x,A.y))[0],k=c[1];else{var q=g.project(L,s.SpatialReference.WGS84,O._spatialReference),V=g.project(A,s.SpatialReference.WGS84,O._spatialReference);if(!q||!V)return a("esri-2d-debug")&&console.debug("Failed to reproject known tree node"),"continue";N=q.x,B=q.y,Q=V.x,k=V.y}var D=[N,B,Q,k],z=null;if(O.forEachInBounds(D,function(e){l._attributeStore.isVisible(e)&&(z&&a("esri-2d-debug")&&console.debug("Expected to find only one feature, but found multiple"),z=e)}),!z)return a("esri-2d-debug")&&console.debug("Expected to find a feature, but found none"),"continue";var U=b.getGeometry(O.geometryInfo,z.geometry,0,u.expect(I)),Y=i({},z.attributes,S.attributes);S.referenceId=z.localId,p.add(S.objectId),M.push(new m.Feature(Y,S.localId,U))}else if(o){p.add(S.objectId);U=b.getGeometry(O.geometryInfo,S.geometry,0,u.expect(I));M.push(new m.Feature(S.attributes,S.localId,U))}}}(C);return{features:M,objectIds:p}},t.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},t.prototype._setGeohashLevel=function(e){var t=this,r=this._geohashLevel,i=this._getGeohashLevel(e),n=2*(Math.floor(i/2)+1)-1,o=this._tree;this._geohashLevel=n,u.isNone(o)||(n>r?this._featuresById.forEach(function(e){e.geohashIndexed&&(o.insert(e,t._geohashLevel,r+1),e.geohashIndexed=!0)}):n<r&&o.dropLevels(this._geohashLevel))},t.prototype._insertIntoIndex=function(e){e.geohashIndexed||(this._invalidated=!0,e.geohashIndexed=!0,u.expect(this._tree).insert(e,this._geohashLevel))},t.prototype._removeFromIndex=function(e){e.geohashIndexed&&(this._invalidated=!0,u.expect(this._tree).remove(e,this._geohashLevel),e.geohashIndexed=!1)},t.prototype._handleClusterUpdates=function(){var e=this;this._invalidated&&this._clusters.size&&this._clusters.forEach(function(t){u.isSome(t)&&(t.invalid=t.invalid||e._invalidated)}),this._invalidated=!1},t.prototype._getTransforms=function(e,t){var r={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},n=d.getInfo(t);if(!n)return{tile:r,left:null,right:null};var o=n.valid,s=o[0],a=o[1];return{tile:r,left:i({},r,{translate:[a,e.bounds[3]]}),right:i({},r,{translate:[s-a+e.bounds[0],e.bounds[3]]})}},t.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},t.prototype._markForDeletion=function(e,t,r){var i=this._getClusterId(e,t,r);if(this._clusters.has(i)){var n=this._clusters.get(i);u.isSome(n)?n.canDelete=!0:this._clusters.delete(i)}},t.prototype._getClusterBounds=function(e,t,r){if(u.isNone(this._featureReduction))return null;var i=this._featureReduction.clusterRadius,n=2*i,o=r%2?t*n:t*n+i,s=r*n,a=o/_.TILE_SIZE,l=s/_.TILE_SIZE,c=(o+n)/_.TILE_SIZE,p=(s-n)/_.TILE_SIZE;return[e.getXForColumn(a),e.getYForRow(l),e.getXForColumn(c),e.getYForRow(p)]},t.prototype._lookupCluster=function(e,t,r,n,o){var a,l;if(u.isNone(this._featureReduction)||u.isNone(this._tree))return null;var c=this._getClusterId(t,r,n),d=this._clusters.get(c);if(d&&u.isSome(d)&&!d.invalid&&!d.canDelete)return d;var f=this._getClusterBounds(e,r,n),y=f[0],v=f[1],m=f[2],b=f[3],_={x:y,y:v},S={x:m,y:b},x=0,w=0,F=0,T=0;if(this._spatialReference.isWebMercator)x=(a=h.xyToLngLat(_.x,_.y))[0],w=a[1],F=(l=h.xyToLngLat(S.x,S.y))[0],T=l[1];else{var E=g.project(_,this._spatialReference,s.SpatialReference.WGS84),R=g.project(S,this._spatialReference,s.SpatialReference.WGS84);if(!E||!R)return null;x=E.x,w=E.y,F=R.x,T=R.y}var M={geohashX:0,geohashY:0},j={geohashX:0,geohashY:0};p.setGeohashXY(M,w,x,o),p.setGeohashXY(j,T,F,o);var P=M.geohashX,O=M.geohashY,C=j.geohashX,G=j.geohashY,L={xLL:P,yLL:O,xTR:C,yTR:G,level:o},A=this._tree.getRegionStatistics(P,O,C,G,o),N=A.count,B=A.xTotal,Q=A.yTotal,k=N?B/N:0,q=N?Q/N:0;if(u.isSome(d)&&d.canDelete){var V=this._attributeStore.removeLocalId(d.objectId);this._deferredDeletionQueue.push(V)}var D=u.isSome(d)&&!d.canDelete&&d.invalid,z=i({cluster_count:N},A.attributes),U=this._attributeStore,Y=D?d.update(k,q,t,z,L):I.create(U,c,k,q,t,z,L);return 0===N&&(Y.geometry.coords[0]=(y+m)/2,Y.geometry.coords[1]=(v+b)/2),this._attributeStore.setAttributeData(Y.localId,Y,this.geometryInfo,null),this._clusters.set(c,Y),this._updateAggregateValueRangeForCluster(Y,Y.tileLevel),Y},t.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},i=r.minValue,n=r.maxValue;r.minValue=Math.min(i,e.count),r.maxValue=Math.max(n,e.count),this._aggregateValueRanges[t]=r,i===r.minValue&&n===r.maxValue||(this._aggregateValueRangesChanged=!0)},t.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,i=Math.ceil(_.TILE_SIZE/r),n=e.key,o=n.row,s=n.col*_.TILE_SIZE,a=o*_.TILE_SIZE,u=Math.floor(s/r),l=Math.floor(a/r),c=u;c<u+i;c++)for(var p=l;p<l+i;p++)this._markForDeletion(e.key.level,c,p)},t.prototype._setGeohash=function(e){var t=e.geometry;if(t&&t.coords.length){var r={x:t.coords[0],y:t.coords[1]},i=g.project(r,this._spatialReference,s.SpatialReference.WGS84);if(!i)return void(a("esri-2d-debug")&&console.debug("Tried to project feature geometry, but got back `null`"));p.setGeohashXY(e,i.y,i.x,12)}},t.prototype._add=function(t){var r=this._featuresById.get(t.objectId);e.prototype._add.call(this,t),u.isSome(this._featureReduction)&&u.isSome(this._tree)&&(r?(t.geohashIndexed=r.geohashIndexed,t.geohashX=r.geohashX,t.geohashY=r.geohashY):this._setGeohash(t),!t.geohashIndexed&&this._attributeStore.isVisible(t)&&this._insertIntoIndex(t))},t.prototype._remove=function(t){return u.isSome(this._featureReduction)&&u.isSome(this._tree)&&this._removeFromIndex(t),e.prototype._remove.call(this,t)},t}(v.default);t.ClusterStore=x}.apply(null,i))||(e.exports=n)},626:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(430),r(40),r(394)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._pool=new r.default(8024),this._nodes=0,this._root=new s(0,0,0),this._fields=e}return e.prototype._acquire=function(e,t,r){var n=this._pool.dequeue();return this._nodes++,i.isSome(n)?n.realloc(e,t,r):new s(e,t,r)},e.prototype._release=function(e){this._nodes--,this._pool.enqueue(e)},Object.defineProperty(e.prototype,"count",{get:function(){return this._root.count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poolSize",{get:function(){return this._pool.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){var e=0;return this._forEachNode(function(t){return e=Math.max(e,t.depth)}),e},enumerable:!0,configurable:!0}),e.prototype.dropLevels=function(e){var t=this;this._forEachNode(function(r){if(r.depth>=e)for(var i=0;i<r.children.length;i++){var n=r.children[i];r.children[i]=null,n&&t._release(n)}})},e.prototype.insert=function(e,t,r){void 0===r&&(r=0);for(var i=this._root,n=0,o=0,s=0;null!==i;){if(i.depth>=r&&(i.count+=1,i.xTotal+=e.geometry.coords[0],i.yTotal+=e.geometry.coords[1],i.xGeohashTotal+=e.geohashX,i.yGeohashTotal+=e.geohashY,this._updateStatistics(e,i,1)),n>=t)return;var a=Math.ceil((n+1)/2),u=Math.floor((n+1)/2),l=1-n%2,c=30-(3*a+2*u),p=30-(2*a+3*u),d=7*l+3*(1-l)<<c,h=3*l+7*(1-l)<<p,f=8*l+4*(1-l),y=(e.geohashX&d)>>c,v=(e.geohashY&h)>>p,g=y+v*f;o=o<<3*l+2*(1-l)|y,s=s<<2*l+3*(1-l)|v,null==i.children[g]&&(i.children[g]=this._acquire(o,s,n+1)),n+=1,i=i.children[g]}},e.prototype.remove=function(e,t){for(var r=this._root,i=0;null!==r;){if(r.count-=1,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),i>=t)return;var n=Math.ceil((i+1)/2),o=Math.floor((i+1)/2),s=1-i%2,a=30-(3*n+2*o),u=30-(2*n+3*o),l=7*s+3*(1-s)<<a,c=3*s+7*(1-s)<<u,p=8*s+4*(1-s),d=((e.geohashX&l)>>a)+((e.geohashY&c)>>u)*p,h=r.children[d];1===h.count&&(this._release(h),r.children[d]=null),i+=1,r=h}},e.prototype.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},e.prototype.findSingleOccupancyNode=function(e,t,r,i,n){for(var o=this._root;null!==o;){var s=o.depth,a=o.xNode,u=o.yNode,l=1-s%2,c=o.xGeohashTotal/o.count,p=o.yGeohashTotal/o.count;if(1===o.count&&e<c&&c<=r&&t<p&&p<=i)return o;if(s>=n)o=o.next;else{for(var d=Math.ceil((s+1)/2),h=Math.floor((s+1)/2),f=30-(3*d+2*h),y=30-(2*d+3*h),v=~((1<<f)-1),g=~((1<<y)-1),m=(e&v)>>f,b=(t&g)>>y,_=(r&v)>>f,S=(i&g)>>y,I=a<<3*l+2*(1-l),x=u<<2*l+3*(1-l),w=I+8*l+4*(1-l),F=x+4*l+8*(1-l),T=Math.max(I,m),E=Math.max(x,b),R=Math.min(w,_),M=Math.min(F,S),j=null,P=null,O=E;O<=M;O++)for(var C=T;C<=R;C++){var G=C-I+(O-x)*(8*l+4*(1-l)),L=o.children[G];L&&(j||((j=L).next=o.next),P&&(P.next=L),P=L,L.next=o.next)}o=j||o.next}}return null},e.prototype.getRegionStatistics=function(e,t,r,i,n){for(var o=this._root,s=0,a=0,u=0,l={};null!==o;){var c=o.depth,p=o.xNode,d=o.yNode;if(c>=n){var h=o.xGeohashTotal/o.count,f=o.yGeohashTotal/o.count;e<h&&h<=r&&t<f&&f<=i&&(s+=o.count,a+=o.xTotal,u+=o.yTotal,this._aggregateStatistics(l,o.statistics)),o=o.next}else{for(var y=Math.ceil((c+1)/2),v=Math.floor((c+1)/2),g=1-c%2,m=30-(3*y+2*v),b=30-(2*y+3*v),_=~((1<<m)-1),S=~((1<<b)-1),I=(e&_)>>m,x=(t&S)>>b,w=(r&_)>>m,F=(i&S)>>b,T=p<<3*g+2*(1-g),E=d<<2*g+3*(1-g),R=T+8*g+4*(1-g),M=E+4*g+8*(1-g),j=Math.max(T,I),P=Math.max(E,x),O=Math.min(R,w),C=Math.min(M,F),G=null,L=null,A=P;A<=C;A++)for(var N=j;N<=O;N++){var B=N-T+(A-E)*(8*g+4*(1-g)),Q=o.children[B];if(Q){if(A!==P&&A!==C&&N!==j&&N!==O){h=Q.xGeohashTotal/Q.count,f=Q.yGeohashTotal/Q.count;e<h&&h<=r&&t<f&&f<=i&&(s+=Q.count,a+=Q.xTotal,u+=Q.yTotal,this._aggregateStatistics(l,Q.statistics));continue}G||((G=Q).next=o.next),L&&(L.next=Q),L=Q,Q.next=o.next}}o=G||o.next}}return{count:s,attributes:this._normalizeStatistics(l,s),xTotal:a,yTotal:u}},e.prototype._forEachNode=function(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}},e.prototype._linkChildren=function(e){for(var t=null,r=null,i=0;i<=e.children.length;i++){var n=e.children[i];n&&(t||((t=n).next=e.next),r&&(r.next=n),r=n,n.next=e.next)}return t},e.prototype._updateStatistics=function(e,t,r){for(var i=0,n=this._fields;i<n.length;i++){var o=n[i],s=o.name,a=o.outStatistic.onStatisticField,u=e.attributes[a];switch(o.outStatistic.statisticType){case"norm":t.statistics[s]||(t.statistics[s]={});var l=o.outStatistic.onStatisticNormalizationField,c=e.attributes[l],p=t.statistics[s].onStatisticField||0,d=t.statistics[s].onStatisticNormalizationField||0;null==u||isNaN(u)||null==c||0===c||isNaN(c)||(t.statistics[s].onStatisticField=p+r*u,t.statistics[s].onStatisticNormalizationField=d+r*c);break;case"avg":t.statistics[s]||(t.statistics[s]={value:0,nanCount:0});var h=t.statistics[s].value,f=t.statistics[s].nanCount;null==u||isNaN(u)?t.statistics[s].nanCount=f+r:t.statistics[s].value=h+r*u;break;case"avg_angle":t.statistics[s]||(t.statistics[s]={x:0,y:0,nanCount:0});var y=t.statistics[s].x,v=t.statistics[s].y,g=(f=t.statistics[s].nanCount,Math.PI/180);null==u||isNaN(u)?t.statistics[s].nanCount=f+r:(t.statistics[s].x=y+r*Math.cos(u*g),t.statistics[s].y=v+r*Math.sin(u*g));break;case"mode":t.statistics[s]||(t.statistics[s]={});h=t.statistics[s][u]||0;t.statistics[s][u]=h+r}}},e.prototype._aggregateStatistics=function(e,t){for(var r=0,i=this._fields;r<i.length;r++){var n=i[r],o=n.name;switch(n.outStatistic.statisticType){case"avg":case"avg_angle":case"mode":case"norm":for(var s in e[o]||(e[o]={}),t[o]){var a=e[o][s]||0;e[o][s]=a+t[o][s]}}}},e.prototype._normalizeStatistics=function(e,t){for(var r={},i=0,n=this._fields;i<n.length;i++){var o=n[i],s=o.name;switch(o.outStatistic.statisticType){case"norm":var a=e[s];if(t&&null==a.onStatisticNormalizationField)break;if(t&&a.onStatisticNormalizationField){r[s]=a.onStatisticField/a.onStatisticNormalizationField;break}r[s]=0;break;case"avg":if(!t)break;var u=e[s],l=u.value;if(!(t-(c=u.nanCount)))break;r[s]=l/(t-c);break;case"avg_angle":if(!t)break;var c,p=e[s],d=p.x,h=p.y;if(!(t-(c=p.nanCount)))break;var f=d/(t-c),y=h/(t-c),v=180/Math.PI,g=Math.atan2(y,f)*v;r[s]=g;break;case"mode":var m=e[s],b=0,_=null;for(var S in m){var I=m[S];I>b&&(b=I,_=S)}r[s]="null"===_?null:_}}return r},e}();t.GeohashTree=o;var s=function(){function e(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var i=0;i<this.children.length;i++)this.children[i]=null;this.xNode=e,this.yNode=t,this.depth=r}return e.prototype.realloc=function(e,t,r){for(var i=0;i<this.children.length;i++)this.children[i]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},e.prototype.getLngLatBounds=function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),i=30-(3*t+2*r),o=30-(2*t+3*r),s=this.xNode<<i,a=this.yNode<<o;return n.decodeGeohashXY({geohashX:s,geohashY:a},this.depth)},e.prototype.find=function(e,t,r,i,n,o){if(i>=r)return this;var s=1-i%2,a=3*s+2*(1-s),u=2*s+3*(1-s),l=30-n-a,c=30-o-u,p=((e&7*s+3*(1-s)<<l)>>l)+((t&3*s+7*(1-s)<<c)>>c)*(8*s+4*(1-s)),d=this.children[p];return null==d?null:d.find(e,t,r,i+1,n+a,o+u)},e}()}.apply(null,i))||(e.exports=n)},627:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(31),r(32),r(34),r(58),r(98),r(368)],void 0===(n=function(e,t,r,i,n,o,s,a){function u(e,t){return null==e?t:e}function l(e,t){return null==e.outline?t:u(e.outline.width,t)}function c(e,t){return i(this,void 0,void 0,function(){var i,n,o,p,h,f,b,_,S,I,x;return r(this,function(r){switch(r.label){case 0:return"simple-marker"===e.type?(i=Math.max(u(e.size,12),t),[2,d(e)+i*y]):"picture-marker"===e.type?(n=Math.max(u(e.height,12),t),o=u(e.width,12)*(n/u(e.height,12)),p=o/2,h=n/2,[2,d(e)+Math.sqrt(p*p+h*h)]):"text"===e.type?(a.getTextSymbolEstimatedSize(v,e,s.definitions.AVERAGE_GLYPH_MOSAIC_ITEM),f=v[2]*(u(e.horizontalAlignment,"top")in g?1:.5),b=v[3]*(u(e.horizontalAlignment,"center")in m?1:.5),_=function(e,t){return null==e.font?t:u(e.font.size,t)}(e,9),S=Math.max(_,t)/_,[2,d(e)+Math.sqrt(f*f+b*b)*S]):"simple-line"===e.type?[2,Math.max(u(e.width,.75),t)/2]:"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(l(e,0),t)/2]:"cim"===e.type?(I=s.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(I.width*I.width+I.height*I.height)]:[2,0]:"web-style"!==e.type?[3,2]:(x=c,[4,e.fetchCIMSymbol()]);case 1:return[2,x.apply(void 0,[r.sent(),t])];case 2:return[2,0]}})})}function p(e,t){return i(this,void 0,void 0,function(){var i,n;return r(this,function(r){switch(r.label){case 0:return function(e){return e.type in f}(e)?(n=(i=Math).min,[4,c(e,t)]):[2,0];case 1:return[2,n.apply(i,[r.sent(),75])]}})})}function d(e){var t=u(e.xoffset,0),r=u(e.yoffset,0);return Math.sqrt(t*t+r*r)}function h(e,t){return Math.max(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var f={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1},y=.707;t.computePxBuffer=function(e,t){return i(this,void 0,void 0,function(){var i,s,a,u,l,c,d;return r(this,function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(i=e.getSymbols(),s=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map(function(e){return e.size}).reduce(h,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map(function(e){return e.size}).reduce(h,0):"real-world-size"===r.transformationType?30:void 0}(e),a=[],u=0,l=i;u<l.length;u++)c=l[u],a.push(p(c,s));return[4,n.all(a)];case 1:return d=r.sent(),[2,o.pt2px(d.reduce(h,0))]}})})};var v=[0,0,0,0],g={left:1,right:1},m={top:1,bottom:1,baseline:1}}.apply(null,i))||(e.exports=n)},64:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(36),r(34),r(30),r(137),r(61),r(53)],void 0===(n=function(e,t,i,n,o,s,a,u,l,c){Object.defineProperty(t,"__esModule",{value:!0}),t.OperationalLayer=function(e){return function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.title="Layer",t}return i(r,e),r.prototype.writeListMode=function(e,t,r,i){i&&"ground"===i.layerContainerType?t[r]=e:e&&l.willPropertyWrite(this,r,{},i)&&(t[r]=e)},r.prototype.writeTitle=function(e,t){t.title=e||"Layer"},r.prototype.writeOperationalLayerType=function(e,t){e&&(t.layerType=e)},r.prototype.read=function(e,t){var r=this,i=arguments;t&&(t.layer=this),u.readLoadable(this,e,function(t){return r.inherited(i,[e,t])},t)},r.prototype.write=function(e,r){if(r&&r.origin){var i=r.origin+"/"+(r.layerContainerType||"operational-layers"),n=t.supportedTypes[i],s=n&&n[this.operationalLayerType];if("write"!==s&&"readwrite"!==s)return r.messages&&r.messages.push(new o("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' are not supported in the context of '"+i+"'",{layer:this})),null}var a=this.inherited(arguments,[e,r]),u=!!r&&!!r.messages&&!!r.messages.filter(function(e){return e instanceof o&&"web-document-write:property-required"===e.name}).length;return!this.url&&u?null:a},n([a.property({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}}}}})],r.prototype,"id",void 0),n([a.property({json:{write:{ignoreOrigin:!0}}})],r.prototype,"listMode",void 0),n([a.writer("listMode")],r.prototype,"writeListMode",null),n([a.property({type:String,json:{write:{ignoreOrigin:!0,allowNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}}}}})],r.prototype,"title",void 0),n([a.writer("title")],r.prototype,"writeTitle",null),n([a.property({type:String,readOnly:!0,json:{write:{target:"layerType",ignoreOrigin:!0}}})],r.prototype,"operationalLayerType",void 0),n([a.writer("operationalLayerType")],r.prototype,"writeOperationalLayerType",null),n([a.property(c.opacity)],r.prototype,"opacity",void 0),n([a.property({type:Boolean,json:{read:{source:"visibility"},write:{target:"visibility"},origins:{"web-document":{read:{source:"visibility"},write:{target:"visibility"},default:!0}}}})],r.prototype,"visible",void 0),n([a.subclass("esri.layers.mixins.OperationalLayer")],r)}(a.declared(e))},t.typeModuleMap={ArcGISFeatureLayer:function(){return s.create(function(e){return Promise.all([r.e(0),r.e(71)]).then(function(){var t=[r(87)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISImageServiceLayer:function(){return s.create(function(e){return Promise.all([r.e(1),r.e(13),r.e(17)]).then(function(){var t=[r(128)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISImageServiceVectorLayer:function(){return s.resolve(null)},ArcGISMapServiceLayer:function(){return s.create(function(e){return Promise.all([r.e(4),r.e(78)]).then(function(){var t=[r(109)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISSceneServiceLayer:function(){return s.create(function(e){return Promise.all([r.e(0),r.e(24)]).then(function(){var t=[r(131)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISStreamLayer:function(){return s.create(function(e){return Promise.all([r.e(0),r.e(26)]).then(function(){var t=[r(133)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISTiledElevationServiceLayer:function(){return s.create(function(e){return r.e(11).then(function(){var t=[r(118)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISTiledImageServiceLayer:function(){return s.create(function(e){return Promise.all([r.e(4),r.e(12)]).then(function(){var t=[r(62)];e.apply(null,t)}.bind(this)).catch(r.oe)})},ArcGISTiledMapServiceLayer:function(){return s.create(function(e){return Promise.all([r.e(4),r.e(12)]).then(function(){var t=[r(62)];e.apply(null,t)}.bind(this)).catch(r.oe)})},BingMapsAerial:function(){return s.create(function(e){return r.e(15).then(function(){var t=[r(51)];e.apply(null,t)}.bind(this)).catch(r.oe)})},BingMapsRoad:function(){return s.create(function(e){return r.e(15).then(function(){var t=[r(51)];e.apply(null,t)}.bind(this)).catch(r.oe)})},BingMapsHybrid:function(){return s.create(function(e){return r.e(15).then(function(){var t=[r(51)];e.apply(null,t)}.bind(this)).catch(r.oe)})},BuildingSceneLayer:function(){return s.create(function(e){return r.e(21).then(function(){var t=[r(132)];e.apply(null,t)}.bind(this)).catch(r.oe)})},CSV:function(){return s.create(function(e){return Promise.all([r.e(0),r.e(25)]).then(function(){var t=[r(127)];e.apply(null,t)}.bind(this)).catch(r.oe)})},GeoRSS:function(){return s.create(function(e){return r.e(97).then(function(){var t=[r(120)];e.apply(null,t)}.bind(this)).catch(r.oe)})},GroupLayer:function(){return s.create(function(e){return r.e(109).then(function(){var t=[r(111)];e.apply(null,t)}.bind(this)).catch(r.oe)})},IntegratedMeshLayer:function(){return s.create(function(e){return r.e(83).then(function(){var t=[r(122)];e.apply(null,t)}.bind(this)).catch(r.oe)})},KML:function(){return s.create(function(e){return r.e(29).then(function(){var t=[r(129)];e.apply(null,t)}.bind(this)).catch(r.oe)})},OpenStreetMap:function(){return s.create(function(e){return r.e(84).then(function(){var t=[r(121)];e.apply(null,t)}.bind(this)).catch(r.oe)})},PointCloudLayer:function(){return s.create(function(e){return r.e(19).then(function(){var t=[r(130)];e.apply(null,t)}.bind(this)).catch(r.oe)})},VectorTileLayer:function(){return s.create(function(e){return r.e(22).then(function(){var t=[r(134)];e.apply(null,t)}.bind(this)).catch(r.oe)})},WebTiledLayer:function(){return s.create(function(e){return r.e(85).then(function(){var t=[r(95)];e.apply(null,t)}.bind(this)).catch(r.oe)})},WFS:function(){return s.resolve(null)},WMS:function(){return s.create(function(e){return r.e(30).then(function(){var t=[r(135)];e.apply(null,t)}.bind(this)).catch(r.oe)})},RasterDataLayer:function(){return s.resolve(null)}},t.supportedTypes={"web-scene/operational-layers":{ArcGISFeatureLayer:"readwrite",ArcGISImageServiceLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISSceneServiceLayer:"readwrite",ArcGISTiledElevationServiceLayer:"read",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",BuildingSceneLayer:"readwrite",GroupLayer:"readwrite",IntegratedMeshLayer:"readwrite",PointCloudLayer:"readwrite",WebTiledLayer:"readwrite",CSV:"readwrite",VectorTileLayer:"readwrite",WMS:"readwrite",KML:"readwrite",RasterDataLayer:"readwrite"},"web-scene/basemap":{ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",WebTiledLayer:"readwrite",OpenStreetMap:"readwrite",VectorTileLayer:"readwrite",ArcGISImageServiceLayer:"readwrite",WMS:"readwrite",ArcGISMapServiceLayer:"readwrite"},"web-scene/ground":{ArcGISTiledElevationServiceLayer:"readwrite"},"web-map/operational-layers":{ArcGISImageServiceLayer:"readwrite",ArcGISImageServiceVectorLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISStreamLayer:"readwrite",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",ArcGISFeatureLayer:"readwrite",BingMapsAerial:"readwrite",BingMapsRoad:"readwrite",BingMapsHybrid:"readwrite",CSV:"readwrite",GeoRSS:"readwrite",KML:"readwrite",VectorTileLayer:"readwrite",WFS:"readwrite",WMS:"readwrite",WebTiledLayer:"readwrite"},"web-map/basemap":{ArcGISImageServiceLayer:"readwrite",ArcGISImageServiceVectorLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",OpenStreetMap:"readwrite",VectorTileLayer:"readwrite",WMS:"readwrite",WebTiledLayer:"readwrite",BingMapsAerial:"readwrite",BingMapsRoad:"readwrite",BingMapsHybrid:"readwrite"}}}.apply(null,i))||(e.exports=n)},66:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(30)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ScaleRangeLayer=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minScale=0,t.maxScale=0,t}return r(t,e),Object.defineProperty(t.prototype,"scaleRangeId",{get:function(){return this.minScale+","+this.maxScale},enumerable:!0,configurable:!0}),i([n.property({type:Number,json:{write:!0}})],t.prototype,"minScale",void 0),i([n.property({type:Number,json:{write:!0}})],t.prototype,"maxScale",void 0),i([n.property({readOnly:!0,dependsOn:["minScale","maxScale"]})],t.prototype,"scaleRangeId",null),i([n.subclass("esri.layers.mixins.ScaleRangeLayer")],t)}(n.declared(e))}}.apply(null,i))||(e.exports=n)},67:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(31),r(32),r(41),r(33),r(30),r(68),r(69)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c){var p=s.strict()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),d=new s.JSONMap({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return r(t,e),n=t,t.prototype.readFeatureExpressionInfo=function(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0},t.prototype.writeFeatureExpressionInfo=function(e,t,r,i){t[r]=e.write(null,i),"0"===e.expression&&(t.featureExpression={value:0})},Object.defineProperty(t.prototype,"mode",{get:function(){return this._isOverridden("mode")?this._get("mode"):null!=this.offset||this.featureExpressionInfo?"relative-to-ground":"on-the-ground"},set:function(e){this._override("mode",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unit",{set:function(e){this._set("unit",e)},enumerable:!0,configurable:!0}),t.prototype.write=function(){return this.offset||this.mode||this.featureExpressionInfo||this.unit?this.inherited(arguments):null},t.prototype.clone=function(){return new n({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})},i([u.property({type:l,json:{write:!0}})],t.prototype,"featureExpressionInfo",void 0),i([u.reader("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],t.prototype,"readFeatureExpressionInfo",null),i([u.writer("featureExpressionInfo",{featureExpressionInfo:{type:l},"featureExpression.value":{type:[0]}})],t.prototype,"writeFeatureExpressionInfo",null),i([u.property({type:p.apiValues,dependsOn:["offset","featureExpressionInfo"],nonNullable:!0,json:{type:p.jsonValues,read:p.read,write:{writer:p.write,isRequired:!0}}})],t.prototype,"mode",null),i([u.property({type:Number,json:{write:!0}})],t.prototype,"offset",void 0),i([u.property({type:c.supportedUnits,json:{type:String,read:d.read,write:d.write}})],t.prototype,"unit",null),n=i([u.subclass("esri.layers.support.ElevationInfo")],t)}(u.declared(a.JSONSupport))}.apply(null,i))||(e.exports=n)},68:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(31),r(32),r(33),r(30),r(65)],void 0===(n=function(e,t,r,i,n,o,s,a,u){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var s;return r(t,e),s=t,t.prototype.collectRequiredFields=function(e,t){return o(this,void 0,void 0,function(){return n(this,function(r){return[2,u.collectArcadeFieldNames(e,t,this.expression)]})})},t.prototype.clone=function(){return new s({expression:this.expression,title:this.title})},i([a.property({type:String,json:{write:!0}})],t.prototype,"expression",void 0),i([a.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),s=i([a.subclass("esri.layers.support.FeatureExpressionInfo")],t)}(a.declared(s.JSONSupport))}.apply(null,i))||(e.exports=n)},69:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(110)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.supportsUnit=function(e){return null!=r.meterIn[e]},t.getMetersPerUnit=function(e){return 1/(r.meterIn[e]||1)},t.supportedUnits=function(){var e=Object.keys(r.meterIn);return e.sort(),e}()}.apply(null,i))||(e.exports=n)},74:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(42),r(42),r(71),r(97),r(41),r(33),r(38),r(30),r(48),r(46),r(80),r(85),r(93)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,v){var g=new u.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),m=new u.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(e){function t(t){var r=e.call(this,t)||this;return r.cacheHint=!1,r.datumTransformation=null,r.distance=void 0,r.gdbVersion=null,r.geometry=null,r.geometryPrecision=void 0,r.groupByFieldsForStatistics=null,r.having=null,r.historicMoment=null,r.maxAllowableOffset=void 0,r.maxRecordCountFactor=1,r.multipatchOption=null,r.num=void 0,r.objectIds=null,r.orderByFields=null,r.outFields=null,r.outSpatialReference=null,r.outStatistics=null,r.parameterValues=null,r.pixelSize=null,r.quantizationParameters=null,r.rangeValues=null,r.relationParameter=null,r.resultType=null,r.returnCentroid=!1,r.returnDistinctValues=!1,r.returnExceededLimitFeatures=!0,r.returnGeometry=!1,r.returnQueryGeometry=!1,r.returnM=void 0,r.returnZ=void 0,r.source=null,r.spatialRelationship="intersects",r.start=void 0,r.sqlFormat=null,r.text=null,r.timeExtent=null,r.units=null,r.where=null,r}var u;return r(t,e),u=t,t.from=function(e){return d.ensureClass(u,e)},t.prototype.castDatumTransformation=function(e){return"number"==typeof e||"object"==typeof e?e:null},t.prototype.writeHistoricMoment=function(e,t){t.historicMoment=e&&e.getTime()},t.prototype.writeParameterValues=function(e,t){if(e){var r={};for(var i in e){var n=e[i];Array.isArray(n)?r[i]=n.map(function(e){return e instanceof Date?e.getTime():e}):n instanceof Date?r[i]=n.getTime():r[i]=n}t.parameterValues=r}},t.prototype.writeStart=function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"},t.prototype.writeWhere=function(e,t){t.where=e||"1=1"},t.prototype.clone=function(){return new u(c.clone({cacheHint:this.cacheHint,datumTransformation:this.datumTransformation,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,source:this.source,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,units:this.units,where:this.where}))},t.MAX_MAX_RECORD_COUNT_FACTOR=5,i([p.property({type:Boolean,json:{write:!0,default:!1}})],t.prototype,"cacheHint",void 0),i([p.property({json:{write:!0}})],t.prototype,"datumTransformation",void 0),i([p.cast("datumTransformation")],t.prototype,"castDatumTransformation",null),i([p.property({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],t.prototype,"distance",void 0),i([p.property({type:String,json:{write:!0}})],t.prototype,"gdbVersion",void 0),i([p.property({types:o.geometryTypes,json:{read:h.fromJSON,write:!0}})],t.prototype,"geometry",void 0),i([p.property({type:Number,json:{write:!0}})],t.prototype,"geometryPrecision",void 0),i([p.property({type:[String],json:{write:!0}})],t.prototype,"groupByFieldsForStatistics",void 0),i([p.property({type:String,json:{write:!0}})],t.prototype,"having",void 0),i([p.property({type:Date})],t.prototype,"historicMoment",void 0),i([p.writer("historicMoment")],t.prototype,"writeHistoricMoment",null),i([p.property({type:Number,json:{write:!0}})],t.prototype,"maxAllowableOffset",void 0),i([p.property({type:Number,cast:function(e){return e<1?1:e>u.MAX_MAX_RECORD_COUNT_FACTOR?u.MAX_MAX_RECORD_COUNT_FACTOR:e},json:{write:{overridePolicy:function(e){return{enabled:e>1}}}}})],t.prototype,"maxRecordCountFactor",void 0),i([p.property({type:String,json:{write:!0}})],t.prototype,"multipatchOption",void 0),i([p.property({type:Number,json:{read:{source:"resultRecordCount"}}})],t.prototype,"num",void 0),i([p.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),i([p.property({type:[String],json:{write:!0}})],t.prototype,"orderByFields",void 0),i([p.property({type:[String],json:{write:!0}})],t.prototype,"outFields",void 0),i([p.property({type:n.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t.prototype,"outSpatialReference",void 0),i([p.property({type:[v],json:{write:!0}})],t.prototype,"outStatistics",void 0),i([p.property({json:{write:!0}})],t.prototype,"parameterValues",void 0),i([p.writer("parameterValues")],t.prototype,"writeParameterValues",null),i([p.property({types:s.symbolTypes,json:{read:f.read,write:!0}})],t.prototype,"pixelSize",void 0),i([p.property({type:y.default,json:{write:!0}})],t.prototype,"quantizationParameters",void 0),i([p.property({type:[Object],json:{write:!0}})],t.prototype,"rangeValues",void 0),i([p.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy:function(){return{enabled:"relation"===this.spatialRelationship}}}}})],t.prototype,"relationParameter",void 0),i([p.property({type:String,json:{write:!0}})],t.prototype,"resultType",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnCentroid",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnDistinctValues",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:!e}}}}})],t.prototype,"returnExceededLimitFeatures",void 0),i([p.property({type:Boolean,json:{write:!0}})],t.prototype,"returnGeometry",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnQueryGeometry",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnM",void 0),i([p.property({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],t.prototype,"returnZ",void 0),i([p.property({json:{write:!0}})],t.prototype,"source",void 0),i([p.property({type:String,json:{read:{source:"spatialRel",reader:g.read},write:{target:"spatialRel",writer:g.write}}})],t.prototype,"spatialRelationship",void 0),i([p.property({type:Number,json:{read:{source:"resultOffset"}}})],t.prototype,"start",void 0),i([p.writer("start"),p.writer("num")],t.prototype,"writeStart",null),i([p.property({type:String,json:{write:!0}})],t.prototype,"sqlFormat",void 0),i([p.property({type:String,json:{write:!0}})],t.prototype,"text",void 0),i([p.property({type:a,json:{write:!0}})],t.prototype,"timeExtent",void 0),i([p.property({type:String,json:{read:m.read,write:{writer:m.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],t.prototype,"units",void 0),i([p.property({type:String,json:{write:{overridePolicy:function(e){return{enabled:null!=e||this.start>0}}}}})],t.prototype,"where",void 0),i([p.writer("where")],t.prototype,"writeWhere",null),u=i([p.subclass("esri.tasks.support.Query")],t)}(p.declared(l.JSONSupport))}.apply(null,i))||(e.exports=n)},88:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(30)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshableLayer=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshInterval=0,t}return r(t,e),t.prototype.refresh=function(){this.emit("refresh")},i([n.property({type:Number,cast:function(e){return e>=.1?e:e<=0?0:.1},json:{write:!0,origins:{"web-document":{write:!0}}}})],t.prototype,"refreshInterval",void 0),i([n.subclass("esri.layers.mixins.RefreshableLayer")],t)}(n.declared(e))}}.apply(null,i))||(e.exports=n)},93:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(29),r(28),r(33),r(30)],void 0===(n=function(e,t,r,i,n,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.maxPointCount=void 0,r.maxRecordCount=void 0,r.maxVertexCount=void 0,r.onStatisticField=null,r.outStatisticFieldName=null,r.statisticType=null,r}var n;return r(t,e),n=t,t.prototype.clone=function(){return new n({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType})},i([o.property({type:Number,json:{write:!0}})],t.prototype,"maxPointCount",void 0),i([o.property({type:Number,json:{write:!0}})],t.prototype,"maxRecordCount",void 0),i([o.property({type:Number,json:{write:!0}})],t.prototype,"maxVertexCount",void 0),i([o.property({type:String,json:{write:!0}})],t.prototype,"onStatisticField",void 0),i([o.property({type:String,json:{write:!0}})],t.prototype,"outStatisticFieldName",void 0),i([o.property({type:String,json:{write:!0}})],t.prototype,"statisticType",void 0),n=i([o.subclass("esri.tasks.support.StatisticDefinition")],t)}(o.declared(n.JSONSupport))}.apply(null,i))||(e.exports=n)}}]);