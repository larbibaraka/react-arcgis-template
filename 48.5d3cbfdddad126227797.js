(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/layers/support/ClipArea":57,"esri/views/layers/LayerView":144,"esri/views/2d/layers/LayerView2D":149,"esri/views/layers/support/ClipRect":150,"esri/views/layers/support/Geometry":151,"esri/views/layers/support/Path":152,"esri/core/requireUtils":164,"esri/layers/support/TilemapCache":230,"esri/layers/support/Tilemap":296,"esri/views/2d/engine/vectorTiles/TileIndex":604,"esri/views/2d/engine/vectorTiles/VectorTile":824,"esri/views/2d/engine/vectorTiles/RectangleBinPack":825,"esri/views/2d/layers/VectorTileLayerView2D":2191,"esri/views/2d/engine/vectorTiles/TileHandler":2192,"esri/views/2d/engine/vectorTiles/RenderBucket":2193,"esri/views/2d/engine/vectorTiles/GlyphMosaic":2194,"esri/views/2d/engine/vectorTiles/GlyphSource":2195,"esri/views/2d/engine/vectorTiles/SpriteMosaic":2196,"esri/views/2d/engine/vectorTiles/VectorTileContainer":2197,"esri/views/2d/engine/vectorTiles/FadeRecorder":2198,"esri/views/2d/tiling/TileInfoViewPOT":2199})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{144:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(29),i(28),i(47),i(106),i(141),i(167),i(37),i(154),i(30)],void 0===(n=function(e,t,i,r,n,a,o,s,l,u,h){return function(e){function t(t){var i=e.call(this,t)||this;return i.layer=null,i.parent=null,i}return i(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var i=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";throw l.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+r+"', id: '"+i+"')",t),t}})},t.prototype.destroy=function(){this.layer=this.parent=null},Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},r([h.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),r([h.property()],t.prototype,"layer",void 0),r([h.property()],t.prototype,"parent",void 0),r([h.property({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),r([h.property({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],t.prototype,"updating",null),r([h.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),r([h.subclass("esri.views.layers.LayerView")],t)}(h.declared(o.HandleOwnerMixin(s.IdentifiableMixin(u.EsriPromiseMixin(a.EventedMixin(n))))))}.apply(null,r))||(e.exports=n)},149:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(29),i(28),i(55),i(168),i(56),i(30),i(57),i(150),i(151),i(152)],void 0===(n=function(e,t,i,r,n,a,o,s,l,u,h,c){Object.defineProperty(t,"__esModule",{value:!0});var p=n.ofType({key:"type",base:l,typeMap:{rect:u,path:c,geometry:h}});t.LayerView2D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clips=new p,t.moving=!1,t.attached=!1,t.lastUpdateId=-1,t.updateRequested=!1,t}return i(t,e),t.prototype.initialize=function(){var e=this;this.when(function(){e.requestUpdate()},function(){});var t=function(){return e.notifyChange("rendering")};this.handles.add([o.init(this,"suspended",function(t){e.container&&(e.container.visible=!t),e.view&&!t&&e.updateRequested&&e.view.requestLayerViewUpdate(e)},!0),o.init(this,["fullOpacity","container"],function(){e.container&&(e.container.opacity=e.fullOpacity)},!0),o.on(this,"container","post-render",t),o.on(this,"container","will-render",t)])},t.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach()),this.handles.remove("initialize"),this.updateRequested=!1,this.layer=null,this.view=null},Object.defineProperty(t.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0}),t.prototype.isVisibleAtScale=function(e){var t=!0,i=this.layer,r=i.minScale,n=i.maxScale;if(null!=r&&null!=n){var a=!r,o=!n;!a&&e<=r&&(a=!0),!o&&e>=n&&(o=!0),t=a&&o}return t},t.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))},t.prototype.processUpdate=function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1},t.prototype.isUpdating=function(){return!1},t.prototype.isRendering=function(){return!1},t.prototype.canResume=function(){var e=this.inherited(arguments);return e&&(e=this.isVisibleAtScale(this.view.scale)),e},r([s.property({type:p,set:function(e){var t=a.referenceSetter(e,this._get("clips"),p);this._set("clips",t)}})],t.prototype,"clips",void 0),r([s.property()],t.prototype,"moving",void 0),r([s.property({dependsOn:["attached","suspended","moving"]})],t.prototype,"rendering",null),r([s.property()],t.prototype,"attached",void 0),r([s.property()],t.prototype,"container",void 0),r([s.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),r([s.property({readOnly:!0})],t.prototype,"updateParameters",void 0),r([s.property()],t.prototype,"updateRequested",void 0),r([s.property({dependsOn:["updateRequested","attached","suspended"]})],t.prototype,"updating",null),r([s.property()],t.prototype,"view",void 0),r([s.subclass("esri.views.2d.layers.LayerView2D")],t)}(s.declared(e))}}.apply(null,r))||(e.exports=n)},150:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(28),i(29),i(30),i(57)],void 0===(n=function(e,t,i,r,n,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="rect",t.left=null,t.right=null,t.top=null,t.bottom=null,t}var a;return r(t,e),a=t,t.prototype.clone=function(){return new a({left:this.left,right:this.right,top:this.top,bottom:this.bottom})},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"left",void 0),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"right",void 0),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"top",void 0),i([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"bottom",void 0),i([n.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],t.prototype,"version",null),a=i([n.subclass("esri.views.layers.support.ClipRect")],t)}(n.declared(a))}.apply(null,r))||(e.exports=n)},151:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(28),i(29),i(42),i(30),i(96),i(46),i(57)],void 0===(n=function(e,t,i,r,n,a,o,s,l){var u={base:o,key:"type",typeMap:{extent:n.Extent,polygon:n.Polygon}};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="geometry",t.geometry=null,t}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n({geometry:this.geometry.clone()})},i([a.property({types:u,json:{read:s.fromJSON,write:!0}})],t.prototype,"geometry",void 0),i([a.property({readOnly:!0,dependsOn:["geometry"]})],t.prototype,"version",null),n=i([a.subclass("esri.views.layers.support.Geometry")],t)}(a.declared(l))}.apply(null,r))||(e.exports=n)},152:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(28),i(29),i(30),i(57)],void 0===(n=function(e,t,i,r,n,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="path",t.path=[],t}return r(t,e),Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),i([n.property({type:[[[Number]]],json:{write:!0}})],t.prototype,"path",void 0),i([n.property({readOnly:!0,dependsOn:["path"]})],t.prototype,"version",null),i([n.subclass("esri.views.layers.support.Path")],t)}(n.declared(a))}.apply(null,r))||(e.exports=n)},164:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(187),i(37),i(34)],void 0===(n=function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0});var a=r.getLogger("esri.core.requireUtils");t.when=function e(t,r){return i.deprecatedFunction(a,"when",{moduleName:"requireUtils",replacement:"Use `promiseUtils.create()` instead.",version:"4.10",warnOnce:!0}),Array.isArray(r)?n.create(function(e){t(r,function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];e(t)})}):e(t,[r]).then(function(e){return e[0]})},t.getAbsMid=function(e,t,i){return t.toAbsMid?t.toAbsMid(e):i.id.replace(/\/[^\/]*$/gi,"/")+e}}.apply(null,r))||(e.exports=n)},2191:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(29),i(28),i(31),i(32),i(77),i(36),i(82),i(37),i(34),i(30),i(2192),i(2197),i(149),i(2199),i(343),i(344),i(144)],void 0===(n=function(e,t,i,r,n,a,o,s,l,u,h,c,p,f,d,y,v,g,_){var m=u.getLogger("esri.views.2d.layers.VectorTileLayerView2D");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new l,t._fetchQueue=null,t._parseQueue=null,t._isTileHandlerPromiseFulfilled=!1,t._invalidateStyle=!1,t}return i(t,e),t.prototype.initialize=function(){var e=this,t=this.layer.tileInfo;(t&&t.spatialReference).equals(this.view.spatialReference)?(this._tileInfoView=new y(this.layer.tileInfo,this.layer.fullExtent),this.container=new f.VectorTileContainer(this._tileInfoView,this.clips),this._tileHandler=new p.TileHandler(this.layer,window.devicePixelRatio||1,!0,this.container,null),this.handles.add([this.watch("layer.currentStyleInfo",function(){return e._start()}),this.clips.on("change",function(){return e.container.setClips(e.clips)})])):this.addResolvingPromise(h.reject(new s("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))},t.prototype.destroy=function(){this._stop(),this.container.dispose(),this._tileHandler&&(this._tileHandler.destroy(),this._tileHandler=null)},t.prototype.hitTest=function(e,t){return a(this,void 0,void 0,function(){var i,r,a,s,l;return n(this,function(n){switch(n.label){case 0:return this.suspended||!this._tileHandlerPromise?[2,null]:[4,this._tileHandlerPromise];case 1:return n.sent(),[4,this.container.hitTest(e,t)];case 2:return(i=n.sent())&&0!==i.length?(r=i[0],a=this._tileHandler.getStyleRepository().layers,r>=a.length?[2,null]:(s=a[r],(l=new o({attributes:{layerId:r,layerName:s.id}})).layer=this.layer,l.sourceLayer=this.layer,[2,l])):[2,null]}})})},t.prototype.update=function(e){var t=this;this.notifyChange("updating");var i=this._tileHandlerPromise;i&&i.then(function(){if(e.pixelRatio!==t._tileHandler.devicePixelRatio)return t._start(),void(t._tileHandler.devicePixelRatio=e.pixelRatio);t._invalidateStyle?(t._issueStyleInvalidation(),t._invalidateStyle=!1):(t._fetchQueue.pause(),t._parseQueue.pause(),t._fetchQueue.state=e.state,t._parseQueue.state=e.state,t._tileStrategy.update(e),t._parseQueue.resume(),t._fetchQueue.resume());for(var i=0,r=t.container.children;i<r.length;i++){var n=r[i];t._tileHandler.updateTile(n,e)}})},t.prototype.attach=function(){var e=this;this._start(),this._handles.add(this.layer.on("paint-change",function(){return e.container.requestRender()})),this._handles.add(this.layer.on("layout-change",function(){e._invalidateStyle=!0,e.requestUpdate()}))},t.prototype.detach=function(){this._stop(),this._handles.removeAll()},t.prototype.moveStart=function(){this.requestUpdate()},t.prototype.viewChange=function(){this.requestUpdate()},t.prototype.moveEnd=function(){this.requestUpdate()},t.prototype.canResume=function(){var e=this.inherited(arguments),t=this.layer;if(e&&t.currentStyleInfo){var i=this.view.scale,r=t.currentStyleInfo;if(r&&r.layerDefinition){var n=r.layerDefinition;n.minScale&&n.minScale<i&&(e=!1),n.maxScale&&n.maxScale>i&&(e=!1)}}return e},t.prototype.isUpdating=function(){return!this._isTileHandlerPromiseFulfilled||this._fetchQueue.updating||this._parseQueue.updating},t.prototype.acquireTile=function(e){var t=this,i=this.container.createTile(e);return this._tileHandlerPromise.then(function(){t.notifyChange("updating"),t._fetchQueue.push(i.key).then(function(e){return t._parseQueue.push(e)}).then(function(e){i.once("attach",function(){return t.requestUpdate()}),t.container.setTileData(i,e),t.container.addChild(i),t.notifyChange("updating")}).catch(function(e){t.notifyChange("updating"),h.isAbortError(e)||m.error(e),i.destroy()})}),i},t.prototype.releaseTile=function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this._tileHandler.abortTileUpdate(t),this.container.removeChild(e),this.requestUpdate(),this.notifyChange("updating")},t.prototype._start=function(){var e=this;if(this._stop(),this.layer.currentStyleInfo&&this.attached){var t=new AbortController,i=this._tileHandler.start({signal:t.signal}).then(function(){e._tileStrategy=new g({cachePolicy:"keep",coveragePolicy:"smallest",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:e._tileInfoView,cacheSize:40,buffer:0}),e._fetchQueue=new v({tileInfoView:e._tileInfoView,process:function(t,i){return e._getTileData(t,i)},concurrency:15}),e._parseQueue=new v({tileInfoView:e._tileInfoView,process:function(t,i){return e._parseTileData(t,i)},concurrency:8}),e.requestUpdate(),e._isTileHandlerPromiseFulfilled=!0});this._tileHandler.spriteMosaic.then(function(t){e.container.setStyleResources(t,e._tileHandler.glyphMosaic,e.layer.styleRepository),e.requestUpdate()}),this._tileHandlerAbortController=t,this._tileHandlerPromise=i}},t.prototype._stop=function(){if(this._tileHandlerAbortController){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerPromiseFulfilled=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this.container.removeAllChildren()}},t.prototype._getTileData=function(e,t){return a(this,void 0,void 0,function(){var i;return n(this,function(r){switch(r.label){case 0:return[4,this._tileHandler.fetchTileData(e,t)];case 1:return i=r.sent(),this.notifyChange("updating"),[2,{key:e,data:i}]}})})},t.prototype._parseTileData=function(e,t){return a(this,void 0,void 0,function(){return n(this,function(i){return[2,this._tileHandler.parseTileData(e,this.updateParameters.state.rotation,t)]})})},t.prototype._issueStyleInvalidation=function(){var e=this;this.notifyChange("updating"),this._tileHandlerPromise=this._tileHandler.updateStyle().then(function(){e._tileHandler.spriteMosaic.then(function(t){return e.container.setStyleResources(t,e._tileHandler.glyphMosaic,e.layer.styleRepository)}),e._fetchQueue.pause(),e._parseQueue.pause(),e._fetchQueue.clear(),e._parseQueue.clear(),e._parseQueue.resume(),e._fetchQueue.resume(),e.notifyChange("updating"),e.requestUpdate()})},r([c.property({dependsOn:["view.scale","layer.currentStyleInfo"]})],t.prototype,"suspended",void 0),r([c.subclass("esri.views.2d.layers.VectorTileLayerView2D")],t)}(c.declared(d.LayerView2D(_)))}.apply(null,r))||(e.exports=n)},2192:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(35),i(31),i(32),i(44),i(49),i(360),i(40),i(355),i(34),i(164),i(205),i(92),i(824),i(248),i(2194),i(2195),i(2196),i(604),i(161),i.dj.m(e)],void 0===(n=function(e,t,i,r,n,a,o,s,l,u,h,c,p,f,d,y,v,g,_,m,b,w){Object.defineProperty(t,"__esModule",{value:!0});var x=new s(10),D=new Map,T=function(){function t(e,t,i,r,n){this._vectorTileLayer=e,this.devicePixelRatio=t,this.allowUpdates=i,this._container=r,this._memCache=n,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._updateToAbortController=new Map,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map}return t.prototype.destroy=function(){this._updateToAbortController&&this._updateToAbortController.forEach(function(e){return e.abort()}),this._ongoingTileRequests&&this.abortAll(),this._connection&&(this._connection.close(),this._connection=null),this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)},Object.defineProperty(t.prototype,"spriteMosaic",{get:function(){var e=this;return this._spriteSourcePromise.then(function(){return e._spriteMosaic})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0}),t.prototype.start=function(t){return n(this,void 0,void 0,function(){var n,a,s,l,u,f=this;return r(this,function(r){for(s in n=this._vectorTileLayer.sourceNameToSource,a=[],n)a.push(this._fetchTileMap(n[s],t));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then(function(e){f._spriteMosaic=new _(1024,1024,250),f._spriteMosaic.setSpriteSource(e),o("stable-symbol-rendering")&&f._spriteMosaic.preloadSpriteItems()}),l=this._vectorTileLayer.styleRepository,u=new g(l.glyphs),this._glyphMosaic=new v(1024,1024,u),this._broadcastPromise=p.open(c.getAbsMid("../vectorTiles/WorkerTileHandler",e,w),{client:this,scheduler:t.scheduler,signal:t.signal}).then(function(e){return f._connection=e,h.all(f._connection.broadcast("setLayers",l.styleJSON,i({},t)))}),[2,h.all(a)]})})},t.prototype.updateStyle=function(){return n(this,void 0,void 0,function(){var e,t=this;return r(this,function(i){switch(i.label){case 0:return[4,this._broadcastPromise];case 1:return i.sent(),this._updateToAbortController.forEach(function(e){return e.abort()}),this._updateToAbortController.clear(),e=this._vectorTileLayer.styleRepository,this._broadcastPromise=h.create(function(i,r){h.all(t._connection.broadcast("updateStyle",e.styleJSON)).then(i,r)}),[2,this._broadcastPromise]}})})},t.prototype.abortTileUpdate=function(e){this._updateToAbortController.has(e)&&(this._updateToAbortController.get(e).abort(),this._updateToAbortController.delete(e))},t.prototype.updateTile=function(e,t){return n(this,void 0,void 0,function(){var i,n,a,o,s=this;return r(this,function(r){switch(r.label){case 0:return this.allowUpdates&&e.isReady?[4,this._broadcastPromise]:[2];case 1:return r.sent(),i=Math.round(y.degToByte(t.state.rotation)),e.rotation===i?[2,null]:(a=e.key,this._updateToAbortController.has(a.id)&&((n=this._updateToAbortController.get(a.id)).abort(),this._updateToAbortController.delete(a.id)),n=h.createAbortController(),e.rotation=i,o=e.client.invoke("updateSymbols",{key:e.id,rotation:i},{signal:n.signal}).then(function(t){s._updateToAbortController.delete(a.id),e.isReady&&e.updateSymbolData(t)}).catch(function(e){h.isAbortError(e)||s._updateToAbortController.delete(a.id)}),this._updateToAbortController.set(e.id,n),[2,o])}})})},t.prototype.updateTileData=function(e){for(var t,i=e.tileId,r=this._container.children,n=0;n<r.length;n++)if((t=r[n]).id===i){t.updateTileData(e.tileData);break}},t.prototype.getVectorTile=function(e,t,i){return n(this,void 0,void 0,function(){var n,a,o,s,h,c,p;return r(this,function(r){switch(r.label){case 0:return n=new b(e,t,i,0),l.isSome(this._memCache)&&(a=this._memCache.get(n.id))?(a.reference(),[2,a]):[4,this._getVectorTileData(n,null)];case 1:return o=r.sent(),l.isSome(this._memCache)&&(s=this._memCache.get(n.id))?(s.reference(),[2,s]):(h=this._vectorTileLayer.tileInfo,c=h.getTileBounds(f.create(),n),p=new d.VectorTile(n,this._vectorTileLayer.styleRepository,c,[512,512]),o&&o.tileData?(p.setData(o.tileData,o.client),l.isSome(this._memCache)&&(p.reference(),this._memCache.put(p.key.id,p,p.getMemoryUsage()*p.referenced,u.MIN_PRIORITY))):p.setData(null,null),[2,p])}})})},t.prototype.releaseVectorTile=function(e){l.isNone(this._memCache)||e.release()||this._memCache.updateSize(e.key.id,e,e.getMemoryUsage()*e.referenced)},t.prototype.fetchTileData=function(e,t){return n(this,void 0,void 0,function(){var i,n,a,o;return r(this,function(r){switch(r.label){case 0:return[4,this._getRefKeys(e,t)];case 1:for(o in i=r.sent(),n=this._vectorTileLayer.sourceNameToSource,a=[],n)a.push(o);return[2,this._getSourcesData(a,i,t)]}})})},t.prototype.parseTileData=function(e,t,a){return n(this,void 0,void 0,function(){var n,s,l,u,h,c,p,f;return r(this,function(r){switch(r.label){case 0:return(n=e&&e.data)?(s=n.sourceName2DataAndRefKey,l=n.transferList,0===Object.keys(s).length?[2,null]:[4,this._broadcastPromise]):[2,null];case 1:return r.sent(),u=Math.round(y.degToByte(t)),[4,(h=this._connection.getAvailableClient()).invoke("createTileAndParse",{key:e.key.id,rotation:u,cacheTile:this.allowUpdates,sourceName2DataAndRefKey:s},i({},a,{transferList:l})).catch(function(){return h.invoke("destructTileData",e.key.id),null})];case 2:if(c=r.sent(),o("esri-vector-tiles-debug")){for(f in p={},s)p[f]=s[f].refKey;return[2,{tileData:c,client:h,refKeys:p}]}return[2,{tileData:c,client:h}]}})})},Object.defineProperty(t.prototype,"updating",{get:function(){return this._ongoingTileRequests.size>0},enumerable:!0,configurable:!0}),t.prototype.abortAll=function(){this._ongoingRequestToController.forEach(function(e){return e.abort()}),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()},t.prototype.getSprites=function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,this._spriteSourcePromise];case 1:return t.sent(),[2,this._spriteMosaic.getSpriteItems(e)]}})})},t.prototype.getGlyphs=function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)},t.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository},t.prototype._getTilePayload=function(e,t,o){return n(this,void 0,void 0,function(){var n,s,l,u;return r(this,function(r){switch(r.label){case 0:return n=b.pool.acquire(e.id),s=this._vectorTileLayer.sourceNameToSource,l=s[t],u=l.getSourceTileUrl(n.level,n.row,n.col),b.pool.release(n),[4,a(u,i({responseType:"array-buffer"},o))];case 1:return[2,{protobuff:r.sent().data,sourceName:t}]}})})},t.prototype._fetchTileMap=function(e,t){if(e.capabilities.operations.supportsTileMap&&e.tileIndex)return h.resolve();if(!e.tileMapURL)return h.resolve();var i=x.get(e.tileMapURL);if(i)return e.tileIndex=i,h.resolve();if(D.has(e.tileMapURL))return D.get(e.tileMapURL).then(function(t){e.tileIndex=new m(t.data)});var r=a(e.tileMapURL,t);return r.then(function(t){e.tileIndex=new m(t.data),D.delete(e.tileMapURL),x.put(e.tileMapURL,e.tileIndex)}),D.set(e.tileMapURL,r),r},t.prototype._getRefKeys=function(e,t){return n(this,void 0,void 0,function(){var i,n,a,o,s;return r(this,function(r){for(a in i=this._vectorTileLayer.sourceNameToSource,n=new Array,i)o=i[a],s=o.getRefKey(e,t),n.push(s);return[2,h.eachAlways(n)]})})},t.prototype._getSourcesData=function(e,t,i){return n(this,void 0,void 0,function(){var n,a,o,s,l,u,c;return r(this,function(r){switch(r.label){case 0:for(n=[],u=0;u<t.length;u++)null==t[u].value||null==e[u]?n.push(null):(a=this._getTilePayload(t[u].value,e[u],i),n.push(a));return[4,h.eachAlways(n)];case 1:for(o=r.sent(),s={},l=[],u=0;u<o.length;u++)o[u].value&&o[u].value&&o[u].value.protobuff&&o[u].value.protobuff.byteLength>0&&(c=t[u].value.id,s[o[u].value.sourceName]={refKey:c,protobuff:o[u].value.protobuff},l.push(o[u].value.protobuff));return[2,{sourceName2DataAndRefKey:s,transferList:l}]}})})},t.prototype._getVectorTileData=function(e,t){return n(this,void 0,void 0,function(){var i,n,a,o,s,l=this;return r(this,function(r){return i=e.id,this._ongoingTileRequests.has(i)?[2,this._ongoingTileRequests.get(i)]:(n=new AbortController,a={signal:n.signal},o=t&&t.signal,s=this._getParsedVectorTileData(e,a).then(function(e){return l._ongoingTileRequests.delete(i),l._ongoingRequestToController.delete(i),e}).catch(function(){return l._ongoingTileRequests.delete(i),l._ongoingRequestToController.delete(i),null}),this._ongoingTileRequests.set(i,s),this._ongoingRequestToController.set(i,n),o&&h.onAbort(o,function(){n.abort(),l._ongoingTileRequests.delete(i),l._ongoingRequestToController.delete(i)}),[2,s])})})},t.prototype._getParsedVectorTileData=function(e,t){return n(this,void 0,void 0,function(){var i;return r(this,function(r){switch(r.label){case 0:return[4,this.fetchTileData(e,t)];case 1:return i=r.sent(),[2,this.parseTileData({key:e,data:i},0,t)]}})})},t}();t.TileHandler=T}.apply(null,r))||(e.exports=n)},2193:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(43)],void 0===(n=function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e){this.type=e}}();t.RenderBucket=r;var n=function(e){function t(){var t=e.call(this,2)||this;return t.triangleElementStart=0,t.triangleElementCount=0,t}return i(t,e),t.prototype.hasData=function(){return this.triangleElementCount>0},t.prototype.triangleCount=function(){return this.triangleElementCount/3},t}(r);t.LineRenderBucket=n;var a=function(e){function t(){var t=e.call(this,1)||this;return t.triangleElementStart=0,t.triangleElementCount=0,t.outlineElementStart=0,t.outlineElementCount=0,t}return i(t,e),t.prototype.hasData=function(){return this.triangleElementCount>0||this.outlineElementCount>0},t.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3},t}(r);t.FillRenderBucket=a;var o=function(e){function t(){var t=e.call(this,3)||this;return t.iconPerPageElementsMap=new Map,t.glyphPerPageElementsMap=new Map,t.isSDF=!1,t}return i(t,e),t.prototype.hasData=function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0},t.prototype.triangleCount=function(){var e=0;return this.iconPerPageElementsMap.forEach(function(t){e+=t[1]}),this.glyphPerPageElementsMap.forEach(function(t){e+=t[1]}),e/3},t}(r);t.SymbolRenderBucket=o;var s=function(e){function t(){var t=e.call(this,4)||this;return t.triangleElementStart=0,t.triangleElementCount=0,t}return i(t,e),t.prototype.hasData=function(){return this.triangleElementCount>0},t.prototype.triangleCount=function(){return this.triangleElementCount/3},t}(r);t.CircleRenderBucket=s;var l=function(e){function t(){return e.call(this,0)||this}return i(t,e),t.prototype.hasData=function(){return!0},t.prototype.triangleCount=function(){return 2},t}(r);t.BackgroundRenderBucket=l}.apply(null,r))||(e.exports=n)},2194:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(49),i(34),i(73),i(825),i(247)],void 0===(n=function(e,t,i,r,n,a,o){var s;return n.enums.PixelFormat,n.enums.PixelType,function(){function e(e,t,r){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,!s&&i("stable-symbol-rendering")&&(s=new Set),this.width=e,this.height=t,this._glyphSource=r,this._binPack=new a(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}return e.prototype.getGlyphItems=function(e,t){for(var n=this,l=[],u=this._glyphSource,h=new Set,c=0,p=t;c<p.length;c++){var f=p[c],d=Math.floor(f*(1/256));h.add(d)}var y=[];return h.forEach(function(t){if(t<=256){var i=e+t;if(n._rangePromises.has(i))y.push(n._rangePromises.get(i));else{var r=u.getRange(e,t).then(function(){n._rangePromises.delete(i)},function(){n._rangePromises.delete(i)});n._rangePromises.set(i,r),y.push(r)}}}),r.all(y).then(function(){var r,c=n._glyphIndex[e];if(c||(c={},n._glyphIndex[e]=c),i("stable-symbol-rendering")){s.clear();for(var p=0,f=t;p<f.length;p++){var d=f[p];s.add(d)}var y=[];h.forEach(function(e){y.push(e)}),y.sort(),r=[];for(var v=0,g=y;v<g.length;v++)for(var _=g[v],m=0;m<256;++m)r.push(256*_+m)}else r=t;for(var b=0,w=r;b<w.length;b++){var x=c[d=w[b]];if(x)i("stable-symbol-rendering")&&!s.has(d)||(l[d]={sdf:!0,rect:x.rect,metrics:x.metrics,page:x.page});else{var D=u.getGlyph(e,d);if(D&&D.metrics){var T=D.metrics,P=void 0;if(0===T.width)P=new o.default(0,0,0,0);else{var S=T.width+6,B=T.height+6,I=S%4?4-S%4:4,R=B%4?4-B%4:4;1===I&&(I=5),1===R&&(R=5),(P=n._binPack.allocate(S+I,B+R)).isEmpty&&(n._dirties[n._currentPage]||(n._glyphData[n._currentPage]=null),n._currentPage=n._glyphData.length,n._glyphData.push(new Uint8Array(n.width*n.height)),n._dirties.push(!0),n._textures.push(void 0),n._binPack=new a(n.width-4,n.height-4),P=n._binPack.allocate(S+I,B+R));var C=n._glyphData[n._currentPage],O=D.bitmap,A=void 0,V=void 0;if(O)for(var M=0;M<B;M++){A=S*M,V=n.width*(P.y+M+1)+P.x;for(var j=0;j<S;j++)C[V+j+1]=O[A+j]}}c[d]={rect:P,metrics:T,tileIDs:null,page:n._currentPage},i("stable-symbol-rendering")&&!s.has(d)||(l[d]={sdf:!0,rect:P,metrics:T,page:n._currentPage}),n._dirties[n._currentPage]=!0}}}return l})},e.prototype.removeGlyphs=function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var n in i)if((r=i[n]).tileIDs.delete(e),0===r.tileIDs.size){for(var a=this._glyphData[r.page],o=r.rect,s=void 0,l=void 0,u=0;u<o.height;u++)for(s=this.width*(o.y+u)+o.x,l=0;l<o.width;l++)a[s+l]=0;delete i[n],this._dirties[r.page]=!0}}}},e.prototype.bind=function(e,t,i,r){void 0===r&&(r=0),this._textures[i]||(this._textures[i]=new n.Texture(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var a=this._textures[i];a.setSamplingMode(t),this._dirties[i]&&a.setData(this._glyphData[i]),e.bindTexture(a,r),this._dirties[i]=!1},e.prototype.dispose=function(){this._binPack=null;for(var e=0,t=this._textures;e<t.length;e++){var i=t[e];i&&i.dispose()}this._textures.length=0},e}()}.apply(null,r))||(e.exports=n)},2195:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(44),i(49),i(428),i(34)],void 0===(n=function(e,t,i,r,n,a){var o=function(){function e(e){if(this._metrics=[],this._bitmaps=[],e)for(;e.next();)switch(e.tag()){case 1:for(var t=e.getMessage();t.next();)switch(t.tag()){case 3:for(var i=t.getMessage(),r=void 0,n=void 0,a=void 0,o=void 0,s=void 0,l=void 0,u=void 0;i.next();)switch(i.tag()){case 1:r=i.getUInt32();break;case 2:n=i.getBytes();break;case 3:a=i.getUInt32();break;case 4:o=i.getUInt32();break;case 5:s=i.getSInt32();break;case 6:l=i.getSInt32();break;case 7:u=i.getUInt32();break;default:i.skip()}i.release(),r&&(this._metrics[r]={width:a,height:o,left:s,top:l,advance:u},this._bitmaps[r]=n);break;default:t.skip()}t.release();break;default:e.skip()}}return e.prototype.getMetrics=function(e){return this._metrics[e]},e.prototype.getBitmap=function(e){return this._bitmaps[e]},e}(),s=function(){function e(){this._ranges=[]}return e.prototype.getRange=function(e){return this._ranges[e]},e.prototype.addRange=function(e,t){this._ranges[e]=t},e}();return function(){function e(e){this._glyphInfo={},this._baseURL=e}return e.prototype.getRange=function(e,t){var s=this._getFontStack(e);if(r("stable-symbol-rendering")&&t>0)return s.addRange(t,new o),a.resolve();if(s.getRange(t))return a.resolve();var l=256*t,u=l+255,h=this._baseURL.replace("{fontstack}",e).replace("{range}",l+"-"+u);return i(h,{responseType:"array-buffer"}).then(function(e){s.addRange(t,new o(new n(new Uint8Array(e.data),new DataView(e.data))))}).catch(function(){s.addRange(t,new o)})},e.prototype.getGlyph=function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var n=i.getRange(r);if(n)return{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}}}},e.prototype._getFontStack=function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new s),t},e}()}.apply(null,r))||(e.exports=n)},2196:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(73),i(825),i(247)],void 0===(n=function(e,t,i,r,n){return i.enums.PixelFormat,i.enums.PixelType,function(){function e(e,t,i){void 0===i&&(i=0),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(e<=0||t<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,i>0&&(this._maxItemSize=i),this._binPack=new r(e-4,t-4)}return e.prototype.getWidth=function(e){return e>=this._size.length?-1:this._size[e][0]},e.prototype.getHeight=function(e){return e>=this._size.length?-1:this._size[e][1]},e.prototype.setSpriteSource=function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new r(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),n=new Uint32Array(t*i);this._mosaicsData[0]=n,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e},e.prototype.getSpriteItem=function(e,t){void 0===t&&(t=!1);var i=this._mosaicRects[e];if(i)return i;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;var r=this._sprites.getSpriteInfo(e);if(!r||!r.width||!r.height||r.width<0||r.height<0)return null;var n=r.width,a=r.height,o=this._allocateImage(n,a),s=o[0],l=o[1],u=o[2];return s.width<=0?null:(this._copy(s,r,l,u,t),i={rect:s,width:n,height:a,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:l},this._mosaicRects[e]=i,i)},e.prototype.preloadSpriteItems=function(){for(var e=0,t=this._sprites.spriteNames;e<t.length;e++){var i=t[e];this.getSpriteItem(i,!0)}},e.prototype.getSpriteItems=function(e){for(var t={},i=0,r=e;i<r.length;i++){var n=r[i];t[n]=this.getSpriteItem(n)}return t},e.prototype.getMosaicItemPosition=function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var n=i.width,a=i.height;return{size:[i.width,i.height],tl:[(r.x+2)/this._size[i.page][0],(r.y+2)/this._size[i.page][1]],br:[(r.x+2+n)/this._size[i.page][0],(r.y+2+a)/this._size[i.page][1]],page:i.page}},e.prototype.bind=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this._textures[r]||(this._textures[r]=new i.Texture(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[r][0],height:this._size[r][1]},new Uint8Array(this._mosaicsData[r].buffer)));var a=this._textures[r];a.setSamplingMode(t),this._dirties[r]&&a.setData(new Uint8Array(this._mosaicsData[r].buffer)),e.bindTexture(a,n),this._dirties[r]=!1},e._copyBits=function(e,t,i,r,n,a,o,s,l,u,h){var c=r*t+i,p=s*a+o;if(h){p-=a;for(var f=-1;f<=u;c=((++f+u)%u+r)*t+i,p+=a)for(var d=-1;d<=l;d++)n[p+d]=e[c+(d+l)%l]}else for(f=0;f<u;f++){for(d=0;d<l;d++)n[p+d]=e[c+d];c+=t,p+=a}},e.prototype._copy=function(t,i,r,n,a,o){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var s=new Uint32Array(o?o.buffer:this._sprites.image.buffer),l=this._mosaicsData[r];l&&s||console.error("Source or target images are uninitialized!");var u=o?i.width:this._sprites.width;e._copyBits(s,u,i.x,i.y,l,n[0],t.x+2,t.y+2,i.width,i.height,a),this._dirties[r]=!0}},e.prototype._allocateImage=function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var a=new n.default(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[a,this._mosaicsData.length-1,[e,t]]}var o=e%4?4-e%4:4,s=t%4?4-t%4:4;1===o&&(o=5),1===s&&(s=5);var l=this._binPack.allocate(e+o,t+s);return l.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new r(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[l,this._currentPage,[this._pageWidth,this._pageHeight]]},e.prototype.dispose=function(){this._binPack=null,this._mosaicRects={};for(var e=0,t=this._textures;e<t.length;e++){var i=t[e];i&&i.dispose()}this._textures.length=0},e}()}.apply(null,r))||(e.exports=n)},2197:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(43),i(35),i(31),i(32),i(107),i(40),i(34),i(92),i(73),i(98),i(824),i(2198),i(84),i(103),i(351),i(342),i(161)],void 0===(n=function(e,t,i,r,n,a,o,s,l,u,h,c,p,f,d,y,v,g,_){Object.defineProperty(t,"__esModule",{value:!0});var m=(h.enums.BlendFactor,h.enums.CompareFunction,h.enums.StencilOperation,function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._backgroundTiles=[],r._fadeRecorder=new f.FadeRecorder(400),r._pointToCallbacks=new Map,r._parsedDataQueue=new Map,r}return i(t,e),t.prototype.destroy=function(){this.removeAllChildren(),this.children.forEach(function(e){return e.destroy()})},t.prototype.dispose=function(){this._spriteMosaic&&this._spriteMosaic.dispose(),this._glyphMosaic&&this._glyphMosaic.dispose(),e.prototype.dispose.call(this)},t.prototype.setStyleResources=function(e,t,i){this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=i},t.prototype.hitTest=function(e,t){return a(this,void 0,void 0,function(){var i,r;return n(this,function(n){return i=[e,t],r=l.createResolver(),this._pointToCallbacks.set(i,r),this.requestRender(),[2,r.promise]})})},t.prototype.setTileData=function(e,t){var i=this.stage;return i.dataUploadCounter<d.MAX_GPU_UPLOADS_PER_FRAME&&t?(e.setData(t.tileData,t.client,t.refKeys),void i.dataUploadCounter++):t?void this._parsedDataQueue.set(e,t):void e.setData(null,null)},t.prototype.createRenderParams=function(t){return r({},e.prototype.createRenderParams.call(this,t),{renderPass:null,styleLayer:null,styleLayerId:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,fadeRecorder:this._fadeRecorder,hasClipping:!!this._clippingInfos})},t.prototype.doRender=function(t){!this.visible||t.drawPhase!==y.WGLDrawPhase.MAP&&t.drawPhase!==y.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||e.prototype.doRender.call(this,t)},t.prototype.createTile=function(e){var t=this._tileInfoView.getTileBounds(u.create(),e),i=new p.VectorTile(e,this._styleRepository,t,[512,512]);return i.rotation=this.stage.state.rotation,i},t.prototype.destroyTile=function(e){e.destroy()},t.prototype.removeChild=function(t){return this._parsedDataQueue.has(t)&&this._parsedDataQueue.delete(t),e.prototype.removeChild.call(this,t)},t.prototype.renderChildren=function(t){if(t.drawPhase!==y.WGLDrawPhase.DEBUG){var i=this.stage;if(this._parsedDataQueue.size>0&&i.dataUploadCounter<d.MAX_GPU_UPLOADS_PER_FRAME)for(var r=o.pairsOfMap(this._parsedDataQueue),n=0;n<r.length&&i.dataUploadCounter<d.MAX_GPU_UPLOADS_PER_FRAME;n++){var a=r[n][0],s=r[n][1];a.setData(s.tileData,s.client,s.refKeys),this._parsedDataQueue.delete(a),i.dataUploadCounter++}if(this._fadeRecorder.recordLevel(t.displayLevel),this._doRender(t),(this._parsedDataQueue.size>0||this._fadeRecorder.needsRedraw())&&this.requestRender(),this._pointToCallbacks.size>0){var l=t.context,u=l.getBoundFramebufferObject();t.drawPhase=y.WGLDrawPhase.HITTEST;var h=t.painter.effects.hittest;h.bind(t),this._doRender(t),h.draw(t,this._pointToCallbacks,6),l.bindFramebuffer(u)}}else e.prototype.renderChildren.call(this,t)},t.prototype.removeAllChildren=function(){this._parsedDataQueue.clear();for(var t=0;t<this.children.length;t++)this.children[t].dispose();e.prototype.removeAllChildren.call(this)},t.prototype._doRender=function(t){var i=t.context,r=this._styleRepository,n=r.layers;r.backgroundBucketIds.length>0&&(t.renderPass="background",this._renderBackgroundLayers(t,r.backgroundBucketIds)),e.prototype.renderChildren.call(this,t);for(var a=this.children.filter(function(e){return e.visible}),o=0,s=a;o<s.length;o++){var l=s[o];l.triangleCount=0,l.commitChanges()}i.setStencilWriteMask(0),i.setColorMask(!0,!0,!0,!0),i.setStencilOp(7680,7680,7681),i.setStencilTestEnabled(!0),i.setBlendingEnabled(!1),i.setDepthTestEnabled(!0),i.setDepthWriteEnabled(!0),i.setDepthFunction(515),i.setClearDepth(1),i.clear(i.gl.DEPTH_BUFFER_BIT),t.renderPass="opaque";for(var u=n.length-1;u>=0;u--)this._renderStyleLayer(u,t,a);i.setDepthWriteEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(1,771,1,771),t.renderPass="translucent";for(u=0;u<n.length;u++)this._renderStyleLayer(u,t,a);i.setDepthTestEnabled(!1),t.renderPass="symbol";for(u=0;u<n.length;u++)this._renderStyleLayer(u,t,a);i.bindVAO(),i.setStencilTestEnabled(!0)},t.prototype._renderStyleLayer=function(e,t,i){var r=t.painter,n=t.renderPass,a=this._styleRepository.layers[e];if(void 0!==a){var o;switch(a.type){case 0:return;case 1:if("opaque"!==n&&"translucent"!==t.renderPass)return;o="vtlFill";break;case 2:if("translucent"!==n)return;o="vtlLine";break;case 4:if("symbol"!==n)return;o="vtlCircle";break;case 3:if("symbol"!==n)return;o="vtlSymbol"}var s=t.displayLevel;if(!(0===i.length||void 0!==a.minzoom&&a.minzoom>=s+1e-6||void 0!==a.maxzoom&&a.maxzoom<s-1e-6)){t.styleLayerId=e,t.styleLayer=a;for(var l=0,u=i;l<u.length;l++)if(u[l].layerData[e]){r.renderObjects(t,i,o);break}}}},t.prototype._renderBackgroundLayers=function(e,t){var i=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),r=i.spans,n=i.lodInfo,a=n.level,o=this._styleRepository,l=e.context,h=e.displayLevel,c=e.painter,p=e.state,f=u.create(),d=[];if(this._renderPasses){var y=this._renderPasses[0];s.isSome(this._clippingInfos)&&(y.brushes[0].prepareState(e,this._clippingInfos[0]),y.brushes[0].drawMany(e,this._clippingInfos))}for(var m,b=this._backgroundTiles,w=0,x=0,D=r;x<D.length;x++)for(var T=D[x],P=T.row,S=T.colFrom,B=T.colTo,I=S;I<=B;I++){if(w<b.length)(m=b[w]).key.set(a,P,n.normalizeCol(I),n.getWorldForColumn(I)),this._tileInfoView.getTileBounds(f,m.key,!1),m.bounds=f,m.coords[0]=f[0],m.coords[1]=f[3];else{var R=new _(a,P,n.normalizeCol(I),n.getWorldForColumn(I));m=new v.TiledDisplayObject(R,this._tileInfoView.getTileBounds(u.create(),R),[512,512],[4096,4096]),b.push(m)}m.setTransform(p,this._tileInfoView.getTileResolution(m.key)),d.push(m),w++}l.setStencilWriteMask(0),l.setColorMask(!0,!0,!0,!0),l.setStencilOp(7680,7680,7681),l.setStencilFunction(514,0,255),l.setStencilTestEnabled(!0);for(var C=0,O=t;C<O.length;C++){var A=O[C],V=o.layers[A];!V||void 0!==V.minzoom&&V.minzoom>=h+1e-6||void 0!==V.maxzoom&&V.maxzoom<h-1e-6||(e.styleLayerId=A,e.styleLayer=V,c.renderObjects(e,d,"vtlBackground"))}g.pool.release(i)},t}(c.TileContainer));t.VectorTileContainer=m}.apply(null,r))||(e.exports=n)},2198:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(219)],void 0===(n=function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,i,r){this.fadeSpeed=e,this.minfadeLevel=t,this.maxfadeLevel=i,this.fadeChange=r}}();t.FadeProperties=r;var n=function(){function e(e,t){void 0===e&&(e=300),void 0===t&&(t=!1),this._levelSnapshots=[],this._duration=e,this._ignoreSpeed=t}return e.prototype.recordLevel=function(e){var t=i(),r=this._levelSnapshots;0===r.length&&(r.push({level:e,now:0}),r.push({level:e,now:0})),2!==r.length&&r[0].level===e||r.push({level:e,now:t})},e.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var e=this._duration,t=this._levelSnapshots,i=t.length,r=t[i-1],n=-1;i>n+1&&t[n+1].now+e<r.now;)n++;for(n<0&&(n=0);n<i;n++)if(t[n].level!==r.level)return!0;return!1},e.prototype.getFadeValues=function(){for(var e=this._duration,t=i(),r=this._levelSnapshots;r.length>3&&r[1].now+e<t;)r.shift();r[1].now+e<t&&(r[0].level=r[1].level);var n=r[0].level,a=r[r.length-1],o=a.level,s=Math.min(n,o),l=Math.max(n,o),u=(a.level-r[1].level)/((a.now-r[1].now)/e),h=(t-a.now)/e*u;return this._ignoreSpeed?{fadeSpeed:0,minfadeLevel:s,maxfadeLevel:l,fadeChange:0}:{fadeSpeed:u,minfadeLevel:s,maxfadeLevel:l,fadeChange:h}},e}();t.FadeRecorder=n}.apply(null,r))||(e.exports=n)},2199:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(43),i(28),i(138),i(244),i(161)],void 0===(n=function(e,t,i,r,n,a,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._fullCacheLodInfos=null,t._levelByScale={},t}return i(t,e),t.prototype.getTileParentId=function(e){var t=o.pool.acquire(e),i=0===t.level?null:o.getId(t.level-1,t.row>>1,t.col>>1,t.world);return o.pool.release(t),i},t.prototype.getTileCoverage=function(t,i,r){var n=e.prototype.getTileCoverage.call(this,t,i,r);if(!n)return n;var a=1<<n.lodInfo.level;return n.spans=n.spans.filter(function(e){return e.row>=0&&e.row<a}),n},t.prototype.scaleToLevel=function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t=this._fullCacheLodInfos;if(e>t[0].scale)return t[0].level;for(var i=void 0,r=void 0,n=0;n<t.length-1;n++)if(e>(r=t[n+1]).scale)return(i=t[n]).level+(i.scale-e)/(i.scale-r.scale);return t[t.length-1].level},t.prototype._initializeFullCacheLODs=function(e){var t;if(0===e[0].level)t=e.map(function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}});else{var i=this.tileInfo.size[0],r=this.tileInfo.spatialReference;t=n.create({size:i,spatialReference:r}).lods.map(function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}})}for(var a=0;a<t.length;a++)this._levelByScale[t[a].scale]=t[a].level;this._fullCacheLodInfos=t},t}(a)}.apply(null,r))||(e.exports=n)},230:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(35),i(29),i(28),i(31),i(32),i(44),i(47),i(36),i(82),i(37),i(354),i(260),i(34),i(146),i(39),i(56),i(30),i(296)],void 0===(n=function(e,t,i,r,n,a,o,s,l,u,h,c,p,f,d,y,v,g,_,m){Object.defineProperty(t,"__esModule",{value:!0}),t.TILEMAP_SIZE_EXP=5;var b=c.getLogger("esri.layers.support.TilemapCache"),w=function(e){function l(t){var i=e.call(this,t)||this;return i._handles=new h,i._pendingTilemapRequests={},i._availableLevels={},i.levels=5,i.cacheByteSize=2097152,i.request=s,i._prefetchingEnabled=!0,i}var c;return r(l,e),c=l,l.prototype.initialize=function(){var e=this;this._tilemapCache=new p(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],function(){return e._initializeTilemapDefinition()}),g.init(this,"layer.tileInfo.lods",function(t){return e._initializeAvailableLevels(t)},!0)]),this._initializeTilemapDefinition()},l.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},l.prototype.castLevels=function(e){return e<=2?(b.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(l.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0}),l.prototype.fetchTilemap=function(e,t,r,n){var a=this;if(!this._availableLevels[e])return d.reject(new u("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var o=this._tmpTilemapDefinition,s=this._tilemapFromCache(e,t,r,o);if(s)return d.resolve(s);var l=n&&n.signal;return n=i({},n,{signal:null}),d.create(function(e,t){d.onAbort(l,function(){return t(d.createAbortError())});var i=m.tilemapDefinitionId(o),r=a._pendingTilemapRequests[i];if(!r){r=m.Tilemap.fromDefinition(o,n).then(function(e){return a._tilemapCache.put(i,e,e.byteSize),e});var s=function(){return delete a._pendingTilemapRequests[i]};a._pendingTilemapRequests[i]=r,r.then(s,s)}r.then(e,t)})},l.prototype.getAvailability=function(e,t,i){if(!this._availableLevels[e])return"unavailable";var r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"},l.prototype.getAvailabilityUpsample=function(e,t,i,r){r.level=e,r.row=t,r.col=i;var n=this.layer.tileInfo;for(n.updateTileInfo(r);;){var a=this.getAvailability(r.level,r.row,r.col);if("unavailable"!==a)return a;if(!n.upsampleTile(r))return"unavailable"}},l.prototype.fetchAvailability=function(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch(function(e){return e}).then(function(r){if(r instanceof m.Tilemap){var n=r.getAvailability(t,i);return"unavailable"===n?d.reject(new u("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):n}if(d.isAbortError(r))throw r;return"unknown"}):d.reject(new u("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},l.prototype.fetchAvailabilityUpsample=function(e,t,i,r,n){var a=this;r.level=e,r.row=t,r.col=i;var o=this.layer.tileInfo;o.updateTileInfo(r);var s=this.fetchAvailability(e,t,i,n).catch(function(e){if(d.isAbortError(e))throw e;if(o.upsampleTile(r))return a.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e});return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,n,s),s},l.prototype._fetchAvailabilityUpsamplePrefetch=function(e,t,r,n,s,l){return o(this,void 0,void 0,function(){var o,u,h,p,f,v,g,_,m,b;return a(this,function(a){switch(a.label){case 0:if(!this._prefetchingEnabled)return[2];if(o="prefetch-"+e,this._handles.has(o))return[2];u=d.createAbortController(),l.then(function(){return u.abort()},function(){return u.abort()}),h=!1,p={remove:function(){h||(h=!0,u.abort())}},this._handles.add(p,o),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,y.waitTicks(10,u.signal)];case 2:return a.sent(),[3,4];case 3:return a.sent(),[3,4];case 4:if(h||(h=!0,this._handles.remove(o)),d.isAborted(u))return[2];for(f={id:e,level:t,row:r,col:n},v=i({},s,{signal:u.signal}),g=this.layer.tileInfo,_=function(e){var t=m.fetchAvailability(f.level,f.row,f.col,v);c._prefetches.push(t);var i=function(){c._prefetches.removeUnordered(t)};t.then(i,i)},m=this,b=0;c._prefetches.length<c._maxPrefetch&&g.upsampleTile(f);++b)_();return[2]}})})},l.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?v.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},l.prototype._tilemapFromCache=function(e,t,i,r){var n=this._getTilemapDefinition(e,t,i,r),a=m.tilemapDefinitionId(n);return this._tilemapCache.get(a)},l.prototype._getTilemapDefinition=function(e,i,r,n){n.level=e;var a=e>t.TILEMAP_SIZE_EXP;return n.row=a?i-i%this.size:i,n.col=a?r-r%this.size:r,n},l.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach(function(e){return t._availableLevels[e.level]=!0})},Object.defineProperty(l.prototype,"test",{get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,i,r){return!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0}),l._maxPrefetch=4,l._prefetches=new f({initialSize:c._maxPrefetch}),n([_.property({constructOnly:!0,type:Number})],l.prototype,"levels",void 0),n([_.cast("levels")],l.prototype,"castLevels",null),n([_.property({readOnly:!0,dependsOn:["levels"],type:Number})],l.prototype,"size",null),n([_.property({constructOnly:!0,type:Number})],l.prototype,"cacheByteSize",void 0),n([_.property({constructOnly:!0})],l.prototype,"layer",void 0),n([_.property({constructOnly:!0})],l.prototype,"request",void 0),c=n([_.subclass("esri.layers.support.TilemapCache")],l)}(_.declared(l));t.TilemapCache=w}.apply(null,r))||(e.exports=n)},296:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(35),i(44),i(136),i(36),i(38)],void 0===(n=function(e,t,i,r,n,a,o){function s(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var i=e.service.tileServers;t=(i&&i.length?i[e.row%i.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var r=e.service.query;return r&&(t=t+"?"+r),t}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return e.prototype.getAvailability=function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i%8,n=i>>3,a=this._tileAvailabilityBitSet;return n<0||n>a.length?"unknown":a[n]&1<<r?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=this.location.width,i=this.location.height,r=!0,n=!0,a=Math.ceil(t*i/8),o=new Uint8Array(a),s=0,l=0;l<e.length;l++){var u=l%8;e[l]?(n=!1,o[s]|=1<<u):r=!1,7===u&&++s}n?this._allAvailability="unavailable":r?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=o,this.byteSize+=o.length)},e.fromDefinition=function(t,o){var l=t.service.request||r,u=t.row,h=t.col,c=t.width,p=t.height,f={query:{f:"json"}};return o=o?i({},f,o):f,l(s(t),o).then(function(e){return e.data}).catch(function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:u,left:h,width:c,height:p},valid:!0,data:n.constant(c*p,0)};throw e}).then(function(t){if(t.location&&(t.location.top!==u||t.location.left!==h||t.location.width!==c||t.location.height!==p))throw new a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:u,left:h,width:c,height:p}});return e.fromJSON(t)})},e.fromJSON=function(t){e.validateJSON(t);var i=new e;return i.location=Object.freeze(o.clone(t.location)),i._updateFromData(t.data),Object.freeze(i)},e.validateJSON=function(e){if(!e||!e.location)throw new a("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new a("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new a("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new a("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();t.Tilemap=l,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=s,t.default=l}.apply(null,r))||(e.exports=n)},57:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(28),i(29),i(33),i(30)],void 0===(n=function(e,t,i,r,n,a){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),i([a.subclass("esri.views.layers.support.ClipArea")],t)}(a.declared(n.JSONSupport))}.apply(null,r))||(e.exports=n)},604:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(34),i(230),i(161)],void 0===(n=function(e,t,i,r,n){return function(){function e(e){if(e instanceof r.TilemapCache)this._tilemapCache=e;else{if(!(e&&"index"in e))throw new Error("Invalid tilemap!");this._tilemap=e.index}}return e.prototype.dataKey=function(e,t){if(this._tilemapCache){var r=e.level,a=e.row,o=e.col,s=new n(e);return this._tilemapCache.fetchAvailabilityUpsample(r,a,o,s,t).then(function(){return s}).catch(function(e){if(i.isAbortError(e))throw e;return s.level=r,s.row=a,s.col=o,s})}return this._getIndexedDataKey(e)},e.prototype.forEach=function(e,t,i,r,n){this._callback=n,this._maxLevel=t+e,this._forEach(this._tilemap,t,i,r)},e.prototype._forEach=function(e,t,i,r){0!==e&&(this._callback(t,i,r),t!==this._maxLevel&&"object"==typeof e&&(this._forEach(e[0],t+1,2*i,2*r),this._forEach(e[1],t+1,2*i,2*r+1),this._forEach(e[2],t+1,2*i+1,2*r),this._forEach(e[3],t+1,2*i+1,2*r+1)))},e.prototype._getIndexedDataKey=function(e){var t=[e];if(e.level<0||e.row<0||e.col<0||e.row>>e.level>0||e.col>>e.level>0)return i.resolve(null);for(var r=e;0!==r.level;)r=new n(r.level-1,r.row>>1,r.col>>1,r.world),t.push(r);var a,o,s=this._tilemap,l=t.pop();if(1===s)return i.resolve(l);for(;t.length;)if(o=(1&(a=t.pop()).col)+((1&a.row)<<1),s){if(0===s[o]){l=null;break}if(1===s[o]){l=a;break}l=a,s=s[o]}return i.resolve(l)},e}()}.apply(null,r))||(e.exports=n)},824:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(43),i(219),i(73),i(2193),i(351)],void 0===(n=function(e,t,i,r,n,a,o){Object.defineProperty(t,"__esModule",{value:!0});var s=(n.enums.Usage,function(e){function t(t,i,r,n){var a=e.call(this,t,r,n,[4096,4096])||this;return a._referenced=0,a._symbolFadeHold=null,a._vectorTileData=null,a._setData=!1,a._symbolUpdateData=null,a._memoryUsed=l,a.rotation=0,a.layerData={},a.status="loading",a._referenced=1,a.styleLayers=i,a.id=t.id,a}return i(t,e),Object.defineProperty(t.prototype,"hasSymbolBuckets",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHoldingForFade",{get:function(){return null!==this._symbolFadeHold},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSymbolFadeDone",{get:function(){return!this._symbolFadeHold||this._symbolFadeHold<r()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status},enumerable:!0,configurable:!0}),t.prototype.setData=function(e,t,i){this._vectorTileData=e,this.client=t,this.refKeys=i,this._memoryUsed=l,this.ready(),this._setData=!0},t.prototype.updateSymbolData=function(e){e&&(this._symbolUpdateData=e,this.requestRender())},t.prototype.updateTileData=function(e){this._vectorTileData=e,this.stage.requestRender(),this._memoryUsed=l},t.prototype.clearSymbolFadeHold=function(){this._symbolFadeHold=null},t.prototype.setSymbolHoldDuration=function(e){this._symbolFadeHold=r()+e},t.prototype.hasData=function(){return Object.keys(this.layerData).length>0},t.prototype.dispose=function(){this._deleteBufferMemory(),this.destroy(),this._memoryUsed=l},t.prototype.release=function(){return 0==--this._referenced&&(this.dispose(),this.attached=!1,this.stage=null,!0)},t.prototype.reference=function(){++this._referenced},Object.defineProperty(t.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0}),t.prototype.getMemoryUsage=function(){var e=this;return this._memoryUsed===l&&(this._memoryUsed=u.reduce(function(t,i){return e[i]?t+e[i].size:t},0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce(function(e,t){return e+t.byteLength},this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength))),this._memoryUsed/(this._referenced||1)},t.prototype.commitChanges=function(){if(this._vectorTileData||this._symbolUpdateData)return this._vectorTileData?(this._deleteBufferMemory(),this._createRenderBuckets(),this._createBufferObjects(),void(this._vectorTileData=null)):void(this._symbolUpdateData&&(this._updateSymbolData(this._symbolUpdateData),this._symbolUpdateData=null))},t.prototype._deleteBufferMemory=function(){for(var e=0,t=["fillVertexArrayObject","fillDDVertexArrayObject","outlineVertexArrayObject","lineVertexArrayObject","lineDDVertexArrayObject","iconVertexArrayObject","iconDDVertexArrayObject","textVertexArrayObject","textDDVertexArrayObject","circleVertexArrayObject","fillVertexBuffer","fillDDVertexBuffer","fillIndexBuffer","outlineVertexBuffer","outlineDDVertexBuffer","outlineIndexBuffer","lineVertexBuffer","lineDDVertexBuffer","lineIndexBuffer","iconVertexBuffer","iconDDVertexBuffer","iconIndexBuffer","textVertexBuffer","textDDVertexBuffer","textIndexBuffer","circleVertexBuffer","circleIndexBuffer","texture"];e<t.length;e++){var i=t[e];this[i]&&(this[i].dispose(),this[i]=null)}this.layerData={},this.triangleCount=0},t.prototype._createRenderBuckets=function(){for(var e=new Uint32Array(this._vectorTileData.bucketDataInfo),t=e.length,i=0;i<t;){var r=e[i];switch(e[i+1]){case 0:(new a.BackgroundRenderBucket).layerID=r,i+=2;break;case 1:var n=new a.FillRenderBucket;n.layerID=r,n.triangleElementStart=e[i+2],n.triangleElementCount=e[i+3],n.outlineElementStart=e[i+4],n.outlineElementCount=e[i+5],0===n.triangleElementCount&&0===n.outlineElementCount||(this.layerData[r]=n),i+=6;break;case 2:var o=new a.LineRenderBucket;o.layerID=r,o.triangleElementStart=e[i+2],o.triangleElementCount=e[i+3],o.triangleElementCount>0&&(this.layerData[r]=o),i+=4;break;case 3:var s=new a.SymbolRenderBucket;s.layerID=r,s.isSDF=0!==e[i+2];var l=i+3,u=e[l];l++;for(var h=0;h<u;h++){var c=e[l],p=e[l+1],f=e[l+2];s.iconPerPageElementsMap.set(c,[p,f]),l+=3}var d=l,y=e[d];d++;for(h=0;h<y;h++){c=e[d],p=e[d+1],f=e[d+2];s.glyphPerPageElementsMap.set(c,[p,f]),d+=3}(s.iconPerPageElementsMap.size>0||s.glyphPerPageElementsMap.size>0)&&(this.layerData[r]=s),i+=5+3*u+3*y;break;case 4:var v=new a.CircleRenderBucket;v.layerID=r,v.triangleElementStart=e[i+2],v.triangleElementCount=e[i+3],v.triangleElementCount>0&&(this.layerData[r]=v),i+=4;break;default:console.error("Bad bucket type!"),i+=2}}},t.prototype.attach=function(){return this._setData},t.prototype.attachWithContext=function(e){this.stage={context:e},this.attached=this.attach()},t.prototype.detach=function(){this.isReady&&this.client&&this.client.invoke("destructTileData",this.id),this.dispose(),e.prototype.detach.call(this)},t.prototype._updateSymbolData=function(e){if(!e||!e.bucketDataInfo)return!0;var t=new Uint32Array(e.bucketDataInfo),i=t.length;if(0===i)return!0;if(!this.isReady)return this.requestRender(),!1;for(var r=this.stage.context,o=new Uint32Array(e.bufferDataInfo),s=o.length,l=0,u=0;u<s;u+=2,l++)switch(o[u]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null),this.iconVertexBuffer=n.BufferObject.createVertex(r,35044,e.bufferData[l]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null),this.iconDDVertexBuffer=n.BufferObject.createVertex(r,35044,e.bufferData[l]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null),this.iconIndexBuffer=n.BufferObject.createIndex(r,35044,e.bufferData[l]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null),this.textVertexBuffer=n.BufferObject.createVertex(r,35044,e.bufferData[l]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null),this.textDDVertexBuffer=n.BufferObject.createVertex(r,35044,e.bufferData[l]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=n.BufferObject.createIndex(r,35044,e.bufferData[l])}var h={};for(var c in this.layerData)3!==this.layerData[c].type&&(h[c]=this.layerData[c]);this.layerData=h;for(var p,f=this.styleLayers.layers,d=0;d<i;){c=t[d];(p=new a.SymbolRenderBucket).layerID=c,p.isSDF=0!==t[d+2],f.length>p.layerID&&f[p.layerID].type===p.type&&(h[p.layerID]=p);var y=d+3,v=t[y];y++;for(var g=0;g<v;g++){var _=t[y],m=t[y+1],b=t[y+2];p.iconPerPageElementsMap.set(_,[m,b]),y+=3}var w=y,x=t[w];w++;for(g=0;g<x;g++){_=t[w],m=t[w+1],b=t[w+2];p.glyphPerPageElementsMap.set(_,[m,b]),w+=3}d+=5+3*v+3*x}return this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null),this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null),this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null),this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null),!0},t._createBufferToObject=function(){var e=[];return e[1]={create:n.BufferObject.createVertex,var:"fillVertexBuffer"},e[2]={create:n.BufferObject.createVertex,var:"fillDDVertexBuffer"},e[3]={create:n.BufferObject.createIndex,var:"fillIndexBuffer"},e[4]={create:n.BufferObject.createVertex,var:"outlineVertexBuffer"},e[5]={create:n.BufferObject.createVertex,var:"outlineDDVertexBuffer"},e[6]={create:n.BufferObject.createIndex,var:"outlineIndexBuffer"},e[7]={create:n.BufferObject.createVertex,var:"lineVertexBuffer"},e[8]={create:n.BufferObject.createVertex,var:"lineDDVertexBuffer"},e[9]={create:n.BufferObject.createIndex,var:"lineIndexBuffer"},e[10]={create:n.BufferObject.createVertex,var:"iconVertexBuffer"},e[11]={create:n.BufferObject.createVertex,var:"iconDDVertexBuffer"},e[12]={create:n.BufferObject.createIndex,var:"iconIndexBuffer"},e[13]={create:n.BufferObject.createVertex,var:"textVertexBuffer"},e[14]={create:n.BufferObject.createVertex,var:"textDDVertexBuffer"},e[15]={create:n.BufferObject.createIndex,var:"textIndexBuffer"},e[16]={create:n.BufferObject.createVertex,var:"circleVertexBuffer"},e[17]={create:n.BufferObject.createIndex,var:"circleIndexBuffer"},e},t.prototype._createBufferObjects=function(){for(var e=this.stage.context,i=new Uint32Array(this._vectorTileData.bufferDataInfo),r=i.length,n=0;n<r;n+=2){var a=n/2;if(!(i[n+1]<=0||0===this._vectorTileData.bufferData[a].byteLength)){var o=i[n],s=t.bufferToObject[o];s?this[s.var]?this[s.var].setData(this._vectorTileData.bufferData[a]):this[s.var]=s.create(e,35044,this._vectorTileData.bufferData[a]):console.error("Bad buffer type "+o)}}},t.bufferToObject=t._createBufferToObject(),t}(o.TiledDisplayObject));t.VectorTile=s;var l=-1,u=["fillVertexBuffer","fillDDVertexBuffer","fillIndexBuffer","outlineVertexBuffer","outlineDDVertexBuffer","outlineIndexBuffer","lineVertexBuffer","lineDDVertexBuffer","lineIndexBuffer","iconVertexBuffer","iconDDVertexBuffer","iconIndexBuffer","textVertexBuffer","textDDVertexBuffer","textIndexBuffer","circleVertexBuffer","circleIndexBuffer"]}.apply(null,r))||(e.exports=n)},825:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(247)],void 0===(n=function(e,t,i){return function(){function e(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new i.default(0,0,e,t))}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.allocate=function(e,t){if(e>this._width||t>this._height)return new i.default;for(var r=null,n=-1,a=0;a<this._free.length;++a){var o=this._free[a];e<=o.width&&t<=o.height&&(null===r||o.y<=r.y&&o.x<=r.x)&&(r=o,n=a)}return null===r?new i.default:(this._free.splice(n,1),r.width<r.height?(r.width>e&&this._free.push(new i.default(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new i.default(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new i.default(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new i.default(r.x,r.y+t,e,r.height-t))),new i.default(r.x,r.y,e,t))},e.prototype.release=function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)},e}()}.apply(null,r))||(e.exports=n)}}]);